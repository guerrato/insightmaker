if("undefined"==typeof window||!window){const{JSDOM:t}=require("jsdom");window=new t("",{url:"http://localhost",referrer:"http://localhost",contentType:"text/html",includeNodeLocations:!1,storageQuota:1e7,userAgent:"Chrome/87.0.4280.141"}).window;document=window.document;DOMParser=window.DOMParser;navigator=window.navigator;location=window.location;importScripts=window.importScripts}const is_owner=!0;function isLocal(){return"localhost"==document.location.hostname||"insightmaker.test"==document.location.hostname||"calc.test"==document.location.hostname}var translations={};function getText(t){translations[t]&&(t=translations[t]);for(var e=1;e<arguments.length;e++)t=t.replace("%s",arguments[e]);return t}function SimpleNode(){}SimpleNode.prototype.getAttribute=function(t){return this["@attributes"][t]};SimpleNode.prototype.setAttribute=function(t,e){this["@attributes"][t]=""+e};function loadXML(t){var e=new DOMParser;(graph=mxGraphToJson(graph=e.parseFromString(t,"text/xml"))).children[0].value={nodeName:"root",id:1};graph.children[0].id=1;clearPrimitiveCache();var i=findType(["Flow","Link","Transition"]),n=primitives();i.forEach((function(t){t.source=null;t.target=null;n.forEach((function(e){t.children[0].getAttribute("source")&&t.children[0].getAttribute("source")==e.id&&(t.source=e);t.children[0].getAttribute("target")&&t.children[0].getAttribute("target")==e.id&&(t.target=e)}))}));clearPrimitiveCache();!function t(e){if(e.children){var i=e.children.filter((function(t){return"mxCell"==t.value.nodeName}));i.length>0&&i[0].getAttribute("parent")&&setParent(e,findID(i[0].getAttribute("parent")));e.children=e.children.filter((function(t){return"mxCell"!=t.value.nodeName}));for(var n=e.children.length-1;n>=0;n--)t(e.children[n])}}(graph);clearPrimitiveCache();return graph}function simpleCloneNode(t,e){var i=new SimpleNode;i.value=t.cloneNode(!0);i.parent=e;i.parentNode=e;var n=[1].concat(primitives().map((function(t){return t.id})).filter((function(t){return t})));i["@attributes"]={id:Math.max.apply(null,n)+1};if(t.attributes.length>0)for(var r=0;r<t.attributes.length;r++){var a=t.attributes.item(r);i["@attributes"][a.nodeName]=a.nodeValue}i.id=i["@attributes"].id;return i}function mxGraphToJson(t,e){var i=new SimpleNode;i["@attributes"]={};i.value=t;i.parent=e;i.parentNode=e;if(1==t.nodeType){if(t.attributes.length>0){for(var n=0;n<t.attributes.length;n++){var r=t.attributes.item(n);i["@attributes"][r.nodeName]=r.nodeValue}i.id=i["@attributes"].id}}else if(3==t.nodeType)return null;if(t.hasChildNodes()){i.children=[];for(var a=0;a<t.childNodes.length;a++){var s=t.childNodes.item(a),o=(s.nodeName,mxGraphToJson(s,i));o&&i.children.push(o)}}return i}function setAttributeUndoable(t,e,i){if(t instanceof SimpleNode){t.setAttribute(e,i);clearPrimitiveCache()}else{var n=new mxCellAttributeChange(t,e,i);graph.getModel().execute(n)}}var analysisCount=0;function getGraphXml(t){var e=new mxCodec(mxUtils.createXmlDocument()).encode(t.getModel());return mxUtils.getPrettyXml(e)}var isSendingtoServer=!1,waitingToSendToServer=!1,waitingToSendTimeout=-1;function sendGraphtoServer(t){if(isSendingtoServer)waitingToSendToServer=!0;else if(!unfoldingManager.unfolding){clearTimeout(waitingToSendTimeout);waitingToSendToServer=!1;isSendingtoServer=!0;sendToParent({type:"save",state:{data:getGraphXml(t),title:graph_title,description:graph_description,tags:graph_tags,published:published,groups:JSON.stringify(node_groups)}})}}function validPrimitiveName(t,e){if("Stock"==e.value.nodeName||"Variable"==e.value.nodeName||"Converter"==e.value.nodeName||"Flow"==e.value.nodeName||"Display"==e.value.nodeName||"Agents"==e.value.nodeName||"Transition"==e.value.nodeName||"State"==e.value.nodeName){if(t.length>0&&!/[\[\]\(\)\{\}\<\>\'\"]/.test(t))return!0;mxUtils.alert(getText("Primitive names cannot contain brackets, parenthesis, or quotes."));return!1}return!0}function isPrimitive(t){return!("Button"==t.value.nodeName||"Picture"==t.value.nodeName||"Text"==t.value.nodeName)}function cellsContainNodename(t,e){for(var i=0;i<t.length;i++)if(t[i].value.nodeName==e)return!0}function connectionType(){return ribbonPanelItems().down("#connect").pressed?"Flow":"Link"}function setAllConnectable(){graph.setConnectable(!0);for(var t=primitives(),e=0;e<t.length;e++)t[e].setConnectable(!0)}var primitiveCache={};function primitives(t){if(primitiveCache[" "+t])return primitiveCache[" "+t];var e=childrenCells((graph instanceof SimpleNode?graph.children[0]:graph.getModel().getRoot()).children[0]);if(null==t)primitiveCache[" "+t]=e;else{for(var i=[],n=0;n<e.length;n++)e[n].value.nodeName==t&&i.push(e[n]);primitiveCache[" "+t]=i}return primitiveCache[" "+t]}function childrenCells(t){var e=t?t.children:null;if(null!=e){for(var i=[],n=0;n<e.length;n++)"Folder"==e[n].value.nodeName&&(i=i.concat(childrenCells(e[n])));for(n=(e=e.concat(i)).length-1;n>=0;n--)null!=e[n]&&null!=e[n].value||e.splice(n,1);return e}return null}var neighborhoodCache={},propertiesWin;function clearPrimitiveCache(){primitiveCache={};neighborhoodCache={}}function neighborhood(t){var e=inAgent(t);if(neighborhoodCache[t.id])return neighborhoodCache[t.id];var i=[],n=primitives();if(null!=n)if(null!=t){var r=[],a=[];if(["Flow","Link","Transition"].indexOf(t.value.nodeName)>-1){null!==orig(t.source)&&i.push({item:orig(t.source),type:"direct"});null!==orig(t.target)&&i.push({item:orig(t.target),type:"direct"})}"Agents"==t.value.nodeName&&t.getAttribute("Agent")&&(i=i.concat(c(t)));for(var s=0;s<n.length;s++)"Flow"==n[s].value.nodeName?r.push(orig(n[s])):"Link"==n[s].value.nodeName&&a.push(orig(n[s]));for(s=0;s<r.length;s++){r[s].source==t&&i.push({item:r[s],type:"direct",linkHidden:!0});r[s].target==t&&i.push({item:r[s],type:"direct",linkHidden:!0})}for(s=0;s<a.length;s++){if(orig(a[s].source)==t&&isDefined(a[s].target)&&null!==a[s].target){var o=!isTrue(a[s].getAttribute("BiDirectional"));i.push({item:orig(a[s].target),type:"direct",linkHidden:o});i=i.concat(c(a[s].target,o))}if(orig(a[s].target)==t&&isDefined(a[s].source)&&null!==a[s].source&&(!inAgent(orig(a[s].source))||e)){i.push({item:orig(a[s].source),type:"direct"});i=i.concat(c(a[s].source))}}}else for(s=0;s<n.length;s++)isValued(n[s])&&i.push({item:orig(n[s]),type:"direct"});i=i.filter((function(t){return t}));var l=[];for(s=0;s<i.length;s++)if(!i[s].linkHidden||!strictLinks){for(var u=!1,h=0;h<l.length;h++)if(l[h].type==i[s].type&&l[h].item.id==i[s].item.id){u=!0;l[h].linkHidden&&!i[s].linkHidden&&(l[h].linkHidden=!1);break}u||(isValued(i[s].item)||"Agents"==i[s].item.value.nodeName)&&l.push(i[s])}neighborhoodCache[t.id]=l;return l;function c(t,e){var i=[];if("Agents"==orig(t).value.nodeName&&orig(t).getAttribute("Agent")){var n=orig(t).getAttribute("Agent");if(n){getChildren(findID(n)).forEach((function(t){isValued(t)&&"Ghost"!=t.value.nodeName&&i.push({item:t,type:"agent",linkHidden:e,name:t.getAttribute("name")})}))}}return i.sort((function(t,e){return t.name==e.name?0:t.name>e.name?1:-1}))}}function doubleArray(t){for(var e=[],i=0;i<t.length;i++)e.push([t[i],t[i]]);return e}function isValued(t){return!isUndefined(t)&&null!=t&&!isUndefined(orig(t))&&("Converter"==orig(t).value.nodeName||"Flow"==orig(t).value.nodeName||"Stock"==orig(t).value.nodeName||"Variable"==orig(t).value.nodeName||"Transition"==orig(t).value.nodeName||"State"==orig(t).value.nodeName)}function setSaveEnabled(t){if(is_editor&&!is_embed){var e=ribbonPanelItems().getComponent("savebut");if(t&&0==unfoldingManager.unfolding){e.setDisabled(!1);e.setText("Save")}else{e.setDisabled(!0);e.setText("Saved")}}}function hasDisplay(){return cellsContainNodename(primitives(),"Display")}function urlImage(t){return t.getAttribute("Image")&&"http"==t.getAttribute("Image").substring(0,4).toLowerCase()}function setPicture(t){var e=t.getStyle();if("None"==t.getAttribute("Image")||""==t.getAttribute("Image")||" "==t.getAttribute("Image")||"null"==t.getAttribute("Image")||"Folder"==t.value.nodeName&&!t.isCollapsed()){e=mxUtils.setStyle(e,"image","None");e="Display"==t.value.nodeName||"Stock"==t.value.nodeName||"Folder"==t.value.nodeName||"Button"==t.value.nodeName?mxUtils.setStyle(e,"shape","rectangle"):mxUtils.setStyle(e,"shape","ellipse")}else{e=urlImage(t)?mxUtils.setStyle(e,"image",t.getAttribute("Image")):mxUtils.setStyle(e,"image",builder_path+"/images/SD/"+t.getAttribute("Image")+".png");e=isTrue(t.getAttribute("FlipVertical"))?mxUtils.setStyle(e,"imageFlipV",1):mxUtils.setStyle(e,"imageFlipV",0);e=isTrue(t.getAttribute("FlipHorizontal"))?mxUtils.setStyle(e,"imageFlipH",1):mxUtils.setStyle(e,"imageFlipH",0);e=mxUtils.setStyle(e,"shape","image")}var i=new mxStyleChange(graph.getModel(),t,e);graph.getModel().execute(i);propagateGhosts(t)}function setLabelPosition(t){var e=t.getAttribute("LabelPosition"),i=t.getStyle();if("Folder"!=t.value.nodeName||t.isCollapsed()){if("Top"==e){i=mxUtils.setStyle(i,"labelPosition","middle");i=mxUtils.setStyle(i,"align","center");i=mxUtils.setStyle(i,"verticalLabelPosition","top");i=mxUtils.setStyle(i,"verticalAlign","bottom")}else if("Bottom"==e){i=mxUtils.setStyle(i,"labelPosition","middle");i=mxUtils.setStyle(i,"align","center");i=mxUtils.setStyle(i,"verticalLabelPosition","bottom");i=mxUtils.setStyle(i,"verticalAlign","top")}else if("Middle"==e){i=mxUtils.setStyle(i,"labelPosition","middle");i=mxUtils.setStyle(i,"align","center");i=mxUtils.setStyle(i,"verticalLabelPosition","middle");i=mxUtils.setStyle(i,"verticalAlign","middle")}else if("Left"==e){i=mxUtils.setStyle(i,"verticalLabelPosition","middle");i=mxUtils.setStyle(i,"verticalAlign","middle");i=mxUtils.setStyle(i,"labelPosition","left");i=mxUtils.setStyle(i,"align","right")}else if("Right"==e){i=mxUtils.setStyle(i,"verticalLabelPosition","middle");i=mxUtils.setStyle(i,"verticalAlign","middle");i=mxUtils.setStyle(i,"labelPosition","right");i=mxUtils.setStyle(i,"align","left")}}else{i=mxUtils.setStyle(i,"labelPosition",null);i=mxUtils.setStyle(i,"align",null);i=mxUtils.setStyle(i,"verticalLabelPosition",null);i=mxUtils.setStyle(i,"verticalAlign",null)}var n=new mxStyleChange(graph.getModel(),t,i);graph.getModel().execute(n);propagateGhosts(t)}function removeAgent(t){for(var e=primitives("Agents"),i=0;i<e.length;i++)e[i].getAttribute("Agent")==t.id&&e[i].setAttribute("Agent","")}function deletePrimitive(t){var e=primitives(),i=getSetting();if(i.getAttribute("SensitivityPrimitives")){if((a=(r=i.getAttribute("SensitivityPrimitives").split(",")).indexOf(t.id))>-1){r.splice(a,1);i.setAttribute("SensitivityPrimitives",r.join(","))}}"Folder"==t.value.nodeName&&"Agent"==t.getAttribute("Type")&&removeAgent(t);for(var n=0;n<e.length;n++)if("Display"==e[n].value.nodeName){if(e[n].getAttribute("Primitives")){var r,a;if((a=(r=e[n].getAttribute("Primitives").split(",")).indexOf(t.id))>-1){r.splice(a,1);e[n].setAttribute("Primitives",r.join(","))}}}else if("Converter"==e[n].value.nodeName)e[n].getAttribute("Source")==t.id?e[n].setAttribute("Source","Time"):"Link"==t.value.nodeName&&testConverterSource(e[n]);else if("Ghost"==e[n].value.nodeName&&e[n].value.getAttribute("Source")==t.id){var s=e[n];deletePrimitive(s);graph.removeCells([s],!1)}}function linkBroken(t){for(var e=primitives(),i=0;i<e.length;i++)"Converter"==e[i].value.nodeName&&testConverterSource(e[i]);null!==t.getTerminal(!1)&&"Converter"==t.getTerminal(!1).value.nodeName&&void 0!==t.getTerminal(!0)&&isValued(t.getTerminal(!0))&&t.getTerminal(!1).setAttribute("Source",orig(t.getTerminal(!0)).id)}function testConverterSource(t){for(var e=neighborhood(t),i=!1,n=0;n<e.length;n++)e[n].linkHidden||t.getAttribute("Source")==e[n].item.id&&(i=!0);i||t.setAttribute("Source","Time")}function downloadModel(){var t=getGraphXml(graph);surpressCloseWarning=!0;document.getElementById("downloader").title.value=encodeURIComponent(graph_title);document.getElementById("downloader").code.value=encodeURIComponent(t);document.getElementById("downloader").submit()}function getSetting(){for(var t=primitives(),e=0;e<t.length;e++)if("Setting"==t[e].value.nodeName)return t[e];alert("Settings primitive could not be found.");return null}function handelCursors(){graph.container.style.cursor="auto"}function updateProperties(){var t;t=""==graph_title?"Untitled Insight":graph_title;if(propertiesWin){if(""!=graph_title){Ext.getCmp("sinsightTitle").setValue(graph_title);Ext.getCmp("sinsightTags").setValue(graph_tags);$("#sinsightDescription").html(clean(graph_description))}}else propertiesWin=new Ext.Window({applyTo:"property-win",layout:{type:"vbox",align:"stretch"},modal:!0,width:550,title:"Save Insight",autoHeight:!0,minHeight:300,minWidth:450,closable:!0,resizable:!0,autoScroll:!0,closeAction:"hide",defaults:{width:230,labelWidth:150},items:[new Ext.form.TextField({fieldLabel:"Insight Title",name:"sinsightTitle",id:"sinsightTitle",allowBlank:!1,selectOnFocus:!0,value:t,margin:9}),new Ext.form.TextField({fieldLabel:"Tags",name:"sinsightTags",id:"sinsightTags",allowBlank:!0,emptyText:"Environment, Health Care, Finance",value:graph_tags,margin:9}),{xtype:"fieldcontainer",fieldLabel:"Description",allowBlank:!0,items:[Ext.create("Ext.toolbar.Toolbar",{style:{padding:"6px 0px"},enableOverflow:!0,items:[{glyph:61490,tooltip:"Bold",handler:()=>{document.execCommand("bold")}},{glyph:61491,tooltip:"Italic",handler:()=>{document.execCommand("italic")}},{glyph:61645,tooltip:"Underline",handler:()=>{document.execCommand("underline")}},"-",{glyph:61494,tooltip:"Left align",handler:()=>{document.execCommand("justifyLeft")}},{glyph:61495,tooltip:"Center",handler:()=>{document.execCommand("justifyCenter")}},{glyph:61496,tooltip:"Right align",handler:()=>{document.execCommand("justifyRight")}},"-",{glyph:61633,tooltip:"Insert link",handler:()=>{var t=prompt("Enter a URL");if(t){document.execCommand("createLink",!0,t);$("#sinsightDescription a").attr("target","_blank")}}},"-",{glyph:61643,tooltip:"Numbered list",handler:()=>{document.execCommand("insertOrderedList")}},{glyph:61642,tooltip:"Bullet list",handler:()=>{document.execCommand("insertUnorderedList")}}]}),{html:'<div id="sinsightDescription" style="height: 130px; border: solid 1px #cecece; padding: 4px 6px 3px 6px; overflow: auto;" contenteditable>'+clean(graph_description)+"</div>"}],margin:9,minHeight:100,flex:1},{xtype:"fieldcontainer",fieldLabel:"Insight Access",layout:"hbox",defaults:{flex:1,hideLabel:!0},margin:9,items:[{xtype:"segmentedbutton",items:[{glyph:61612,text:"Public Insight",pressed:published,id:"insightPublic",tooltip:"This Insight is public. Anyone can view it, but only you can edit it."},{glyph:61572,text:"Private Insight",pressed:!published,tooltip:"This Insight is private. Only people you have given access to can view it."}]}]},Ext.create("Ext.form.field.Tag",{hidden:0==user_groups.length,fieldLabel:"Share with Groups",name:"sinsightGroups",id:"sinsightGroups",value:node_groups,allowBlank:!0,filterPickList:!0,store:group_titles,margin:9})],buttons:[{text:"Cancel",scale:"large",glyph:61532,handler:function(){propertiesWin.hide()}},{glyph:61452,scale:"large",text:"Save",handler:function(){if(Ext.getCmp("sinsightTitle").validate()){propertiesWin.hide();graph_title=Ext.String.trim(Ext.getCmp("sinsightTitle").getValue());graph_description=clean(Ext.String.trim($("#sinsightDescription").html()));graph_description=graph_description.replace(/^(\u200b|&nbsp;)/g,"");graph_description=graph_description.replace(/(\u200b|&nbsp;)$/g,"");"<br>"!=graph_description&&"<br/>"!=graph_description&&"​"!=graph_description&&"&nbsp;"!=graph_description||(graph_description="");graph_tags=Ext.getCmp("sinsightTags").getValue();node_groups=Ext.getCmp("sinsightGroups").getValue();published=Ext.getCmp("insightPublic").pressed;setSaveEnabled(!0);sendGraphtoServer(graph);selectionChanged(!1)}else showNotification(getText("You must specify a name for the Insight."),"error",!0)}}]});propertiesWin.show();Ext.getCmp("sinsightTitle").focus(!0,300)}function isTrue(t){return"false"!=t&&"No"!=t&&0!=t&&(1==t||-1==t||"True"==t||"true"==t||1==t||"Yes"==t)}function customUnits(){if(void 0!==getSetting().getAttribute("Units")){for(var t=getSetting().getAttribute("Units").split("\n"),e=0;e<t.length;e++)t[e]=t[e].split("<>");return t}return[]}function orig(t){if(t){if("Ghost"===t.value.nodeName){t.origCache||(t.origCache=findID(t.value.getAttribute("Source")));return t.origCache}return t}return null}function currentStyleIs(t){for(var e=graph.getCellStyle(graph.getSelectionCell())[mxConstants.STYLE_FONTSTYLE],i=3;i>=1;i--)(e-=t*Math.pow(2,i))<0&&(e+=t*Math.pow(2,i));return e>=t}function setStyles(){if(!is_embed&&is_editor){var t=!graph.isSelectionEmpty(),e=ribbonPanelItems();if(t){e.down("#bold").setChecked(currentStyleIs(mxConstants.FONT_BOLD));e.down("#italic").setChecked(currentStyleIs(mxConstants.FONT_ITALIC));e.down("#underline").setChecked(currentStyleIs(mxConstants.FONT_UNDERLINE));var i=graph.getCellStyle(graph.getSelectionCell());e.down("#sizeCombo").setValue(i[mxConstants.STYLE_FONTSIZE]);e.down("#fontCombo").setValue(i[mxConstants.STYLE_FONTFAMILY])}else{e.down("#bold").setChecked(!1);e.down("#italic").setChecked(!1);e.down("#underline").setChecked(!1);e.down("#fontCombo").setValue("");e.down("#sizeCombo").setValue("")}}}function stringArray(t,e,i){if(0==t.length)return"";if(1==t.length)return t[0];var n=t.slice(),r=n.pop();return n.join(e)+i+r}function quickLabel(t,e,i){var n=getSetting();return processLabel(t,e,i,n.getAttribute("TimeUnits"),n.getAttribute("TimeStep"),n.getAttribute("SolutionAlgorithm"))}function processLabel(t,e,i,n,r,a){var s="<PERCENTSIGNPLACEHOLDER>";t=replaceAll(t,"%%",s);t=replaceAll(t,"%u",n);t=replaceAll(t,"%t",e);t=replaceAll(t,"%o",i);t=replaceAll(t,"%ts",r);t=replaceAll(t,"%a",a);t=replaceAll(t,s,"%");return clean(t)}function replaceAll(t,e,i){return isUndefined(t)?"":t.replace(new RegExp(e,"g"),i)}function loadBackgroundColor(){mxPanel.el.dom.style["background-color"]=getSetting().getAttribute("BackgroundColor");mxPanel.el.dom.style.backgroundColor=getSetting().getAttribute("BackgroundColor")}function isUndefined(t){return void 0===t}function isDefined(t){return!isUndefined(t)}function isTouch(){return mxClient.IS_TOUCH}function propagateGhosts(t){for(var e=primitives("Ghost"),i=0;i<e.length;i++)if(e[i].getAttribute("Source")==t.id){var n=t.getStyle();n=mxUtils.setStyle(n,"opacity",30);e[i].setStyle(n);setAttributeUndoable(e[i],"name",t.getAttribute("name"))}}function propagateName(t,e){if(isValued(t))for(var i=getName(t),n=new RegExp("\\["+e+"\\]","gi"),r=graph.getConnections(t),a=0;a<r.length;a++)if(r[a].target&&r[a].source){var s;(isValued(s="Flow"==r[a].value.nodeName||"Transition"==r[a].value.nodeName?r[a]:r[a].target.id==t.id?r[a].source:r[a].target)||s&&"Action"==s.value.nodeName)&&setValue(s,getValue(s).replace(n,"["+i+"]"))}}function map(t,e){return t instanceof Array?t.map(e):e(t)}function unitsUsedInModel(){for(var t=primitives(),e=[],i=0;i<t.length;i++){var n=t[i].getAttribute("Units");"Setting"!=t[i].value.nodeName&&isDefined(n)&&null!==n&&"Unitless"!=n&&e.push(n)}return Ext.Array.unique(e)}function changeNodeName(t,e){for(var i=mxUtils.createXmlDocument().createElement(e),n=t.attributes,r=0;r<n.length;r++)i.setAttribute(n[r].name,n[r].value);return i}function cmd(t){return mxClient.IS_MAC?"<span style='color:grey'>(&#8984;"+t+")</span>":"<span style='color:grey'>(Ctrl-"+t+")</span>"}function inAgent(t){if(!t||null==t)return!1;var e=getParent(t);return!(!e||"Agent"!=e.getAttribute("Type"))||inAgent(e)}function parentAgent(t){if(t&&null!=t){var e=getParent(t);return e&&"Agent"==e.getAttribute("Type")?e:parentAgent(e)}}function isGray(t){if(isUndefined(t))return!0;var e;if("#6482B9"==(e="#"==t[0]?t:colourNameToHex(t)))return!0;var i=e[1];if(4==e.length){for(var n=2;n<e.length;n++)if(e[n]!=i)return!1}else if(7==e.length){for(n=1;n<e.length;n+=2)if(e[n]!=i)return!1;for(i=e[2],n=2;n<e.length;n+=2)if(e[n]!=i)return!1}return!0}function colourNameToHex(t){var e={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return void 0!==e[t.toLowerCase()]&&e[t.toLowerCase()]}function flatten(t){var e=[];return function t(i){var n,r,a;for(n=0,r=i.length;n<r;n++){a=i[n];Array.isArray(a)?t(a):e.push(a)}return e}(t)}var downloadButton=function(t){return{xtype:"button",text:"Download CSV",glyph:61677,handler:function(){var e=this.up("gridpanel"),i=e.getStore(),n=e.columns,r="";r+=n.filter((function(t){return!t.hidden})).map((function(t){return'"'+(t.text||t.name).replace(/"/g,'""')+'"'})).join(",");i.each((function(t){var e=[];n.forEach((function(i){var n=i.name||i.dataIndex;if(n){var r=""+t.get(n);e.push('"'+r.replace(/"/g,'""')+'"')}}));r+="\r\n"+e.join(",")}));downloadFile(t,r,"text/csv")}}};function deepClone(t,e,i,n){var r,a,s,o,l,u;if(null!=(r=arguments[1]))for(a in r){s=t[a];if(t!==(o=r[a])){if(n){var h=n(o);if(h){t[a]=h;continue}}if(i>0&&o&&((l=Array.isArray(o))||"object"==typeof o)){if(l){l=!1;u=s&&Array.isArray(s)?s:[]}else u=s&&"object"==typeof srv?s:{};t[a]=deepClone(u,o,i-1,n)}else void 0!==o&&(t[a]=o)}}return t}function exportSvg(){var t=graph.view.scale,e=graph.getGraphBounds(),i=mxUtils.createXmlDocument(),n=null!=i.createElementNS?i.createElementNS(mxConstants.NS_SVG,"svg"):i.createElement("svg");null!=n.style?n.style.backgroundColor="#FFFFFF":n.setAttribute("style","background-color:#FFFFFF");null==i.createElementNS&&n.setAttribute("xmlns",mxConstants.NS_SVG);n.setAttribute("width",Math.ceil(e.width*t+2)+"px");n.setAttribute("height",Math.ceil(e.height*t+2)+"px");n.setAttribute("xmlns:xlink",mxConstants.NS_XLINK);n.setAttribute("version","1.1");var r=null!=i.createElementNS?i.createElementNS(mxConstants.NS_SVG,"g"):i.createElement("g");r.setAttribute("transform","translate(0.5,0.5)");n.appendChild(r);i.appendChild(n);var a=new mxSvgCanvas2D(r);a.translate(Math.floor(1/t-e.x),Math.floor(1/t-e.y));a.scale(t);(new mxImageExport).drawState(graph.getView().getState(graph.model.root),a);downloadFile("Insight Maker Diagram.svg",mxUtils.getXml(n),"text/svg")}function showMessage(t){alert(t)}function showPrompt(t,e){return prompt(t,e)}function showChoice(t){return confirm(t)}function showURL(t){var e=window.open(t,"","scrollbars=yes,menubar=yes,height=500,width=700,resizable=yes,toolbar=yes,location=yes,status=yes");open!=e&&void 0!==e||Ext.Msg.alert("","<big><big><center><a href='"+t+"' target='_blank'><i class='fa fa-external-link-square'></i> Open Link</a></center></big></big>")}function downloadFile(t,e,i){var n=document.createElement("a");document.body.appendChild(n);var r=new Blob([e],{type:i||"octet/stream"}),a=window.URL.createObjectURL(r);n.href=a;n.download=t;n.click();window.URL.revokeObjectURL(a);n.remove()}function showData(t,e,i){i||(i=[Math.min(Ext.getBody().getViewSize().width,640),Math.min(Ext.getBody().getViewSize().height,480)]);for(var n=[],r=0;r<e.length;r++){var a={layout:"fit"};a.title=e[r].name;if("text"==e[r].type.toLowerCase()){var s={xtype:"textareafield",value:e[r].data,readOnly:!0};a.items=[s]}else if("html"==e[r].type.toLowerCase()){var o={title:"Insight Equations",xtype:"box",html:e[r].data,style:"background-color: white",autoScroll:!0};a.items=[o]}else if("table"==e[r].type.toLowerCase()){for(var l={xtype:"grid"},u=[],h=[],c=[],d=0;d<e[r].data.length;d++){u.push({dataIndex:"a"+d,text:e[r].header?e[r].header[d]:""});for(var m="float",f=0;f<e[r].data[d].length;f++)"string"==typeof e[r].data[d][r]&&(m="string");h.push({name:"a"+d,type:m})}for(f=0;f<e[r].data[0].length;f++)c.push({});for(d=0;d<e[r].data.length;d++)for(f=0;f<e[r].data[0].length;f++)c[f]["a"+d]=e[r].data[d][f];l.columns=u;l.store=new Ext.data.JsonStore({fields:h,data:c});e[r].header||(l.hideHeaders=!0);l.dockedItems=[{xtype:"toolbar",dock:"bottom",items:["->",downloadButton(e[r].name)]}];a.items=[l]}else if("chart"==e[r].type.toLowerCase()){var g=["#94ae0a","#115fa6","#a61120","#ff8809","#ffd13e","#a61187","#24ad9a","#7c7474","#a66111"],p=0,_=[];for(d=0;d<e[r].data.length;d++)if(e[r].data[d].color)_.push(e[r].data[d].color);else{_.push(g[p]);p++;p%=g.length}var v=[],S=(h=[{name:"x",type:"numeric"==e[r].xType.toLowerCase()?"float":"string"}],[]);for(c=[],d=0;d<e[r].xData.length;d++)c.push({x:e[r].xData[d]});for(d=0;d<e[r].data.length;d++){h.push({name:"a"+d,type:"float"});v.push({shadow:!1,type:e[r].data[d].fill?"area":e[r].data[d].type.toLowerCase(),title:e[r].data[d].name,colors:[_[d]],axis:"left",xField:"x",yField:"a"+d,showInLegend:!e[r].data[d].hideLegend,showMarkers:!e[r].data[d].hideMarkers,style:{opacity:1,"stroke-width":3},marker:{radius:3},animation:!1});e[r].data[d].fill&&(v[v.length-1].style["stroke-width"]=0);S.push("a"+d);for(f=0;f<e[r].data[d].data.length;f++)c[f]["a"+d]=e[r].data[d].data[f]}var N={xtype:"cartesian",animation:!1,shadow:!1,interactions:"crosszoom",store:new Ext.data.JsonStore({fields:h,data:c}),axes:[{position:"bottom",type:e[r].xType?e[r].xType.toLowerCase():"numeric",grid:!!e[r].verticalGrid&&e[r].verticalGrid,title:{text:e[r].xLabel?e[r].xLabel:"",fontSize:14},fields:["x"],minimum:e[r].xMin,maximum:e[r].xMax},{position:"left",type:"numeric",grid:!!e[r].horizontalGrid&&e[r].horizontalGrid,title:{text:e[r].yLabel?e[r].yLabel:"",fontSize:14},titleMargin:20,fields:S,minimum:e[r].yMin,maximum:e[r].yMax}],series:v};if(e[r].legend&&"none"!=e[r].legend){N.legend={};N.legend.docked=e[r].legend;N.legend.toggleable=!e[r].legendStatic}a.items=[N]}else alert("Unknown tab type: "+e[r].type);n.push(a)}var T=new Ext.Window({title:t,layout:"fit",closeAction:"destroy",border:!1,modal:!1,resizable:!0,closable:!0,maximizable:!0,minimizable:!0,shadow:!0,width:i[0],height:i[1],items:[{xtype:"tabpanel",layout:"fit",items:n}]});T.on("minimize",(function(t){if(t.expandedState){t.expandedState=!1;t.collapse()}else{t.expandedState=!0;T.expand()}}));T.show();return T}function frontWindow(){return Ext.WindowMgr.getActive()}function closeAllWindows(){for(var t;t=Ext.WindowMgr.getActive();)t.close()}function openFile(t){(t=t||{multiple:!1,accept:null,onCompleted:null,onSelected:null,onError:null,read:!1}).read&&(t.read=t.read.toLowerCase());"xlsx"!=t.read||t.accept||(t.accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");var e=document.createElement("input");e.setAttribute("type","file");t.multiple&&e.setAttribute("multiple",!0);t.accept&&e.setAttribute("accept",t.accept);var i=null,n=0,r=function(){$(e).remove();i.length?++n==i.length&&t.onCompleted(i):t.onCompleted(i)},a=function(e){var i={};i.file=e;i.size=e.size;i.name=e.name;i.type=e.type;var n=new FileReader;n.onloadend=function(e){if("xlsx"==t.read)require(["jszip"],(function(){require(["xlsx"],(function(){i.contents=XLSX.read(n.result,{type:"binary"});r()}))}));else{i.contents=n.result;r()}};n.onerror=function(){if(t.onError)t.onError(n.error);else{alert("FileReader error.");console.log("FileReader Error");console.log(n.error)}};n.onabort=function(){if(t.onError)t.onError(n.error);else{alert("FileReader aborted.");console.log("FileReader Error");console.log(n.error)}};if("binary"==t.read)n.readAsBinaryString(e);else if("text"==t.read)n.readAsText(e);else if("xlsx"==t.read)n.readAsBinaryString(e);else{if(t.read)throw"Unknown data read type: "+t.type;setTimeout(r,1)}return i};e.onchange=function(){var n=e.files;t.onSelected&&t.onSelected(n);if(t.onCompleted){void 0===n[0]&&t.onCompleted(null);i=t.multiple?Array.prototype.slice.call(n).map((function(t){return a(t)})):a(n[0])}};document.body.appendChild(e);e.click()}function runModel(t){if(!simulationRunning()||simulate.config.silent||t.resultsWindow){isUndefined(t)?t={silent:graph instanceof SimpleNode}:"boolean"==typeof t&&(t={silent:t});return runSimulation(t)}mxUtils.alert(getText("You have an existing simulation running that has not yet completed. Either close the results window or press the window's 'Stop' button. You may then run a new simulation."));simulate.resultsWindow.show()}function simulationRunning(){return simulate&&!simulate.completed()}function endRunningSimulation(){simulate&&simulate.terminate()}function saveModel(t){t||""==graph_title?updateProperties():unfoldingManager.unfolding||sendGraphtoServer(graph)}function clearModel(){if(graph instanceof SimpleNode){graph.children[0].children[0].children=graph.children[0].children[0].children.filter((function(t){return"Setting"==t.value.nodeName}));clearPrimitiveCache()}else{graph.getModel().beginUpdate();graph.allowButtonSelect=!0;graph.selectAll();graph.allowButtonSelect=!1;graph.removeCells(graph.getSelectionCells(),!1);graph.getModel().endUpdate()}}function layoutModel(t){if("organic"==t){(e=new mxFastOrganicLayout(graph)).forceConstant=50;executeLayout(e,!0)}else if("circular"==t)executeLayout(new mxCircleLayout(graph),!0);else if("hierarchical"==t){var e;(e=new mxCompactTreeLayout(graph)).horizontal=!1;e.resizeParent=!1;e.moveTree=!1;executeLayout(e,!0)}else alert("Unknown layout algorithm: "+t)}var executeLayout=function(t,e,i){var n=graph.getSelectionCell();(null==n||!i&&0==graph.getModel().getChildCount(n))&&(n=graph.getDefaultParent());graph.getModel().beginUpdate();try{t.execute(n)}catch(t){throw t}finally{if(e&&navigator.userAgent.indexOf("Camino")<0){var r=new mxMorphing(graph);r.addListener(mxEvent.DONE,(function(){graph.getModel().endUpdate()}));r.startAnimation()}else graph.getModel().endUpdate()}};function setZoom(t){"fit"==t?graph.fit():"actual"==t?graph.zoomActual():"in"==t?graph.zoomIn():"out"==t?graph.zoomOut():graph.getView().setScale(t)}function getTimeStep(){return parseFloat(getSetting().getAttribute("TimeStep"))}function setTimeStep(t){setAttributeUndoable(getSetting(),"TimeStep",t)}function getTimeStart(){return parseFloat(getSetting().getAttribute("TimeStart"))}function setTimeStart(t){setAttributeUndoable(getSetting(),"TimeStart",t)}function getTimeLength(){return parseFloat(getSetting().getAttribute("TimeLength"))}function setTimeLength(t){setAttributeUndoable(getSetting(),"TimeLength",t)}function getPauseInterval(){return parseFloat(getSetting().getAttribute("TimePause"))}function setPauseInterval(t){setAttributeUndoable(getSetting(),"TimePause",t)}function getTimeUnits(){return getSetting().getAttribute("TimeUnits")}function setTimeUnits(t){setAttributeUndoable(getSetting(),"TimeUnits",t)}function getAlgorithm(){return getSetting().getAttribute("SolutionAlgorithm")}function setAlgorithm(t){setAttributeUndoable(getSetting(),"SolutionAlgorithm",t)}function getMacros(){return getSetting().getAttribute("Macros")}function setMacros(t){setAttributeUndoable(getSetting(),"Macros",t)}function findName(t){var e=map(t,(function(t){for(var e=[],i=findAll(),n=0;n<i.length;n++)isDefined(i[n].getAttribute("name"))&&i[n].getAttribute("name").toLowerCase()==t.toLowerCase()&&e.push(i[n]);return e}));e=(e=flatten(e)).filter((function(t){return null!==t}));return t instanceof Array?e:0==e.length?null:1==e.length?e[0]:e}function findAll(){for(var t=primitives(),e=[],i=0;i<t.length;i++)"Setting"!=t[i].value.nodeName&&"Display"!=t[i].value.nodeName&&e.push(t[i]);return e}function findType(t){var e=map(t,(function(t){return primitives(t)}));return e=flatten(e)}function findID(t){var e=primitives(),i=map(t,(function(t){for(var i=0;i<e.length;i++)if(e[i].id==t)return e[i];return null}));return null===i||t instanceof Array?i:1==i.length?i[0]:i}function findValue(t){var e=findAll();return uniquePrimitives(flatten(map(t,(function(t){for(var i=[],n=0;n<e.length;n++)t instanceof RegExp?t.test(getValue(e[n]))&&i.push(e[n]):getValue(e[n])==t&&i.push(e[n]);return i}))))}function findNote(t){var e=findAll();return uniquePrimitives(flatten(map(t,(function(t){for(var i=[],n=0;n<e.length;n++)t instanceof RegExp?t.test(getNote(e[n]))&&i.push(e[n]):getNote(e[n])==t&&i.push(e[n]);return i}))))}function createPrimitive(t,e,i,n){var r=e.toLowerCase();if(graph instanceof SimpleNode){var a=graph.children[0].children[0],s=simpleCloneNode(primitiveBank[r],a);a.children.push(s);clearPrimitiveCache()}else a=graph.getDefaultParent(),s=graph.insertVertex(a,null,primitiveBank[r].cloneNode(!0),i[0],i[1],n[0],n[1],r);setName(s,t);"Converter"==s.value.nodeName&&setConverterInit(s);if(isValued(s)||"Agents"==s.value.nodeName)for(var o=primitives("Display"),l=0;l<o.length;l++){var u=o[l];if(isTrue(u.getAttribute("AutoAddPrimitives"))&&"Scatterplot"!=u.getAttribute("Type")&&("Map"!=u.getAttribute("Type")||"Agents"==s.value.nodeName)){var h=u.getAttribute("Primitives");if(void 0===h)u.setAttribute("Primitives",s.id);else{var c=h.split(",");c.push(s.id);u.setAttribute("Primitives",c.join(","))}}}return s}function createConnector(t,e,i,n){var r,a=!1,s=e.toLowerCase();if(graph instanceof SimpleNode){var o=graph.children[0].children[0];i&&(o=i.parent);n&&(o=n.parent);var l=simpleCloneNode(primitiveBank[s],o);o.children.push(l);setEnds(l,[i,n]);clearPrimitiveCache()}else{o=graph.getDefaultParent();if(null==n&&null==i){a=!0;i=r=createPrimitive("temp stock xyz","Stock",[300,300],[10,10]);n=r}else if(null==i){a=!0;var u=getPosition(n),h=getSize(n);i=r=createPrimitive("temp stock xyz","Stock",[u[0]+h[0]/2-5,u[1]-120],[10,10])}else if(null==n){a=!0;u=getPosition(i),h=getSize(i);n=r=createPrimitive("temp stock xyz","Stock",[u[0]+h[0]/2-5,u[1]+120+h[1]],[10,10])}l=graph.insertEdge(o,null,primitiveBank[s].cloneNode(!0),i,n,s)}setName(l,t);a&&removePrimitive(r);return l}function removePrimitive(t){t instanceof Array||(t=[t]);if(graph instanceof SimpleNode){var e=findType(["Flow","Transition","Link"]);t.forEach((function(t){t.parent.children.splice(t.parent.children.indexOf(t),1);e.forEach((function(e){if(e.source==t){e.source=null;e.target&&e.target.parent!==e.parent&&setParent(e,e.target.parent)}if(e.target==t){e.target=null;e.source&&e.source.parent!==e.parent&&setParent(e,e.source.parent)}}))}));clearPrimitiveCache()}else graph.removeCells(t,!1)}function highlight(t){for(var e=getParent(t);e;){getCollapsed(e)&&expandFolder(e);e=getParent(e)}setSelected(t);graph.scrollCellToVisible(t)}function getSelected(){return graph.getSelectionCells()}function setSelected(t){graph.allowButtonSelect=!0;t instanceof Array?graph.setSelectionCells(t):graph.setSelectionCells([t]);graph.allowButtonSelect=!1}function isSelected(t){var e=getSelected();return map(t,(function(t){return primitiveIndex(e,t)>-1}))}function getID(t){return map(t,(function(t){return t.id}))}function getType(t){return map(t,(function(t){return t.value.nodeName}))}function getName(t){return map(t,(function(t){return t.getAttribute("name")}))}function setName(t,e){map(t,(function(t){if(validPrimitiveName(String(e),t)){setAttributeUndoable(t,"name",String(e));propagateGhosts(t)}}))}function getUnits(t){return map(t,(function(t){return t.getAttribute("Units")}))}function setUnits(t,e){map(t,(function(t){setAttributeUndoable(t,"Units",String(e))}))}function getConstraints(t){return map(t,(function(t){return[t.getAttribute("MinConstraint"),isTrue(t.getAttribute("MinConstraintUsed")),t.getAttribute("MaxConstraint"),isTrue(t.getAttribute("MaxConstraintUsed"))]}))}function setConstraints(t,e){map(t,(function(t){setAttributeUndoable(t,"MinConstraint",e[0]);setAttributeUndoable(t,"MinConstraintUsed",e[1]);setAttributeUndoable(t,"MaxConstraint",e[2]);setAttributeUndoable(t,"MaxConstraintUsed",e[3])}))}function getNote(t){return map(t,(function(t){return t.getAttribute("Note")}))}function setNote(t,e){map(t,(function(t){setAttributeUndoable(t,"Note",String(e))}))}function showNote(t){return map(t,(function(t){if(null!==t.value.getAttribute("Note",null)&&""!=t.value.getAttribute("Note")){if(isUndefined(Ext.getCmp("note"+t.id))){var e=graph.view.getState(t);if(e){new Ext.ToolTip({html:"<big>"+clean(t.value.getAttribute("Note").replace(/\n/g,"<br/>"))+"</big>",autoHide:!1,closable:!0,width:300,draggable:!0,id:"note"+t.id,title:clean(t.value.getAttribute("name")),closeAction:"destroy"}).showAt([e.x+mxPanel.getEl().getLeft()+e.width+4-graph.container.scrollLeft,e.y+mxPanel.getEl().getTop()-graph.container.scrollTop])}}}}))}function hideNote(t){return map(t,(function(t){var e=Ext.getCmp("note"+t.id);isUndefined(e)||e.destroy()}))}function showEditor(t,e){if("Converter"==t.value.nodeName){new ConverterWindow({parent:"",cell:t,oldKeys:t.getAttribute("Data"),interpolation:t.getAttribute("Interpolation")}).show()}else if("Stock"==t.value.nodeName){var i=new Ext.form.field.Checkbox({xtype:"checkboxfield",boxLabel:getText("Restrict this stock to positive values"),checked:getNonNegative(t),autoEl:{"data-qtip":"If checked, the value of the stock will not be allowed to fall below zero. The rates of outflows may be adjusted to ensure this condition is met."}});new EquationWindow({parent:"",cell:t,equation:getValue(t),annotations:e,extra:i,saveExtra:function(e){setNonNegative(t,i.getValue())}}).show()}else if("Flow"==t.value.nodeName){i=new Ext.form.field.Checkbox({xtype:"checkboxfield",boxLabel:getText("Restrict this flow to positive rates"),checked:getNonNegative(t),autoEl:{"data-qtip":"If checked, the flow will not be applied if the calculated rate is less than zero."}});new EquationWindow({parent:"",cell:t,equation:getValue(t),annotations:e,extra:i,saveExtra:function(e){setNonNegative(t,i.getValue())}}).show()}else if("Transition"==t.value.nodeName){var n=function(){var t="Condition"==r.getValue();a.setDisabled(t);s.setDisabled(t)},r=new Ext.form.ComboBox({triggerAction:"all",store:["Timeout","Probability","Condition"],editable:!1,selectOnFocus:!1,value:getTriggerType(t),fieldLabel:"Trigger Type",width:240,listeners:{change:function(){n()}}}),a=new Ext.form.field.Checkbox({xtype:"checkboxfield",boxLabel:getText("Recalculate each time step"),checked:getTriggerRecalculate(t),margin:"0 0 0 15",autoEl:{"data-qtip":"If this is not true, the equation will be evaluated once and the trigger time scheduled based on that calculation. If this is true, the timeout or probability will be recalculated as the state of the system changes."}}),s=new Ext.form.field.Checkbox({xtype:"checkboxfield",boxLabel:getText("Repeat after triggering"),checked:getTriggerRepeat(t),margin:"0 0 0 15",autoEl:{"data-qtip":"If this is true, the transition will be rescheduled after it is triggered. If this is not true, the transition will only be rescheduled if its source state becomes active again."}}),o={xtype:"container",layout:"hbox",items:[r,a,s]};n();new EquationWindow({parent:"",cell:t,equation:getValue(t),annotations:e,extra:o,saveExtra:function(e){setTriggerType(t,r.value);setTriggerRecalculate(t,a.getValue());setTriggerRepeat(t,s.getValue())}}).show()}else{new EquationWindow({parent:"",cell:t,equation:getValue(t),annotations:e}).show()}}function getValue(t){return map(t,(function(t){var e,i=t.value.nodeName;"Stock"==i?e=t.getAttribute("InitialValue"):"Flow"==i?e=t.getAttribute("FlowRate"):"Transition"==i?e=t.getAttribute("Value"):"State"==i?e=t.getAttribute("Active"):"Variable"==i?e=t.getAttribute("Equation"):"Button"==i?e=t.getAttribute("Function"):"Converter"==i?e=t.getAttribute("Data"):"Action"==i?e=t.getAttribute("Action"):"Agents"==i&&(e=t.getAttribute("Size"));return isDefined(e)?e:""}))}function setValue(t,e){map(t,(function(t){if(getValue(t)!=e){var i=t.value.nodeName;if("Stock"==i)setAttributeUndoable(t,"InitialValue",String(e));else if("Flow"==i)setAttributeUndoable(t,"FlowRate",String(e));else if("Transition"==i)setAttributeUndoable(t,"Value",String(e));else if("State"==i)setAttributeUndoable(t,"Active",String(e));else if("Variable"==i)setAttributeUndoable(t,"Equation",String(e));else if("Button"==i)setAttributeUndoable(t,"Function",String(e));else if("Converter"==i)setAttributeUndoable(t,"Data",String(e));else if("Action"==i)setAttributeUndoable(t,"Action",String(e));else if("Agents"==i){if(e<0||Math.round(e)!=e){alert("The agent population size must be a non-negative integer.");return}setAttributeUndoable(t,"Size",parseFloat(e))}}}))}function getSize(t){return map(t,(function(t){if(graph instanceof SimpleNode)return[0,0];var e=graph.getCellBounds(t),i=graph.view.getScale();return[e.width/i,e.height/i]}))}function getPosition(t){return map(t,(function(t){if(graph instanceof SimpleNode)return[0,0];var e=graph.view.getState(t),i=graph.view.getScale();return[e.x/i,e.y/i]}))}function setPosition(t,e){map(t,(function(t){var i=graph.view.getState(t),n=graph.view.getScale(),r=t.geometry,a=i.x/n-r.x,s=i.y/n-r.y,o=r.clone();o.x=e[0]-a;o.y=e[1]-s;graph.getModel().setGeometry(t,o)}))}function flash(t,e,i){map(t,(function(t){"Folder"==t.value.nodeName&&flash(getChildren(t,!1),e,i);var n=getOpacity(t);setOpacity(t,e||0);setTimeout((function(){setOpacity(t,n)}),i||100)}))}function getShowSlider(t){return map(t,(function(t){return isTrue(t.getAttribute("ShowSlider"))}))}function setShowSlider(t,e){map(t,(function(t){setAttributeUndoable(t,"ShowSlider",e)}))}function getSliderMin(t){return map(t,(function(t){return t.getAttribute("SliderMin")}))}function setSliderMin(t,e){map(t,(function(t){setAttributeUndoable(t,"SliderMin",e)}))}function getSliderMax(t){return map(t,(function(t){return t.getAttribute("SliderMax")}))}function setSliderMax(t,e){map(t,(function(t){setAttributeUndoable(t,"SliderMax",e)}))}function getSliderStep(t){return map(t,(function(t){return t.getAttribute("SliderStep")}))}function setSliderStep(t,e){map(t,(function(t){setAttributeUndoable(t,"SliderStep",e)}))}function getOpacity(t){return map(t,(function(t){return graph.getCellStyle(t).opacity}))}function setOpacity(t,e){map(t,(function(t){var i=t.getStyle();i=mxUtils.setStyle(i,"opacity",e);i=mxUtils.setStyle(i,mxConstants.STYLE_TEXT_OPACITY,e);graph.getModel().execute(new mxStyleChange(graph.getModel(),t,i));propagateGhosts(t)}))}function getLineColor(t){return map(t,(function(t){return graph.getCellStyle(t).strokeColor}))}function setLineColor(t,e){map(t,(function(t){var i=t.getStyle();i=mxUtils.setStyle(i,"strokeColor",e);graph.getModel().execute(new mxStyleChange(graph.getModel(),t,i));propagateGhosts(t)}))}function getFontColor(t){return map(t,(function(t){return graph.getCellStyle(t).fontColor}))}function setFontColor(t,e){map(t,(function(t){var i=t.getStyle();i=mxUtils.setStyle(i,"fontColor",e);graph.getModel().execute(new mxStyleChange(graph.getModel(),t,i));propagateGhosts(t)}))}function getFillColor(t){return map(t,(function(t){return graph.getCellStyle(t).fillColor}))}function setFillColor(t,e){map(t,(function(t){var i=t.getStyle();i=mxUtils.setStyle(i,"fillColor",e);graph.getModel().execute(new mxStyleChange(graph.getModel(),t,i));propagateGhosts(t)}))}function getImage(t){return map(t,(function(t){return t.getAttribute("Image")}))}function setImage(t,e){map(t,(function(t){t.setAttribute("Image",e);setPicture(t)}))}function getNonNegative(t){return map(t,(function(t){return"Stock"==t.value.nodeName?isTrue(t.getAttribute("NonNegative")):isTrue(t.getAttribute("OnlyPositive"))}))}function setNonNegative(t,e){map(t,(function(t){if("Stock"==t.value.nodeName)setAttributeUndoable(t,"NonNegative",e);else{setAttributeUndoable(t,"OnlyPositive",e);if(!(t instanceof SimpleNode))if(e)graph.setCellStyles(mxConstants.STYLE_STARTARROW,"",[t]);else{graph.setCellStyles(mxConstants.STYLE_STARTARROW,"block",[t]);graph.setCellStyles("startFill",0,[t])}}}))}function getStockType(t){return map(t,(function(t){return t.getAttribute("StockMode")}))}function setStockType(t,e){map(t,(function(t){setAttributeUndoable(t,"StockMode",e)}))}function getDelay(t){return map(t,(function(t){return t.getAttribute("Delay")}))}function setDelay(t,e){map(t,(function(t){setAttributeUndoable(t,"Delay",e)}))}function getEnds(t){return map(t,(function(t){return[t.source,t.target]}))}function setEnds(t,e){map(t,(function(i){if(t instanceof SimpleNode){i.source=e[0];i.target=e[1];clearPrimitiveCache()}else{var n=new mxTerminalChange(graph.model,i,e[0],!0);graph.getModel().execute(n);n=new mxTerminalChange(graph.model,i,e[1],!1);graph.getModel().execute(n)}}))}function connected(t,e){if(t.isEdge){if(null!==t.source&&t.source.id===e.id)return!0;if(null!==t.target&&t.target.id===e.id)return!0}if(e.isEdge){if(null!==e.source&&e.source.id===t.id)return!0;if(null!==e.target&&e.target.id===t.id)return!0}for(var i=findType(["Flow","Link","Transition"]),n=0;n<i.length;n++)if(null!==i[n].source&&null!==i[n].target){if(i[n].source.id===t.id&&i[n].target.id===e.id)return!0;if(i[n].target.id===t.id&&i[n].source.id===e.id)return!0}return!1}function getResidency(t){return map(t,(function(t){return t.getAttribute("Residency")}))}function setResidency(t,e){map(t,(function(t){setAttributeUndoable(t,"Residency",e)}))}function getTriggerType(t){return map(t,(function(t){return t.getAttribute("Trigger")}))}function setTriggerType(t,e){map(t,(function(t){setAttributeUndoable(t,"Trigger",e)}))}function getTriggerValue(t){return map(t,(function(t){return t.getAttribute("Value")}))}function setTriggerValue(t,e){map(t,(function(t){setAttributeUndoable(t,"Value",e)}))}function getTriggerRepeat(t){return map(t,(function(t){return isTrue(t.getAttribute("Repeat"))}))}function setTriggerRepeat(t,e){map(t,(function(t){setAttributeUndoable(t,"Repeat",e)}))}function getTriggerRecalculate(t){return map(t,(function(t){return isTrue(t.getAttribute("Recalculate"))}))}function setTriggerRecalculate(t,e){map(t,(function(t){setAttributeUndoable(t,"Recalculate",e)}))}function getData(t){return map(t,(function(t){return t.getAttribute("Data")}))}function setData(t,e){map(t,(function(t){setAttributeUndoable(t,"Data",e)}))}function getConverterInput(t){return map(t,(function(t){var e=t.getAttribute("Source");return"Time"==e?null:findID(e)}))}function setConverterInput(t,e){map(t,(function(t){setAttributeUndoable(t,"Source",null==e?"Time":e.id)}))}function getInterpolation(t){return map(t,(function(t){return t.getAttribute("Interpolation")}))}function setInterpolation(t,e){map(t,(function(t){setAttributeUndoable(t,"Interpolation",e)}))}function pressButton(t){"use strict";graph.getModel().beginUpdate();map(t,(function(t){runAction(t.getAttribute("Function"),"<p>There was an error with the Action for the button <i>"+t.getAttribute("name")+"</i>.</p><br/>",t)}));graph.getModel().endUpdate()}var trusted=is_owner;function runAction(code,errHeader,button){try{var msg="This insight is requesting permission to execute custom code. For security reasons, you should only run custom code in trusted insights.\n\nAre you sure you want to run code in this insight?";if(trusted||confirm(msg)){trusted||sendToParent({type:"start_action"});trusted=!0;eval('"use strict;"\n\n'+code)}}catch(t){errHeader=errHeader||"";Ext.Msg.show({title:getText("Action Error"),msg:errHeader+"<p><tt>"+t+"</tt></p><p><b>Code:</b></p><p><tt><pre>"+code+"</pre></tt></p>",buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR});button&&setTimeout((function(){highlight(button)}),100)}}function getPopulationSize(t){return map(t,(function(t){return t.getAttribute("Size")}))}function setPopulationSize(t,e){map(t,(function(t){setAttributeUndoable(t,"Size",e)}))}function getAgentBase(t){return map(t,(function(t){return findID(t.getAttribute("Agent"))}))}function setAgentBase(t,e){map(t,(function(t){setAttributeUndoable(t,"Agent",e.id)}))}function getGeometryWrap(t){return map(t,(function(t){return isTrue(t.getAttribute("GeoWrap"))}))}function setGeometryWrap(t,e){map(t,(function(t){setAttributeUndoable(t,"GeoWrap",e)}))}function getGeometryUnits(t){return map(t,(function(t){return t.getAttribute("GeoDimUnits")}))}function setGeometryUnits(t,e){map(t,(function(t){setAttributeUndoable(t,"GeoDimUnits",e)}))}function getGeometryWidth(t){return map(t,(function(t){return t.getAttribute("GeoWidth")}))}function setGeometryWidth(t,e){map(t,(function(t){setAttributeUndoable(t,"GeoWidth",e)}))}function getGeometryHeight(t){return map(t,(function(t){return t.getAttribute("GeoHeight")}))}function setGeometryHeight(t,e){map(t,(function(t){setAttributeUndoable(t,"GeoHeight",e)}))}function getAgentPlacement(t){return map(t,(function(t){return t.getAttribute("Placement")}))}function setAgentPlacement(t,e){map(t,(function(t){setAttributeUndoable(t,"Placement",e)}))}function getAgentPlacementFunction(t){return map(t,(function(t){return t.getAttribute("PlacementFunction")}))}function setAgentPlacementFunction(t,e){map(t,(function(t){setAttributeUndoable(t,"PlacementFunction",e)}))}function getAgentNetwork(t){return map(t,(function(t){return t.getAttribute("Network")}))}function setAgentNetwork(t,e){map(t,(function(t){setAttributeUndoable(t,"Network",e)}))}function getAgentNetworkFunction(t){return map(t,(function(t){return t.getAttribute("NetworkFunction")}))}function setAgentNetworkFunction(t,e){map(t,(function(t){setAttributeUndoable(t,"NetworkFunction",e)}))}function collapseFolder(t){map(t,(function(t){graph.foldCells(!0,!1,[t])}))}function expandFolder(t){map(t,(function(t){graph.foldCells(!1,!1,[t])}))}function getCollapsed(t){return map(t,(function(t){return t.isCollapsed()}))}function getParent(t){return map(t,(function(t){var e=t.parentNode||t.parent;return e.value&&"root"==e.value.nodeName||"root"==e.nodeName||"1"==e.id?null:e}))}function setParent(t,e,i){if(graph instanceof SimpleNode)null==e&&(e=graph.children[0].children[0]);else var n=null==e?graph.getDefaultParent():e;map(t,(function(t){if(graph instanceof SimpleNode){t.parent.children.splice(t.parent.children.indexOf(t),1);t.parent=e;t.parentNode=e;e.children||(e.children=[]);e.children.push(t)}else{var r=getPosition(t),a=new mxChildChange(graph.getModel(),n,t);graph.getModel().execute(a);i||setPosition(t,r)}}))}function getFrozen(t){return map(t,(function(t){return isTrue(t.getAttribute("Frozen"))}))}function setFrozen(t,e){map(t,(function(t){setAttributeUndoable(t,"Frozen",e)}))}function getChildren(t,e){isUndefined(e)&&(e=!0);return t.children?e?flatten(map(t.children,(function(t){return"Folder"==t.value.nodeName?t.children.concat([t]):t}))):t.children:[]}function getFolderType(t){return map(t,(function(t){return t.getAttribute("Type")}))}function setFolderType(t,e){map(t,(function(t){setAttributeUndoable(t,"Type",e)}))}function getFolderAgentParent(t){return map(t,(function(t){return t.getAttribute("AgentBase")}))}function setFolderAgentParent(t,e){map(t,(function(t){setAttributeUndoable(t,"AgentBase",e)}))}function getFolderSolver(t){return map(t,(function(t){return JSON.parse(t.getAttribute("Solver"))}))}function setFolderSolver(t,e){map(t,(function(t){setAttributeUndoable(t,"Solver",JSON.stringify(e))}))}function excludeType(t,e){var i=function(t,e){if(t instanceof Array){for(var i=[],n=0;n<t.length;n++)t[n].value.nodeName!=e&&i.push(t[n]);return i}return null==t?t:t.value.nodeName==e?null:t};if(Array.isArray(e)){for(var n=0;n<e.length;n++)t=i(t,e[n]);return t}return i(t,e)}function primitiveIndex(t,e){for(var i=0;i<t.length;i++)if(t[i].id==e.id)return i;return-1}function uniquePrimitives(t){for(var e=[],i=0;i<t.length;i++){for(var n=!1,r=0;r<e.length;r++)if(e[r].id==t[i].id){n=!0;break}n||e.push(t[i])}return e}var globalVarBank={},graph;function setGlobal(t,e){globalVarBank["_"+t]=e}function getGlobal(t){return globalVarBank["_"+t]}function topBarShown(){return ribbonPanel.getDockedItems()[0].isVisible()}function toggleTopBar(){var t=ribbonPanel.getDockedItems()[0];if(t.isVisible()){t.hide();try{Ext.get("toplinks-holder").addCls("collapsed")}catch(t){}}else{t.show();try{Ext.get("toplinks-holder").removeCls("collapsed")}catch(t){}}}function sideBarShown(){return!configPanel.collapsed}function toggleSideBar(){sideBarShown()?configPanel.collapse(Ext.Component.DIRECTION_RIGHT,!1):configPanel.expand(!1)}function updateSideBar(){selectionChanged(!0)}var primitiveBank={},defaultSolver='{"enabled": false, "algorithm": "RK1", "timeStep": 1}',doc=document.implementation.createDocument("","",null);primitiveBank.text=doc.createElement("Text");primitiveBank.text.setAttribute("name",getText("Text Area"));primitiveBank.text.setAttribute("LabelPosition","Middle");primitiveBank.folder=doc.createElement("Folder");primitiveBank.folder.setAttribute("name",getText("New Folder"));primitiveBank.folder.setAttribute("Note","");primitiveBank.folder.setAttribute("Type","None");primitiveBank.folder.setAttribute("Solver",defaultSolver);primitiveBank.folder.setAttribute("Image","None");primitiveBank.folder.setAttribute("FlipHorizontal",!1);primitiveBank.folder.setAttribute("FlipVertical",!1);primitiveBank.folder.setAttribute("LabelPosition","Middle");primitiveBank.folder.setAttribute("AgentBase","");primitiveBank.ghost=doc.createElement("Ghost");primitiveBank.ghost.setAttribute("Source","");primitiveBank.picture=doc.createElement("Picture");primitiveBank.picture.setAttribute("name","");primitiveBank.picture.setAttribute("Note","");primitiveBank.picture.setAttribute("Image","Growth");primitiveBank.picture.setAttribute("FlipHorizontal",!1);primitiveBank.picture.setAttribute("FlipVertical",!1);primitiveBank.picture.setAttribute("LabelPosition","Bottom");primitiveBank.display=doc.createElement("Display");primitiveBank.display.setAttribute("name",getText("Default Display"));primitiveBank.display.setAttribute("Note","");primitiveBank.display.setAttribute("Type","Time Series");primitiveBank.display.setAttribute("xAxis",getText("Time")+" (%u)");primitiveBank.display.setAttribute("yAxis","");primitiveBank.display.setAttribute("yAxis2","");primitiveBank.display.setAttribute("showMarkers",!1);primitiveBank.display.setAttribute("showLines",!0);primitiveBank.display.setAttribute("showArea",!1);primitiveBank.display.setAttribute("ThreeDimensional",!1);primitiveBank.display.setAttribute("Primitives","");primitiveBank.display.setAttribute("Primitives2","");primitiveBank.display.setAttribute("AutoAddPrimitives",!1);primitiveBank.display.setAttribute("ScatterplotOrder","X Primitive, Y Primitive");primitiveBank.display.setAttribute("Image","Display");primitiveBank.display.setAttribute("FlipHorizontal",!1);primitiveBank.display.setAttribute("FlipVertical",!1);primitiveBank.display.setAttribute("LabelPosition","Bottom");primitiveBank.display.setAttribute("legendPosition","Automatic");function setValuedProperties(t){t.setAttribute("Units","Unitless");t.setAttribute("MaxConstraintUsed",!1);t.setAttribute("MinConstraintUsed",!1);t.setAttribute("MaxConstraint","100");t.setAttribute("MinConstraint","0");t.setAttribute("ShowSlider",!1);t.setAttribute("SliderMax",100);t.setAttribute("SliderMin",0);t.setAttribute("SliderStep","")}primitiveBank.stock=doc.createElement("Stock");primitiveBank.stock.setAttribute("name",getText("New Stock"));primitiveBank.stock.setAttribute("Note","");primitiveBank.stock.setAttribute("InitialValue","0");primitiveBank.stock.setAttribute("StockMode","Store");primitiveBank.stock.setAttribute("Delay","10");primitiveBank.stock.setAttribute("Volume","100");primitiveBank.stock.setAttribute("NonNegative",!1);setValuedProperties(primitiveBank.stock);primitiveBank.stock.setAttribute("Image","None");primitiveBank.stock.setAttribute("FlipHorizontal",!1);primitiveBank.stock.setAttribute("FlipVertical",!1);primitiveBank.stock.setAttribute("LabelPosition","Middle");primitiveBank.state=doc.createElement("State");primitiveBank.state.setAttribute("name",getText("New State"));primitiveBank.state.setAttribute("Note","");primitiveBank.state.setAttribute("Active","false");primitiveBank.state.setAttribute("Residency","0");primitiveBank.state.setAttribute("Image","None");primitiveBank.state.setAttribute("FlipHorizontal",!1);primitiveBank.state.setAttribute("FlipVertical",!1);primitiveBank.state.setAttribute("LabelPosition","Middle");primitiveBank.transition=doc.createElement("Transition");primitiveBank.transition.setAttribute("name",getText("Transition"));primitiveBank.transition.setAttribute("Note","");primitiveBank.transition.setAttribute("Trigger","Timeout");primitiveBank.transition.setAttribute("Value","1");primitiveBank.transition.setAttribute("Repeat",!1);primitiveBank.transition.setAttribute("Recalculate",!1);setValuedProperties(primitiveBank.transition);primitiveBank.action=doc.createElement("Action");primitiveBank.action.setAttribute("name",getText("New Action"));primitiveBank.action.setAttribute("Note","");primitiveBank.action.setAttribute("Trigger","Probability");primitiveBank.action.setAttribute("Value","0.5");primitiveBank.action.setAttribute("Repeat",!0);primitiveBank.action.setAttribute("Recalculate",!1);primitiveBank.action.setAttribute("Action","Self.Move({Rand(), Rand()})");primitiveBank.agents=doc.createElement("Agents");primitiveBank.agents.setAttribute("name",getText("New Agent Population"));primitiveBank.agents.setAttribute("Note","");primitiveBank.agents.setAttribute("Size",100);primitiveBank.agents.setAttribute("GeoWrap",!1);primitiveBank.agents.setAttribute("GeoDimUnits","Unitless");primitiveBank.agents.setAttribute("GeoWidth",200);primitiveBank.agents.setAttribute("GeoHeight",100);primitiveBank.agents.setAttribute("Placement","Random");primitiveBank.agents.setAttribute("PlacementFunction","{Rand()*Width(Self), Rand()*Height(Self)}");primitiveBank.agents.setAttribute("Network","None");primitiveBank.agents.setAttribute("NetworkFunction","RandBoolean(0.02)");primitiveBank.agents.setAttribute("Agent","");primitiveBank.agents.setAttribute("Image","None");primitiveBank.agents.setAttribute("FlipHorizontal",!1);primitiveBank.agents.setAttribute("FlipVertical",!1);primitiveBank.agents.setAttribute("LabelPosition","Middle");primitiveBank.agents.setAttribute("ShowSlider",!1);primitiveBank.agents.setAttribute("SliderMax",100);primitiveBank.agents.setAttribute("SliderMin",0);primitiveBank.agents.setAttribute("SliderStep",1);primitiveBank.variable=doc.createElement("Variable");primitiveBank.variable.setAttribute("name",getText("New Variable"));primitiveBank.variable.setAttribute("Note","");primitiveBank.variable.setAttribute("Equation","0");setValuedProperties(primitiveBank.variable);primitiveBank.variable.setAttribute("Image","None");primitiveBank.variable.setAttribute("FlipHorizontal",!1);primitiveBank.variable.setAttribute("FlipVertical",!1);primitiveBank.variable.setAttribute("LabelPosition","Middle");primitiveBank.button=doc.createElement("Button");primitiveBank.button.setAttribute("name",getText("New Button"));primitiveBank.button.setAttribute("Note","");primitiveBank.button.setAttribute("Function",'showMessage("Button action triggered!\\n\\nIf you want to edit this Action, click on the button while holding down the Shift key on your keyboard.")');primitiveBank.button.setAttribute("Image","None");primitiveBank.button.setAttribute("FlipHorizontal",!1);primitiveBank.button.setAttribute("FlipVertical",!1);primitiveBank.button.setAttribute("LabelPosition","Middle");primitiveBank.converter=doc.createElement("Converter");primitiveBank.converter.setAttribute("name",getText("New Converter"));primitiveBank.converter.setAttribute("Note","");primitiveBank.converter.setAttribute("Source","Time");primitiveBank.converter.setAttribute("Data","0,0; 1,1; 2,4; 3,9");primitiveBank.converter.setAttribute("Interpolation","Linear");setValuedProperties(primitiveBank.converter);primitiveBank.converter.setAttribute("Image","None");primitiveBank.converter.setAttribute("FlipHorizontal",!1);primitiveBank.converter.setAttribute("FlipVertical",!1);primitiveBank.converter.setAttribute("LabelPosition","Middle");primitiveBank.flow=doc.createElement("Flow");primitiveBank.flow.setAttribute("name",getText("Flow"));primitiveBank.flow.setAttribute("Note","");primitiveBank.flow.setAttribute("FlowRate","0");primitiveBank.flow.setAttribute("OnlyPositive",!0);primitiveBank.flow.setAttribute("TimeIndependent",!1);setValuedProperties(primitiveBank.flow);primitiveBank.link=doc.createElement("Link");primitiveBank.link.setAttribute("name",getText("Link"));primitiveBank.link.setAttribute("Note","");primitiveBank.link.setAttribute("BiDirectional",!1);primitiveBank.setting=doc.createElement("Setting");primitiveBank.setting.setAttribute("Note","");primitiveBank.setting.setAttribute("Version","36");primitiveBank.setting.setAttribute("Throttle","1");primitiveBank.setting.setAttribute("TimeLength","100");primitiveBank.setting.setAttribute("TimeStart","0");primitiveBank.setting.setAttribute("TimeStep","1");primitiveBank.setting.setAttribute("TimeUnits","Years");primitiveBank.setting.setAttribute("Units","");primitiveBank.setting.setAttribute("SolutionAlgorithm","RK1");primitiveBank.setting.setAttribute("BackgroundColor","white");primitiveBank.setting.setAttribute("Macros","");primitiveBank.setting.setAttribute("SensitivityPrimitives","");primitiveBank.setting.setAttribute("SensitivityRuns",50);primitiveBank.setting.setAttribute("SensitivityBounds","50, 80, 95, 100");primitiveBank.setting.setAttribute("SensitivityShowRuns","false");primitiveBank.setting.setAttribute("StrictUnits","true");primitiveBank.setting.setAttribute("StrictLinks","true");primitiveBank.setting.setAttribute("StrictAgentResolution","true");primitiveBank.setting.setAttribute("StyleSheet","{}");var blankGraphTemplate='<mxGraphModel>\n  <root>\n    <mxCell id="0"/>\n    <mxCell id="1" parent="0"/>\n    <Folder name="Step 2. Share your Insights" Note="" Type="None" Solver="{&quot;enabled&quot;: false, &quot;algorithm&quot;: &quot;RK1&quot;, &quot;timeStep&quot;: 1}" Image="None" FlipHorizontal="false" FlipVertical="false" LabelPosition="Top" AgentBase="" id="44">\n      <mxCell style="folder;dashed=0;fontSize=18;fontFamily=Verdana;fontStyle=1;rounded=0;strokeColor=#C0C0C0;strokeWidth=1;30=10;fillColor=#FFFFFF" parent="1" vertex="1">\n        <mxGeometry x="710" y="90" width="320" height="522" as="geometry"/>\n      </mxCell>\n    </Folder>\n    <Setting Note="" Version="34" TimeLength="20" TimeStart="0" TimeStep="1" TimeUnits="Years" StrictUnits="true" StrictLinks="true" StrictAgentResolution="true" Units="" HiddenUIGroups="Validation,User Interface" SolutionAlgorithm="RK1" BackgroundColor="white" Throttle="1" Macros="" SensitivityPrimitives="" SensitivityRuns="50" SensitivityBounds="50, 80, 95, 100" SensitivityShowRuns="false" id="2">\n      <mxCell parent="1" vertex="1" visible="0">\n        <mxGeometry x="20" y="20" width="80" height="40" as="geometry"/>\n      </mxCell>\n    </Setting>\n    <Display name="Default Display" Note="" Type="Time Series" xAxis="Time (%u)" yAxis="%o" ThreeDimensional="false" Primitives="35" AutoAddPrimitives="true" ScatterplotOrder="X Primitive, Y Primitive" Image="Display" yAxis2="" Primitives2="" showMarkers="false" showLines="true" showArea="false" legendPosition="None" id="3">\n      <mxCell style="roundImage;image=/builder/images/DisplayFull.png;" parent="1" vertex="1" visible="0">\n        <mxGeometry x="50" y="20" width="64" height="64" as="geometry"/>\n      </mxCell>\n    </Display>\n    <Button name="Click me to Clear this Demo Model" Note="" Function="clearModel()" Image="None" FlipHorizontal="false" FlipVertical="false" LabelPosition="Middle" id="23">\n      <mxCell style="button;fontSize=18;fillColor=#FFFF99;strokeColor=#FF9900;fontColor=#FF6600;fontStyle=1;fontFamily=Verdana" parent="1" vertex="1">\n        <mxGeometry x="510" y="12" width="520" height="58" as="geometry"/>\n      </mxCell>\n    </Button>\n    <Picture name="" Note="" Image="List" FlipHorizontal="false" FlipVertical="false" LabelPosition="Bottom" id="46">\n      <mxCell style="picture;image=https://insightmaker.com/builder/images/SD/List.png;imageFlipV=0;imageFlipH=0;shape=image" parent="1" vertex="1">\n        <mxGeometry x="30" y="10" width="64" height="64" as="geometry"/>\n      </mxCell>\n    </Picture>\n    <Text name="Insight Maker Basics" LabelPosition="Middle" id="47">\n      <mxCell style="text;fontStyle=1;fontFamily=Helvetica" parent="1" vertex="1">\n        <mxGeometry x="100" y="17" width="320" height="50" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Picture name="" Note="" Image="Network" FlipHorizontal="false" FlipVertical="false" LabelPosition="Bottom" id="48">\n      <mxCell style="picture;image=https://insightmaker.com/builder/images/SD/Network.png;imageFlipV=0;imageFlipH=0;shape=image" parent="1" vertex="1">\n        <mxGeometry x="950" y="492" width="132" height="132" as="geometry"/>\n      </mxCell>\n    </Picture>\n    <Text name="&lt;i style=&quot;float:left;margin-right:8px;margin-bottom:5px;color:lightgrey&quot; class=&quot;fa fa-3x fa-share-alt&quot;&gt;&lt;/i&gt; Insight Maker models are web pages, so sharing them is as easy as emailing a link or posting it to Twitter or Facebook.&#xa;&#xa;If you have your own web page or blog, you can embed Insight Maker models right in your page.&#xa;&lt;hr style=&quot;width:50%; margin-top:16px;margin-bottom:16px&quot;&gt;&lt;i style=&quot;float:left;margin-right:10px;margin-bottom:5px;color:lightgrey&quot; class=&quot;fa fa-4x fa-file-text-o&quot;&gt;&lt;/i&gt; Insight Maker also provides a great way to explain your model: Stories.&#xa;&#xa;&lt;a href=&quot;/storytelling&quot; target=&quot;_blank&quot;&gt;Stories&lt;/a&gt; create a walkthrough of your model where you can show messages and reveal the model step-by-step.&#xa;&#xa;" LabelPosition="Middle" id="55">\n      <mxCell style="text;fontFamily=Helvetica;fontStyle=0;fontSize=15;align=left;labelPosition=middle;verticalLabelPosition=middle;verticalAlign=middle" parent="1" vertex="1">\n        <mxGeometry x="730" y="128" width="280" height="346" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Folder name="Step 1. Build your Model" Note="" Type="None" Solver="{&quot;enabled&quot;: false, &quot;algorithm&quot;: &quot;RK1&quot;, &quot;timeStep&quot;: 1}" Image="None" FlipHorizontal="false" FlipVertical="false" LabelPosition="Middle" AgentBase="" id="42">\n      <mxCell style="folder;dashed=0;fontSize=18;fontFamily=Verdana;fontStyle=1;image=None;shape=rectangle;rounded=0;strokeColor=#C0C0C0;strokeWidth=1;30=10" parent="1" vertex="1">\n        <mxGeometry x="15" y="90" width="680" height="522" as="geometry">\n          <mxRectangle x="15" y="98" width="250" height="30" as="alternateBounds"/>\n        </mxGeometry>\n      </mxCell>\n    </Folder>\n    <Link name="Link" Note="" BiDirectional="false" id="28">\n      <mxCell style="link;dashed=0;strokeColor=#003366;strokeWidth=5;30=50;endArrow=block" parent="42" source="51" target="49" edge="1">\n        <mxGeometry x="35" width="100" height="100" as="geometry">\n          <mxPoint x="35" y="100" as="sourcePoint"/>\n          <mxPoint x="135" as="targetPoint"/>\n        </mxGeometry>\n      </mxCell>\n    </Link>\n    <Link name="Link" Note="" BiDirectional="false" id="29">\n      <mxCell style="link;strokeColor=#003366;dashed=0;strokeWidth=5;30=50;endArrow=block" parent="42" source="49" target="50" edge="1">\n        <mxGeometry x="35" width="100" height="100" as="geometry">\n          <mxPoint x="35" y="100" as="sourcePoint"/>\n          <mxPoint x="135" as="targetPoint"/>\n          <Array as="points"/>\n        </mxGeometry>\n      </mxCell>\n    </Link>\n    <Text name="Use an extensive set of &lt;a href=&quot;/diagramming&quot; target=&quot;_blank&quot;&gt;drawing tools to create&lt;/a&gt; causal loop diagrams, flow charts or rich pictures. Build the diagram that communicates your insights and mental models.&#xa;&#xa;This diagram is an Insight Maker model. Feel free to change it. Each  picture, textbox or other element is called a &quot;&lt;a href=&quot;/primitives&quot; target=&quot;_blank&quot;&gt;Primitive&lt;/a&gt;&quot;. You can click and drag primitives to move them or edit their contents in the sidebar." LabelPosition="Middle" id="45">\n      <mxCell style="text;fontFamily=Helvetica;fontStyle=0;fontSize=15;align=left;labelPosition=middle;verticalLabelPosition=middle;verticalAlign=middle" parent="42" vertex="1">\n        <mxGeometry x="185" y="36" width="475" height="136" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Picture name="Simulate" Note="" Image="https://insightmaker.com/sites/default/files/misc/kchart.png" FlipHorizontal="false" FlipVertical="false" LabelPosition="Left" id="49">\n      <mxCell style="picture;image=https://insightmaker.com/sites/default/files/misc/kchart.png;imageFlipV=0;imageFlipH=0;shape=image;verticalLabelPosition=middle;verticalAlign=middle;labelPosition=left;align=right;fontStyle=1" parent="42" vertex="1">\n        <mxGeometry x="79" y="223" width="90" height="90" as="geometry"/>\n      </mxCell>\n    </Picture>\n    <Picture name="Analyze" Note="" Image="https://insightmaker.com/sites/default/files/misc/kformula.png" FlipHorizontal="false" FlipVertical="false" LabelPosition="Left" id="50">\n      <mxCell style="picture;image=https://insightmaker.com/sites/default/files/misc/kformula.png;imageFlipV=0;imageFlipH=0;shape=image;verticalLabelPosition=middle;verticalAlign=middle;labelPosition=left;align=right;fontStyle=1" parent="42" vertex="1">\n        <mxGeometry x="79" y="402" width="90" height="90" as="geometry"/>\n      </mxCell>\n    </Picture>\n    <Picture name="Diagram" Note="" Image="https://insightmaker.com/sites/default/files/misc/kivio.png" FlipHorizontal="false" FlipVertical="false" LabelPosition="Left" id="51">\n      <mxCell style="picture;image=https://insightmaker.com/sites/default/files/misc/kivio.png;imageFlipV=0;imageFlipH=0;shape=image;verticalLabelPosition=middle;verticalAlign=middle;labelPosition=left;align=right;fontStyle=1" parent="42" vertex="1">\n        <mxGeometry x="79" y="40" width="90" height="90" as="geometry"/>\n      </mxCell>\n    </Picture>\n    <Text name="Add equations to your model to &lt;a href=&quot;/simulating&quot; target=&quot;_blank&quot;&gt;simulate&lt;/a&gt; future behavior and changes. Use a powerful &lt;a href=&quot;/equations&quot; target=&quot;_blank&quot;&gt;equation language&lt;/a&gt; and large library of &lt;a href=&quot;/functions&quot; target=&quot;_blank&quot;&gt;built-in functions&lt;/a&gt; to simulate &lt;a href=&quot;/systemdynamics&quot; target=&quot;_blank&quot;&gt;System Dynamics&lt;/a&gt; or &lt;a href=&quot;/agentbased&quot; target=&quot;_blank&quot;&gt;Agent Based Models&lt;/a&gt;. View and explore results directly within Insight Maker." LabelPosition="Middle" id="52">\n      <mxCell style="text;fontFamily=Helvetica;fontStyle=0;fontSize=15;align=left;labelPosition=middle;verticalLabelPosition=middle;verticalAlign=middle" parent="42" vertex="1">\n        <mxGeometry x="185" y="215" width="290" height="120" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name="Analyze your model results. Study the trends to understand the dynamics of your system. Use Insight Maker&#39;s &lt;a href=&quot;/sensitivitytesting&quot; target=&quot;_blank&quot;&gt;Sensitivity Testing Tool&lt;/a&gt; to understand the effect of randomness. Apply Insight Maker&#39;s &lt;a href=&quot;/optimization&quot; target=&quot;_blank&quot;&gt;Optimization Tool&lt;/a&gt; to maximize or minimize a goal. Utilize Insight Maker&#39;s &lt;a href=&quot;/scripting&quot; target=&quot;_blank&quot;&gt;scripting&lt;/a&gt; capabilities to take complete control of your analysis." LabelPosition="Middle" id="53">\n      <mxCell style="text;fontFamily=Helvetica;fontStyle=0;fontSize=15;align=left;labelPosition=middle;verticalLabelPosition=middle;verticalAlign=middle" parent="42" vertex="1">\n        <mxGeometry x="185" y="387" width="475" height="120" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Folder name="Product Adoption" Note="" Type="None" Solver="{&quot;enabled&quot;: false, &quot;algorithm&quot;: &quot;RK1&quot;, &quot;timeStep&quot;: 1}" Image="None" FlipHorizontal="false" FlipVertical="false" LabelPosition="Middle" AgentBase="" id="41">\n      <mxCell style="folder;strokeWidth=1;30=10;fontSize=13;image=None;shape=rectangle;" parent="42" vertex="1">\n        <mxGeometry x="490" y="213" width="170" height="122" as="geometry">\n          <mxRectangle x="490" y="213" width="170" height="27" as="alternateBounds"/>\n        </mxGeometry>\n      </mxCell>\n    </Folder>\n    <Stock name="Users" Note="" InitialValue="1000" StockMode="Store" Delay="10" Volume="100" NonNegative="false" Units="Unitless" MaxConstraintUsed="false" MinConstraintUsed="false" MaxConstraint="100" MinConstraint="0" ShowSlider="false" SliderMax="100" SliderMin="0" SliderStep="" Image="None" FlipHorizontal="false" FlipVertical="false" LabelPosition="Middle" id="35">\n      <mxCell style="stock;fontSize=9;strokeWidth=1;30=10" parent="41" vertex="1">\n        <mxGeometry x="20" y="90" width="40" height="20" as="geometry"/>\n      </mxCell>\n    </Stock>\n    <Flow name="Adoption" Note="" FlowRate="[Users]*[Rate]" OnlyPositive="true" TimeIndependent="false" Units="Unitless" MaxConstraintUsed="false" MinConstraintUsed="false" MaxConstraint="100" MinConstraint="0" ShowSlider="false" SliderMax="100" SliderMin="0" SliderStep="" id="36">\n      <mxCell style="flow;fontSize=9;strokeWidth=2;30=20" parent="41" target="35" edge="1">\n        <mxGeometry x="-680" y="-150" width="100" height="100" as="geometry">\n          <mxPoint x="40" y="40" as="sourcePoint"/>\n          <mxPoint x="-680" y="-50" as="targetPoint"/>\n        </mxGeometry>\n      </mxCell>\n    </Flow>\n    <Variable name="Rate" Note="" Equation="0.2" Units="Unitless" MaxConstraintUsed="false" MinConstraintUsed="false" MaxConstraint="100" MinConstraint="0" ShowSlider="false" SliderMax="100" SliderMin="0" SliderStep="" Image="None" FlipHorizontal="false" FlipVertical="false" LabelPosition="Middle" id="37">\n      <mxCell style="variable;fontSize=9;strokeWidth=1;30=10" parent="41" vertex="1">\n        <mxGeometry x="60" y="25" width="40" height="20" as="geometry"/>\n      </mxCell>\n    </Variable>\n    <Link name="Link" Note="" BiDirectional="false" id="38">\n      <mxCell style="link;strokeWidth=1;30=10" parent="41" source="37" target="36" edge="1">\n        <mxGeometry x="-650" y="-150" width="100" height="100" as="geometry">\n          <mxPoint x="-650" y="-50" as="sourcePoint"/>\n          <mxPoint x="-550" y="-150" as="targetPoint"/>\n          <Array as="points">\n            <mxPoint x="50" y="42"/>\n          </Array>\n        </mxGeometry>\n      </mxCell>\n    </Link>\n    <Button name="Click me to Simulate" Note="" Function="runModel();" Image="None" FlipHorizontal="false" FlipVertical="false" LabelPosition="Middle" id="40">\n      <mxCell style="button;fillColor=#B3E2CD;strokeWidth=2;30=20;fontSize=12" parent="41" vertex="1">\n        <mxGeometry x="80" y="63" width="75" height="35" as="geometry"/>\n      </mxCell>\n    </Button>\n  </root>\n</mxGraphModel>\n';function setConverterInit(t){var e=parseFloat(getTimeStart(),10),i=parseFloat(getTimeStart(),10)+parseFloat(getTimeLength(),10);t.setAttribute("Data",e+","+Math.pow(e,2)+"; "+(e+i)/2+","+Math.pow((e+i)/2,2)+"; "+i+","+Math.pow(i,2))}if(void 0===org||!org)var org={};void 0!==org.antlr&&org.antlr||(org.antlr={});org.antlr.global=function(){return this}.call(null);org.antlr.namespace=function(){var t,e,i,n=arguments,r=null;for(t=0;t<n.length;t+=1){i=n[t].split(".");r=org.antlr.global;for(e=0;e<i.length;e+=1){r[i[e]]=r[i[e]]||{};r=r[i[e]]}}return r};org.antlr.env=org.antlr.env||{};org.antlr.env.ua=function(){var t,e,i={ie:0,opera:0,gecko:0,webkit:0,mobile:null,air:0,rhino:!1};try{t=navigator.userAgent;/KHTML/.test(t)&&(i.webkit=1);if((e=t.match(/AppleWebKit\/([^\s]*)/))&&e[1]){i.webkit=parseFloat(e[1]);/ Mobile\//.test(t)?i.mobile="Apple":(e=t.match(/NokiaN[^\/]*/))&&(i.mobile=e[0]);(e=t.match(/AdobeAIR\/([^\s]*)/))&&(i.air=e[0])}if(!i.webkit)if((e=t.match(/Opera[\s\/]([^\s]*)/))&&e[1]){i.opera=parseFloat(e[1]);(e=t.match(/Opera Mini[^;]*/))&&(i.mobile=e[0])}else if((e=t.match(/MSIE\s([^;]*)/))&&e[1])i.ie=parseFloat(e[1]);else if(e=t.match(/Gecko\/([^\s]*)/)){i.gecko=1;(e=t.match(/rv:([^\s\)]*)/))&&e[1]&&(i.gecko=parseFloat(e[1]))}}catch(t){}try{"undefined"==typeof window&&"undefined"!=typeof loadClass&&(i.rhino=!0)}catch(t){}return i}();org.antlr.namespace("org.antlr.runtime.tree");org.antlr.lang=org.antlr.lang||{isArray:function(t){if(t){var e=org.antlr.lang;return e.isNumber(t.length)&&e.isFunction(t.splice)}return!1},isBoolean:function(t){return"boolean"==typeof t},isFunction:function(t){return"function"==typeof t},isNull:function(t){return null===t},isNumber:function(t){return"number"==typeof t&&isFinite(t)},isObject:function(t){return t&&("object"==typeof t||org.antlr.lang.isFunction(t))||!1},isString:function(t){return"string"==typeof t},isUndefined:function(t){return void 0===t},_IEEnumFix:function(t,e){if(org.antlr.env.ua.ie){var i,n=["toString","valueOf"];for(i=0;i<n.length;i+=1){var r=n[i],a=e[r];org.antlr.lang.isFunction(a)&&a!=Object.prototype[r]&&(t[r]=a)}}},extend:function(t,e,i){if(!e||!t)throw new Error("org.antlr.lang.extend failed, please check that all dependencies are included.");var n=function(){};n.prototype=e.prototype;t.prototype=new n;t.prototype.constructor=t;t.superclass=e.prototype;e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e);if(i){for(var r in i)t.prototype[r]=i[r];org.antlr.lang._IEEnumFix(t.prototype,i)}},augmentObject:function(t,e){if(!e||!t)throw new Error("Absorb failed, verify dependencies.");var i,n,r=arguments,a=r[2];if(a&&!0!==a)for(i=2;i<r.length;i+=1)t[r[i]]=e[r[i]];else{for(n in e)!a&&t[n]||(t[n]=e[n]);org.antlr.lang._IEEnumFix(t,e)}},augmentProto:function(t,e){if(!e||!t)throw new Error("Augment failed, verify dependencies.");for(var i=[t.prototype,e.prototype],n=2;n<arguments.length;n+=1)i.push(arguments[n]);org.antlr.lang.augmentObject.apply(this,i)},merge:function(){for(var t={},e=arguments,i=0,n=e.length;i<n;i+=1)org.antlr.lang.augmentObject(t,e[i],!0);return t},isValue:function(t){var e=org.antlr.lang;return e.isObject(t)||e.isString(t)||e.isNumber(t)||e.isBoolean(t)},array:{peek:function(t){if(!org.antlr.lang.isArray(t))throw new Error("org.antlr.lang.array.peek: a is not an array.");var e=t.length;if(e<=0)throw new Error("org.antlr.lang.array.peek: a is empty.");return t[e-1]}}};void 0!==org.antlr.runtime&&org.antlr.runtime||(org.antlr.runtime={});org.antlr.runtime.RecognitionException=function(t){org.antlr.runtime.RecognitionException.superclass.constructor.call(this);this.input=t;this.index=t.index();if(t instanceof org.antlr.runtime.TokenStream){this.token=t.LT(1);this.line=this.token.getLine();this.charPositionInLine=this.token.getCharPositionInLine()}if(t instanceof org.antlr.runtime.tree.TreeNodeStream)this.extractInformationFromTreeNodeStream(t);else if(t instanceof org.antlr.runtime.CharStream){this.c=t.LA(1);this.line=t.getLine();this.charPositionInLine=t.getCharPositionInLine()}else this.c=t.LA(1);this.message=this.toString()};org.antlr.lang.extend(org.antlr.runtime.RecognitionException,Error,{input:null,index:null,token:null,node:null,c:null,line:null,name:"org.antlr.runtime.RecognitionException",charPositionInLine:null,approximateLineInfo:null,extractInformationFromTreeNodeStream:function(t){var e,i,n,r,a,s=t;this.node=s.LT(1);var o=s.getTreeAdaptor(),l=o.getToken(this.node);if(l){this.token=l;if(l.getLine()<=0){a=-1;e=s.LT(a);for(;e;){if((i=o.getToken(e))&&i.getLine()>0){this.line=i.getLine();this.charPositionInLine=i.getCharPositionInLine();this.approximateLineInfo=!0;break}--a;e=s.LT(a)}}else{this.line=l.getLine();this.charPositionInLine=l.getCharPositionInLine()}}else if(this.node instanceof org.antlr.runtime.tree.Tree){this.line=this.node.getLine();this.charPositionInLine=this.node.getCharPositionInLine();this.node instanceof org.antlr.runtime.tree.CommonTree&&(this.token=this.node.token)}else{n=o.getType(this.node);r=o.getText(this.node);this.token=new org.antlr.runtime.CommonToken(n,r)}},getUnexpectedType:function(){if(this.input instanceof org.antlr.runtime.TokenStream)return this.token.getType();if(this.input instanceof org.antlr.runtime.tree.TreeNodeStream){return this.input.getTreeAdaptor().getType(this.node)}return this.c}});org.antlr.runtime.CharStream=function(){};org.antlr.runtime.IntStream=function(){};org.antlr.lang.extend(org.antlr.runtime.CharStream,org.antlr.runtime.IntStream);org.antlr.lang.augmentObject(org.antlr.runtime.CharStream,{EOF:-1});org.antlr.runtime.Token=function(){};org.antlr.lang.augmentObject(org.antlr.runtime.Token,{EOR_TOKEN_TYPE:1,DOWN:2,UP:3,MIN_TOKEN_TYPE:4,EOF:org.antlr.runtime.CharStream.EOF,EOF_TOKEN:null,INVALID_TOKEN_TYPE:0,INVALID_TOKEN:null,SKIP_TOKEN:null,DEFAULT_CHANNEL:0,HIDDEN_CHANNEL:99});org.antlr.runtime.MismatchedTokenException=function(t,e){if(0===arguments.length)this.expecting=org.antlr.runtime.Token.INVALID_TOKEN_TYPE;else{org.antlr.runtime.MismatchedTokenException.superclass.constructor.call(this,e);this.expecting=t}};org.antlr.lang.extend(org.antlr.runtime.MismatchedTokenException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedTokenException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedTokenException"});org.antlr.runtime.UnwantedTokenException=function(t,e){arguments.length>0&&org.antlr.runtime.UnwantedTokenException.superclass.constructor.call(this,t,e)};org.antlr.lang.extend(org.antlr.runtime.UnwantedTokenException,org.antlr.runtime.MismatchedTokenException,{getUnexpectedToken:function(){return this.token},toString:function(){var t=", expected "+this.expecting;this.expecting===org.antlr.runtime.Token.INVALID_TOKEN_TYPE&&(t="");return org.antlr.lang.isValue(this.token)?"UnwantedTokenException(found="+this.token.getText()+t+")":"UnwantedTokenException(found="+t+")"},name:"org.antlr.runtime.UnwantedTokenException"});org.antlr.runtime.CommonToken=function(){var t;this.charPositionInLine=-1;this.channel=0;this.index=-1;if(1==arguments.length)if(org.antlr.lang.isNumber(arguments[0]))this.type=arguments[0];else{t=arguments[0];this.text=t.getText();this.type=t.getType();this.line=t.getLine();this.index=t.getTokenIndex();this.charPositionInLine=t.getCharPositionInLine();this.channel=t.getChannel();if(t instanceof org.antlr.runtime.CommonToken){this.start=t.start;this.stop=t.stop}}else if(2==arguments.length){this.type=arguments[0];this.text=arguments[1];this.channel=0}else if(5==arguments.length){this.input=arguments[0];this.type=arguments[1];this.channel=arguments[2];this.start=arguments[3];this.stop=arguments[4]}};org.antlr.lang.extend(org.antlr.runtime.CommonToken,org.antlr.runtime.Token,{getType:function(){return this.type},setLine:function(t){this.line=t},getText:function(){if(org.antlr.lang.isString(this.text))return this.text;if(!this.input)return null;this.text=this.input.substring(this.start,this.stop);return this.text},setText:function(t){this.text=t},getLine:function(){return this.line},getCharPositionInLine:function(){return this.charPositionInLine},setCharPositionInLine:function(t){this.charPositionInLine=t},getChannel:function(){return this.channel},setChannel:function(t){this.channel=t},setType:function(t){this.type=t},getStartIndex:function(){return this.start},setStartIndex:function(t){this.start=t},getStopIndex:function(){return this.stop},setStopIndex:function(t){this.stop=t},getTokenIndex:function(){return this.index},setTokenIndex:function(t){this.index=t},getInputStream:function(){return this.input},setInputStream:function(t){this.input=t},toString:function(){var t="";this.channel>0&&(t=",channel="+this.channel);var e=this.getText();e=org.antlr.lang.isNull(e)?"<no text>":(e=(e=e.replace(/\n/g,"\\\\n")).replace(/\r/g,"\\\\r")).replace(/\t/g,"\\\\t");return"[@"+this.getTokenIndex()+","+this.start+":"+this.stop+"='"+e+"',<"+this.type+">"+t+","+this.line+":"+this.getCharPositionInLine()+"]"}});org.antlr.lang.augmentObject(org.antlr.runtime.Token,{EOF_TOKEN:new org.antlr.runtime.CommonToken(org.antlr.runtime.CharStream.EOF),INVALID_TOKEN:new org.antlr.runtime.CommonToken(0),SKIP_TOKEN:new org.antlr.runtime.CommonToken(0)},!0);org.antlr.runtime.CommonTokenStream=function(t,e){this.p=-1;this.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL;this.v_discardOffChannelTokens=!1;this.tokens=[];arguments.length>=2?this.channel=e:1===arguments.length&&(this.tokenSource=t)};org.antlr.runtime.TokenStream=function(){};org.antlr.lang.extend(org.antlr.runtime.CommonTokenStream,org.antlr.runtime.TokenStream,{setTokenSource:function(t){this.tokenSource=t;this.tokens=[];this.p=-1;this.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL},fillBuffer:function(){for(var t,e,i=0,n=this.tokenSource.nextToken();org.antlr.lang.isValue(n)&&n.getType()!=org.antlr.runtime.CharStream.EOF;){t=!1;if(this.channelOverrideMap){e=this.channelOverrideMap[n.getType()];org.antlr.lang.isValue(e)&&n.setChannel(e)}(this.discardSet&&this.discardSet[n.getType()]||this.v_discardOffChannelTokens&&n.getChannel()!=this.channel)&&(t=!0);if(!t){n.setTokenIndex(i);this.tokens.push(n);i++}n=this.tokenSource.nextToken()}this.p=0;this.p=this.skipOffTokenChannels(this.p)},consume:function(){if(this.p<this.tokens.length){this.p++;this.p=this.skipOffTokenChannels(this.p)}},skipOffTokenChannels:function(t){for(var e=this.tokens.length;t<e&&this.tokens[t].getChannel()!=this.channel;)t++;return t},skipOffTokenChannelsReverse:function(t){for(;t>=0&&this.tokens[t].getChannel()!=this.channel;)t--;return t},setTokenTypeChannel:function(t,e){this.channelOverrideMap||(this.channelOverrideMap={});this.channelOverrideMap[t]=e},discardTokenType:function(t){this.discardSet||(this.discardSet={});this.discardSet[t]=!0},discardOffChannelTokens:function(t){this.v_discardOffChannelTokens=t},getTokens:function(t,e,i){-1===this.p&&this.fillBuffer();if(0===arguments.length)return this.tokens;org.antlr.lang.isArray(i)?i=new org.antlr.runtime.BitSet(i):org.antlr.lang.isNumber(i)&&(i=org.antlr.runtime.BitSet.of(i));e>=this.tokens.length&&(e=this.tokens.length-1);t<0&&(t=0);if(t>e)return null;var n,r,a=[];for(n=t;n<=e;n++){r=this.tokens[n];this.types&&!i.member(r.getType())||a.push(r)}0===a.length&&(a=null);return a},LT:function(t){-1===this.p&&this.fillBuffer();if(0===t)return null;if(t<0)return this.LB(-1*t);if(this.p+t-1>=this.tokens.length)return org.antlr.runtime.Token.EOF_TOKEN;for(var e=this.p,i=1;i<t;){e=this.skipOffTokenChannels(e+1);i++}return e>=this.tokens.length?org.antlr.runtime.Token.EOF_TOKEN:this.tokens[e]},LB:function(t){-1===this.p&&this.fillBuffer();if(0===t)return null;if(this.p-t<0)return null;for(var e=this.p,i=1;i<=t;){e=this.skipOffTokenChannelsReverse(e-1);i++}return e<0?null:this.tokens[e]},get:function(t){return this.tokens[t]},LA:function(t){return this.LT(t).getType()},mark:function(){-1===this.p&&this.fillBuffer();this.lastMarker=this.index();return this.lastMarker},release:function(t){},size:function(){return this.tokens.length},index:function(){return this.p},rewind:function(t){org.antlr.lang.isNumber(t)||(t=this.lastMarker);this.seek(t)},reset:function(){this.p=0;this.lastMarker=0},seek:function(t){this.p=t},getTokenSource:function(){return this.tokenSource},getSourceName:function(){return this.getTokenSource().getSourceName()},toString:function(t,e){if(0===arguments.length){-1===this.p&&this.fillBuffer();t=0;e=this.tokens.length-1}if(!org.antlr.lang.isNumber(t)&&!org.antlr.lang.isNumber(e)){if(!org.antlr.lang.isValue(t)||!org.antlr.lang.isValue(e))return null;t=t.getTokenIndex();e=e.getTokenIndex()}var i,n="";if(t<0||e<0)return null;-1==this.p&&this.fillBuffer();e>=this.tokens.length&&(e=this.tokens.length-1);for(i=t;i<=e;i++){this.tokens[i];n+=this.tokens[i].getText()}return n}});org.antlr.runtime.TokenRewriteStream=function(){var t=org.antlr.runtime.TokenRewriteStream.superclass;this.programs=null;this.lastRewriteTokenIndexes=null;if(0===arguments.length)this.init();else{t.constructor.apply(this,arguments);this.init()}};!function(){var t=org.antlr.runtime.TokenRewriteStream;org.antlr.lang.augmentObject(t,{DEFAULT_PROGRAM_NAME:"default",PROGRAM_INIT_SIZE:100,MIN_TOKEN_INDEX:0});t.RewriteOperation=function(t,e){this.index=t;this.text=e};t.RewriteOperation.prototype={execute:function(t){return this.index},toString:function(){return this.text}};t.InsertBeforeOp=function(e,i){t.InsertBeforeOp.superclass.constructor.call(this,e,i)};org.antlr.lang.extend(t.InsertBeforeOp,t.RewriteOperation,{execute:function(t){t.push(this.text);return this.index}});t.ReplaceOp=function(e,i,n){t.ReplaceOp.superclass.constructor.call(this,e,n);this.lastIndex=i};org.antlr.lang.extend(t.ReplaceOp,t.RewriteOperation,{execute:function(t){org.antlr.lang.isValue(this.text)&&t.push(this.text);return this.lastIndex+1}});t.DeleteOp=function(e,i){t.DeleteOp.superclass.constructor.call(this,e,i)};org.antlr.lang.extend(t.DeleteOp,t.ReplaceOp);org.antlr.lang.extend(t,org.antlr.runtime.CommonTokenStream,{init:function(){this.programs={};this.programs[t.DEFAULT_PROGRAM_NAME]=[];this.lastRewriteTokenIndexes={}},rollback:function(){var e;if(1===arguments.length){e=t.DEFAULT_PROGRAM_NAME;arguments[0]}else if(2===arguments.length){e=arguments[0];arguments[1]}var i=this.programs[e];i&&(programs[e]=i.slice(t.MIN_TOKEN_INDEX,this.instructionIndex))},deleteProgram:function(e){e=e||t.DEFAULT_PROGRAM_NAME;this.rollback(e,t.MIN_TOKEN_INDEX)},addToSortedRewriteList:function(){var e,i;if(1===arguments.length){e=t.DEFAULT_PROGRAM_NAME;i=arguments[0]}else if(2===arguments.length){e=arguments[0];i=arguments[1]}var n,r,a,s,o,l,u=this.getProgram(e);for(r=0,n=u.length;r<n;r++){if((a=u[r]).index===i.index){if(i instanceof t.ReplaceOp){s=!1;for(l=r;l<u.length&&(o=u[r]).index===i.index;l++)if(o instanceof t.ReplaceOp){u[r]=i;s=!0;break}s||u.splice(l,0,i)}else u.splice(r,0,i);break}if(a.index>i.index){u.splice(r,0,i);break}}r===n&&u.push(i)},insertAfter:function(){var e,i,n;if(2===arguments.length){i=t.DEFAULT_PROGRAM_NAME;e=arguments[0];n=arguments[1]}else if(3===arguments.length){i=arguments[0];e=arguments[1];n=arguments[2]}e instanceof org.antlr.runtime.Token&&(e=e.index);this.insertBefore(i,e+1,n)},insertBefore:function(){var e,i,n;if(2===arguments.length){i=t.DEFAULT_PROGRAM_NAME;e=arguments[0];n=arguments[1]}else if(3===arguments.length){i=arguments[0];e=arguments[1];n=arguments[2]}e instanceof org.antlr.runtime.Token&&(e=e.index);this.addToSortedRewriteList(i,new t.InsertBeforeOp(e,n))},replace:function(){var e,i,n,r;if(2===arguments.length){e=t.DEFAULT_PROGRAM_NAME;i=arguments[0];n=arguments[0];r=arguments[1]}else if(3===arguments.length){e=t.DEFAULT_PROGRAM_NAME;i=arguments[0];n=arguments[1];r=arguments[2]}if(4===arguments.length){e=arguments[0];i=arguments[1];n=arguments[2];r=arguments[3]}i instanceof org.antlr.runtime.Token&&(i=i.index);n instanceof org.antlr.runtime.Token&&(n=n.index);i>n||n<0||i<0||this.addToSortedRewriteList(e,new t.ReplaceOp(i,n,r))},remove:function(){for(var t=[],e=arguments.length-1;e>=0;){t[e]=arguments[e];e--}t.push("");this.replace.apply(this,t)},getLastRewriteTokenIndex:function(e){e=e||t.DEFAULT_PROGRAM_NAME;return this.lastRewriteTokenIndexes[e]||-1},setLastRewriteTokenIndex:function(t,e){this.lastRewriteTokenIndexes[t]=e},getProgram:function(t){var e=this.programs[t];e||(e=this.initializeProgram(t));return e},initializeProgram:function(t){var e=[];this.programs[t]=e;return e},toOriginalString:function(e,i){org.antlr.lang.isNumber(e)||(e=t.MIN_TOKEN_INDEX);org.antlr.lang.isNumber(i)||(i=this.size()-1);var n,r=[];for(n=e;n>=t.MIN_TOKEN_INDEX&&n<=i&&n<this.tokens.length;n++)r.push(this.get(n).getText());return r.join("")},toString:function(){var e,i,n;if(0===arguments.length){e=t.DEFAULT_PROGRAM_NAME;i=t.MIN_TOKEN_INDEX;n=this.size()-1}else if(1===arguments.length){e=arguments[0];i=t.MIN_TOKEN_INDEX;n=this.size()-1}else if(2===arguments.length){e=t.DEFAULT_PROGRAM_NAME;i=arguments[0];n=arguments[1]}var r=this.programs[e];if(!r||0===r.length)return this.toOriginalString(i,n);for(var a,s,o=0,l=i,u=[];l>=t.MIN_TOKEN_INDEX&&l<=n&&l<this.tokens.length;){if(o<r.length){a=r[o];for(;a.index<l&&o<r.length;)++o<r.length&&(a=r[o]);for(;l===a.index&&o<r.length;){l=a.execute(u);++o<r.length&&(a=r[o])}}if(l<=n){u.push(this.get(l).getText());l++}}for(s=o;s<r.length;s++)(a=r[s]).index>=this.size()&&a.execute(u);return u.join("")},toDebugString:function(e,i){org.antlr.lang.isNumber(e)||(e=t.MIN_TOKEN_INDEX);org.antlr.lang.isNumber(i)||(i=this.size()-1);var n,r=[];for(n=e;n>=t.MIN_TOKEN_INDEX&&n<=i&&n<this.tokens.length;n++)r.push(this.get(n));return r.join("")}})}();org.antlr.runtime.ANTLRStringStream=function(t){this.p=0;this.line=1;this.charPositionInLine=0;this.markDepth=0;this.markers=null;this.lastMarker=null;this.data=t;this.n=t.length};org.antlr.lang.extend(org.antlr.runtime.ANTLRStringStream,org.antlr.runtime.CharStream,{reset:function(){this.p=0;this.line=1;this.charPositionInLine=0;this.markDepth=0},consume:function(){if(this.p<this.n){this.charPositionInLine++;if("\n"===this.data.charAt(this.p)){this.line++;this.charPositionInLine=0}this.p++}},LA:function(t){t<0&&t++;var e=this.p+t-1;return e>=this.n||e<0?org.antlr.runtime.CharStream.EOF:this.data.charAt(e)},index:function(){return this.p},size:function(){return this.n},mark:function(){if(!this.markers){this.markers=[];this.markers.push(null)}this.markDepth++;var t=null;if(this.markDepth>=this.markers.length){t={};this.markers.push(t)}else t=this.markers[this.markDepth];t.p=this.p;t.line=this.line;t.charPositionInLine=this.charPositionInLine;this.lastMarker=this.markDepth;return this.markDepth},rewind:function(t){org.antlr.lang.isNumber(t)||(t=this.lastMarker);var e=this.markers[t];this.seek(e.p);this.line=e.line;this.charPositionInLine=e.charPositionInLine;this.release(t)},release:function(t){this.markDepth=t;this.markDepth--},seek:function(t){if(t<=this.p)this.p=t;else for(;this.p<t;)this.consume()},substring:function(t,e){return this.data.substr(t,e-t+1)},getLine:function(){return this.line},getCharPositionInLine:function(){return this.charPositionInLine},setLine:function(t){this.line=t},setCharPositionInLine:function(t){this.charPositionInLine=t},getSourceName:function(){return null}});org.antlr.runtime.ANTLRStringStream.prototype.LT=org.antlr.runtime.ANTLRStringStream.prototype.LA;org.antlr.runtime.ANTLRFileStream=function(t,e){this.fileName=t;if(!org.antlr.env.ua.rhino)throw new Error("ANTLR File I/O is not supported in this JS implementation.");var i=this["loadFileUsingJava"](t,e);org.antlr.runtime.ANTLRFileStream.superclass.constructor.call(this,i)};org.antlr.lang.extend(org.antlr.runtime.ANTLRFileStream,org.antlr.runtime.ANTLRStringStream,{getSourceName:function(){return this.fileName},loadFileUsingJava:function(t,e){var i,n=new java.io.File(t),r=n.length(),a=new java.io.FileInputStream(n);i=e?new java.io.InputStreamReader(a,e):new java.io.InputStreamReader(a);var s=java.lang.reflect.Array.newInstance(java.lang.Character.TYPE,r);i.read(s,0,r);return new String(new java.lang.String(s))}});org.antlr.runtime.BaseRecognizer=function(t){this.state=t||new org.antlr.runtime.RecognizerSharedState};org.antlr.lang.augmentObject(org.antlr.runtime.BaseRecognizer,{MEMO_RULE_FAILED:-2,MEMO_RULE_UNKNOWN:-1,INITIAL_FOLLOW_STACK_SIZE:100,MEMO_RULE_FAILED_I:-2,DEFAULT_TOKEN_CHANNEL:org.antlr.runtime.Token.DEFAULT_CHANNEL,HIDDEN:org.antlr.runtime.Token.HIDDEN_CHANNEL,NEXT_TOKEN_RULE_NAME:"nextToken"});org.antlr.runtime.BaseRecognizer.prototype={reset:function(){var t,e;if(this.state){this.state._fsp=-1;this.state.errorRecovery=!1;this.state.lastErrorIndex=-1;this.state.failed=!1;this.state.syntaxErrors=0;this.state.backtracking=0;if(this.state.ruleMemo)for(t=0,e=this.state.ruleMemo.length;t<e;t++)this.state.ruleMemo[t]=null}},match:function(t,e,i){var n=this.getCurrentInputSymbol(t);if(t.LA(1)===e){t.consume();this.state.errorRecovery=!1;this.state.failed=!1;return n}if(this.state.backtracking>0){this.state.failed=!0;return n}return n=this.recoverFromMismatchedToken(t,e,i)},matchAny:function(t){this.state.errorRecovery=!1;this.state.failed=!1;t.consume()},mismatchIsUnwantedToken:function(t,e){return t.LA(2)===e},mismatchIsMissingToken:function(t,e){if(!e)return!1;if(e.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE)){this.computeContextSensitiveRuleFOLLOW();e=e.or(this.viableTokensFollowingThisRule);this.state._fsp>=0&&e.remove(org.antlr.runtime.Token.EOR_TOKEN_TYPE)}return!(!e.member(t.LA(1))&&!e.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE))},mismatch:function(t,e,i){if(this.mismatchIsUnwantedToken(t,e))throw new org.antlr.runtime.UnwantedTokenException(e,t);if(this.mismatchIsMissingToken(t,i))throw new org.antlr.runtime.MissingTokenException(e,t,null);throw new org.antlr.runtime.MismatchedTokenException(e,t)},reportError:function(t){if(!this.state.errorRecovery){this.state.syntaxErrors++;this.state.errorRecovery=!0;this.displayRecognitionError(this.getTokenNames(),t)}},displayRecognitionError:function(t,e){var i=this.getErrorHeader(e),n=this.getErrorMessage(e,t);this.emitErrorMessage(i+" "+n)},getErrorHeader:function(t){org.antlr.lang.isNumber(t.line)||(t.line=0);return"line "+t.line+":"+t.charPositionInLine},emitErrorMessage:function(t){"undefined"!=typeof window&&window.alert?alert(t):print(t)},getErrorMessage:function(t,e){var i,n,r=t&&t.getMessage?t.getMessage():null;if(t instanceof org.antlr.runtime.UnwantedTokenException){var a=t;n="<unknown>";n=a.expecting==org.antlr.runtime.Token.EOF?"EOF":e[a.expecting];r="extraneous input "+this.getTokenErrorDisplay(a.getUnexpectedToken())+" expecting "+n}else if(t instanceof org.antlr.runtime.MissingTokenException){n="<unknown>";r="missing "+(n=(i=t).expecting==org.antlr.runtime.Token.EOF?"EOF":e[i.expecting])+" at "+this.getTokenErrorDisplay(t.token)}else if(t instanceof org.antlr.runtime.MismatchedTokenException){n="<unknown>";n=(i=t).expecting==org.antlr.runtime.Token.EOF?"EOF":e[i.expecting];r="mismatched input "+this.getTokenErrorDisplay(t.token)+" expecting "+n}else t instanceof org.antlr.runtime.NoViableAltException?r="no viable alternative at input "+this.getTokenErrorDisplay(t.token):t instanceof org.antlr.runtime.EarlyExitException?r="required (...)+ loop did not match anything at input "+this.getTokenErrorDisplay(t.token):t instanceof org.antlr.runtime.MismatchedSetException||t instanceof org.antlr.runtime.MismatchedNotSetException?r="mismatched input "+this.getTokenErrorDisplay(t.token)+" expecting set "+t.expecting:t instanceof org.antlr.runtime.FailedPredicateException&&(r="rule "+t.ruleName+" failed predicate: {"+t.predicateText+"}?");return r},getNumberOfSyntaxErrors:function(){return this.state.syntaxErrors},getTokenErrorDisplay:function(t){var e=t.getText();org.antlr.lang.isValue(e)||(e=t.getType()==org.antlr.runtime.Token.EOF?"<EOF>":"<"+t.getType()+">");return"'"+(e=(e=(e=e.replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace(/\t/g,"\\t"))+"'"},recover:function(t,e){this.state.lastErrorIndex==t.index()&&t.consume();this.state.lastErrorIndex=t.index();var i=this.computeErrorRecoverySet();this.beginResync();this.consumeUntil(t,i);this.endResync()},beginResync:function(){},endResync:function(){},computeErrorRecoverySet:function(){return this.combineFollows(!1)},computeContextSensitiveRuleFOLLOW:function(){return this.combineFollows(!0)},combineFollows:function(t){var e,i,n=this.state._fsp,r=new org.antlr.runtime.BitSet;for(e=n;e>=0;e--){i=this.state.following[e];r.orInPlace(i);if(t){if(!i.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE))break;e>0&&r.remove(org.antlr.runtime.Token.EOR_TOKEN_TYPE)}}return r},recoverFromMismatchedToken:function(t,e,i){var n=null;if(this.mismatchIsUnwantedToken(t,e)){n=new org.antlr.runtime.UnwantedTokenException(e,t);this.beginResync();t.consume();this.endResync();this.reportError(n);var r=this.getCurrentInputSymbol(t);t.consume();return r}if(this.mismatchIsMissingToken(t,i)){var a=this.getMissingSymbol(t,n,e,i);n=new org.antlr.runtime.MissingTokenException(e,t,a);this.reportError(n);return a}throw n=new org.antlr.runtime.MismatchedTokenException(e,t)},recoverFromMismatchedSet:function(t,e,i){if(this.mismatchIsMissingToken(t,i)){this.reportError(e);return this.getMissingSymbol(t,e,org.antlr.runtime.Token.INVALID_TOKEN_TYPE,i)}throw e},getCurrentInputSymbol:function(t){return null},getMissingSymbol:function(t,e,i,n){return null},consumeUntil:function(t,e){for(var i=t.LA(1);i!=org.antlr.runtime.Token.EOF&&!e.member(i);){t.consume();i=t.LA(1)}},pushFollow:function(t){if(this.state._fsp+1>=this.state.following.length){var e,i=[];for(e=this.state.following.length-1;e>=0;e--)i[e]=this.state.following[e];this.state.following=i}this.state._fsp++;this.state.following[this.state._fsp]=t},getRuleInvocationStack:function(t,e){throw new Error("Not implemented.")},getBacktrackingLevel:function(){return this.state.backtracking},getTokenNames:function(){return null},getGrammarFileName:function(){return null},toStrings:function(t){if(!t)return null;var e,i=[];for(e=0;e<t.length;e++)i.push(t[e].getText());return i},getRuleMemoization:function(t,e){this.state.ruleMemo[t]||(this.state.ruleMemo[t]={});var i=this.state.ruleMemo[t][e];return org.antlr.lang.isNumber(i)?i:org.antlr.runtime.BaseRecognizer.MEMO_RULE_UNKNOWN},alreadyParsedRule:function(t,e){var i=this.getRuleMemoization(e,t.index());if(i==org.antlr.runtime.BaseRecognizer.MEMO_RULE_UNKNOWN)return!1;i==org.antlr.runtime.BaseRecognizer.MEMO_RULE_FAILED?this.state.failed=!0:t.seek(i+1);return!0},memoize:function(t,e,i){var n=this.state.failed?org.antlr.runtime.BaseRecognizer.MEMO_RULE_FAILED:t.index()-1;if(!org.antlr.lang.isValue(this.state.ruleMemo))throw new Error("!!!!!!!!! memo array is null for "+this.getGrammarFileName());if(e>=this.state.ruleMemo.length)throw new Error("!!!!!!!!! memo size is "+this.state.ruleMemo.length+", but rule index is "+e);org.antlr.lang.isValue(this.state.ruleMemo[e])&&(this.state.ruleMemo[e][i]=n)},getRuleMemoizationCacheSize:function(){var t,e=0;for(t=0;this.state.ruleMemo&&t<this.state.ruleMemo.length;t++){var i=this.state.ruleMemo[t];i&&(e+=i.length)}return e},traceIn:function(t,e,i){this.emitErrorMessage("enter "+t+" "+i);this.state.failed&&this.emitErrorMessage(" failed="+this.failed);this.state.backtracking>0&&this.emitErrorMessage(" backtracking="+this.state.backtracking)},traceOut:function(t,e,i){this.emitErrorMessage("exit "+t+" "+i);this.state.failed&&this.emitErrorMessage(" failed="+this.state.failed);this.state.backtracking>0&&this.emitErrorMessage(" backtracking="+this.state.backtracking)}};org.antlr.runtime.Lexer=function(t,e){e&&org.antlr.runtime.Lexer.superclass.constructor.call(this,e);t&&(this.input=t)};org.antlr.lang.extend(org.antlr.runtime.Lexer,org.antlr.runtime.BaseRecognizer,{reset:function(){org.antlr.runtime.Lexer.superclass.reset.call(this);org.antlr.lang.isValue(this.input)&&this.input.seek(0);if(org.antlr.lang.isValue(this.state)){this.state.token=null;this.state.type=org.antlr.runtime.Token.INVALID_TOKEN_TYPE;this.state.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL;this.state.tokenStartCharIndex=-1;this.state.tokenStartCharPositionInLine=-1;this.state.tokenStartLine=-1;this.state.text=null}},nextToken:function(){for(;;){this.state.token=null;this.state.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL;this.state.tokenStartCharIndex=this.input.index();this.state.tokenStartCharPositionInLine=this.input.getCharPositionInLine();this.state.tokenStartLine=this.input.getLine();this.state.text=null;if(this.input.LA(1)===org.antlr.runtime.CharStream.EOF)return org.antlr.runtime.Token.EOF_TOKEN;try{this.mTokens();if(org.antlr.lang.isValue(this.state.token)){if(this.state.token==org.antlr.runtime.Token.SKIP_TOKEN)continue}else this.emit();return this.state.token}catch(t){if(t instanceof org.antlr.runtime.NoViableAltException){this.reportError(t);this.recover(t)}else{if(!(t instanceof org.antlr.runtime.RecognitionException))throw t;this.reportError(t)}}}},skip:function(){this.state.token=org.antlr.runtime.Token.SKIP_TOKEN},setCharStream:function(t){this.input=null;this.reset();this.input=t},getCharStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},emit:function(){if(0===arguments.length){var t=new org.antlr.runtime.CommonToken(this.input,this.state.type,this.state.channel,this.state.tokenStartCharIndex,this.getCharIndex()-1);t.setLine(this.state.tokenStartLine);t.setText(this.state.text);t.setCharPositionInLine(this.state.tokenStartCharPositionInLine);this.state.token=t;return t}this.state.token=arguments[0]},match:function(t){var e,i=0;if(org.antlr.lang.isString(t))for(;i<t.length;){if(this.input.LA(1)!=t.charAt(i)){if(this.state.backtracking>0){this.state.failed=!0;return}e=new org.antlr.runtime.MismatchedTokenException(t.charAt(i),this.input);this.recover(e);throw e}i++;this.input.consume();this.state.failed=!1}else if(org.antlr.lang.isNumber(t)){if(this.input.LA(1)!=t){if(this.state.backtracking>0){this.state.failed=!0;return}e=new org.antlr.runtime.MismatchedTokenException(t,this.input);this.recover(e);throw e}this.input.consume();this.state.failed=!1}},matchAny:function(){this.input.consume()},matchRange:function(t,e){if(this.input.LA(1)<t||this.input.LA(1)>e){if(this.state.backtracking>0){this.state.failed=!0;return}var i=new org.antlr.runtime.MismatchedRangeException(t,e,this.input);this.recover(i);throw i}this.input.consume();this.state.failed=!1},getLine:function(){return this.input.getLine()},getCharPositionInLine:function(){return this.input.getCharPositionInLine()},getCharIndex:function(){return this.input.index()},getText:function(){return org.antlr.lang.isString(this.state.text)?this.state.text:this.input.substring(this.state.tokenStartCharIndex,this.getCharIndex()-1)},setText:function(t){this.state.text=t},reportError:function(t){this.displayRecognitionError(this.getTokenNames(),t)},getErrorMessage:function(t,e){return t instanceof org.antlr.runtime.MismatchedTokenException?"mismatched character "+this.getCharErrorDisplay(t.c)+" expecting "+this.getCharErrorDisplay(t.expecting):t instanceof org.antlr.runtime.NoViableAltException?"no viable alternative at character "+this.getCharErrorDisplay(t.c):t instanceof org.antlr.runtime.EarlyExitException?"required (...)+ loop did not match anything at character "+this.getCharErrorDisplay(t.c):t instanceof org.antlr.runtime.MismatchedNotSetException||t instanceof org.antlr.runtime.MismatchedSetException?"mismatched character "+this.getCharErrorDisplay(t.c)+" expecting set "+t.expecting:t instanceof org.antlr.runtime.MismatchedRangeException?"mismatched character "+this.getCharErrorDisplay(t.c)+" expecting set "+this.getCharErrorDisplay(t.a)+".."+this.getCharErrorDisplay(t.b):org.antlr.runtime.Lexer.superclass.getErrorMessage.call(this,t,e)},getCharErrorDisplay:function(t){var e=t;switch(e){case org.antlr.runtime.Token.EOF:e="<EOF>";break;case"\n":e="\\n";break;case"\t":e="\\t";break;case"\r":e="\\r"}return"'"+e+"'"},recover:function(t){this.input.consume()},traceIn:function(t,e){var i=String.fromCharCode(this.input.LT(1))+" line="+this.getLine()+":"+this.getCharPositionInLine();org.antlr.runtime.Lexer.superclass.traceIn.call(this,t,e,i)},traceOut:function(t,e){var i=String.fromCharCode(this.input.LT(1))+" line="+this.getLine()+":"+this.getCharPositionInLine();org.antlr.runtime.Lexer.superclass.traceOut.call(this,t,e,i)}});org.antlr.runtime.DFA=function(){};org.antlr.runtime.DFA.prototype={predict:function(t){var e,i,n,r=t.mark(),a=0;try{for(;;)if((e=this.special[a])>=0){if(-1===(a=this.specialStateTransition(e,t))){this.noViableAlt(a,t);return 0}t.consume()}else{if(this.accept[a]>=1)return this.accept[a];(i=t.LA(1))===org.antlr.runtime.Token.EOF?i=-1:org.antlr.lang.isString(i)&&(i=i.charCodeAt(0));if(i>=this.min[a]&&i<=this.max[a]){if((n=this.transition[a][i-this.min[a]])<0){if(this.eot[a]>=0){a=this.eot[a];t.consume();continue}this.noViableAlt(a,t);return 0}a=n;t.consume()}else{if(!(this.eot[a]>=0)){if(i==org.antlr.runtime.Token.EOF&&this.eof[a]>=0)return this.accept[this.eof[a]];this.noViableAlt(a,t);return 0}a=this.eot[a];t.consume()}}}finally{t.rewind(r)}},noViableAlt:function(t,e){if(!(this.recognizer.state.backtracking>0)){var i=new org.antlr.runtime.NoViableAltException(this.getDescription(),this.decisionNumber,t,e);this.error(i);throw i}this.recognizer.state.failed=!0},error:function(t){},specialStateTransition:function(t,e){return-1},getDescription:function(){return"n/a"}};org.antlr.lang.augmentObject(org.antlr.runtime.DFA,{unpackEncodedString:function(t){var e,i,n,r,a=[],s=0;for(e=0;e<t.length;e+=2){i=t.charCodeAt(e);65535===(n=t.charCodeAt(e+1))&&(n=-1);for(r=1;r<=i;r++)a[s++]=n}return a},unpackEncodedStringToUnsignedChars:function(t){return org.antlr.runtime.DFA.unpackEncodedString(t)}});org.antlr.runtime.Parser=function(t,e){org.antlr.runtime.Parser.superclass.constructor.call(this,e);this.setTokenStream(t)};org.antlr.lang.extend(org.antlr.runtime.Parser,org.antlr.runtime.BaseRecognizer,{reset:function(){org.antlr.runtime.Parser.superclass.reset.call(this);org.antlr.lang.isValue(this.input)&&this.input.seek(0)},getCurrentInputSymbol:function(t){return t.LT(1)},getMissingSymbol:function(t,e,i,n){var r,a="<missing "+this.getTokenNames()[i]+">",s=new org.antlr.runtime.CommonToken(i,a),o=t.LT(1);if(o.getType()===org.antlr.runtime.Token.EOF){r=o;(o=t.LT(-1))||(o=r)}s.line=o.getLine();s.charPositionInLine=o.getCharPositionInLine();s.channel=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;return s},setTokenStream:function(t){this.input=null;this.reset();this.input=t},getTokenStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},traceIn:function(t,e){org.antlr.runtime.Parser.superclass.traceIn.call(this,t,e,this.input.LT(1))},traceOut:function(t,e){org.antlr.runtime.Parser.superclass.traceOut.call(this,t,e,this.input.LT(1))}});org.antlr.runtime.BitSet=function(t){t||(t=org.antlr.runtime.BitSet.BITS);org.antlr.lang.isArray(t)?this.bits=t:org.antlr.lang.isNumber(t)&&(this.bits=[])};org.antlr.lang.augmentObject(org.antlr.runtime.BitSet,{BITS:32,LOG_BITS:5,MOD_MASK:31,bitMask:function(t){return 1<<(t&org.antlr.runtime.BitSet.MOD_MASK)},numWordsToHold:function(t){return 1+(t>>org.antlr.runtime.BitSet.LOG_BITS)},wordNumber:function(t){return t>>org.antlr.runtime.BitSet.LOG_BITS},of:function(t,e){var i,n,r,a;if(org.antlr.lang.isNumber(t)){if(org.antlr.lang.isNumber(e)){r=new org.antlr.runtime.BitSet(e+1);for(i=t;i<=e;i++){n=org.antlr.runtime.BitSet.wordNumber(i);r.bits[n]|=org.antlr.runtime.BitSet.bitMask(i)}return r}(r=new org.antlr.runtime.BitSet(t+1)).add(t);return r}if(org.antlr.lang.isArray(t)){r=new org.antlr.runtime.BitSet;for(i=t.length-1;i>=0;i--)r.add(t[i]);return r}if(t instanceof org.antlr.runtime.BitSet)return t||null;if(t instanceof org.antlr.runtime.IntervalSet){if(!t)return null;(r=new org.antlr.runtime.BitSet).addAll(t);return r}if(org.antlr.lang.isObject(t)){a=[];for(i in t)org.antlr.lang.isNumber(i)&&a.push(i);return org.antlr.runtime.BitSet.of(a)}}});org.antlr.runtime.BitSet.prototype={add:function(t){var e=org.antlr.runtime.BitSet.wordNumber(t);e>=this.bits.length&&this.growToInclude(t);this.bits[e]|=org.antlr.runtime.BitSet.bitMask(t)},addAll:function(t){var e,i;if(t instanceof org.antlr.runtime.BitSet)this.orInPlace(t);else if(t instanceof org.antlr.runtime.IntervalSet)t;else{if(!org.antlr.lang.isArray(t))return;for(e=0;e<t.length;e++){i=t[e];this.add(i)}}},and:function(t){var e=this.clone();e.andInPlace(t);return e},andInPlace:function(t){var e,i=Math.min(this.bits.length,t.bits.length);for(e=i-1;e>=0;e--)this.bits[e]&=t.bits[e];for(e=i;e<this.bits.length;e++)this.bits[e]=0},clear:function(t){if(0!==arguments.length){var e=org.antlr.runtime.BitSet.wordNumber(t);e>=this.bits.length&&this.growToInclude(t);this.bits[e]&=~org.antlr.runtime.BitSet.bitMask(t)}else{var i;for(i=this.bits.length-1;i>=0;i--)this.bits[i]=0}},clone:function(){var t,e,i=[];for(t=0,e=this.bits.length;t<e;t++)i[t]=this.bits[t];return new org.antlr.runtime.BitSet(i)},size:function(){var t,e,i,n=0;for(t=this.bits.length-1;t>=0;t--)if(0!==(e=this.bits[t]))for(i=org.antlr.runtime.BitSet.BITS-1;i>=0;i--)0!=(e&1<<i)&&n++;return n},equals:function(t){if(!(t&&t instanceof org.antlr.runtime.BitSet))return!1;var e,i=t,n=Math.min(this.bits.length,i.bits.length);for(e=0;e<n;e++)if(this.bits[e]!=i.bits[e])return!1;if(this.bits.length>n){for(e=n+1;e<this.bits.length;e++)if(0!==this.bits[e])return!1}else if(i.bits.length>n)for(e=n+1;e<i.bits.length;e++)if(0!==i.bits[e])return!1;return!0},growToInclude:function(t){Math.max(this.bits.length<<1,org.antlr.runtime.BitSet.numWordsToHold(t));var e,i,n=[];for(e=0,i=this.bits.length;e<i;e++)n[e]=this.bits[e];this.bits=n},member:function(t){var e=org.antlr.runtime.BitSet.wordNumber(t);return!(e>=this.bits.length)&&0!=(this.bits[e]&org.antlr.runtime.BitSet.bitMask(t))},getSingleElement:function(){var t;for(t=0;t<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;t++)if(this.member(t))return t;return-1},isNil:function(){var t;for(t=this.bits.length-1;t>=0;t--)if(0!==this.bits[t])return!1;return!0},complement:function(t){if(t)return t.subtract(this);var e=this.clone();e.notInPlace();return e},notInPlace:function(){var t,e,i,n;if(0===arguments.length)for(i=this.bits.length-1;i>=0;i--)this.bits[i]=~this.bits[i];else{if(1===arguments.length){t=0;e=arguments[0]}else{t=arguments[0];e=arguments[1]}this.growToInclude(e);for(i=t;i<=e;i++){n=org.antlr.runtime.BitSet.wordNumber(i);this.bits[n]^=org.antlr.runtime.BitSet.bitMask(i)}}},or:function(t){if(!t)return this;var e=this.clone();e.orInPlace(t);return e},orInPlace:function(t){if(t){t.bits.length>this.bits.length&&this.setSize(t.bits.length);var e;for(e=Math.min(this.bits.length,t.bits.length)-1;e>=0;e--)this.bits[e]|=t.bits[e]}},remove:function(t){var e=org.antlr.runtime.BitSet.wordNumber(t);e>=this.bits.length&&this.growToInclude(t);this.bits[e]&=~org.antlr.runtime.BitSet.bitMask(t)},setSize:function(t){for(var e=t-this.bits.length;e>=0;){this.bits.push(0);e--}},numBits:function(){return this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS},lengthInLongWords:function(){return this.bits.length},subset:function(t){return!!t&&this.and(t).equals(this)},subtractInPlace:function(t){if(t){var e;for(e=0;e<this.bits.length&&e<t.bits.length;e++)this.bits[e]&=~t.bits[e]}},subtract:function(t){if(!(t&&t instanceof org.antlr.runtime.BitSet))return null;var e=this.clone();e.subtractInPlace(t);return e},toArray:function(){var t,e=[],i=0;for(t=0;t<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;t++)this.member(t)&&(e[i++]=t);return e},toPackedArray:function(){return this.bits},toString:function(){return 0===arguments.length?this.toString1(null):org.antlr.lang.isString(arguments[0])?org.antlr.lang.isValue(arguments[1])?this.toString2(arguments[0],arguments[1]):this.toString1(null):this.toString1(arguments[0])},toString1:function(t){var e,i="{",n=!1;for(e=0;e<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;e++)if(this.member(e)){e>0&&n&&(i+=",");i+=t?t.getTokenDisplayName(e):e.toString();n=!0}return i+"}"},toString2:function(t,e){var i,n="";for(i=0;i<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;i++)if(this.member(i)){n.length>0&&(n+=t);i>=e.size()?n+="'"+i+"'":org.antlr.lang.isValue(e.get(i))?n+=e.get(i):n+="'"+i+"'"}return n}};org.antlr.runtime.ParserRuleReturnScope=function(){};org.antlr.runtime.RuleReturnScope=function(){};org.antlr.lang.extend(org.antlr.runtime.ParserRuleReturnScope,org.antlr.runtime.RuleReturnScope,{getStart:function(){return this.start},getStop:function(){return this.stop}});org.antlr.runtime.RecognizerSharedState=function(){this.following=[];this._fsp=-1;this.errorRecovery=!1;this.lastErrorIndex=-1;this.failed=!1;this.syntaxErrors=0;this.backtracking=0;this.ruleMemo=null;this.token=null;this.tokenStartCharIndex=-1;this.text=null};org.antlr.runtime.tree={};org.antlr.runtime.tree.Tree=function(){};org.antlr.runtime.tree.BaseTree=function(){};org.antlr.lang.extend(org.antlr.runtime.tree.BaseTree,org.antlr.runtime.tree.Tree,{getChild:function(t){return!this.children||t>=this.children.length?null:this.children[t]},getChildren:function(){return this.children},getFirstChildWithType:function(t){var e,i;for(e=0;this.children&&e<this.children.length;e++)if((i=this.children[e]).getType()===t)return i;return null},getChildCount:function(){return this.children?this.children.length:0},addChild:function(t){if(org.antlr.lang.isValue(t)){var e,i,n,r=t;if(r.isNil()){if(this.children&&this.children==r.children)throw new Error("attempt to add child list to itself");if(r.children)if(this.children){e=r.children.length;for(i=0;i<e;i++){n=r.children[i];this.children.push(n);n.setParent(this);n.setChildIndex(this.children.length-1)}}else{this.children=r.children;this.freshenParentAndChildIndexes()}}else{this.children||(this.children=this.createChildrenList());this.children.push(t);r.setParent(this);r.setChildIndex(this.children.length-1)}}},addChildren:function(t){var e,i;for(e=0;e<t.length;e++){i=t[e];this.addChild(i)}},setChild:function(t,e){if(e){if(e.isNil())throw new Error("Can't set single child to a list");this.children||(this.children=this.createChildrenList());this.children[t]=e;e.setParent(this);e.setChildIndex(t)}},deleteChild:function(t){if(!this.children)return null;if(t<0||t>=this.children.length)throw new Error("Index out of bounds.");var e=this.children.splice(t,1)[0];this.freshenParentAndChildIndexes(t);return e},replaceChildren:function(t,e,i){if(!this.children)throw new Error("indexes invalid; no children in list");var n,r=e-t+1,a=i,s=null;a.isNil()?s=a.children:(s=[]).push(a);n=s.length;var o,l,u,h,c,d=s.length,m=r-n;if(0===m){o=0;for(l=t;l<=e;l++){u=s[o];this.children[l]=u;u.setParent(this);u.setChildIndex(l);o++}}else if(m>0){for(o=0;o<d;o++)this.children[t+o]=s[o];for(c=h=t+d;c<=e;c++)this.children.splice(h,1)[0];this.freshenParentAndChildIndexes(t)}else{for(o=0;o<r;o++)this.children[t+o]=s[o];n-r;for(o=r;o<n;o++)this.children.splice(t+o,0,s[o]);this.freshenParentAndChildIndexes(t)}},createChildrenList:function(){return[]},isNil:function(){return!1},freshenParentAndChildIndexes:function(t){org.antlr.lang.isNumber(t)||(t=0);var e,i,n=this.getChildCount();for(e=t;e<n;e++){(i=this.getChild(e)).setChildIndex(e);i.setParent(this)}},sanityCheckParentAndChildIndexes:function(t,e){if(0===arguments.length){t=null;e=-1}if(t!==this.getParent())throw new Error("parents don't match; expected "+t+" found "+this.getParent());if(e!==this.getChildIndex())throw new Error("child indexes don't match; expected "+e+" found "+this.getChildIndex());var i,n=this.getChildCount();for(i=0;i<n;i++)this.getChild(i).sanityCheckParentAndChildIndexes(this,i)},getChildIndex:function(){return 0},setChildIndex:function(t){},getParent:function(){return null},setParent:function(t){},getTree:function(){return this},toStringTree:function(){if(!this.children||0===this.children.length)return this.toString();var t,e="";if(!this.isNil()){e+="(";e+=this.toString();e+=" "}for(t=0;this.children&&t<this.children.length;t++){t>0&&(e+=" ");e+=this.children[t].toStringTree()}this.isNil()||(e+=")");return e},getLine:function(){return 0},getCharPositionInLine:function(){return 0}});org.antlr.runtime.tree.CommonTree=function(t){this.startIndex=-1;this.stopIndex=-1;this.childIndex=-1;this.parent=null;this.token=null;if(t instanceof org.antlr.runtime.tree.CommonTree){org.antlr.runtime.tree.CommonTree.superclass.constructor.call(this,t);this.token=t.token;this.startIndex=t.startIndex;this.stopIndex=t.stopIndex}else t instanceof org.antlr.runtime.CommonToken&&(this.token=t)};org.antlr.lang.extend(org.antlr.runtime.tree.CommonTree,org.antlr.runtime.tree.BaseTree,{getToken:function(){return this.token},dupNode:function(){return new org.antlr.runtime.tree.CommonTree(this)},isNil:function(){return!this.token},getType:function(){return this.token?this.token.getType():org.antlr.runtime.Token.INVALID_TOKEN_TYPE},getText:function(){return this.token?this.token.getText():null},getLine:function(){return this.token&&0!==this.token.getLine()?this.token.getLine():this.getChildCount()>0?this.getChild(0).getLine():0},getCharPositionInLine:function(){return this.token&&-1!==this.token.getCharPositionInLine()?this.token.getCharPositionInLine():this.getChildCount()>0?this.getChild(0).getCharPositionInLine():0},getTokenStartIndex:function(){return this.token?this.token.getTokenIndex():this.startIndex},setTokenStartIndex:function(t){this.startIndex=t},getTokenStopIndex:function(){return this.token?this.token.getTokenIndex():this.stopIndex},setTokenStopIndex:function(t){this.stopIndex=t},getChildIndex:function(){return this.childIndex},getParent:function(){return this.parent},setParent:function(t){this.parent=t},setChildIndex:function(t){this.childIndex=t},toString:function(){return this.isNil()?"nil":this.getType()===org.antlr.runtime.Token.INVALID_TOKEN_TYPE?"<errornode>":this.token?this.token.getText():null}});org.antlr.runtime.tree.Tree.INVALID_NODE=new org.antlr.runtime.tree.CommonTree(org.antlr.runtime.Token.INVALID_TOKEN);org.antlr.runtime.tree.RewriteRuleElementStream=function(t,e,i){this.cursor=0;this.dirty=!1;this.elementDescription=e;this.adaptor=t;if(i)if(org.antlr.lang.isArray(i)){this.singleElement=null;this.elements=i}else this.add(i)};org.antlr.runtime.tree.RewriteRuleElementStream.prototype={reset:function(){this.cursor=0;this.dirty=!0},add:function(t){if(org.antlr.lang.isValue(t))if(this.elements)this.elements.push(t);else if(org.antlr.lang.isValue(this.singleElement)){this.elements=[];this.elements.push(this.singleElement);this.singleElement=null;this.elements.push(t)}else this.singleElement=t},nextTree:function(){var t,e=this.size();if(this.dirty||this.cursor>=e&&1==e){t=this._next();return this.dup(t)}return t=this._next()},_next:function(){var t=this.size();if(0===t)throw new org.antlr.runtime.tree.RewriteEmptyStreamException(this.elementDescription);if(this.cursor>=t){if(1===t)return this.toTree(this.singleElement);throw new org.antlr.runtime.tree.RewriteCardinalityException(this.elementDescription)}if(org.antlr.lang.isValue(this.singleElement)){this.cursor++;return this.toTree(this.singleElement)}var e=this.toTree(this.elements[this.cursor]);this.cursor++;return e},toTree:function(t){return t&&t.getTree?t.getTree():t},hasNext:function(){return org.antlr.lang.isValue(this.singleElement)&&this.cursor<1||this.elements&&this.cursor<this.elements.length},size:function(){var t=0;org.antlr.lang.isValue(this.singleElement)&&(t=1);return this.elements?this.elements.length:t},getDescription:function(){return this.elementDescription}};org.antlr.runtime.tree.RewriteRuleSubtreeStream=function(){var t=org.antlr.runtime.tree.RewriteRuleSubtreeStream.superclass;t.constructor.apply(this,arguments)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleSubtreeStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){var t,e=this.size();if(this.dirty||this.cursor>=e&&1===e){t=this._next();return this.adaptor.dupNode(t)}return t=this._next()},dup:function(t){return this.adaptor.dupTree(t)}});org.antlr.runtime.tree.RewriteRuleTokenStream=function(t,e,i){var n=org.antlr.runtime.tree.RewriteRuleTokenStream.superclass;n.constructor.apply(this,arguments)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleTokenStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){var t=this._next();return this.adaptor.create(t)},nextToken:function(){return this._next()},toTree:function(t){return t},dup:function(t){throw new Error("dup can't be called for a token stream.")}});org.antlr.runtime.tree.BaseTreeAdaptor=function(){this.uniqueNodeID=1};org.antlr.runtime.tree.TreeAdaptor=function(){};org.antlr.lang.extend(org.antlr.runtime.tree.BaseTreeAdaptor,org.antlr.runtime.tree.TreeAdaptor,{nil:function(){return this.create(null)},errorNode:function(t,e,i,n){return new org.antlr.runtime.tree.CommonErrorNode(t,e,i,n)},isNil:function(t){return t.isNil()},dupTree:function(t,e){1===arguments.length&&(e=null);if(!t)return null;var i=this.dupNode(t);this.setChildIndex(i,this.getChildIndex(t));this.setParent(i,e);var n,r,a,s=this.getChildCount(t);for(n=0;n<s;n++){r=this.getChild(t,n);a=this.dupTree(r,t);this.addChild(i,a)}return i},addChild:function(t,e){t&&org.antlr.lang.isValue(e)&&t.addChild(e)},becomeRoot:function(t,e){(t instanceof org.antlr.runtime.Token||!t)&&(t=this.create(t));var i=t,n=e;if(!e)return t;if(i.isNil()){var r=i.getChildCount();if(1===r)i=i.getChild(0);else if(r>1)throw new Error("more than one node as root (TODO: make exception hierarchy)")}i.addChild(n);return i},rulePostProcessing:function(t){var e=t;if(e&&e.isNil())if(0===e.getChildCount())e=null;else if(1===e.getChildCount()){(e=e.getChild(0)).setParent(null);e.setChildIndex(-1)}return e},create:function(t,e){var i;if(2===arguments.length){if(org.antlr.lang.isString(arguments[1])){i=arguments[1];e=this.createToken(t,i);return this.create(e)}(e=this.createToken(e)).setType(t);return this.create(e)}if(3===arguments.length){i=arguments[2];(e=this.createToken(e)).setType(t);e.setText(i);return this.create(e)}},getType:function(t){t.getType();return 0},setType:function(t,e){throw new Error("don't know enough about Tree node")},getText:function(t){return t.getText()},setText:function(t,e){throw new Error("don't know enough about Tree node")},getChild:function(t,e){return t.getChild(e)},setChild:function(t,e,i){t.setChild(e,i)},deleteChild:function(t,e){return t.deleteChild(e)},getChildCount:function(t){return t.getChildCount()},getUniqueID:function(t){this.treeToUniqueIDMap||(this.treeToUniqueIDMap={});var e=this.treeToUniqueIDMap[t];if(org.antlr.lang.isValue(e))return e;var i=this.uniqueNodeID;this.treeToUniqueIDMap[t]=i;this.uniqueNodeID++;return i}});org.antlr.runtime.tree.CommonTreeAdaptor=function(){};org.antlr.lang.extend(org.antlr.runtime.tree.CommonTreeAdaptor,org.antlr.runtime.tree.BaseTreeAdaptor,{dupNode:function(t){return org.antlr.lang.isValue(t)?t.dupNode():null},create:function(t){return arguments.length>1?org.antlr.runtime.tree.CommonTreeAdaptor.superclass.create.apply(this,arguments):new org.antlr.runtime.tree.CommonTree(t)},createToken:function(t){return 2===arguments.length?new org.antlr.runtime.CommonToken(arguments[0],arguments[1]):new org.antlr.runtime.CommonToken(arguments[0])},setTokenBoundaries:function(t,e,i){if(org.antlr.lang.isValue(t)){var n=0,r=0;org.antlr.lang.isValue(e)&&(n=e.getTokenIndex?e.getTokenIndex():e.getStartIndex?e.getStartIndex():e.getTokenStartIndex());org.antlr.lang.isValue(i)&&(r=r.getTokenIndex?i.getTokenIndex():i.getStopIndex?i.getStopIndex():i.getTokenStopIndex());t.setTokenStartIndex(n);t.setTokenStopIndex(r)}},getTokenStartIndex:function(t){return t?t.getTokenStartIndex():-1},getTokenStopIndex:function(t){return t?t.getTokenStopIndex():-1},getText:function(t){return t?t.getText():null},getType:function(t){return t?t.getType():org.antlr.runtime.Token.INVALID_TOKEN_TYPE},getToken:function(t){return t instanceof org.antlr.runtime.tree.CommonTree?t.getToken():null},getChild:function(t,e){return t?t.getChild(e):null},getChildCount:function(t){return t?t.getChildCount():0},getParent:function(t){return t.getParent()},setParent:function(t,e){t.setParent(e)},getChildIndex:function(t){return t.getChildIndex()},setChildIndex:function(t,e){t.setChildIndex(e)},replaceChildren:function(t,e,i,n){t&&t.replaceChildren(e,i,n)}});var FormulaLexer=function(t,e){e||(e=new org.antlr.runtime.RecognizerSharedState);(function(){}).call(this);this.dfa30=new FormulaLexer.DFA30(this);FormulaLexer.superclass.constructor.call(this,t,e)};org.antlr.lang.augmentObject(FormulaLexer,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112});!function(){var t=org.antlr.runtime.Token.HIDDEN_CHANNEL;org.antlr.runtime.Token.EOF;org.antlr.lang.extend(FormulaLexer,org.antlr.runtime.Lexer,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112,getGrammarFileName:function(){return"/Library/WebServer/Documents/calc/Formula.g"}});org.antlr.lang.augmentObject(FormulaLexer.prototype,{mT__113:function(){try{var t=this.T__113,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("(");this.state.type=t;this.state.channel=e}finally{}},mT__114:function(){try{var t=this.T__114,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(")");this.state.type=t;this.state.channel=e}finally{}},mT__115:function(){try{var t=this.T__115,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<-");this.state.type=t;this.state.channel=e}finally{}},mT__116:function(){try{var t=this.T__116,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(".");this.state.type=t;this.state.channel=e}finally{}},mNEWLINE:function(){try{var t=this.NEWLINE,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,i=2;"\r"==this.input.LA(1)&&(i=1);switch(i){case 1:this.match("\r")}this.match("\n");this.state.type=t;this.state.channel=e}finally{}},mWHILESTATEMENT:function(){try{var t=this.WHILESTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mW();this.mH();this.mI();this.mL();this.mE();this.state.type=t;this.state.channel=e}finally{}},mFORSTATEMENT:function(){try{var t=this.FORSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mO();this.mR();this.state.type=t;this.state.channel=e}finally{}},mFROMSTATEMENT:function(){try{var t=this.FROMSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mR();this.mO();this.mM();this.state.type=t;this.state.channel=e}finally{}},mINSTATEMENT:function(){try{var t=this.INSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mI();this.mN();this.state.type=t;this.state.channel=e}finally{}},mTOSTATEMENT:function(){try{var t=this.TOSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mO();this.state.type=t;this.state.channel=e}finally{}},mBYSTATEMENT:function(){try{var t=this.BYSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mB();this.mY();this.state.type=t;this.state.channel=e}finally{}},mLOOPSTATEMENT:function(){try{var t=this.LOOPSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mL();this.mO();this.mO();this.mP();this.state.type=t;this.state.channel=e}finally{}},mIFSTATEMENT:function(){try{var t=this.IFSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mI();this.mF();this.state.type=t;this.state.channel=e}finally{}},mTHENSTATEMENT:function(){try{var t=this.THENSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mH();this.mE();this.mN();this.state.type=t;this.state.channel=e}finally{}},mELSESTATEMENT:function(){try{var t=this.ELSESTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mE();this.mL();this.mS();this.mE();this.state.type=t;this.state.channel=e}finally{}},mFUNCTIONSTATEMENT:function(){try{var t=this.FUNCTIONSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mU();this.mN();this.mC();this.mT();this.mI();this.mO();this.mN();this.state.type=t;this.state.channel=e}finally{}},mENDBLOCK:function(){try{var t=this.ENDBLOCK,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mE();this.mN();this.mD();this.state.type=t;this.state.channel=e}finally{}},mRETURNSTATEMENT:function(){try{var t=this.RETURNSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mR();this.mE();this.mT();this.mU();this.mR();this.mN();this.state.type=t;this.state.channel=e}finally{}},mNEWSTATEMENT:function(){try{var t=this.NEWSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mN();this.mE();this.mW();this.state.type=t;this.state.channel=e}finally{}},mTRYSTATEMENT:function(){try{var t=this.TRYSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mR();this.mY();this.state.type=t;this.state.channel=e}finally{}},mCATCHSTATEMENT:function(){try{var t=this.CATCHSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mC();this.mA();this.mT();this.mC();this.mH();this.state.type=t;this.state.channel=e}finally{}},mTHROWSTATEMENT:function(){try{var t=this.THROWSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mH();this.mR();this.mO();this.mW();this.state.type=t;this.state.channel=e}finally{}},mOR:function(){try{var t=this.OR,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,i=2,n=this.input.LA(1);if("|"==n)i=1;else{if("O"!=n&&"o"!=n){throw new org.antlr.runtime.NoViableAltException("",2,0,this.input)}i=2}switch(i){case 1:this.match("||");break;case 2:this.mO();this.mR()}this.state.type=t;this.state.channel=e}finally{}},mXOR:function(){try{var t=this.XOR,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mX();this.mO();this.mR();this.state.type=t;this.state.channel=e}finally{}},mAND:function(){try{var t=this.AND,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,i=2,n=this.input.LA(1);if("&"==n)i=1;else{if("A"!=n&&"a"!=n){throw new org.antlr.runtime.NoViableAltException("",3,0,this.input)}i=2}switch(i){case 1:this.match("&&");break;case 2:this.mA();this.mN();this.mD()}this.state.type=t;this.state.channel=e}finally{}},mEQUALS:function(){try{var t=this.EQUALS,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;if("="!=this.input.LA(1)){throw new org.antlr.runtime.NoViableAltException("",4,0,this.input)}switch("="==this.input.LA(2)?2:1){case 1:this.match("=");break;case 2:this.match("==")}this.state.type=t;this.state.channel=e}finally{}},mNOTEQUALS:function(){try{var t=this.NOTEQUALS,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,i=2,n=this.input.LA(1);if("!"==n)i=1;else{if("<"!=n){throw new org.antlr.runtime.NoViableAltException("",5,0,this.input)}i=2}switch(i){case 1:this.match("!=");break;case 2:this.match("<>")}this.state.type=t;this.state.channel=e}finally{}},mLT:function(){try{var t=this.LT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<");this.state.type=t;this.state.channel=e}finally{}},mLTEQ:function(){try{var t=this.LTEQ,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<=");this.state.type=t;this.state.channel=e}finally{}},mGT:function(){try{var t=this.GT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(">");this.state.type=t;this.state.channel=e}finally{}},mGTEQ:function(){try{var t=this.GTEQ,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(">=");this.state.type=t;this.state.channel=e}finally{}},mPLUS:function(){try{var t=this.PLUS,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("+");this.state.type=t;this.state.channel=e}finally{}},mMINUS:function(){try{var t=this.MINUS,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("-");this.state.type=t;this.state.channel=e}finally{}},mMULT:function(){try{var t=this.MULT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("*");this.state.type=t;this.state.channel=e}finally{}},mDIV:function(){try{var t=this.DIV,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("/");this.state.type=t;this.state.channel=e}finally{}},mMOD:function(){try{var t=this.MOD,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,i=2,n=this.input.LA(1);if("%"==n)i=1;else{if("M"!=n&&"m"!=n){throw new org.antlr.runtime.NoViableAltException("",6,0,this.input)}i=2}switch(i){case 1:this.match("%");break;case 2:this.mM();this.mO();this.mD()}this.state.type=t;this.state.channel=e}finally{}},mPOW:function(){try{var t=this.POW,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("^");this.state.type=t;this.state.channel=e}finally{}},mNOT:function(){try{var t=this.NOT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,i=2,n=this.input.LA(1);if("!"==n)i=1;else{if("N"!=n&&"n"!=n){throw new org.antlr.runtime.NoViableAltException("",7,0,this.input)}i=2}switch(i){case 1:this.match("!");break;case 2:this.mN();this.mO();this.mT()}this.state.type=t;this.state.channel=e}finally{}},mLARR:function(){try{var t=this.LARR,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,i=2,n=this.input.LA(1);if("«"==n)i=1;else{if("<"!=n){throw new org.antlr.runtime.NoViableAltException("",8,0,this.input)}i=2}switch(i){case 1:this.match("«");break;case 2:this.match("<<")}this.state.type=t;this.state.channel=e}finally{}},mRARR:function(){try{var t=this.RARR,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,i=2,n=this.input.LA(1);if("»"==n)i=1;else{if(">"!=n){throw new org.antlr.runtime.NoViableAltException("",9,0,this.input)}i=2}switch(i){case 1:this.match("»");break;case 2:this.match(">>")}this.state.type=t;this.state.channel=e}finally{}},mLCURL:function(){try{var t=this.LCURL,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("{");this.state.type=t;this.state.channel=e}finally{}},mRCURL:function(){try{var t=this.RCURL,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("}");this.state.type=t;this.state.channel=e}finally{}},mINTEGER:function(){try{var t=this.INTEGER,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,i=0;t:for(;;){var n=2,r=this.input.LA(1);r>="0"&&r<="9"&&(n=1);switch(n){case 1:this.matchRange("0","9");break;default:if(i>=1)break t;throw new org.antlr.runtime.EarlyExitException(10,this.input)}i++}var a=2;"e"==this.input.LA(1)&&(a=1);switch(a){case 1:this.match("e");var s=2,o=this.input.LA(1);"+"!=o&&"-"!=o||(s=1);switch(s){case 1:if("+"!=this.input.LA(1)&&"-"!=this.input.LA(1)){var l=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(l);throw l}this.input.consume()}t:for(;;){var u=2,h=this.input.LA(1);h>="0"&&h<="9"&&(u=1);switch(u){case 1:this.matchRange("0","9");break;default:break t}}}this.state.type=t;this.state.channel=e}finally{}},mFLOAT:function(){try{var t=this.FLOAT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;t:for(;;){var i=2,n=this.input.LA(1);n>="0"&&n<="9"&&(i=1);switch(i){case 1:this.matchRange("0","9");break;default:break t}}this.match(".");var r=0;t:for(;;){var a=2,s=this.input.LA(1);s>="0"&&s<="9"&&(a=1);switch(a){case 1:this.matchRange("0","9");break;default:if(r>=1)break t;throw new org.antlr.runtime.EarlyExitException(15,this.input)}r++}var o=2;"e"==this.input.LA(1)&&(o=1);switch(o){case 1:this.match("e");var l=2,u=this.input.LA(1);"+"!=u&&"-"!=u||(l=1);switch(l){case 1:if("+"!=this.input.LA(1)&&"-"!=this.input.LA(1)){var h=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(h);throw h}this.input.consume()}t:for(;;){var c=2,d=this.input.LA(1);d>="0"&&d<="9"&&(c=1);switch(c){case 1:this.matchRange("0","9");break;default:break t}}}this.state.type=t;this.state.channel=e}finally{}},mTRUE:function(){try{var t=this.TRUE,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mR();this.mU();this.mE();this.state.type=t;this.state.channel=e}finally{}},mFALSE:function(){try{var t=this.FALSE,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mA();this.mL();this.mS();this.mE();this.state.type=t;this.state.channel=e}finally{}},mPER:function(){try{var t=this.PER,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mP();this.mE();this.mR();this.state.type=t;this.state.channel=e}finally{}},mSQUARED:function(){try{var t=this.SQUARED,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mS();this.mQ();this.mU();this.mA();this.mR();this.mE();this.mD();this.state.type=t;this.state.channel=e}finally{}},mCUBED:function(){try{var t=this.CUBED,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mC();this.mU();this.mB();this.mE();this.mD();this.state.type=t;this.state.channel=e}finally{}},mIDENT:function(){try{var t=this.IDENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;if(!(this.input.LA(1)>="A"&&this.input.LA(1)<="Z"||this.input.LA(1)>="a"&&this.input.LA(1)<="z")){var i=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(i);throw i}this.input.consume();t:for(;;){var n=2,r=this.input.LA(1);(r>="0"&&r<="9"||r>="A"&&r<="Z"||"_"==r||r>="a"&&r<="z")&&(n=1);switch(n){case 1:if(!(this.input.LA(1)>="0"&&this.input.LA(1)<="9"||this.input.LA(1)>="A"&&this.input.LA(1)<="Z"||"_"==this.input.LA(1)||this.input.LA(1)>="a"&&this.input.LA(1)<="z")){i=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(i);throw i}this.input.consume();break;default:break t}}this.state.type=t;this.state.channel=e}finally{}},mPRIMITIVE:function(){try{var t=this.PRIMITIVE,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,i=2;if("["!=this.input.LA(1)){throw new org.antlr.runtime.NoViableAltException("",22,0,this.input)}var n=this.input.LA(2);if(n>="\0"&&n<="Z"||n>="\\"&&n<="￿")i=1;else{if("["!=n){throw new org.antlr.runtime.NoViableAltException("",22,1,this.input)}i=2}switch(i){case 1:this.mLBRACKET();if(!(this.input.LA(1)>="\0"&&this.input.LA(1)<="Z"||this.input.LA(1)>="\\"&&this.input.LA(1)<="￿")){var r=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(r);throw r}this.input.consume();t:for(;;){var a=2,s=this.input.LA(1);"]"==s?a=2:(s>="\0"&&s<="\\"||s>="^"&&s<="￿")&&(a=1);switch(a){case 1:this.matchAny();break;default:break t}}this.mRBRACKET();break;case 2:this.mLBRACKET();this.mLBRACKET();t:for(;;){var o=2,l=this.input.LA(1);"]"==l?o=2:(l>="\0"&&l<="\\"||l>="^"&&l<="￿")&&(o=1);switch(o){case 1:this.matchAny();break;default:break t}}this.mRBRACKET();this.mRBRACKET()}this.state.type=t;this.state.channel=e}finally{}},mLBRACKET:function(){try{var t=this.LBRACKET,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("[");this.state.type=t;this.state.channel=e}finally{}},mRBRACKET:function(){try{var t=this.RBRACKET,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("]");this.state.type=t;this.state.channel=e}finally{}},mCOMMENT:function(){try{var e=this.COMMENT,i=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("/*");t:for(;;){var n=2,r=this.input.LA(1);if("*"==r){var a=this.input.LA(2);"/"==a?n=2:(a>="\0"&&a<="."||a>="0"&&a<="￿")&&(n=1)}else(r>="\0"&&r<=")"||r>="+"&&r<="￿")&&(n=1);switch(n){case 1:this.matchAny();break;default:break t}}this.match("*/");i=t;this.state.type=e;this.state.channel=i}finally{}},mLINE_COMMENT:function(){try{var e=this.LINE_COMMENT,i=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,n=2,r=this.input.LA(1);if("/"==r)n=1;else{if("#"!=r){throw new org.antlr.runtime.NoViableAltException("",24,0,this.input)}n=2}switch(n){case 1:this.match("//");break;case 2:this.match("#")}t:for(;;){var a=2,s=this.input.LA(1);(s>="\0"&&s<="\t"||s>="\v"&&s<="\f"||s>=""&&s<="￿")&&(a=1);switch(a){case 1:if(!(this.input.LA(1)>="\0"&&this.input.LA(1)<="\t"||this.input.LA(1)>="\v"&&this.input.LA(1)<="\f"||this.input.LA(1)>=""&&this.input.LA(1)<="￿")){var o=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(o);throw o}this.input.consume();break;default:break t}}i=t;this.state.type=e;this.state.channel=i}finally{}},mCOLON:function(){try{var t=this.COLON,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(":");this.state.type=t;this.state.channel=e}finally{}},mWS:function(){try{var e=this.WS,i=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,n=0;t:for(;;){var r=2,a=this.input.LA(1);"\t"!=a&&"\f"!=a&&" "!=a||(r=1);switch(r){case 1:if("\t"!=this.input.LA(1)&&"\f"!=this.input.LA(1)&&" "!=this.input.LA(1)){var s=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(s);throw s}this.input.consume();break;default:if(n>=1)break t;throw new org.antlr.runtime.EarlyExitException(26,this.input)}n++}i=t;this.state.type=e;this.state.channel=i}finally{}},mA:function(){try{if("A"!=this.input.LA(1)&&"a"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mB:function(){try{if("B"!=this.input.LA(1)&&"b"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mC:function(){try{if("C"!=this.input.LA(1)&&"c"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mD:function(){try{if("D"!=this.input.LA(1)&&"d"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mE:function(){try{if("E"!=this.input.LA(1)&&"e"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mF:function(){try{if("F"!=this.input.LA(1)&&"f"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mG:function(){try{if("G"!=this.input.LA(1)&&"g"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mH:function(){try{if("H"!=this.input.LA(1)&&"h"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mI:function(){try{if("I"!=this.input.LA(1)&&"i"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mJ:function(){try{if("J"!=this.input.LA(1)&&"j"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mK:function(){try{if("K"!=this.input.LA(1)&&"k"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mL:function(){try{if("L"!=this.input.LA(1)&&"l"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mM:function(){try{if("M"!=this.input.LA(1)&&"m"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mN:function(){try{if("N"!=this.input.LA(1)&&"n"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mO:function(){try{if("O"!=this.input.LA(1)&&"o"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mP:function(){try{if("P"!=this.input.LA(1)&&"p"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mQ:function(){try{if("Q"!=this.input.LA(1)&&"q"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mR:function(){try{if("R"!=this.input.LA(1)&&"r"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mS:function(){try{if("S"!=this.input.LA(1)&&"s"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mT:function(){try{if("T"!=this.input.LA(1)&&"t"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mU:function(){try{if("U"!=this.input.LA(1)&&"u"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mV:function(){try{if("V"!=this.input.LA(1)&&"v"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mW:function(){try{if("W"!=this.input.LA(1)&&"w"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mX:function(){try{if("X"!=this.input.LA(1)&&"x"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mY:function(){try{if("Y"!=this.input.LA(1)&&"y"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mZ:function(){try{if("Z"!=this.input.LA(1)&&"z"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mCOMMA:function(){try{var t=this.COMMA,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(",");this.state.type=t;this.state.channel=e}finally{}},mSTRING:function(){try{var t=this.STRING,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,i=2,n=this.input.LA(1);if("'"==n)i=1;else{if('"'!=n){throw new org.antlr.runtime.NoViableAltException("",29,0,this.input)}i=2}switch(i){case 1:this.match("'");t:for(;;){var r=2,a=this.input.LA(1);"'"==a?r=2:(a>="\0"&&a<="&"||a>="("&&a<="￿")&&(r=1);switch(r){case 1:this.matchAny();break;default:break t}}this.match("'");break;case 2:this.match('"');t:for(;;){var s=3,o=this.input.LA(1);if("\\"==o){var l=this.input.LA(2);if('"'==l){var u=this.input.LA(3);s=u>="\0"&&u<="￿"?1:2}else(l>="\0"&&l<="!"||l>="#"&&l<="￿")&&(s=2)}else(o>="\0"&&o<="!"||o>="#"&&o<="["||o>="]"&&o<="￿")&&(s=2);switch(s){case 1:this.match('\\"');break;case 2:if(!(this.input.LA(1)>="\0"&&this.input.LA(1)<="!"||this.input.LA(1)>="#"&&this.input.LA(1)<="￿")){var h=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(h);throw h}this.input.consume();break;default:break t}}this.match('"')}this.state.type=t;this.state.channel=e}finally{}},mTokens:function(){switch(this.dfa30.predict(this.input)){case 1:this.mT__113();break;case 2:this.mT__114();break;case 3:this.mT__115();break;case 4:this.mT__116();break;case 5:this.mNEWLINE();break;case 6:this.mWHILESTATEMENT();break;case 7:this.mFORSTATEMENT();break;case 8:this.mFROMSTATEMENT();break;case 9:this.mINSTATEMENT();break;case 10:this.mTOSTATEMENT();break;case 11:this.mBYSTATEMENT();break;case 12:this.mLOOPSTATEMENT();break;case 13:this.mIFSTATEMENT();break;case 14:this.mTHENSTATEMENT();break;case 15:this.mELSESTATEMENT();break;case 16:this.mFUNCTIONSTATEMENT();break;case 17:this.mENDBLOCK();break;case 18:this.mRETURNSTATEMENT();break;case 19:this.mNEWSTATEMENT();break;case 20:this.mTRYSTATEMENT();break;case 21:this.mCATCHSTATEMENT();break;case 22:this.mTHROWSTATEMENT();break;case 23:this.mOR();break;case 24:this.mXOR();break;case 25:this.mAND();break;case 26:this.mEQUALS();break;case 27:this.mNOTEQUALS();break;case 28:this.mLT();break;case 29:this.mLTEQ();break;case 30:this.mGT();break;case 31:this.mGTEQ();break;case 32:this.mPLUS();break;case 33:this.mMINUS();break;case 34:this.mMULT();break;case 35:this.mDIV();break;case 36:this.mMOD();break;case 37:this.mPOW();break;case 38:this.mNOT();break;case 39:this.mLARR();break;case 40:this.mRARR();break;case 41:this.mLCURL();break;case 42:this.mRCURL();break;case 43:this.mINTEGER();break;case 44:this.mFLOAT();break;case 45:this.mTRUE();break;case 46:this.mFALSE();break;case 47:this.mPER();break;case 48:this.mSQUARED();break;case 49:this.mCUBED();break;case 50:this.mIDENT();break;case 51:this.mPRIMITIVE();break;case 52:this.mLBRACKET();break;case 53:this.mRBRACKET();break;case 54:this.mCOMMENT();break;case 55:this.mLINE_COMMENT();break;case 56:this.mCOLON();break;case 57:this.mWS();break;case 58:this.mCOMMA();break;case 59:this.mSTRING()}}},!0);org.antlr.lang.augmentObject(FormulaLexer,{DFA30_eotS:"￿12￿\n&￿&￿&￿JL￿N￿&￿P&￿S\f￿&Z[\\&a\b&&￿&￿&￿&p&￿&v&￿&z&|J&&￿&&￿￿&￿&￿&￿&￿￿&&￿&￿￿&￿￿",DFA30_eofS:"￿",DFA30_minS:"\t￿-0￿HAFHYOLEA￿RO￿N￿=￿*￿O￿.EQ￿\0\f￿IRONL0EU0OSDTWTB0RD￿D￿RU￿L0MCS￿NO0E￿PE0U0CE0AE￿0TE0W￿0￿R￿HD￿R0￿I0￿0￿N0E￿O￿0￿DN￿0￿",DFA30_maxS:"»￿>9￿hunryoneou￿ro￿n￿=>￿/￿o￿9eq￿￿\f￿ironlzryzosdtwtbzrd￿d￿ru￿lzmcs￿noze￿pezuzcezae￿ztezw￿z￿r￿hd￿rz￿iz￿z￿nze￿o￿z￿dn￿z￿",DFA30_acceptS:"￿￿\n￿￿￿￿ !\"￿$￿%'()*￿2￿5789:;,￿&6#￿+￿43￿\t\r\n￿\v￿￿￿￿￿/￿\b￿￿-\f￿￿.￿1￿￿0",DFA30_specialS:"'￿\0u￿}>",DFA30_transitionS:["+￿+￿+-)￿-,\n#*￿￿\n&\f&\b&\v$&\r%\t&&'￿(￿\n&\f&\b&\v$&\r%\t&&!\"-￿￿ ","","",".￿0/","\n3","","4￿4","8\r￿5￿6￿7\v￿8\r￿5￿6￿7",":￿9￿:￿9","<￿;￿=￿<￿;￿=",">￿>","?￿?","@￿A￿@￿A","B￿B","C\t￿D￿C\t￿D","E￿F\v￿E￿F","","G￿G","H￿H","","I￿I","","/","K ","","","","M￿)","","O￿O","","","","","","3￿\n#","Q￿Q","R￿R","","\0T","","","","","","","","","","","","","U￿U","V￿V","W￿W","X￿X","Y￿Y","\n&￿&￿&￿&","\n&￿&￿&￿&","\n&￿&￿&￿&","]\f￿^￿]\f￿^","`￿_￿`￿_","\n&￿&￿&￿&","b￿b","c￿c","d￿d","e￿e","f￿f","g￿g","h￿h","i￿i","\n&￿&￿&￿&","j￿j","k￿k","","","","","","l￿l","","m￿m","n￿n","","","o￿o","\n&￿&￿&￿&","q￿q","r￿r","s￿s","","","","t￿t","u￿u","\n&￿&￿&￿&","w￿w","","x￿x","y￿y","\n&￿&￿&￿&","{￿{","\n&￿&￿&￿&","\n&￿&￿&￿&","}￿}","~￿~","\n&￿&￿&￿&","\n&￿&￿&￿&","\n&￿&￿&￿&","\n&￿&￿&￿&","￿","￿","","\n&￿&￿&￿&","￿","￿","\n&￿&￿&￿&","￿","","\n&￿&￿&￿&","\n&￿&￿&￿&","\n&￿&￿&￿&","","￿","","￿","￿","","","￿","\n&￿&￿&￿&","","￿","\n&￿&￿&￿&","","\n&￿&￿&￿&","","","","￿","\n&￿&￿&￿&","\n&￿&￿&￿&","￿","","￿","","","\n&￿&￿&￿&","","","￿","￿","","\n&￿&￿&￿&","\n&￿&￿&￿&","",""]});org.antlr.lang.augmentObject(FormulaLexer,{DFA30_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_eotS),DFA30_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_eofS),DFA30_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaLexer.DFA30_minS),DFA30_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaLexer.DFA30_maxS),DFA30_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_acceptS),DFA30_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_specialS),DFA30_transition:function(){var t,e=[],i=FormulaLexer.DFA30_transitionS.length;for(t=0;t<i;t++)e.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_transitionS[t]));return e}()});FormulaLexer.DFA30=function(t){this.recognizer=t;this.decisionNumber=30;this.eot=FormulaLexer.DFA30_eot;this.eof=FormulaLexer.DFA30_eof;this.min=FormulaLexer.DFA30_min;this.max=FormulaLexer.DFA30_max;this.accept=FormulaLexer.DFA30_accept;this.special=FormulaLexer.DFA30_special;this.transition=FormulaLexer.DFA30_transition};org.antlr.lang.extend(FormulaLexer.DFA30,org.antlr.runtime.DFA,{getDescription:function(){return"1:1: Tokens : ( T__113 | T__114 | T__115 | T__116 | NEWLINE | WHILESTATEMENT | FORSTATEMENT | FROMSTATEMENT | INSTATEMENT | TOSTATEMENT | BYSTATEMENT | LOOPSTATEMENT | IFSTATEMENT | THENSTATEMENT | ELSESTATEMENT | FUNCTIONSTATEMENT | ENDBLOCK | RETURNSTATEMENT | NEWSTATEMENT | TRYSTATEMENT | CATCHSTATEMENT | THROWSTATEMENT | OR | XOR | AND | EQUALS | NOTEQUALS | LT | LTEQ | GT | GTEQ | PLUS | MINUS | MULT | DIV | MOD | POW | NOT | LARR | RARR | LCURL | RCURL | INTEGER | FLOAT | TRUE | FALSE | PER | SQUARED | CUBED | IDENT | PRIMITIVE | LBRACKET | RBRACKET | COMMENT | LINE_COMMENT | COLON | WS | COMMA | STRING );"},specialStateTransition:function(t,e){var i=t,n=function(t,e){switch(t){case 0:var i=e.LA(1);t=-1;if((t=i>="\0"&&i<="￿"?84:83)>=0)return t}}.call(this.recognizer,t,e);if(!org.antlr.lang.isUndefined(n))return n;var r=new org.antlr.runtime.NoViableAltException(this.getDescription(),30,i,e);this.error(r);throw r},dummy:null})}();var FormulaParser=function(t,e){e||(e=new org.antlr.runtime.RecognizerSharedState);(function(){}).call(this);FormulaParser.superclass.constructor.call(this,t,e);this.dfa5=new FormulaParser.DFA5(this);this.dfa57=new FormulaParser.DFA57(this);this.dfa58=new FormulaParser.DFA58(this);this.dfa65=new FormulaParser.DFA65(this);this.dfa72=new FormulaParser.DFA72(this);this.dfa85=new FormulaParser.DFA85(this);this.adaptor=new org.antlr.runtime.tree.CommonTreeAdaptor};org.antlr.lang.augmentObject(FormulaParser,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112});!function(){var t=11,e=32,i=54,n=60,r=62,a=64,s=69,o=70,l=71,u=82,h=83,c=86,d=88,m=89,f=91,g=93,p=94,_=98,v=100,S=101;org.antlr.lang.extend(FormulaParser,org.antlr.runtime.Parser,{setTreeAdaptor:function(t){this.adaptor=t},getTreeAdaptor:function(){return this.adaptor},getTokenNames:function(){return FormulaParser.tokenNames},getGrammarFileName:function(){return"/Library/WebServer/Documents/calc/Formula.g"}});org.antlr.lang.augmentObject(FormulaParser.prototype,{lines_return:function(){FormulaParser.lines_return=function(){};org.antlr.lang.extend(FormulaParser.lines_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),lines:function(){var t=new FormulaParser.lines_return;t.start=this.input.LT(1);var r=null,a=null,o=null,h=null,c=null,g=null,v=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),S=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EOF"),N=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression");try{t:for(;;){var T=2;this.input.LA(1)==e&&(T=1);switch(T){case 1:a=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_lines160);if(this.state.failed)return t;0===this.state.backtracking&&v.add(a);break;default:break t}}t:for(;;){var b=2,E=this.input.LA(1);(38==E||42==E||E==i||E==n||E>=63&&E<=65||E>=68&&E<=s||E==l||E==u||E>=d&&E<=m||E==f||E>=p&&E<=_||113==E)&&(b=1);switch(b){case 1:this.pushFollow(FormulaParser.FOLLOW_expression_in_lines164);g=this.expression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&N.add(g.getTree());var F=2,k=this.input.LA(1);if(k==e)F=1;else{if(-1!=k){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",3,0,this.input)}F=2}switch(F){case 1:var L=0;e:for(;;){var w=2;this.input.LA(1)==e&&(w=1);switch(w){case 1:o=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_lines168);if(this.state.failed)return t;0===this.state.backtracking&&v.add(o);break;default:if(L>=1)break e;if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.EarlyExitException(2,this.input)}L++}break;case 2:h=this.match(this.input,-1,FormulaParser.FOLLOW_EOF_in_lines171);if(this.state.failed)return t;0===this.state.backtracking&&S.add(h)}break;default:break t}}c=this.match(this.input,-1,FormulaParser.FOLLOW_EOF_in_lines176);if(this.state.failed)return t;0===this.state.backtracking&&S.add(c);if(0===this.state.backtracking){t.tree=r;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);r=this.adaptor.nil();var x=this.adaptor.nil();x=this.adaptor.becomeRoot(this.adaptor.create(14,"LINES"),x);for(;N.hasNext();)this.adaptor.addChild(x,N.nextTree());N.reset();this.adaptor.addChild(r,x);t.tree=r}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(r);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},expression_return:function(){FormulaParser.expression_return=function(){};org.antlr.lang.extend(FormulaParser.expression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),expression:function(){var t=new FormulaParser.expression_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null,a=null,s=null,o=null,l=null,u=null,h=null,c=null;try{switch(this.dfa5.predict(this.input)){case 1:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_assignment_in_expression508);i=this.assignment();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());break;case 2:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_expression514);n=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());break;case 3:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_whileLoop_in_expression520);r=this.whileLoop();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;case 4:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_forLoop_in_expression526);a=this.forLoop();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,a.getTree());break;case 5:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_forInLoop_in_expression532);s=this.forInLoop();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,s.getTree());break;case 6:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_ifThenElse_in_expression538);o=this.ifThenElse();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,o.getTree());break;case 7:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_functionDef_in_expression544);l=this.functionDef();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,l.getTree());break;case 8:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_returnExp_in_expression550);u=this.returnExp();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,u.getTree());break;case 9:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_tryCatch_in_expression556);h=this.tryCatch();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,h.getTree());break;case 10:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_throwExp_in_expression562);c=this.throwExp();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,c.getTree())}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},returnExp_return:function(){FormulaParser.returnExp_return=function(){};org.antlr.lang.extend(FormulaParser.returnExp_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),returnExp:function(){var t=new FormulaParser.returnExp_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null;try{e=this.adaptor.nil();i=this.match(this.input,63,FormulaParser.FOLLOW_RETURNSTATEMENT_in_returnExp574);if(this.state.failed)return t;if(0===this.state.backtracking){r=this.adaptor.create(i);e=this.adaptor.becomeRoot(r,e)}this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_returnExp577);n=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},innerBlock_return:function(){FormulaParser.innerBlock_return=function(){};org.antlr.lang.extend(FormulaParser.innerBlock_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),innerBlock:function(){var t=new FormulaParser.innerBlock_return;t.start=this.input.LT(1);var r=null,a=null,o=null,h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),c=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression");try{t:for(;;){var g=2,v=this.input.LA(1);(38==v||42==v||v==i||v==n||v>=63&&v<=65||v>=68&&v<=s||v==l||v==u||v>=d&&v<=m||v==f||v>=p&&v<=_||113==v)&&(g=1);switch(g){case 1:this.pushFollow(FormulaParser.FOLLOW_expression_in_innerBlock590);o=this.expression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&c.add(o.getTree());var S=0;e:for(;;){var N=2;this.input.LA(1)==e&&(N=1);switch(N){case 1:a=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_innerBlock594);if(this.state.failed)return t;0===this.state.backtracking&&h.add(a);break;default:if(S>=1)break e;if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.EarlyExitException(6,this.input)}S++}break;default:break t}}if(0===this.state.backtracking){t.tree=r;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);r=this.adaptor.nil();var T=this.adaptor.nil();T=this.adaptor.becomeRoot(this.adaptor.create(14,"LINES"),T);if(!c.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;c.hasNext();)this.adaptor.addChild(T,c.nextTree());c.reset();this.adaptor.addChild(r,T);t.tree=r}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(r);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},whileLoop_return:function(){FormulaParser.whileLoop_return=function(){};org.antlr.lang.extend(FormulaParser.whileLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),whileLoop:function(){var t=new FormulaParser.whileLoop_return;t.start=this.input.LT(1);var i=null,n=null,a=null,s=null,o=null,l=null,u=null,h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),c=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),d=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LOOPSTATEMENT"),m=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token WHILESTATEMENT"),f=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),g=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{n=this.match(this.input,38,FormulaParser.FOLLOW_WHILESTATEMENT_in_whileLoop619);if(this.state.failed)return t;0===this.state.backtracking&&m.add(n);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_whileLoop621);l=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&g.add(l.getTree());var p=0;t:for(;;){var _=2;this.input.LA(1)==e&&(_=1);switch(_){case 1:a=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_whileLoop623);if(this.state.failed)return t;0===this.state.backtracking&&h.add(a);break;default:if(p>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.EarlyExitException(8,this.input)}p++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_whileLoop626);u=this.innerBlock();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&f.add(u.getTree());s=this.match(this.input,r,FormulaParser.FOLLOW_ENDBLOCK_in_whileLoop629);if(this.state.failed)return t;0===this.state.backtracking&&c.add(s);o=this.match(this.input,53,FormulaParser.FOLLOW_LOOPSTATEMENT_in_whileLoop631);if(this.state.failed)return t;0===this.state.backtracking&&d.add(o);if(0===this.state.backtracking){t.tree=i;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);i=this.adaptor.nil();var v=this.adaptor.nil();v=this.adaptor.becomeRoot(this.adaptor.create(15,"WHILE"),v);this.adaptor.addChild(v,g.nextTree());this.adaptor.addChild(v,f.nextTree());this.adaptor.addChild(i,v);t.tree=i}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(i);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},forLoop_return:function(){FormulaParser.forLoop_return=function(){};org.antlr.lang.extend(FormulaParser.forLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),forLoop:function(){var i=new FormulaParser.forLoop_return;i.start=this.input.LT(1);var n=null,a=null,o=null,l=null,u=null,h=null,c=null,d=null,m=null,f=null,g=null,p=null,_=null,v=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FORSTATEMENT"),S=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),N=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FROMSTATEMENT"),T=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),b=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token TOSTATEMENT"),E=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),F=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LOOPSTATEMENT"),k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token BYSTATEMENT"),L=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),w=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{a=this.match(this.input,42,FormulaParser.FOLLOW_FORSTATEMENT_in_forLoop652);if(this.state.failed)return i;0===this.state.backtracking&&v.add(a);o=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_forLoop654);if(this.state.failed)return i;0===this.state.backtracking&&S.add(o);l=this.match(this.input,44,FormulaParser.FOLLOW_FROMSTATEMENT_in_forLoop656);if(this.state.failed)return i;0===this.state.backtracking&&N.add(l);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop658);f=this.logicalExpression();this.state._fsp--;if(this.state.failed)return i;0===this.state.backtracking&&w.add(f.getTree());u=this.match(this.input,48,FormulaParser.FOLLOW_TOSTATEMENT_in_forLoop660);if(this.state.failed)return i;0===this.state.backtracking&&b.add(u);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop662);g=this.logicalExpression();this.state._fsp--;if(this.state.failed)return i;0===this.state.backtracking&&w.add(g.getTree());var x=2;51==this.input.LA(1)&&(x=1);switch(x){case 1:h=this.match(this.input,51,FormulaParser.FOLLOW_BYSTATEMENT_in_forLoop665);if(this.state.failed)return i;0===this.state.backtracking&&k.add(h);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop667);p=this.logicalExpression();this.state._fsp--;if(this.state.failed)return i;0===this.state.backtracking&&w.add(p.getTree())}var y=0;t:for(;;){var A=2;this.input.LA(1)==e&&(A=1);switch(A){case 1:c=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_forLoop671);if(this.state.failed)return i;0===this.state.backtracking&&T.add(c);break;default:if(y>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return i}throw new org.antlr.runtime.EarlyExitException(10,this.input)}y++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_forLoop674);_=this.innerBlock();this.state._fsp--;if(this.state.failed)return i;0===this.state.backtracking&&L.add(_.getTree());d=this.match(this.input,r,FormulaParser.FOLLOW_ENDBLOCK_in_forLoop677);if(this.state.failed)return i;0===this.state.backtracking&&E.add(d);m=this.match(this.input,53,FormulaParser.FOLLOW_LOOPSTATEMENT_in_forLoop679);if(this.state.failed)return i;0===this.state.backtracking&&F.add(m);if(0===this.state.backtracking){i.tree=n;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=i?i.tree:null);n=this.adaptor.nil();var O=this.adaptor.nil();O=this.adaptor.becomeRoot(this.adaptor.create(18,"FOR"),O);this.adaptor.addChild(O,S.nextNode());var R=this.adaptor.nil();R=this.adaptor.becomeRoot(this.adaptor.create(t,"PARAMS"),R);for(;w.hasNext();)this.adaptor.addChild(R,w.nextTree());w.reset();this.adaptor.addChild(O,R);this.adaptor.addChild(O,L.nextTree());this.adaptor.addChild(n,O);i.tree=n}i.stop=this.input.LT(-1);if(0===this.state.backtracking){i.tree=this.adaptor.rulePostProcessing(n);this.adaptor.setTokenBoundaries(i.tree,i.start,i.stop)}}catch(t){if(!(t instanceof org.antlr.runtime.RecognitionException))throw t;this.reportError(t);this.recover(this.input,t);i.tree=this.adaptor.errorNode(this.input,i.start,this.input.LT(-1),t)}return i},forInLoop_return:function(){FormulaParser.forInLoop_return=function(){};org.antlr.lang.extend(FormulaParser.forInLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),forInLoop:function(){var t=new FormulaParser.forInLoop_return;t.start=this.input.LT(1);var i=null,n=null,a=null,o=null,l=null,u=null,h=null,c=null,d=null,m=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FORSTATEMENT"),f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),g=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),p=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),_=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LOOPSTATEMENT"),v=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token INSTATEMENT"),S=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),N=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{n=this.match(this.input,42,FormulaParser.FOLLOW_FORSTATEMENT_in_forInLoop707);if(this.state.failed)return t;0===this.state.backtracking&&m.add(n);a=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_forInLoop709);if(this.state.failed)return t;0===this.state.backtracking&&f.add(a);o=this.match(this.input,46,FormulaParser.FOLLOW_INSTATEMENT_in_forInLoop711);if(this.state.failed)return t;0===this.state.backtracking&&v.add(o);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forInLoop713);c=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&N.add(c.getTree());var T=0;t:for(;;){var b=2;this.input.LA(1)==e&&(b=1);switch(b){case 1:l=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_forInLoop715);if(this.state.failed)return t;0===this.state.backtracking&&g.add(l);break;default:if(T>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.EarlyExitException(11,this.input)}T++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_forInLoop718);d=this.innerBlock();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&S.add(d.getTree());u=this.match(this.input,r,FormulaParser.FOLLOW_ENDBLOCK_in_forInLoop721);if(this.state.failed)return t;0===this.state.backtracking&&p.add(u);h=this.match(this.input,53,FormulaParser.FOLLOW_LOOPSTATEMENT_in_forInLoop723);if(this.state.failed)return t;0===this.state.backtracking&&_.add(h);if(0===this.state.backtracking){t.tree=i;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);i=this.adaptor.nil();var E=this.adaptor.nil();E=this.adaptor.becomeRoot(this.adaptor.create(19,"FORIN"),E);this.adaptor.addChild(E,f.nextNode());this.adaptor.addChild(E,N.nextTree());this.adaptor.addChild(E,S.nextTree());this.adaptor.addChild(i,E);t.tree=i}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(i);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},ifThenElse_return:function(){FormulaParser.ifThenElse_return=function(){};org.antlr.lang.extend(FormulaParser.ifThenElse_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),ifThenElse:function(){var n=new FormulaParser.ifThenElse_return;n.start=this.input.LT(1);var a=null,s=null,o=null,l=null,u=null,h=null,c=null,d=null,m=null,f=null,g=null,p=null,_=null,v=null,S=null,N=null,T=null,b=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IFSTATEMENT"),E=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),F=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ELSESTATEMENT"),L=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token THENSTATEMENT"),w=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),x=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{s=this.match(this.input,i,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse748);if(this.state.failed)return n;0===this.state.backtracking&&b.add(s);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_ifThenElse750);_=this.logicalExpression();this.state._fsp--;if(this.state.failed)return n;0===this.state.backtracking&&x.add(_.getTree());o=this.match(this.input,55,FormulaParser.FOLLOW_THENSTATEMENT_in_ifThenElse752);if(this.state.failed)return n;0===this.state.backtracking&&L.add(o);var y=0;t:for(;;){var A=2;this.input.LA(1)==e&&(A=1);switch(A){case 1:l=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse755);if(this.state.failed)return n;0===this.state.backtracking&&E.add(l);break;default:if(y>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return n}throw new org.antlr.runtime.EarlyExitException(12,this.input)}y++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse758);v=this.innerBlock();this.state._fsp--;if(this.state.failed)return n;0===this.state.backtracking&&w.add(v.getTree());t:for(;;){var O=2;if(57==this.input.LA(1)){this.input.LA(2)==i&&(O=1)}switch(O){case 1:u=this.match(this.input,57,FormulaParser.FOLLOW_ELSESTATEMENT_in_ifThenElse762);if(this.state.failed)return n;0===this.state.backtracking&&k.add(u);h=this.match(this.input,i,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse764);if(this.state.failed)return n;0===this.state.backtracking&&b.add(h);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_ifThenElse766);S=this.logicalExpression();this.state._fsp--;if(this.state.failed)return n;0===this.state.backtracking&&x.add(S.getTree());c=this.match(this.input,55,FormulaParser.FOLLOW_THENSTATEMENT_in_ifThenElse768);if(this.state.failed)return n;0===this.state.backtracking&&L.add(c);var R=0;e:for(;;){var P=2;this.input.LA(1)==e&&(P=1);switch(P){case 1:d=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse770);if(this.state.failed)return n;0===this.state.backtracking&&E.add(d);break;default:if(R>=1)break e;if(this.state.backtracking>0){this.state.failed=!0;return n}throw new org.antlr.runtime.EarlyExitException(13,this.input)}R++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse773);N=this.innerBlock();this.state._fsp--;if(this.state.failed)return n;0===this.state.backtracking&&w.add(N.getTree());break;default:break t}}var C=2;57==this.input.LA(1)&&(C=1);switch(C){case 1:m=this.match(this.input,57,FormulaParser.FOLLOW_ELSESTATEMENT_in_ifThenElse778);if(this.state.failed)return n;0===this.state.backtracking&&k.add(m);var M=0;t:for(;;){var I=2;this.input.LA(1)==e&&(I=1);switch(I){case 1:f=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse780);if(this.state.failed)return n;0===this.state.backtracking&&E.add(f);break;default:if(M>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return n}throw new org.antlr.runtime.EarlyExitException(15,this.input)}M++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse783);T=this.innerBlock();this.state._fsp--;if(this.state.failed)return n;0===this.state.backtracking&&w.add(T.getTree())}g=this.match(this.input,r,FormulaParser.FOLLOW_ENDBLOCK_in_ifThenElse787);if(this.state.failed)return n;0===this.state.backtracking&&F.add(g);p=this.match(this.input,i,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse789);if(this.state.failed)return n;0===this.state.backtracking&&b.add(p);if(0===this.state.backtracking){n.tree=a;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=n?n.tree:null);a=this.adaptor.nil();var B=this.adaptor.nil();B=this.adaptor.becomeRoot(this.adaptor.create(16,"IFTHENELSE"),B);var D=this.adaptor.nil();D=this.adaptor.becomeRoot(this.adaptor.create(t,"PARAMS"),D);if(!x.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;x.hasNext();)this.adaptor.addChild(D,x.nextTree());x.reset();this.adaptor.addChild(B,D);D=this.adaptor.nil();D=this.adaptor.becomeRoot(this.adaptor.create(t,"PARAMS"),D);if(!w.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;w.hasNext();)this.adaptor.addChild(D,w.nextTree());w.reset();this.adaptor.addChild(B,D);this.adaptor.addChild(a,B);n.tree=a}n.stop=this.input.LT(-1);if(0===this.state.backtracking){n.tree=this.adaptor.rulePostProcessing(a);this.adaptor.setTokenBoundaries(n.tree,n.start,n.stop)}}catch(t){if(!(t instanceof org.antlr.runtime.RecognitionException))throw t;this.reportError(t);this.recover(this.input,t);n.tree=this.adaptor.errorNode(this.input,n.start,this.input.LT(-1),t)}return n},functionDef_return:function(){FormulaParser.functionDef_return=function(){};org.antlr.lang.extend(FormulaParser.functionDef_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),functionDef:function(){var i=new FormulaParser.functionDef_return;i.start=this.input.LT(1);var a=null,l=null,u=null,h=null,c=null,d=null,m=null,f=null,p=null,_=null,v=null,S=null,N=null,T=null,b=null,E=null,F=null,k=null,L=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FUNCTIONSTATEMENT"),w=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),x=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),y=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),O=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),R=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),P=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),C=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),M=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue");try{l=this.match(this.input,n,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_functionDef820);if(this.state.failed)return i;0===this.state.backtracking&&L.add(l);u=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_functionDef822);if(this.state.failed)return i;0===this.state.backtracking&&x.add(u);h=this.match(this.input,113,FormulaParser.FOLLOW_113_in_functionDef824);if(this.state.failed)return i;0===this.state.backtracking&&A.add(h);var I=2;this.input.LA(1)==s&&(I=1);switch(I){case 1:c=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_functionDef827);if(this.state.failed)return i;0===this.state.backtracking&&x.add(c);var B=2,D=this.input.LA(1);if(D==o)B=1;else{if(D!=g&&114!=D){if(this.state.backtracking>0){this.state.failed=!0;return i}throw new org.antlr.runtime.NoViableAltException("",18,0,this.input)}B=2}switch(B){case 1:d=this.match(this.input,o,FormulaParser.FOLLOW_EQUALS_in_functionDef831);if(this.state.failed)return i;0===this.state.backtracking&&y.add(d);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_functionDef834);E=this.defaultValue();this.state._fsp--;if(this.state.failed)return i;0===this.state.backtracking&&M.add(E.getTree());break;case 2:t:for(;;){var V=2;if(this.input.LA(1)==g){if(this.input.LA(2)==s){var U=this.input.LA(3);U!=g&&114!=U||(V=1)}}switch(V){case 1:m=this.match(this.input,g,FormulaParser.FOLLOW_COMMA_in_functionDef839);if(this.state.failed)return i;0===this.state.backtracking&&R.add(m);f=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_functionDef841);if(this.state.failed)return i;0===this.state.backtracking&&x.add(f);break;default:break t}}}t:for(;;){var W=2;this.input.LA(1)==g&&(W=1);switch(W){case 1:p=this.match(this.input,g,FormulaParser.FOLLOW_COMMA_in_functionDef848);if(this.state.failed)return i;0===this.state.backtracking&&R.add(p);_=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_functionDef850);if(this.state.failed)return i;0===this.state.backtracking&&x.add(_);v=this.match(this.input,o,FormulaParser.FOLLOW_EQUALS_in_functionDef852);if(this.state.failed)return i;0===this.state.backtracking&&y.add(v);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_functionDef854);F=this.defaultValue();this.state._fsp--;if(this.state.failed)return i;0===this.state.backtracking&&M.add(F.getTree());break;default:break t}}}S=this.match(this.input,114,FormulaParser.FOLLOW_114_in_functionDef861);if(this.state.failed)return i;0===this.state.backtracking&&w.add(S);var G=0;t:for(;;){var q=2;this.input.LA(1)==e&&(q=1);switch(q){case 1:N=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_functionDef863);if(this.state.failed)return i;0===this.state.backtracking&&O.add(N);break;default:if(G>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return i}throw new org.antlr.runtime.EarlyExitException(21,this.input)}G++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_functionDef866);k=this.innerBlock();this.state._fsp--;if(this.state.failed)return i;0===this.state.backtracking&&C.add(k.getTree());T=this.match(this.input,r,FormulaParser.FOLLOW_ENDBLOCK_in_functionDef869);if(this.state.failed)return i;0===this.state.backtracking&&P.add(T);b=this.match(this.input,n,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_functionDef871);if(this.state.failed)return i;0===this.state.backtracking&&L.add(b);if(0===this.state.backtracking){i.tree=a;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=i?i.tree:null);a=this.adaptor.nil();var j=this.adaptor.nil();j=this.adaptor.becomeRoot(this.adaptor.create(20,"FUNCTION"),j);var z=this.adaptor.nil();z=this.adaptor.becomeRoot(this.adaptor.create(t,"PARAMS"),z);for(;x.hasNext();)this.adaptor.addChild(z,x.nextNode());x.reset();this.adaptor.addChild(j,z);z=this.adaptor.nil();z=this.adaptor.becomeRoot(this.adaptor.create(10,"DEFAULTS"),z);for(;M.hasNext();)this.adaptor.addChild(z,M.nextTree());M.reset();this.adaptor.addChild(j,z);this.adaptor.addChild(j,C.nextTree());this.adaptor.addChild(a,j);i.tree=a}i.stop=this.input.LT(-1);if(0===this.state.backtracking){i.tree=this.adaptor.rulePostProcessing(a);this.adaptor.setTokenBoundaries(i.tree,i.start,i.stop)}}catch(t){if(!(t instanceof org.antlr.runtime.RecognitionException))throw t;this.reportError(t);this.recover(this.input,t);i.tree=this.adaptor.errorNode(this.input,i.start,this.input.LT(-1),t)}return i},tryCatch_return:function(){FormulaParser.tryCatch_return=function(){};org.antlr.lang.extend(FormulaParser.tryCatch_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),tryCatch:function(){var t=new FormulaParser.tryCatch_return;t.start=this.input.LT(1);var i=null,n=null,a=null,o=null,l=null,u=null,h=null,c=null,d=null,m=null,f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),g=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token TRYSTATEMENT"),p=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),_=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token CATCHSTATEMENT"),v=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),S=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock");try{n=this.match(this.input,65,FormulaParser.FOLLOW_TRYSTATEMENT_in_tryCatch904);if(this.state.failed)return t;0===this.state.backtracking&&g.add(n);var N=0;t:for(;;){var T=2;this.input.LA(1)==e&&(T=1);switch(T){case 1:a=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_tryCatch906);if(this.state.failed)return t;0===this.state.backtracking&&p.add(a);break;default:if(N>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.EarlyExitException(22,this.input)}N++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_tryCatch909);d=this.innerBlock();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&S.add(d.getTree());o=this.match(this.input,67,FormulaParser.FOLLOW_CATCHSTATEMENT_in_tryCatch911);if(this.state.failed)return t;0===this.state.backtracking&&_.add(o);l=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_tryCatch913);if(this.state.failed)return t;0===this.state.backtracking&&f.add(l);var b=0;t:for(;;){var E=2;this.input.LA(1)==e&&(E=1);switch(E){case 1:u=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_tryCatch915);if(this.state.failed)return t;0===this.state.backtracking&&p.add(u);break;default:if(b>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.EarlyExitException(23,this.input)}b++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_tryCatch919);m=this.innerBlock();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&S.add(m.getTree());h=this.match(this.input,r,FormulaParser.FOLLOW_ENDBLOCK_in_tryCatch921);if(this.state.failed)return t;0===this.state.backtracking&&v.add(h);c=this.match(this.input,65,FormulaParser.FOLLOW_TRYSTATEMENT_in_tryCatch923);if(this.state.failed)return t;0===this.state.backtracking&&g.add(c);if(0===this.state.backtracking){t.tree=i;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);i=this.adaptor.nil();var F=this.adaptor.nil();F=this.adaptor.becomeRoot(this.adaptor.create(30,"TRYCATCH"),F);for(;S.hasNext();)this.adaptor.addChild(F,S.nextTree());S.reset();this.adaptor.addChild(F,f.nextNode());this.adaptor.addChild(i,F);t.tree=i}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(i);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},throwExp_return:function(){FormulaParser.throwExp_return=function(){};org.antlr.lang.extend(FormulaParser.throwExp_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),throwExp:function(){var t=new FormulaParser.throwExp_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token THROWSTATEMENT"),a=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule primaryExpression");try{i=this.match(this.input,68,FormulaParser.FOLLOW_THROWSTATEMENT_in_throwExp945);if(this.state.failed)return t;0===this.state.backtracking&&r.add(i);this.pushFollow(FormulaParser.FOLLOW_primaryExpression_in_throwExp947);n=this.primaryExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&a.add(n.getTree());if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var s=this.adaptor.nil();s=this.adaptor.becomeRoot(this.adaptor.create(31,"THROW"),s);this.adaptor.addChild(s,a.nextTree());this.adaptor.addChild(e,s);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},anonFunctionDef_return:function(){FormulaParser.anonFunctionDef_return=function(){};org.antlr.lang.extend(FormulaParser.anonFunctionDef_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),anonFunctionDef:function(){var a=new FormulaParser.anonFunctionDef_return;a.start=this.input.LT(1);var h=null,c=null,v=null,S=null,N=null,T=null,b=null,E=null,F=null,k=null,L=null,w=null,x=null,y=null,A=null,O=null,R=null,P=null,C=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FUNCTIONSTATEMENT"),M=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),I=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),B=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),D=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),V=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),U=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),W=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),G=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression"),q=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),j=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue");try{c=this.match(this.input,n,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef967);if(this.state.failed)return a;0===this.state.backtracking&&C.add(c);v=this.match(this.input,113,FormulaParser.FOLLOW_113_in_anonFunctionDef970);if(this.state.failed)return a;0===this.state.backtracking&&D.add(v);var z=2;this.input.LA(1)==s&&(z=1);switch(z){case 1:S=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef973);if(this.state.failed)return a;0===this.state.backtracking&&I.add(S);var H=2,K=this.input.LA(1);if(K==o)H=1;else{if(K!=g&&114!=K){if(this.state.backtracking>0){this.state.failed=!0;return a}throw new org.antlr.runtime.NoViableAltException("",25,0,this.input)}H=2}switch(H){case 1:N=this.match(this.input,o,FormulaParser.FOLLOW_EQUALS_in_anonFunctionDef977);if(this.state.failed)return a;0===this.state.backtracking&&B.add(N);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_anonFunctionDef980);A=this.defaultValue();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&j.add(A.getTree());break;case 2:t:for(;;){var Q=2;if(this.input.LA(1)==g){if(this.input.LA(2)==s){var Y=this.input.LA(3);Y!=g&&114!=Y||(Q=1)}}switch(Q){case 1:T=this.match(this.input,g,FormulaParser.FOLLOW_COMMA_in_anonFunctionDef985);if(this.state.failed)return a;0===this.state.backtracking&&U.add(T);b=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef987);if(this.state.failed)return a;0===this.state.backtracking&&I.add(b);break;default:break t}}}t:for(;;){var X=2;this.input.LA(1)==g&&(X=1);switch(X){case 1:E=this.match(this.input,g,FormulaParser.FOLLOW_COMMA_in_anonFunctionDef994);if(this.state.failed)return a;0===this.state.backtracking&&U.add(E);F=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef996);if(this.state.failed)return a;0===this.state.backtracking&&I.add(F);k=this.match(this.input,o,FormulaParser.FOLLOW_EQUALS_in_anonFunctionDef998);if(this.state.failed)return a;0===this.state.backtracking&&B.add(k);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_anonFunctionDef1000);O=this.defaultValue();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&j.add(O.getTree());break;default:break t}}}L=this.match(this.input,114,FormulaParser.FOLLOW_114_in_anonFunctionDef1007);if(this.state.failed)return a;0===this.state.backtracking&&M.add(L);var Z=2,J=this.input.LA(1);if(J==e)Z=1;else{if(!(38==J||42==J||J==i||J==n||J>=63&&J<=65||J>=68&&J<=s||J==l||J==u||J>=d&&J<=m||J==f||J>=p&&J<=_||113==J)){if(this.state.backtracking>0){this.state.failed=!0;return a}throw new org.antlr.runtime.NoViableAltException("",29,0,this.input)}Z=2}switch(Z){case 1:var $=0;t:for(;;){var tt=2;this.input.LA(1)==e&&(tt=1);switch(tt){case 1:w=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_anonFunctionDef1012);if(this.state.failed)return a;0===this.state.backtracking&&V.add(w);break;default:if($>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return a}throw new org.antlr.runtime.EarlyExitException(28,this.input)}$++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_anonFunctionDef1015);R=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&q.add(R.getTree());x=this.match(this.input,r,FormulaParser.FOLLOW_ENDBLOCK_in_anonFunctionDef1018);if(this.state.failed)return a;0===this.state.backtracking&&W.add(x);y=this.match(this.input,n,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef1020);if(this.state.failed)return a;0===this.state.backtracking&&C.add(y);break;case 2:this.pushFollow(FormulaParser.FOLLOW_expression_in_anonFunctionDef1025);P=this.expression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&G.add(P.getTree())}if(0===this.state.backtracking){a.tree=h;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);h=this.adaptor.nil();var et=this.adaptor.nil();et=this.adaptor.becomeRoot(this.adaptor.create(21,"ANONFUNCTION"),et);var it=this.adaptor.nil();it=this.adaptor.becomeRoot(this.adaptor.create(t,"PARAMS"),it);for(;I.hasNext();)this.adaptor.addChild(it,I.nextNode());I.reset();this.adaptor.addChild(et,it);it=this.adaptor.nil();it=this.adaptor.becomeRoot(this.adaptor.create(10,"DEFAULTS"),it);for(;j.hasNext();)this.adaptor.addChild(it,j.nextTree());j.reset();this.adaptor.addChild(et,it);q.hasNext()&&this.adaptor.addChild(et,q.nextTree());q.reset();G.hasNext()&&this.adaptor.addChild(et,G.nextTree());G.reset();this.adaptor.addChild(h,et);a.tree=h}a.stop=this.input.LT(-1);if(0===this.state.backtracking){a.tree=this.adaptor.rulePostProcessing(h);this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop)}}catch(t){if(!(t instanceof org.antlr.runtime.RecognitionException))throw t;this.reportError(t);this.recover(this.input,t);a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),t)}return a},assignment_return:function(){FormulaParser.assignment_return=function(){};org.antlr.lang.extend(FormulaParser.assignment_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),assignment:function(){var e=new FormulaParser.assignment_return;e.start=this.input.LT(1);var i=null,n=null,r=null,a=null,u=null,h=null,c=null,d=null,p=null,_=null,v=null,S=null,N=null,T=null,b=null,E=null,F=null,k=null,L=null,w=null,x=null,y=null,A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),O=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),R=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 115"),P=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),C=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),M=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),I=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token PRIMITIVE"),B=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule assigned"),D=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue"),V=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{var U=2,W=this.input.LA(1);if(W==s){var G=this.input.LA(2);if(113==G)U=1;else{if(!(G==m||G==f||G==g||G>=115&&G<=116)){if(this.state.backtracking>0){this.state.failed=!0;return e}throw new org.antlr.runtime.NoViableAltException("",37,1,this.input)}U=2}}else{if(W!=l){if(this.state.backtracking>0){this.state.failed=!0;return e}throw new org.antlr.runtime.NoViableAltException("",37,0,this.input)}U=2}switch(U){case 1:n=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_assignment1067);if(this.state.failed)return e;0===this.state.backtracking&&O.add(n);r=this.match(this.input,113,FormulaParser.FOLLOW_113_in_assignment1069);if(this.state.failed)return e;0===this.state.backtracking&&C.add(r);var q=2;this.input.LA(1)==s&&(q=1);switch(q){case 1:a=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_assignment1072);if(this.state.failed)return e;0===this.state.backtracking&&O.add(a);var j=2,z=this.input.LA(1);if(z==o)j=1;else{if(z!=g&&114!=z){if(this.state.backtracking>0){this.state.failed=!0;return e}throw new org.antlr.runtime.NoViableAltException("",31,0,this.input)}j=2}switch(j){case 1:u=this.match(this.input,o,FormulaParser.FOLLOW_EQUALS_in_assignment1076);if(this.state.failed)return e;0===this.state.backtracking&&P.add(u);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_assignment1078);F=this.defaultValue();this.state._fsp--;if(this.state.failed)return e;0===this.state.backtracking&&D.add(F.getTree());break;case 2:t:for(;;){var H=2;if(this.input.LA(1)==g){if(this.input.LA(2)==s){var K=this.input.LA(3);K!=g&&114!=K||(H=1)}}switch(H){case 1:h=this.match(this.input,g,FormulaParser.FOLLOW_COMMA_in_assignment1083);if(this.state.failed)return e;0===this.state.backtracking&&M.add(h);c=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_assignment1085);if(this.state.failed)return e;0===this.state.backtracking&&O.add(c);break;default:break t}}}t:for(;;){var Q=2;this.input.LA(1)==g&&(Q=1);switch(Q){case 1:d=this.match(this.input,g,FormulaParser.FOLLOW_COMMA_in_assignment1092);if(this.state.failed)return e;0===this.state.backtracking&&M.add(d);p=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_assignment1094);if(this.state.failed)return e;0===this.state.backtracking&&O.add(p);_=this.match(this.input,o,FormulaParser.FOLLOW_EQUALS_in_assignment1096);if(this.state.failed)return e;0===this.state.backtracking&&P.add(_);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_assignment1098);k=this.defaultValue();this.state._fsp--;if(this.state.failed)return e;0===this.state.backtracking&&D.add(k.getTree());break;default:break t}}}v=this.match(this.input,114,FormulaParser.FOLLOW_114_in_assignment1105);if(this.state.failed)return e;0===this.state.backtracking&&A.add(v);S=this.match(this.input,115,FormulaParser.FOLLOW_115_in_assignment1107);if(this.state.failed)return e;0===this.state.backtracking&&R.add(S);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_assignment1109);L=this.logicalExpression();this.state._fsp--;if(this.state.failed)return e;0===this.state.backtracking&&V.add(L.getTree());if(0===this.state.backtracking){e.tree=i;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=e?e.tree:null);i=this.adaptor.nil();var Y=this.adaptor.nil();Y=this.adaptor.becomeRoot(this.adaptor.create(20,"FUNCTION"),Y);var X=this.adaptor.nil();X=this.adaptor.becomeRoot(this.adaptor.create(t,"PARAMS"),X);for(;O.hasNext();)this.adaptor.addChild(X,O.nextNode());O.reset();this.adaptor.addChild(Y,X);X=this.adaptor.nil();X=this.adaptor.becomeRoot(this.adaptor.create(10,"DEFAULTS"),X);for(;D.hasNext();)this.adaptor.addChild(X,D.nextTree());D.reset();this.adaptor.addChild(Y,X);this.adaptor.addChild(Y,V.nextTree());this.adaptor.addChild(i,Y);e.tree=i}break;case 2:var Z=2,J=this.input.LA(1);if(J==l)Z=1;else{if(J!=s){if(this.state.backtracking>0){this.state.failed=!0;return e}throw new org.antlr.runtime.NoViableAltException("",34,0,this.input)}Z=2}switch(Z){case 1:N=this.match(this.input,l,FormulaParser.FOLLOW_PRIMITIVE_in_assignment1137);if(this.state.failed)return e;0===this.state.backtracking&&I.add(N);break;case 2:this.pushFollow(FormulaParser.FOLLOW_assigned_in_assignment1141);w=this.assigned();this.state._fsp--;if(this.state.failed)return e;0===this.state.backtracking&&B.add(w.getTree())}t:for(;;){var $=2;this.input.LA(1)==g&&($=1);switch($){case 1:T=this.match(this.input,g,FormulaParser.FOLLOW_COMMA_in_assignment1145);if(this.state.failed)return e;0===this.state.backtracking&&M.add(T);var tt=2,et=this.input.LA(1);if(et==l)tt=1;else{if(et!=s){if(this.state.backtracking>0){this.state.failed=!0;return e}throw new org.antlr.runtime.NoViableAltException("",35,0,this.input)}tt=2}switch(tt){case 1:b=this.match(this.input,l,FormulaParser.FOLLOW_PRIMITIVE_in_assignment1148);if(this.state.failed)return e;0===this.state.backtracking&&I.add(b);break;case 2:this.pushFollow(FormulaParser.FOLLOW_assigned_in_assignment1152);x=this.assigned();this.state._fsp--;if(this.state.failed)return e;0===this.state.backtracking&&B.add(x.getTree())}break;default:break t}}E=this.match(this.input,115,FormulaParser.FOLLOW_115_in_assignment1158);if(this.state.failed)return e;0===this.state.backtracking&&R.add(E);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_assignment1160);y=this.logicalExpression();this.state._fsp--;if(this.state.failed)return e;0===this.state.backtracking&&V.add(y.getTree());if(0===this.state.backtracking){e.tree=i;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=e?e.tree:null);i=this.adaptor.nil();Y=this.adaptor.nil();Y=this.adaptor.becomeRoot(this.adaptor.create(5,"ASSIGN"),Y);for(;I.hasNext();)this.adaptor.addChild(Y,I.nextNode());I.reset();for(;B.hasNext();)this.adaptor.addChild(Y,B.nextTree());B.reset();this.adaptor.addChild(Y,V.nextTree());this.adaptor.addChild(i,Y);e.tree=i}}e.stop=this.input.LT(-1);if(0===this.state.backtracking){e.tree=this.adaptor.rulePostProcessing(i);this.adaptor.setTokenBoundaries(e.tree,e.start,e.stop)}}catch(t){if(!(t instanceof org.antlr.runtime.RecognitionException))throw t;this.reportError(t);this.recover(this.input,t);e.tree=this.adaptor.errorNode(this.input,e.start,this.input.LT(-1),t)}return e},assigned_return:function(){FormulaParser.assigned_return=function(){};org.antlr.lang.extend(FormulaParser.assigned_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),assigned:function(){var t=new FormulaParser.assigned_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),a=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule selector");try{i=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_assigned1186);if(this.state.failed)return t;0===this.state.backtracking&&r.add(i);var o=2,l=this.input.LA(1);l!=m&&l!=f&&116!=l||(o=1);switch(o){case 1:this.pushFollow(FormulaParser.FOLLOW_selector_in_assigned1188);n=this.selector();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&a.add(n.getTree())}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var u=this.adaptor.nil();u=this.adaptor.becomeRoot(this.adaptor.create(26,"ASSIGNED"),u);this.adaptor.addChild(u,r.nextNode());a.hasNext()&&this.adaptor.addChild(u,a.nextTree());a.reset();this.adaptor.addChild(e,u);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},logicalExpression_return:function(){FormulaParser.logicalExpression_return=function(){};org.antlr.lang.extend(FormulaParser.logicalExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),logicalExpression:function(){var t=new FormulaParser.logicalExpression_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null,a=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_logicalExpression1214);n=this.booleanXORExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());t:for(;;){var s=2;if(72==this.input.LA(1)){this.input.LA(2);this.synpred47_Formula()&&(s=1)}switch(s){case 1:i=this.match(this.input,72,FormulaParser.FOLLOW_OR_in_logicalExpression1217);if(this.state.failed)return t;if(0===this.state.backtracking){a=this.adaptor.create(i);e=this.adaptor.becomeRoot(a,e)}this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_logicalExpression1220);r=this.booleanXORExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},booleanXORExpression_return:function(){FormulaParser.booleanXORExpression_return=function(){};org.antlr.lang.extend(FormulaParser.booleanXORExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),booleanXORExpression:function(){var t=new FormulaParser.booleanXORExpression_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null,a=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_booleanXORExpression1250);n=this.booleanAndExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());t:for(;;){var s=2;if(73==this.input.LA(1)){this.input.LA(2);this.synpred48_Formula()&&(s=1)}switch(s){case 1:i=this.match(this.input,73,FormulaParser.FOLLOW_XOR_in_booleanXORExpression1253);if(this.state.failed)return t;if(0===this.state.backtracking){a=this.adaptor.create(i);e=this.adaptor.becomeRoot(a,e)}this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_booleanXORExpression1256);r=this.booleanAndExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},booleanAndExpression_return:function(){FormulaParser.booleanAndExpression_return=function(){};org.antlr.lang.extend(FormulaParser.booleanAndExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),booleanAndExpression:function(){var t=new FormulaParser.booleanAndExpression_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null,a=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_booleanAndExpression1285);n=this.equalityExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());t:for(;;){var s=2;if(75==this.input.LA(1)){this.input.LA(2);this.synpred49_Formula()&&(s=1)}switch(s){case 1:i=this.match(this.input,75,FormulaParser.FOLLOW_AND_in_booleanAndExpression1288);if(this.state.failed)return t;if(0===this.state.backtracking){a=this.adaptor.create(i);e=this.adaptor.becomeRoot(a,e)}this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_booleanAndExpression1291);r=this.equalityExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},equalityExpression_return:function(){FormulaParser.equalityExpression_return=function(){};org.antlr.lang.extend(FormulaParser.equalityExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),equalityExpression:function(){var t=new FormulaParser.equalityExpression_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_equalityExpression1322);n=this.relationalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());t:for(;;){var a=2,s=this.input.LA(1);if(s==o||76==s){this.input.LA(2);this.synpred51_Formula()&&(a=1)}switch(a){case 1:i=this.input.LT(1);if(this.input.LA(1)!=o&&76!=this.input.LA(1)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&(e=this.adaptor.becomeRoot(this.adaptor.create(i),e));this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_equalityExpression1332);r=this.relationalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},relationalExpression_return:function(){FormulaParser.relationalExpression_return=function(){};org.antlr.lang.extend(FormulaParser.relationalExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),relationalExpression:function(){var t=new FormulaParser.relationalExpression_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_relationalExpression1374);n=this.additiveExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());t:for(;;){var a=2,s=this.input.LA(1);if(s>=77&&s<=80){this.input.LA(2);this.synpred55_Formula()&&(a=1)}switch(a){case 1:i=this.input.LT(1);if(!(this.input.LA(1)>=77&&this.input.LA(1)<=80)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&(e=this.adaptor.becomeRoot(this.adaptor.create(i),e));this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_relationalExpression1389);r=this.additiveExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},additiveExpression_return:function(){FormulaParser.additiveExpression_return=function(){};org.antlr.lang.extend(FormulaParser.additiveExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),additiveExpression:function(){var t=new FormulaParser.additiveExpression_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_additiveExpression1432);n=this.multiplicativeExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());t:for(;;){var a=2,s=this.input.LA(1);if(s>=81&&s<=u){this.input.LA(2);this.synpred57_Formula()&&(a=1)}switch(a){case 1:i=this.input.LT(1);if(!(this.input.LA(1)>=81&&this.input.LA(1)<=u)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&(e=this.adaptor.becomeRoot(this.adaptor.create(i),e));this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_additiveExpression1443);r=this.multiplicativeExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},multiplicativeExpression_return:function(){FormulaParser.multiplicativeExpression_return=function(){};org.antlr.lang.extend(FormulaParser.multiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),multiplicativeExpression:function(){var t=new FormulaParser.multiplicativeExpression_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_multiplicativeExpression1473);n=this.arrayExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());t:for(;;){var a=2,s=this.input.LA(1);if(s>=h&&s<=85){this.input.LA(2);this.synpred60_Formula()&&(a=1)}switch(a){case 1:i=this.input.LT(1);if(!(this.input.LA(1)>=h&&this.input.LA(1)<=85)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&(e=this.adaptor.becomeRoot(this.adaptor.create(i),e));this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_multiplicativeExpression1486);r=this.arrayExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},arrayExpression_return:function(){FormulaParser.arrayExpression_return=function(){};org.antlr.lang.extend(FormulaParser.arrayExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),arrayExpression:function(){var t=new FormulaParser.arrayExpression_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null,a=null,s=null,o=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COLON"),l=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule negationExpression");try{this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1532);r=this.negationExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&l.add(r.getTree());var u=2;if(this.input.LA(1)==c){this.input.LA(2);this.synpred61_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(u=1)}switch(u){case 1:if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "')}i=this.match(this.input,c,FormulaParser.FOLLOW_COLON_in_arrayExpression1538);if(this.state.failed)return t;0===this.state.backtracking&&o.add(i);if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "')}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1542);a=this.negationExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&l.add(a.getTree())}var h=2;if(this.input.LA(1)==c){this.input.LA(2);this.synpred62_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(h=1)}switch(h){case 1:if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "')}n=this.match(this.input,c,FormulaParser.FOLLOW_COLON_in_arrayExpression1551);if(this.state.failed)return t;0===this.state.backtracking&&o.add(n);if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "')}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1555);s=this.negationExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&l.add(s.getTree())}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var d=this.adaptor.nil();d=this.adaptor.becomeRoot(this.adaptor.create(24,"RANGE"),d);for(;l.hasNext();)this.adaptor.addChild(d,l.nextTree());l.reset();this.adaptor.addChild(e,d);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},negationExpression_return:function(){FormulaParser.negationExpression_return=function(){};org.antlr.lang.extend(FormulaParser.negationExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),negationExpression:function(){var t=new FormulaParser.negationExpression_return;t.start=this.input.LT(1);var e=null,i=null,r=null,o=null,h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),c=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule powerExpression");try{var g=2,v=this.input.LA(1);if(v==u)g=1;else{if(!(v==n||v==a||v==s||v==l||v>=d&&v<=m||v==f||v>=p&&v<=_||113==v)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",48,0,this.input)}g=2}switch(g){case 1:i=this.match(this.input,u,FormulaParser.FOLLOW_MINUS_in_negationExpression1580);if(this.state.failed)return t;0===this.state.backtracking&&h.add(i);this.pushFollow(FormulaParser.FOLLOW_powerExpression_in_negationExpression1582);r=this.powerExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&c.add(r.getTree());if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var S=this.adaptor.nil();S=this.adaptor.becomeRoot(this.adaptor.create(4,"NEGATE"),S);this.adaptor.addChild(S,c.nextTree());this.adaptor.addChild(e,S);t.tree=e}break;case 2:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_powerExpression_in_negationExpression1596);o=this.powerExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,o.getTree())}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},powerExpression_return:function(){FormulaParser.powerExpression_return=function(){};org.antlr.lang.extend(FormulaParser.powerExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),powerExpression:function(){var t=new FormulaParser.powerExpression_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null,a=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token POW"),s=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryOrNegate"),o=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryExpression");try{this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_powerExpression1607);n=this.unaryExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&o.add(n.getTree());t:for(;;){var l=2;if(87==this.input.LA(1)){this.input.LA(2);this.synpred64_Formula()&&(l=1)}switch(l){case 1:i=this.match(this.input,87,FormulaParser.FOLLOW_POW_in_powerExpression1610);if(this.state.failed)return t;0===this.state.backtracking&&a.add(i);this.pushFollow(FormulaParser.FOLLOW_unaryOrNegate_in_powerExpression1612);r=this.unaryOrNegate();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&s.add(r.getTree());break;default:break t}}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var u=this.adaptor.nil();u=this.adaptor.becomeRoot(this.adaptor.create(9,"POWER"),u);this.adaptor.addChild(u,o.nextTree());for(;s.hasNext();)this.adaptor.addChild(u,s.nextTree());s.reset();this.adaptor.addChild(e,u);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},unaryOrNegate_return:function(){FormulaParser.unaryOrNegate_return=function(){};org.antlr.lang.extend(FormulaParser.unaryOrNegate_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unaryOrNegate:function(){var t=new FormulaParser.unaryOrNegate_return;t.start=this.input.LT(1);var e=null,i=null,r=null,o=null,h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),c=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryExpression");try{var g=2,v=this.input.LA(1);if(v==n||v==a||v==s||v==l||v>=d&&v<=m||v==f||v>=p&&v<=_||113==v)g=1;else{if(v!=u){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",50,0,this.input)}g=2}switch(g){case 1:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_unaryOrNegate1639);r=this.unaryExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;case 2:i=this.match(this.input,u,FormulaParser.FOLLOW_MINUS_in_unaryOrNegate1645);if(this.state.failed)return t;0===this.state.backtracking&&h.add(i);this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_unaryOrNegate1647);o=this.unaryExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&c.add(o.getTree());if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var S=this.adaptor.nil();S=this.adaptor.becomeRoot(this.adaptor.create(4,"NEGATE"),S);this.adaptor.addChild(S,c.nextTree());this.adaptor.addChild(e,S);t.tree=e}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},unaryExpression_return:function(){FormulaParser.unaryExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unaryExpression:function(){var t=new FormulaParser.unaryExpression_return;t.start=this.input.LT(1);var e=null,i=null,r=null,o=null,u=null;try{var h=2,c=this.input.LA(1);if(c==d)h=1;else{if(!(c==n||c==a||c==s||c==l||c==m||c==f||c>=p&&c<=_||113==c)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",51,0,this.input)}h=2}switch(h){case 1:e=this.adaptor.nil();i=this.match(this.input,d,FormulaParser.FOLLOW_NOT_in_unaryExpression1675);if(this.state.failed)return t;if(0===this.state.backtracking){u=this.adaptor.create(i);e=this.adaptor.becomeRoot(u,e)}this.pushFollow(FormulaParser.FOLLOW_innerPrimaryExpression_in_unaryExpression1678);r=this.innerPrimaryExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;case 2:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_innerPrimaryExpression_in_unaryExpression1687);o=this.innerPrimaryExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,o.getTree())}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},innerPrimaryExpression_return:function(){FormulaParser.innerPrimaryExpression_return=function(){};org.antlr.lang.extend(FormulaParser.innerPrimaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),innerPrimaryExpression:function(){var t=new FormulaParser.innerPrimaryExpression_return;t.start=this.input.LT(1);var e=null,i=null,n=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule selectionExpression");try{this.pushFollow(FormulaParser.FOLLOW_selectionExpression_in_innerPrimaryExpression1718);i=this.selectionExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&n.add(i.getTree());if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var r=this.adaptor.nil();r=this.adaptor.becomeRoot(this.adaptor.create(25,"INNER"),r);this.adaptor.addChild(r,n.nextTree());this.adaptor.addChild(e,r);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},selectionExpression_return:function(){FormulaParser.selectionExpression_return=function(){};org.antlr.lang.extend(FormulaParser.selectionExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),selectionExpression:function(){var t=new FormulaParser.selectionExpression_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_primaryExpression_in_selectionExpression1738);i=this.primaryExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());t:for(;;){var a=2;switch(this.input.LA(1)){case m:this.input.LA(2);this.synpred68_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(a=1);break;case f:this.input.LA(2);this.synpred68_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(a=1);break;case 116:this.input.LA(2);this.synpred68_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(a=1);break;case 113:this.input.LA(2);this.synpred68_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(a=1)}switch(a){case 1:if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.FailedPredicateException(this.input,"selectionExpression",' this.input.get(this.input.index()-1).getText()!=" "')}var s=2,o=this.input.LA(1);if(o==m||o==f||116==o)s=1;else{if(113!=o){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",52,0,this.input)}s=2}switch(s){case 1:this.pushFollow(FormulaParser.FOLLOW_selector_in_selectionExpression1744);n=this.selector();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());break;case 2:this.pushFollow(FormulaParser.FOLLOW_funCall_in_selectionExpression1746);r=this.funCall();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree())}break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},funCall_return:function(){FormulaParser.funCall_return=function(){};org.antlr.lang.extend(FormulaParser.funCall_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),funCall:function(){var t=new FormulaParser.funCall_return;t.start=this.input.LT(1);var e=null,i=null,r=null,o=null,h=null,c=null,v=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),S=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),N=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),T=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{i=this.match(this.input,113,FormulaParser.FOLLOW_113_in_funCall1761);if(this.state.failed)return t;0===this.state.backtracking&&S.add(i);var b=2,E=this.input.LA(1);(E==n||E==a||E==s||E==l||E==u||E>=d&&E<=m||E==f||E>=p&&E<=_||113==E)&&(b=1);switch(b){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_funCall1765);h=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&T.add(h.getTree());t:for(;;){var F=2;this.input.LA(1)==g&&(F=1);switch(F){case 1:r=this.match(this.input,g,FormulaParser.FOLLOW_COMMA_in_funCall1768);if(this.state.failed)return t;0===this.state.backtracking&&N.add(r);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_funCall1770);c=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&T.add(c.getTree());break;default:break t}}}o=this.match(this.input,114,FormulaParser.FOLLOW_114_in_funCall1777);if(this.state.failed)return t;0===this.state.backtracking&&v.add(o);if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var k=this.adaptor.nil();k=this.adaptor.becomeRoot(this.adaptor.create(6,"FUNCALL"),k);for(;T.hasNext();)this.adaptor.addChild(k,T.nextTree());T.reset();this.adaptor.addChild(e,k);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},primaryExpression_return:function(){FormulaParser.primaryExpression_return=function(){};org.antlr.lang.extend(FormulaParser.primaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),primaryExpression:function(){var t=new FormulaParser.primaryExpression_return;t.start=this.input.LT(1);var e=null,i=null,r=null;try{var o=2,u=this.input.LA(1);if(113==u)o=1;else{if(!(u==n||u==a||u==s||u==l||u==m||u==f||u>=p&&u<=_)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",56,0,this.input)}o=2}switch(o){case 1:e=this.adaptor.nil();this.match(this.input,113,FormulaParser.FOLLOW_113_in_primaryExpression1798);if(this.state.failed)return t;this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_primaryExpression1801);i=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());this.match(this.input,114,FormulaParser.FOLLOW_114_in_primaryExpression1803);if(this.state.failed)return t;break;case 2:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_value_in_primaryExpression1809);r=this.value();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree())}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},value_return:function(){FormulaParser.value_return=function(){};org.antlr.lang.extend(FormulaParser.value_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),value:function(){var t=new FormulaParser.value_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null,a=null,o=null,l=null,u=null,h=null,c=null,d=null;try{switch(this.dfa57.predict(this.input)){case 1:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_number_in_value1823);n=this.number();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());break;case 2:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_bool_in_value1829);r=this.bool();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;case 3:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_string_in_value1835);a=this.string();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,a.getTree());break;case 4:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_material_in_value1841);o=this.material();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,o.getTree());break;case 5:e=this.adaptor.nil();i=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_value1846);if(this.state.failed)return t;if(0===this.state.backtracking){d=this.adaptor.create(i);this.adaptor.addChild(e,d)}break;case 6:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_primitive_in_value1851);l=this.primitive();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,l.getTree());break;case 7:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_array_in_value1856);u=this.array();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,u.getTree());break;case 8:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_anonFunctionDef_in_value1861);h=this.anonFunctionDef();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,h.getTree());break;case 9:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_newObject_in_value1866);c=this.newObject();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,c.getTree())}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},newObject_return:function(){FormulaParser.newObject_return=function(){};org.antlr.lang.extend(FormulaParser.newObject_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),newObject:function(){var t=new FormulaParser.newObject_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null,o=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWSTATEMENT"),u=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule funCall");try{i=this.match(this.input,a,FormulaParser.FOLLOW_NEWSTATEMENT_in_newObject1876);if(this.state.failed)return t;0===this.state.backtracking&&l.add(i);n=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_newObject1878);if(this.state.failed)return t;0===this.state.backtracking&&o.add(n);switch(this.dfa58.predict(this.input)){case 1:this.pushFollow(FormulaParser.FOLLOW_funCall_in_newObject1880);r=this.funCall();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&u.add(r.getTree())}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var h=this.adaptor.nil();h=this.adaptor.becomeRoot(this.adaptor.create(29,"NEW"),h);this.adaptor.addChild(h,o.nextNode());u.hasNext()&&this.adaptor.addChild(h,u.nextTree());u.reset();this.adaptor.addChild(e,h);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},defaultValue_return:function(){FormulaParser.defaultValue_return=function(){};org.antlr.lang.extend(FormulaParser.defaultValue_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),defaultValue:function(){var t=new FormulaParser.defaultValue_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null,a=null,s=null;try{var o=5;switch(this.input.LA(1)){case u:o=1;break;case 95:case 96:o=2;break;case 97:case _:o=3;break;case p:o=4;break;case m:case f:o=5;break;default:if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",59,0,this.input)}switch(o){case 1:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_negnumber_in_defaultValue1906);i=this.negnumber();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());break;case 2:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_number_in_defaultValue1912);n=this.number();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());break;case 3:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_bool_in_defaultValue1918);r=this.bool();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;case 4:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_string_in_defaultValue1924);a=this.string();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,a.getTree());break;case 5:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_array_in_defaultValue1930);s=this.array();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,s.getTree())}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},array_return:function(){FormulaParser.array_return=function(){};org.antlr.lang.extend(FormulaParser.array_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),array:function(){var t=new FormulaParser.array_return;t.start=this.input.LT(1);var i=null,n=null,r=null,a=null,s=null,o=null,l=null,u=null,h=null,c=null,d=null,p=null,_=null,v=null,S=null,N=null,T=null,b=null,E=null,F=null,k=null,L=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LCURL"),w=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),x=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RARR"),y=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LARR"),O=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RCURL"),R=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule label");try{var P=2,C=this.input.LA(1);if(C==m)P=1;else{if(C!=f){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",74,0,this.input)}P=2}switch(P){case 1:n=this.match(this.input,m,FormulaParser.FOLLOW_LARR_in_array1944);if(this.state.failed)return t;0===this.state.backtracking&&A.add(n);t:for(;;){var M=2;if(this.input.LA(1)==e){this.input.LA(2);this.synpred85_Formula()&&(M=1)}switch(M){case 1:r=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array1946);if(this.state.failed)return t;0===this.state.backtracking&&w.add(r);break;default:break t}}switch(this.dfa65.predict(this.input)){case 1:this.pushFollow(FormulaParser.FOLLOW_label_in_array1950);b=this.label();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&R.add(b.getTree());t:for(;;){var I=2;if(this.input.LA(1)==e){this.input.LA(2);this.synpred86_Formula()&&(I=1)}switch(I){case 1:a=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array1952);if(this.state.failed)return t;0===this.state.backtracking&&w.add(a);break;default:break t}}t:for(;;){var B=2;this.input.LA(1)==g&&(B=1);switch(B){case 1:s=this.match(this.input,g,FormulaParser.FOLLOW_COMMA_in_array1956);if(this.state.failed)return t;0===this.state.backtracking&&y.add(s);e:for(;;){var D=2;if(this.input.LA(1)==e){this.input.LA(2);this.synpred87_Formula()&&(D=1)}switch(D){case 1:o=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array1958);if(this.state.failed)return t;0===this.state.backtracking&&w.add(o);break;default:break e}}this.pushFollow(FormulaParser.FOLLOW_label_in_array1961);E=this.label();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&R.add(E.getTree());e:for(;;){var V=2;if(this.input.LA(1)==e){this.input.LA(2);this.synpred88_Formula()&&(V=1)}switch(V){case 1:l=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array1963);if(this.state.failed)return t;0===this.state.backtracking&&w.add(l);break;default:break e}}break;default:break t}}}t:for(;;){var U=2;this.input.LA(1)==e&&(U=1);switch(U){case 1:u=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array1970);if(this.state.failed)return t;0===this.state.backtracking&&w.add(u);break;default:break t}}h=this.match(this.input,90,FormulaParser.FOLLOW_RARR_in_array1973);if(this.state.failed)return t;0===this.state.backtracking&&x.add(h);if(0===this.state.backtracking){t.tree=i;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);i=this.adaptor.nil();var W=this.adaptor.nil();W=this.adaptor.becomeRoot(this.adaptor.create(13,"ARRAY"),W);for(;R.hasNext();)this.adaptor.addChild(W,R.nextTree());R.reset();this.adaptor.addChild(i,W);t.tree=i}break;case 2:c=this.match(this.input,f,FormulaParser.FOLLOW_LCURL_in_array1987);if(this.state.failed)return t;0===this.state.backtracking&&L.add(c);t:for(;;){var G=2;if(this.input.LA(1)==e){this.input.LA(2);this.synpred93_Formula()&&(G=1)}switch(G){case 1:d=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array1989);if(this.state.failed)return t;0===this.state.backtracking&&w.add(d);break;default:break t}}switch(this.dfa72.predict(this.input)){case 1:this.pushFollow(FormulaParser.FOLLOW_label_in_array1993);F=this.label();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&R.add(F.getTree());t:for(;;){var q=2;if(this.input.LA(1)==e){this.input.LA(2);this.synpred94_Formula()&&(q=1)}switch(q){case 1:p=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array1995);if(this.state.failed)return t;0===this.state.backtracking&&w.add(p);break;default:break t}}t:for(;;){var j=2;this.input.LA(1)==g&&(j=1);switch(j){case 1:_=this.match(this.input,g,FormulaParser.FOLLOW_COMMA_in_array1998);if(this.state.failed)return t;0===this.state.backtracking&&y.add(_);e:for(;;){var z=2;if(this.input.LA(1)==e){this.input.LA(2);this.synpred95_Formula()&&(z=1)}switch(z){case 1:v=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array2000);if(this.state.failed)return t;0===this.state.backtracking&&w.add(v);break;default:break e}}this.pushFollow(FormulaParser.FOLLOW_label_in_array2003);k=this.label();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&R.add(k.getTree());e:for(;;){var H=2;if(this.input.LA(1)==e){this.input.LA(2);this.synpred96_Formula()&&(H=1)}switch(H){case 1:S=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array2005);if(this.state.failed)return t;0===this.state.backtracking&&w.add(S);break;default:break e}}break;default:break t}}}t:for(;;){var K=2;this.input.LA(1)==e&&(K=1);switch(K){case 1:N=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array2012);if(this.state.failed)return t;0===this.state.backtracking&&w.add(N);break;default:break t}}T=this.match(this.input,92,FormulaParser.FOLLOW_RCURL_in_array2015);if(this.state.failed)return t;0===this.state.backtracking&&O.add(T);if(0===this.state.backtracking){t.tree=i;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);i=this.adaptor.nil();W=this.adaptor.nil();W=this.adaptor.becomeRoot(this.adaptor.create(13,"ARRAY"),W);for(;R.hasNext();)this.adaptor.addChild(W,R.nextTree());R.reset();this.adaptor.addChild(i,W);t.tree=i}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(i);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},selector_return:function(){FormulaParser.selector_return=function(){};org.antlr.lang.extend(FormulaParser.selector_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),selector:function(){var t=new FormulaParser.selector_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule dotselector"),a=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule minarray");try{var s=2,o=this.input.LA(1);if(o==m||o==f)s=1;else{if(116!=o){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",75,0,this.input)}s=2}switch(s){case 1:this.pushFollow(FormulaParser.FOLLOW_minarray_in_selector2036);i=this.minarray();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&a.add(i.getTree());break;case 2:this.pushFollow(FormulaParser.FOLLOW_dotselector_in_selector2040);n=this.dotselector();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&r.add(n.getTree())}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var l=this.adaptor.nil();l=this.adaptor.becomeRoot(this.adaptor.create(27,"SELECTOR"),l);a.hasNext()&&this.adaptor.addChild(l,a.nextTree());a.reset();r.hasNext()&&this.adaptor.addChild(l,r.nextTree());r.reset();this.adaptor.addChild(e,l);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},minarray_return:function(){FormulaParser.minarray_return=function(){};org.antlr.lang.extend(FormulaParser.minarray_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),minarray:function(){var t=new FormulaParser.minarray_return;t.start=this.input.LT(1);var e=null,i=null,r=null,o=null,c=null,v=null,S=null,N=null,T=null,b=null,E=null,F=null,k=null;try{var L=2,w=this.input.LA(1);if(w==m)L=1;else{if(w!=f){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",82,0,this.input)}L=2}switch(L){case 1:e=this.adaptor.nil();this.match(this.input,m,FormulaParser.FOLLOW_LARR_in_minarray2067);if(this.state.failed)return t;var x=2,y=this.input.LA(1);if(y==n||y==a||y==s||y==l||y==u||y>=d&&y<=m||y==f||y>=p&&y<=_||113==y)x=1;else{if(y!=h){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",76,0,this.input)}x=2}switch(x){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2072);v=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,v.getTree());break;case 2:i=this.match(this.input,h,FormulaParser.FOLLOW_MULT_in_minarray2074);if(this.state.failed)return t;if(0===this.state.backtracking){b=this.adaptor.create(i);this.adaptor.addChild(e,b)}}t:for(;;){var A=2;this.input.LA(1)==g&&(A=1);switch(A){case 1:this.match(this.input,g,FormulaParser.FOLLOW_COMMA_in_minarray2078);if(this.state.failed)return t;var O=2,R=this.input.LA(1);if(R==n||R==a||R==s||R==l||R==u||R>=d&&R<=m||R==f||R>=p&&R<=_||113==R)O=1;else{if(R!=h){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",77,0,this.input)}O=2}switch(O){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2082);S=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,S.getTree());break;case 2:r=this.match(this.input,h,FormulaParser.FOLLOW_MULT_in_minarray2084);if(this.state.failed)return t;if(0===this.state.backtracking){E=this.adaptor.create(r);this.adaptor.addChild(e,E)}}break;default:break t}}this.match(this.input,90,FormulaParser.FOLLOW_RARR_in_minarray2091);if(this.state.failed)return t;break;case 2:e=this.adaptor.nil();this.match(this.input,f,FormulaParser.FOLLOW_LCURL_in_minarray2097);if(this.state.failed)return t;var P=2,C=this.input.LA(1);if(C==n||C==a||C==s||C==l||C==u||C>=d&&C<=m||C==f||C>=p&&C<=_||113==C)P=1;else{if(C!=h){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",79,0,this.input)}P=2}switch(P){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2102);N=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,N.getTree());break;case 2:o=this.match(this.input,h,FormulaParser.FOLLOW_MULT_in_minarray2104);if(this.state.failed)return t;if(0===this.state.backtracking){F=this.adaptor.create(o);this.adaptor.addChild(e,F)}}t:for(;;){var M=2;this.input.LA(1)==g&&(M=1);switch(M){case 1:this.match(this.input,g,FormulaParser.FOLLOW_COMMA_in_minarray2108);if(this.state.failed)return t;var I=2,B=this.input.LA(1);if(B==n||B==a||B==s||B==l||B==u||B>=d&&B<=m||B==f||B>=p&&B<=_||113==B)I=1;else{if(B!=h){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",80,0,this.input)}I=2}switch(I){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2112);T=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,T.getTree());break;case 2:c=this.match(this.input,h,FormulaParser.FOLLOW_MULT_in_minarray2114);if(this.state.failed)return t;if(0===this.state.backtracking){k=this.adaptor.create(c);this.adaptor.addChild(e,k)}}break;default:break t}}this.match(this.input,92,FormulaParser.FOLLOW_RCURL_in_minarray2121);if(this.state.failed)return t}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},dotselector_return:function(){FormulaParser.dotselector_return=function(){};org.antlr.lang.extend(FormulaParser.dotselector_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),dotselector:function(){var t=new FormulaParser.dotselector_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 116"),a=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule arrayName");try{var s=0;t:for(;;){var o=2;if(116==this.input.LA(1)){this.input.LA(2);this.synpred108_Formula()&&(o=1)}switch(o){case 1:i=this.match(this.input,116,FormulaParser.FOLLOW_116_in_dotselector2133);if(this.state.failed)return t;0===this.state.backtracking&&r.add(i);this.pushFollow(FormulaParser.FOLLOW_arrayName_in_dotselector2135);n=this.arrayName();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&a.add(n.getTree());break;default:if(s>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.EarlyExitException(83,this.input)}s++}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var l=this.adaptor.nil();l=this.adaptor.becomeRoot(this.adaptor.create(28,"DOTSELECTOR"),l);if(!a.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;a.hasNext();)this.adaptor.addChild(l,a.nextTree());a.reset();this.adaptor.addChild(e,l);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},arrayName_return:function(){FormulaParser.arrayName_return=function(){};org.antlr.lang.extend(FormulaParser.arrayName_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),arrayName:function(){var t=new FormulaParser.arrayName_return;t.start=this.input.LT(1);var e=null,i=null;try{e=this.adaptor.nil();i=this.input.LT(1);if(this.input.LA(1)!=s&&this.input.LA(1)!=h&&this.input.LA(1)!=p){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&this.adaptor.addChild(e,this.adaptor.create(i));this.state.errorRecovery=!1;this.state.failed=!1;t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},label_return:function(){FormulaParser.label_return=function(){};org.antlr.lang.extend(FormulaParser.label_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),label:function(){var t=new FormulaParser.label_return;t.start=this.input.LT(1);var i=null,n=null,r=null,a=null,s=null,o=null,l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COLON"),u=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),h=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule arrayName"),d=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{switch(this.dfa85.predict(this.input)){case 1:this.pushFollow(FormulaParser.FOLLOW_arrayName_in_label2173);s=this.arrayName();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&h.add(s.getTree());t:for(;;){var m=2;this.input.LA(1)==e&&(m=1);switch(m){case 1:n=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_label2175);if(this.state.failed)return t;0===this.state.backtracking&&u.add(n);break;default:break t}}r=this.match(this.input,c,FormulaParser.FOLLOW_COLON_in_label2178);if(this.state.failed)return t;0===this.state.backtracking&&l.add(r)}t:for(;;){var f=2;this.input.LA(1)==e&&(f=1);switch(f){case 1:a=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_label2182);if(this.state.failed)return t;0===this.state.backtracking&&u.add(a);break;default:break t}}this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_label2185);o=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&d.add(o.getTree());if(0===this.state.backtracking){t.tree=i;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);i=this.adaptor.nil();var g=this.adaptor.nil();g=this.adaptor.becomeRoot(this.adaptor.create(23,"LABEL"),g);this.adaptor.addChild(g,d.nextTree());h.hasNext()&&this.adaptor.addChild(g,h.nextTree());h.reset();this.adaptor.addChild(i,g);t.tree=i}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(i);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},number_return:function(){FormulaParser.number_return=function(){};org.antlr.lang.extend(FormulaParser.number_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),number:function(){var t=new FormulaParser.number_return;t.start=this.input.LT(1);var e=null,i=null;try{e=this.adaptor.nil();i=this.input.LT(1);if(!(this.input.LA(1)>=95&&this.input.LA(1)<=96)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&this.adaptor.addChild(e,this.adaptor.create(i));this.state.errorRecovery=!1;this.state.failed=!1;t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},negnumber_return:function(){FormulaParser.negnumber_return=function(){};org.antlr.lang.extend(FormulaParser.negnumber_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),negnumber:function(){var t=new FormulaParser.negnumber_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),a=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule number");try{i=this.match(this.input,u,FormulaParser.FOLLOW_MINUS_in_negnumber2261);if(this.state.failed)return t;0===this.state.backtracking&&r.add(i);this.pushFollow(FormulaParser.FOLLOW_number_in_negnumber2263);n=this.number();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&a.add(n.getTree());if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var s=this.adaptor.nil();s=this.adaptor.becomeRoot(this.adaptor.create(4,"NEGATE"),s);this.adaptor.addChild(s,a.nextTree());this.adaptor.addChild(e,s);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},bool_return:function(){FormulaParser.bool_return=function(){};org.antlr.lang.extend(FormulaParser.bool_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),bool:function(){var t=new FormulaParser.bool_return;t.start=this.input.LT(1);var e=null,i=null;try{e=this.adaptor.nil();i=this.input.LT(1);if(!(this.input.LA(1)>=97&&this.input.LA(1)<=_)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&this.adaptor.addChild(e,this.adaptor.create(i));this.state.errorRecovery=!1;this.state.failed=!1;t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},material_return:function(){FormulaParser.material_return=function(){};org.antlr.lang.extend(FormulaParser.material_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),material:function(){var t=new FormulaParser.material_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null,a=null,s=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LCURL"),o=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RCURL"),l=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitMultiplicativeExpression"),u=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule additiveExpression");try{i=this.match(this.input,f,FormulaParser.FOLLOW_LCURL_in_material2415);if(this.state.failed)return t;0===this.state.backtracking&&s.add(i);this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_material2417);r=this.additiveExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&u.add(r.getTree());if(" "!=this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.FailedPredicateException(this.input,"material",' this.input.get(this.input.index()-1).getText()==" "')}this.pushFollow(FormulaParser.FOLLOW_unitMultiplicativeExpression_in_material2421);a=this.unitMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&l.add(a.getTree());n=this.match(this.input,92,FormulaParser.FOLLOW_RCURL_in_material2423);if(this.state.failed)return t;0===this.state.backtracking&&o.add(n);if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var h=this.adaptor.nil();h=this.adaptor.becomeRoot(this.adaptor.create(7,"MATERIAL"),h);this.adaptor.addChild(h,l.nextTree());this.adaptor.addChild(h,u.nextTree());this.adaptor.addChild(e,h);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},unitMultiplicativeExpression_return:function(){FormulaParser.unitMultiplicativeExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unitMultiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitMultiplicativeExpression:function(){var t=new FormulaParser.unitMultiplicativeExpression_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null,a=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2460);n=this.unitInnerMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());t:for(;;){var s=2;99==this.input.LA(1)&&(s=1);switch(s){case 1:i=this.match(this.input,99,FormulaParser.FOLLOW_PER_in_unitMultiplicativeExpression2464);if(this.state.failed)return t;if(0===this.state.backtracking){a=this.adaptor.create(i);e=this.adaptor.becomeRoot(a,e)}this.pushFollow(FormulaParser.FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2467);r=this.unitInnerMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},unitInnerMultiplicativeExpression_return:function(){FormulaParser.unitInnerMultiplicativeExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unitInnerMultiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitInnerMultiplicativeExpression:function(){var t=new FormulaParser.unitInnerMultiplicativeExpression_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2483);n=this.unitClump();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());t:for(;;){var a=2,s=this.input.LA(1);s>=h&&s<=84&&(a=1);switch(a){case 1:i=this.input.LT(1);if(!(this.input.LA(1)>=h&&this.input.LA(1)<=84)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&(e=this.adaptor.becomeRoot(this.adaptor.create(i),e));this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2494);r=this.unitClump();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},unitClump_return:function(){FormulaParser.unitClump_return=function(){};org.antlr.lang.extend(FormulaParser.unitClump_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitClump:function(){var t=new FormulaParser.unitClump_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null,a=null,o=null,l=null,u=null,h=null,c=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token INTEGER"),d=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token SQUARED"),m=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token DIV"),f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token CUBED"),g=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitPowerExpression");try{var p=2,_=this.input.LA(1);if(95==_)p=1;else{if(_!=s&&113!=_){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",93,0,this.input)}p=2}switch(p){case 1:i=this.match(this.input,95,FormulaParser.FOLLOW_INTEGER_in_unitClump2510);if(this.state.failed)return t;0===this.state.backtracking&&c.add(i);n=this.match(this.input,84,FormulaParser.FOLLOW_DIV_in_unitClump2512);if(this.state.failed)return t;0===this.state.backtracking&&m.add(n);this.pushFollow(FormulaParser.FOLLOW_unitPowerExpression_in_unitClump2515);u=this.unitPowerExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&g.add(u.getTree());var N=2;this.input.LA(1)==v&&(N=1);switch(N){case 1:r=this.match(this.input,v,FormulaParser.FOLLOW_CUBED_in_unitClump2517);if(this.state.failed)return t;0===this.state.backtracking&&f.add(r)}var T=2;this.input.LA(1)==S&&(T=1);switch(T){case 1:a=this.match(this.input,S,FormulaParser.FOLLOW_SQUARED_in_unitClump2520);if(this.state.failed)return t;0===this.state.backtracking&&d.add(a)}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var b=this.adaptor.nil();b=this.adaptor.becomeRoot(this.adaptor.create(12,"UNITCLUMP"),b);this.adaptor.addChild(b,g.nextTree());this.adaptor.addChild(b,this.adaptor.create(4,"NEGATE"));for(;f.hasNext();)this.adaptor.addChild(b,f.nextNode());f.reset();for(;d.hasNext();)this.adaptor.addChild(b,d.nextNode());d.reset();this.adaptor.addChild(e,b);t.tree=e}break;case 2:this.pushFollow(FormulaParser.FOLLOW_unitPowerExpression_in_unitClump2543);h=this.unitPowerExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&g.add(h.getTree());var E=2;this.input.LA(1)==v&&(E=1);switch(E){case 1:o=this.match(this.input,v,FormulaParser.FOLLOW_CUBED_in_unitClump2545);if(this.state.failed)return t;0===this.state.backtracking&&f.add(o)}var F=2;this.input.LA(1)==S&&(F=1);switch(F){case 1:l=this.match(this.input,S,FormulaParser.FOLLOW_SQUARED_in_unitClump2548);if(this.state.failed)return t;0===this.state.backtracking&&d.add(l)}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();b=this.adaptor.nil();b=this.adaptor.becomeRoot(this.adaptor.create(12,"UNITCLUMP"),b);this.adaptor.addChild(b,g.nextTree());for(;f.hasNext();)this.adaptor.addChild(b,f.nextNode());f.reset();for(;d.hasNext();)this.adaptor.addChild(b,d.nextNode());d.reset();this.adaptor.addChild(e,b);t.tree=e}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},unitPowerExpression_return:function(){FormulaParser.unitPowerExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unitPowerExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitPowerExpression:function(){var t=new FormulaParser.unitPowerExpression_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null,a=null,s=null,o=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unit_in_unitPowerExpression2610);a=this.unit();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,a.getTree());t:for(;;){var l=2;87==this.input.LA(1)&&(l=1);switch(l){case 1:i=this.match(this.input,87,FormulaParser.FOLLOW_POW_in_unitPowerExpression2614);if(this.state.failed)return t;if(0===this.state.backtracking){s=this.adaptor.create(i);e=this.adaptor.becomeRoot(s,e)}var h=2;this.input.LA(1)==u&&(h=1);switch(h){case 1:n=this.match(this.input,u,FormulaParser.FOLLOW_MINUS_in_unitPowerExpression2617);if(this.state.failed)return t;if(0===this.state.backtracking){o=this.adaptor.create(n);this.adaptor.addChild(e,o)}}r=this.input.LT(1);if(!(this.input.LA(1)>=95&&this.input.LA(1)<=96)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&this.adaptor.addChild(e,this.adaptor.create(r));this.state.errorRecovery=!1;this.state.failed=!1;break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},unit_return:function(){FormulaParser.unit_return=function(){};org.antlr.lang.extend(FormulaParser.unit_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unit:function(){var t=new FormulaParser.unit_return;t.start=this.input.LT(1);var e=null,i=null,n=null,r=null,a=null,o=null,l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),u=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),c=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitMultiplicativeExpression");try{var d=2,m=this.input.LA(1);if(m==s)d=1;else{if(113!=m){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",97,0,this.input)}d=2}switch(d){case 1:i=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_unit2638);if(this.state.failed)return t;0===this.state.backtracking&&u.add(i);t:for(;;){var f=2;this.input.LA(1)==s&&(f=1);switch(f){case 1:n=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_unit2641);if(this.state.failed)return t;0===this.state.backtracking&&u.add(n);break;default:break t}}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var g=this.adaptor.nil();g=this.adaptor.becomeRoot(this.adaptor.create(8,"UNIT"),g);if(!u.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;u.hasNext();)this.adaptor.addChild(g,u.nextNode());u.reset();this.adaptor.addChild(e,g);t.tree=e}break;case 2:r=this.match(this.input,113,FormulaParser.FOLLOW_113_in_unit2658);if(this.state.failed)return t;0===this.state.backtracking&&h.add(r);this.pushFollow(FormulaParser.FOLLOW_unitMultiplicativeExpression_in_unit2660);o=this.unitMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&c.add(o.getTree());a=this.match(this.input,114,FormulaParser.FOLLOW_114_in_unit2662);if(this.state.failed)return t;0===this.state.backtracking&&l.add(a);if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();g=this.adaptor.nil();g=this.adaptor.becomeRoot(this.adaptor.create(12,"UNITCLUMP"),g);this.adaptor.addChild(g,c.nextTree());this.adaptor.addChild(e,g);t.tree=e}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},primitive_return:function(){FormulaParser.primitive_return=function(){};org.antlr.lang.extend(FormulaParser.primitive_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),primitive:function(){var t=new FormulaParser.primitive_return;t.start=this.input.LT(1);var e=null,i=null,n=null;try{e=this.adaptor.nil();i=this.match(this.input,l,FormulaParser.FOLLOW_PRIMITIVE_in_primitive2731);if(this.state.failed)return t;if(0===this.state.backtracking){n=this.adaptor.create(i);this.adaptor.addChild(e,n)}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},string_return:function(){FormulaParser.string_return=function(){};org.antlr.lang.extend(FormulaParser.string_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),string:function(){var t=new FormulaParser.string_return;t.start=this.input.LT(1);var e=null,i=null,n=null;try{e=this.adaptor.nil();i=this.match(this.input,p,FormulaParser.FOLLOW_STRING_in_string3200);if(this.state.failed)return t;if(0===this.state.backtracking){n=this.adaptor.create(i);e=this.adaptor.becomeRoot(n,e)}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},synpred5_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_assignment_in_synpred5_Formula508);this.assignment();this.state._fsp--;this.state.failed},synpred6_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_synpred6_Formula514);this.logicalExpression();this.state._fsp--;this.state.failed},synpred8_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_forLoop_in_synpred8_Formula526);this.forLoop();this.state._fsp--;this.state.failed},synpred9_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_forInLoop_in_synpred9_Formula532);this.forInLoop();this.state._fsp--;this.state.failed},synpred11_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_functionDef_in_synpred11_Formula544);this.functionDef();this.state._fsp--;this.state.failed},synpred47_Formula_fragment:function(){this.match(this.input,72,FormulaParser.FOLLOW_OR_in_synpred47_Formula1217);if(!this.state.failed){this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_synpred47_Formula1220);this.booleanXORExpression();this.state._fsp--;this.state.failed}},synpred48_Formula_fragment:function(){this.match(this.input,73,FormulaParser.FOLLOW_XOR_in_synpred48_Formula1253);if(!this.state.failed){this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_synpred48_Formula1256);this.booleanAndExpression();this.state._fsp--;this.state.failed}},synpred49_Formula_fragment:function(){this.match(this.input,75,FormulaParser.FOLLOW_AND_in_synpred49_Formula1288);if(!this.state.failed){this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_synpred49_Formula1291);this.equalityExpression();this.state._fsp--;this.state.failed}},synpred51_Formula_fragment:function(){if(this.input.LA(1)!=o&&76!=this.input.LA(1)){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_synpred51_Formula1332);this.relationalExpression();this.state._fsp--;this.state.failed},synpred55_Formula_fragment:function(){if(!(this.input.LA(1)>=77&&this.input.LA(1)<=80)){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_synpred55_Formula1389);this.additiveExpression();this.state._fsp--;this.state.failed},synpred57_Formula_fragment:function(){if(!(this.input.LA(1)>=81&&this.input.LA(1)<=u)){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_synpred57_Formula1443);this.multiplicativeExpression();this.state._fsp--;this.state.failed},synpred60_Formula_fragment:function(){if(!(this.input.LA(1)>=h&&this.input.LA(1)<=85)){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_synpred60_Formula1486);this.arrayExpression();this.state._fsp--;this.state.failed},synpred61_Formula_fragment:function(){if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred61_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}this.match(this.input,c,FormulaParser.FOLLOW_COLON_in_synpred61_Formula1538);if(!this.state.failed){if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred61_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_synpred61_Formula1542);this.negationExpression();this.state._fsp--;this.state.failed}},synpred62_Formula_fragment:function(){if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred62_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}this.match(this.input,c,FormulaParser.FOLLOW_COLON_in_synpred62_Formula1551);if(!this.state.failed){if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred62_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_synpred62_Formula1555);this.negationExpression();this.state._fsp--;this.state.failed}},synpred64_Formula_fragment:function(){this.match(this.input,87,FormulaParser.FOLLOW_POW_in_synpred64_Formula1610);if(!this.state.failed){this.pushFollow(FormulaParser.FOLLOW_unaryOrNegate_in_synpred64_Formula1612);this.unaryOrNegate();this.state._fsp--;this.state.failed}},synpred68_Formula_fragment:function(){if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred68_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}var t=2,e=this.input.LA(1);if(e==m||e==f||116==e)t=1;else{if(113!=e){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.NoViableAltException("",119,0,this.input)}t=2}switch(t){case 1:this.pushFollow(FormulaParser.FOLLOW_selector_in_synpred68_Formula1744);this.selector();this.state._fsp--;if(this.state.failed)return;break;case 2:this.pushFollow(FormulaParser.FOLLOW_funCall_in_synpred68_Formula1746);this.funCall();this.state._fsp--;if(this.state.failed)return}},synpred75_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_material_in_synpred75_Formula1841);this.material();this.state._fsp--;this.state.failed},synpred78_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_array_in_synpred78_Formula1856);this.array();this.state._fsp--;this.state.failed},synpred80_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_funCall_in_synpred80_Formula1880);this.funCall();this.state._fsp--;this.state.failed},synpred85_Formula_fragment:function(){this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred85_Formula1946);this.state.failed},synpred86_Formula_fragment:function(){this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred86_Formula1952);this.state.failed},synpred87_Formula_fragment:function(){this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred87_Formula1958);this.state.failed},synpred88_Formula_fragment:function(){this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred88_Formula1963);this.state.failed},synpred93_Formula_fragment:function(){this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred93_Formula1989);this.state.failed},synpred94_Formula_fragment:function(){this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred94_Formula1995);this.state.failed},synpred95_Formula_fragment:function(){this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred95_Formula2000);this.state.failed},synpred96_Formula_fragment:function(){this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred96_Formula2005);this.state.failed},synpred108_Formula_fragment:function(){this.match(this.input,116,FormulaParser.FOLLOW_116_in_synpred108_Formula2133);if(!this.state.failed){this.pushFollow(FormulaParser.FOLLOW_arrayName_in_synpred108_Formula2135);this.arrayName();this.state._fsp--;this.state.failed}},synpred112_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_arrayName_in_synpred112_Formula2173);this.arrayName();this.state._fsp--;if(!this.state.failed){t:for(;;){var t=2;this.input.LA(1)==e&&(t=1);switch(t){case 1:this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred112_Formula2175);if(this.state.failed)return;break;default:break t}}this.match(this.input,c,FormulaParser.FOLLOW_COLON_in_synpred112_Formula2178);this.state.failed}},synpred95_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred95_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred94_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred94_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred80_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred80_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred49_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred49_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred57_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred57_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred68_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred68_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred51_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred51_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred62_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred62_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred64_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred64_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred93_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred93_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred55_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred55_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred85_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred85_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred87_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred87_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred48_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred48_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred86_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred86_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred9_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred9_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred75_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred75_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred96_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred96_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred47_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred47_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred8_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred8_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred112_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred112_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred6_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred6_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred5_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred5_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred60_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred60_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred61_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred61_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred108_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred108_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred11_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred11_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred78_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred78_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred88_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred88_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e}},!0);org.antlr.lang.augmentObject(FormulaParser,{DFA5_eotS:"￿",DFA5_eofS:"￿",DFA5_minS:"&\0\b￿\0￿\0\b￿",DFA5_maxS:"q\0\b￿\0￿\0\b￿",DFA5_acceptS:"￿\t￿￿\b\t\n",DFA5_specialS:"￿\0\b￿￿\b￿}>",DFA5_transitionS:["\r￿\v￿￿\v￿￿￿\n￿￿￿￿￿","￿","￿","","","","","","","","","￿","","","￿","","","","","","","",""]});org.antlr.lang.augmentObject(FormulaParser,{DFA5_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_eotS),DFA5_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_eofS),DFA5_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA5_minS),DFA5_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA5_maxS),DFA5_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_acceptS),DFA5_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_specialS),DFA5_transition:function(){var t,e=[],i=FormulaParser.DFA5_transitionS.length;for(t=0;t<i;t++)e.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_transitionS[t]));return e}()});FormulaParser.DFA5=function(t){this.recognizer=t;this.decisionNumber=5;this.eot=FormulaParser.DFA5_eot;this.eof=FormulaParser.DFA5_eof;this.min=FormulaParser.DFA5_min;this.max=FormulaParser.DFA5_max;this.accept=FormulaParser.DFA5_accept;this.special=FormulaParser.DFA5_special;this.transition=FormulaParser.DFA5_transition};org.antlr.lang.extend(FormulaParser.DFA5,org.antlr.runtime.DFA,{getDescription:function(){return"120:1: expression : ( assignment | logicalExpression | whileLoop | forLoop | forInLoop | ifThenElse | functionDef | returnExp | tryCatch | throwExp );"},specialStateTransition:function(t,e){var i=t,n=function(t,e){switch(t){case 0:e.LA(1);var i=e.index();e.rewind();t=-1;this.synpred5_Formula()?t=19:this.synpred6_Formula()&&(t=3);e.seek(i);if(t>=0)return t;break;case 1:e.LA(1);var n=e.index();e.rewind();t=-1;this.synpred5_Formula()?t=19:this.synpred6_Formula()&&(t=3);e.seek(n);if(t>=0)return t;break;case 2:e.LA(1);var r=e.index();e.rewind();t=-1;this.synpred6_Formula()?t=3:this.synpred11_Formula()&&(t=20);e.seek(r);if(t>=0)return t;break;case 3:e.LA(1);var a=e.index();e.rewind();t=-1;this.synpred8_Formula()?t=21:this.synpred9_Formula()&&(t=22);e.seek(a);if(t>=0)return t}}.call(this.recognizer,t,e);if(!org.antlr.lang.isUndefined(n))return n;if(this.recognizer.state.backtracking>0){this.recognizer.state.failed=!0;return-1}var r=new org.antlr.runtime.NoViableAltException(this.getDescription(),5,i,e);this.error(r);throw r},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA57_eotS:"\v￿",DFA57_eofS:"\v￿",DFA57_minS:"<￿\0￿",DFA57_maxS:"b￿\0￿",DFA57_acceptS:"￿￿\b\t",DFA57_specialS:"￿\0￿}>",DFA57_transitionS:["\b￿\t￿￿￿￿￿","","","","￿","","","","","",""]});org.antlr.lang.augmentObject(FormulaParser,{DFA57_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_eotS),DFA57_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_eofS),DFA57_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA57_minS),DFA57_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA57_maxS),DFA57_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_acceptS),DFA57_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_specialS),DFA57_transition:function(){var t,e=[],i=FormulaParser.DFA57_transitionS.length;for(t=0;t<i;t++)e.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_transitionS[t]));return e}()});FormulaParser.DFA57=function(t){this.recognizer=t;this.decisionNumber=57;this.eot=FormulaParser.DFA57_eot;this.eof=FormulaParser.DFA57_eof;this.min=FormulaParser.DFA57_min;this.max=FormulaParser.DFA57_max;this.accept=FormulaParser.DFA57_accept;this.special=FormulaParser.DFA57_special;this.transition=FormulaParser.DFA57_transition};org.antlr.lang.extend(FormulaParser.DFA57,org.antlr.runtime.DFA,{getDescription:function(){return"283:1: value : ( number | bool | string | material | IDENT | primitive | array | anonFunctionDef | newObject );"},specialStateTransition:function(t,e){var i=t,n=function(t,e){switch(t){case 0:e.LA(1);var i=e.index();e.rewind();t=-1;this.synpred75_Formula()?t=10:this.synpred78_Formula()&&(t=7);e.seek(i);if(t>=0)return t}}.call(this.recognizer,t,e);if(!org.antlr.lang.isUndefined(n))return n;if(this.recognizer.state.backtracking>0){this.recognizer.state.failed=!0;return-1}var r=new org.antlr.runtime.NoViableAltException(this.getDescription(),57,i,e);this.error(r);throw r},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA58_eotS:"￿",DFA58_eofS:"￿",DFA58_minS:" \0￿",DFA58_maxS:"t\0￿",DFA58_acceptS:"￿￿",DFA58_specialS:"￿\0￿}>",DFA58_transitionS:["￿￿￿\r￿￿￿\r￿￿￿￿","￿","","","","","","","","","","","","","","","","","","","","","","","",""]});org.antlr.lang.augmentObject(FormulaParser,{DFA58_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_eotS),DFA58_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_eofS),DFA58_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA58_minS),DFA58_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA58_maxS),DFA58_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_acceptS),DFA58_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_specialS),DFA58_transition:function(){var t,e=[],i=FormulaParser.DFA58_transitionS.length;for(t=0;t<i;t++)e.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_transitionS[t]));return e}()});FormulaParser.DFA58=function(t){this.recognizer=t;this.decisionNumber=58;this.eot=FormulaParser.DFA58_eot;this.eof=FormulaParser.DFA58_eof;this.min=FormulaParser.DFA58_min;this.max=FormulaParser.DFA58_max;this.accept=FormulaParser.DFA58_accept;this.special=FormulaParser.DFA58_special;this.transition=FormulaParser.DFA58_transition};org.antlr.lang.extend(FormulaParser.DFA58,org.antlr.runtime.DFA,{getDescription:function(){return"296:22: ( funCall )?"},specialStateTransition:function(t,e){var i=t,n=function(t,e){switch(t){case 0:e.LA(1);var i=e.index();e.rewind();t=-1;this.synpred80_Formula()?t=25:" "!=this.input.get(this.input.index()-1).getText()&&" "==this.input.get(this.input.index()-1).getText()||(t=2);e.seek(i);if(t>=0)return t}}.call(this.recognizer,t,e);if(!org.antlr.lang.isUndefined(n))return n;if(this.recognizer.state.backtracking>0){this.recognizer.state.failed=!0;return-1}var r=new org.antlr.runtime.NoViableAltException(this.getDescription(),58,i,e);this.error(r);throw r},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA65_eotS:"￿",DFA65_eofS:"￿",DFA65_minS:" ￿ ￿",DFA65_maxS:"q￿q￿",DFA65_acceptS:"￿￿",DFA65_specialS:"￿}>",DFA65_transitionS:["￿￿￿￿\n￿￿￿￿","","￿￿￿￿\n￿￿￿￿",""]});org.antlr.lang.augmentObject(FormulaParser,{DFA65_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_eotS),DFA65_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_eofS),DFA65_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA65_minS),DFA65_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA65_maxS),DFA65_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_acceptS),DFA65_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_specialS),DFA65_transition:function(){var t,e=[],i=FormulaParser.DFA65_transitionS.length;for(t=0;t<i;t++)e.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_transitionS[t]));return e}()});FormulaParser.DFA65=function(t){this.recognizer=t;this.decisionNumber=65;this.eot=FormulaParser.DFA65_eot;this.eof=FormulaParser.DFA65_eof;this.min=FormulaParser.DFA65_min;this.max=FormulaParser.DFA65_max;this.accept=FormulaParser.DFA65_accept;this.special=FormulaParser.DFA65_special;this.transition=FormulaParser.DFA65_transition};org.antlr.lang.extend(FormulaParser.DFA65,org.antlr.runtime.DFA,{getDescription:function(){return"309:16: ( label ( NEWLINE )* ( ',' ( NEWLINE )* label ( NEWLINE )* )* )?"},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA72_eotS:"￿",DFA72_eofS:"￿",DFA72_minS:" ￿ ￿",DFA72_maxS:"q￿q￿",DFA72_acceptS:"￿￿",DFA72_specialS:"￿}>",DFA72_transitionS:["￿￿￿￿\n￿￿￿￿￿","","￿￿￿￿\n￿￿￿￿￿",""]});org.antlr.lang.augmentObject(FormulaParser,{DFA72_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_eotS),DFA72_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_eofS),DFA72_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA72_minS),DFA72_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA72_maxS),DFA72_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_acceptS),DFA72_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_specialS),DFA72_transition:function(){var t,e=[],i=FormulaParser.DFA72_transitionS.length;for(t=0;t<i;t++)e.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_transitionS[t]));return e}()});FormulaParser.DFA72=function(t){this.recognizer=t;this.decisionNumber=72;this.eot=FormulaParser.DFA72_eot;this.eof=FormulaParser.DFA72_eof;this.min=FormulaParser.DFA72_min;this.max=FormulaParser.DFA72_max;this.accept=FormulaParser.DFA72_accept;this.special=FormulaParser.DFA72_special;this.transition=FormulaParser.DFA72_transition};org.antlr.lang.extend(FormulaParser.DFA72,org.antlr.runtime.DFA,{getDescription:function(){return"310:19: ( label ( NEWLINE )* ( ',' ( NEWLINE )* label ( NEWLINE )* )* )?"},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA85_eotS:"￿",DFA85_eofS:"￿",DFA85_minS:" \0￿\0￿",DFA85_maxS:"q\0￿\0￿",DFA85_acceptS:"￿￿￿",DFA85_specialS:"￿\0￿￿}>",DFA85_transitionS:["￿￿￿\b￿\n￿\n￿￿￿￿","￿","","","","","","","￿","","","","","",""]});org.antlr.lang.augmentObject(FormulaParser,{DFA85_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_eotS),DFA85_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_eofS),DFA85_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA85_minS),DFA85_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA85_maxS),DFA85_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_acceptS),DFA85_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_specialS),DFA85_transition:function(){var t,e=[],i=FormulaParser.DFA85_transitionS.length;for(t=0;t<i;t++)e.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_transitionS[t]));return e}()});FormulaParser.DFA85=function(t){this.recognizer=t;this.decisionNumber=85;this.eot=FormulaParser.DFA85_eot;this.eof=FormulaParser.DFA85_eof;this.min=FormulaParser.DFA85_min;this.max=FormulaParser.DFA85_max;this.accept=FormulaParser.DFA85_accept;this.special=FormulaParser.DFA85_special;this.transition=FormulaParser.DFA85_transition};org.antlr.lang.extend(FormulaParser.DFA85,org.antlr.runtime.DFA,{getDescription:function(){return"331:2: ( arrayName ( NEWLINE )* COLON )?"},specialStateTransition:function(t,e){var i=t,n=function(t,e){switch(t){case 0:e.LA(1);var i=e.index();e.rewind();t=-1;if(this.synpred112_Formula())t=10;else{t=2}e.seek(i);if(t>=0)return t;break;case 1:e.LA(1);var n=e.index();e.rewind();t=-1;if(this.synpred112_Formula())t=10;else{t=2}e.seek(n);if(t>=0)return t}}.call(this.recognizer,t,e);if(!org.antlr.lang.isUndefined(n))return n;if(this.recognizer.state.backtracking>0){this.recognizer.state.failed=!0;return-1}var r=new org.antlr.runtime.NoViableAltException(this.getDescription(),85,i,e);this.error(r);throw r},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{tokenNames:["<invalid>","<EOR>","<DOWN>","<UP>","NEGATE","ASSIGN","FUNCALL","MATERIAL","UNIT","POWER","DEFAULTS","PARAMS","UNITCLUMP","ARRAY","LINES","WHILE","IFTHENELSE","ELSE","FOR","FORIN","FUNCTION","ANONFUNCTION","NUMBER","LABEL","RANGE","INNER","ASSIGNED","SELECTOR","DOTSELECTOR","NEW","TRYCATCH","THROW","NEWLINE","W","H","I","L","E","WHILESTATEMENT","F","O","R","FORSTATEMENT","M","FROMSTATEMENT","N","INSTATEMENT","T","TOSTATEMENT","B","Y","BYSTATEMENT","P","LOOPSTATEMENT","IFSTATEMENT","THENSTATEMENT","S","ELSESTATEMENT","U","C","FUNCTIONSTATEMENT","D","ENDBLOCK","RETURNSTATEMENT","NEWSTATEMENT","TRYSTATEMENT","A","CATCHSTATEMENT","THROWSTATEMENT","IDENT","EQUALS","PRIMITIVE","OR","XOR","X","AND","NOTEQUALS","LT","LTEQ","GT","GTEQ","PLUS","MINUS","MULT","DIV","MOD","COLON","POW","NOT","LARR","RARR","LCURL","RCURL","COMMA","STRING","INTEGER","FLOAT","TRUE","FALSE","PER","CUBED","SQUARED","Q","LBRACKET","RBRACKET","COMMENT","LINE_COMMENT","WS","G","J","K","V","Z","'('","')'","'<-'","'.'"],FOLLOW_NEWLINE_in_lines160:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_expression_in_lines164:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_lines168:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_EOF_in_lines171:new org.antlr.runtime.BitSet([0,2420114496,3406037171,131079]),FOLLOW_EOF_in_lines176:new org.antlr.runtime.BitSet([2,0]),FOLLOW_assignment_in_expression508:new org.antlr.runtime.BitSet([2,0]),FOLLOW_logicalExpression_in_expression514:new org.antlr.runtime.BitSet([2,0]),FOLLOW_whileLoop_in_expression520:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forLoop_in_expression526:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forInLoop_in_expression532:new org.antlr.runtime.BitSet([2,0]),FOLLOW_ifThenElse_in_expression538:new org.antlr.runtime.BitSet([2,0]),FOLLOW_functionDef_in_expression544:new org.antlr.runtime.BitSet([2,0]),FOLLOW_returnExp_in_expression550:new org.antlr.runtime.BitSet([2,0]),FOLLOW_tryCatch_in_expression556:new org.antlr.runtime.BitSet([2,0]),FOLLOW_throwExp_in_expression562:new org.antlr.runtime.BitSet([2,0]),FOLLOW_RETURNSTATEMENT_in_returnExp574:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_returnExp577:new org.antlr.runtime.BitSet([2,0]),FOLLOW_expression_in_innerBlock590:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_innerBlock594:new org.antlr.runtime.BitSet([2,2420114497,3406037171,131079]),FOLLOW_WHILESTATEMENT_in_whileLoop619:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_whileLoop621:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_whileLoop623:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_whileLoop626:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_whileLoop629:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_whileLoop631:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FORSTATEMENT_in_forLoop652:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_forLoop654:new org.antlr.runtime.BitSet([0,4096]),FOLLOW_FROMSTATEMENT_in_forLoop656:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop658:new org.antlr.runtime.BitSet([0,65536]),FOLLOW_TOSTATEMENT_in_forLoop660:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop662:new org.antlr.runtime.BitSet([0,524289]),FOLLOW_BYSTATEMENT_in_forLoop665:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop667:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_forLoop671:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_forLoop674:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_forLoop677:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_forLoop679:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FORSTATEMENT_in_forInLoop707:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_forInLoop709:new org.antlr.runtime.BitSet([0,16384]),FOLLOW_INSTATEMENT_in_forInLoop711:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forInLoop713:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_forInLoop715:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_forInLoop718:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_forInLoop721:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_forInLoop723:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IFSTATEMENT_in_ifThenElse748:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_ifThenElse750:new org.antlr.runtime.BitSet([0,8388608]),FOLLOW_THENSTATEMENT_in_ifThenElse752:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse755:new org.antlr.runtime.BitSet([0,3527410753,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse758:new org.antlr.runtime.BitSet([0,1107296256]),FOLLOW_ELSESTATEMENT_in_ifThenElse762:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IFSTATEMENT_in_ifThenElse764:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_ifThenElse766:new org.antlr.runtime.BitSet([0,8388608]),FOLLOW_THENSTATEMENT_in_ifThenElse768:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse770:new org.antlr.runtime.BitSet([0,3527410753,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse773:new org.antlr.runtime.BitSet([0,1107296256]),FOLLOW_ELSESTATEMENT_in_ifThenElse778:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse780:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse783:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_ifThenElse787:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IFSTATEMENT_in_ifThenElse789:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FUNCTIONSTATEMENT_in_functionDef820:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef822:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_functionDef824:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_functionDef827:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_functionDef831:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_functionDef834:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_functionDef839:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef841:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_functionDef848:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef850:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_functionDef852:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_functionDef854:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_functionDef861:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_functionDef863:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_functionDef866:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_functionDef869:new org.antlr.runtime.BitSet([0,268435456]),FOLLOW_FUNCTIONSTATEMENT_in_functionDef871:new org.antlr.runtime.BitSet([2,0]),FOLLOW_TRYSTATEMENT_in_tryCatch904:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_tryCatch906:new org.antlr.runtime.BitSet([0,2420114497,3406037179,131079]),FOLLOW_innerBlock_in_tryCatch909:new org.antlr.runtime.BitSet([0,0,8,0]),FOLLOW_CATCHSTATEMENT_in_tryCatch911:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_tryCatch913:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_tryCatch915:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_tryCatch919:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_tryCatch921:new org.antlr.runtime.BitSet([0,0,2,0]),FOLLOW_TRYSTATEMENT_in_tryCatch923:new org.antlr.runtime.BitSet([2,0]),FOLLOW_THROWSTATEMENT_in_throwExp945:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_primaryExpression_in_throwExp947:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef967:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_anonFunctionDef970:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_anonFunctionDef973:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_anonFunctionDef977:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_anonFunctionDef980:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_anonFunctionDef985:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_anonFunctionDef987:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_anonFunctionDef994:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_anonFunctionDef996:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_anonFunctionDef998:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_anonFunctionDef1000:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_anonFunctionDef1007:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_NEWLINE_in_anonFunctionDef1012:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_anonFunctionDef1015:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_anonFunctionDef1018:new org.antlr.runtime.BitSet([0,268435456]),FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef1020:new org.antlr.runtime.BitSet([2,0]),FOLLOW_expression_in_anonFunctionDef1025:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_assignment1067:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_assignment1069:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_assignment1072:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_assignment1076:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_assignment1078:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_assignment1083:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_assignment1085:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_assignment1092:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_assignment1094:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_assignment1096:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_assignment1098:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_assignment1105:new org.antlr.runtime.BitSet([0,0,0,524288]),FOLLOW_115_in_assignment1107:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_assignment1109:new org.antlr.runtime.BitSet([2,0]),FOLLOW_PRIMITIVE_in_assignment1137:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_assigned_in_assignment1141:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_COMMA_in_assignment1145:new org.antlr.runtime.BitSet([0,0,160,0]),FOLLOW_PRIMITIVE_in_assignment1148:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_assigned_in_assignment1152:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_115_in_assignment1158:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_assignment1160:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_assigned1186:new org.antlr.runtime.BitSet([2,0,167772160,1048576]),FOLLOW_selector_in_assigned1188:new org.antlr.runtime.BitSet([2,0]),FOLLOW_booleanXORExpression_in_logicalExpression1214:new org.antlr.runtime.BitSet([2,0,256,0]),FOLLOW_OR_in_logicalExpression1217:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanXORExpression_in_logicalExpression1220:new org.antlr.runtime.BitSet([2,0,256,0]),FOLLOW_booleanAndExpression_in_booleanXORExpression1250:new org.antlr.runtime.BitSet([2,0,512,0]),FOLLOW_XOR_in_booleanXORExpression1253:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanAndExpression_in_booleanXORExpression1256:new org.antlr.runtime.BitSet([2,0,512,0]),FOLLOW_equalityExpression_in_booleanAndExpression1285:new org.antlr.runtime.BitSet([2,0,2048,0]),FOLLOW_AND_in_booleanAndExpression1288:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_equalityExpression_in_booleanAndExpression1291:new org.antlr.runtime.BitSet([2,0,2048,0]),FOLLOW_relationalExpression_in_equalityExpression1322:new org.antlr.runtime.BitSet([2,0,4160,0]),FOLLOW_set_in_equalityExpression1325:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_relationalExpression_in_equalityExpression1332:new org.antlr.runtime.BitSet([2,0,4160,0]),FOLLOW_additiveExpression_in_relationalExpression1374:new org.antlr.runtime.BitSet([2,0,122880,0]),FOLLOW_set_in_relationalExpression1378:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_additiveExpression_in_relationalExpression1389:new org.antlr.runtime.BitSet([2,0,122880,0]),FOLLOW_multiplicativeExpression_in_additiveExpression1432:new org.antlr.runtime.BitSet([2,0,393216,0]),FOLLOW_set_in_additiveExpression1436:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_multiplicativeExpression_in_additiveExpression1443:new org.antlr.runtime.BitSet([2,0,393216,0]),FOLLOW_arrayExpression_in_multiplicativeExpression1473:new org.antlr.runtime.BitSet([2,0,3670016,0]),FOLLOW_set_in_multiplicativeExpression1477:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_arrayExpression_in_multiplicativeExpression1486:new org.antlr.runtime.BitSet([2,0,3670016,0]),FOLLOW_negationExpression_in_arrayExpression1532:new org.antlr.runtime.BitSet([2,0,4194304,0]),FOLLOW_COLON_in_arrayExpression1538:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_arrayExpression1542:new org.antlr.runtime.BitSet([2,0,4194304,0]),FOLLOW_COLON_in_arrayExpression1551:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_arrayExpression1555:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_negationExpression1580:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_powerExpression_in_negationExpression1582:new org.antlr.runtime.BitSet([2,0]),FOLLOW_powerExpression_in_negationExpression1596:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unaryExpression_in_powerExpression1607:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_POW_in_powerExpression1610:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_unaryOrNegate_in_powerExpression1612:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_unaryExpression_in_unaryOrNegate1639:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_unaryOrNegate1645:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_unaryExpression_in_unaryOrNegate1647:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NOT_in_unaryExpression1675:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_innerPrimaryExpression_in_unaryExpression1678:new org.antlr.runtime.BitSet([2,0]),FOLLOW_innerPrimaryExpression_in_unaryExpression1687:new org.antlr.runtime.BitSet([2,0]),FOLLOW_selectionExpression_in_innerPrimaryExpression1718:new org.antlr.runtime.BitSet([2,0]),FOLLOW_primaryExpression_in_selectionExpression1738:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_selector_in_selectionExpression1744:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_funCall_in_selectionExpression1746:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_113_in_funCall1761:new org.antlr.runtime.BitSet([0,268435456,3406037153,393223]),FOLLOW_logicalExpression_in_funCall1765:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_funCall1768:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_funCall1770:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_funCall1777:new org.antlr.runtime.BitSet([2,0]),FOLLOW_113_in_primaryExpression1798:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_primaryExpression1801:new org.antlr.runtime.BitSet([0,0,0,262144]),FOLLOW_114_in_primaryExpression1803:new org.antlr.runtime.BitSet([2,0]),FOLLOW_value_in_primaryExpression1809:new org.antlr.runtime.BitSet([2,0]),FOLLOW_number_in_value1823:new org.antlr.runtime.BitSet([2,0]),FOLLOW_bool_in_value1829:new org.antlr.runtime.BitSet([2,0]),FOLLOW_string_in_value1835:new org.antlr.runtime.BitSet([2,0]),FOLLOW_material_in_value1841:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_value1846:new org.antlr.runtime.BitSet([2,0]),FOLLOW_primitive_in_value1851:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_value1856:new org.antlr.runtime.BitSet([2,0]),FOLLOW_anonFunctionDef_in_value1861:new org.antlr.runtime.BitSet([2,0]),FOLLOW_newObject_in_value1866:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWSTATEMENT_in_newObject1876:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_newObject1878:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_funCall_in_newObject1880:new org.antlr.runtime.BitSet([2,0]),FOLLOW_negnumber_in_defaultValue1906:new org.antlr.runtime.BitSet([2,0]),FOLLOW_number_in_defaultValue1912:new org.antlr.runtime.BitSet([2,0]),FOLLOW_bool_in_defaultValue1918:new org.antlr.runtime.BitSet([2,0]),FOLLOW_string_in_defaultValue1924:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_defaultValue1930:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LARR_in_array1944:new org.antlr.runtime.BitSet([0,268435457,3473670305,131079]),FOLLOW_NEWLINE_in_array1946:new org.antlr.runtime.BitSet([0,268435457,3473670305,131079]),FOLLOW_label_in_array1950:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1952:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_COMMA_in_array1956:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_NEWLINE_in_array1958:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_label_in_array1961:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1963:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1970:new org.antlr.runtime.BitSet([0,1,67108864,0]),FOLLOW_RARR_in_array1973:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_array1987:new org.antlr.runtime.BitSet([0,268435457,3674996897,131079]),FOLLOW_NEWLINE_in_array1989:new org.antlr.runtime.BitSet([0,268435457,3674996897,131079]),FOLLOW_label_in_array1993:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_NEWLINE_in_array1995:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_COMMA_in_array1998:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_NEWLINE_in_array2000:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_label_in_array2003:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_NEWLINE_in_array2005:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_NEWLINE_in_array2012:new org.antlr.runtime.BitSet([0,1,268435456,0]),FOLLOW_RCURL_in_array2015:new org.antlr.runtime.BitSet([2,0]),FOLLOW_minarray_in_selector2036:new org.antlr.runtime.BitSet([2,0]),FOLLOW_dotselector_in_selector2040:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LARR_in_minarray2067:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2072:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_MULT_in_minarray2074:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_COMMA_in_minarray2078:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2082:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_MULT_in_minarray2084:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_RARR_in_minarray2091:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_minarray2097:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2102:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_MULT_in_minarray2104:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_COMMA_in_minarray2108:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2112:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_MULT_in_minarray2114:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_RCURL_in_minarray2121:new org.antlr.runtime.BitSet([2,0]),FOLLOW_116_in_dotselector2133:new org.antlr.runtime.BitSet([0,0,1074266144,0]),FOLLOW_arrayName_in_dotselector2135:new org.antlr.runtime.BitSet([2,0,0,1048576]),FOLLOW_set_in_arrayName0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_arrayName_in_label2173:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_NEWLINE_in_label2175:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_COLON_in_label2178:new org.antlr.runtime.BitSet([0,268435457,3406037153,131079]),FOLLOW_NEWLINE_in_label2182:new org.antlr.runtime.BitSet([0,268435457,3406037153,131079]),FOLLOW_logicalExpression_in_label2185:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_number0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_negnumber2261:new org.antlr.runtime.BitSet([0,0,2147483648,1]),FOLLOW_number_in_negnumber2263:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_bool0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_material2415:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_additiveExpression_in_material2417:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitMultiplicativeExpression_in_material2421:new org.antlr.runtime.BitSet([0,0,268435456,0]),FOLLOW_RCURL_in_material2423:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2460:new org.antlr.runtime.BitSet([2,0,0,8]),FOLLOW_PER_in_unitMultiplicativeExpression2464:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2467:new org.antlr.runtime.BitSet([2,0,0,8]),FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2483:new org.antlr.runtime.BitSet([2,0,1572864,0]),FOLLOW_set_in_unitInnerMultiplicativeExpression2487:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2494:new org.antlr.runtime.BitSet([2,0,1572864,0]),FOLLOW_INTEGER_in_unitClump2510:new org.antlr.runtime.BitSet([0,0,1048576,0]),FOLLOW_DIV_in_unitClump2512:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitPowerExpression_in_unitClump2515:new org.antlr.runtime.BitSet([2,0,0,48]),FOLLOW_CUBED_in_unitClump2517:new org.antlr.runtime.BitSet([2,0,0,32]),FOLLOW_SQUARED_in_unitClump2520:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unitPowerExpression_in_unitClump2543:new org.antlr.runtime.BitSet([2,0,0,48]),FOLLOW_CUBED_in_unitClump2545:new org.antlr.runtime.BitSet([2,0,0,32]),FOLLOW_SQUARED_in_unitClump2548:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unit_in_unitPowerExpression2610:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_POW_in_unitPowerExpression2614:new org.antlr.runtime.BitSet([0,0,2147745792,1]),FOLLOW_MINUS_in_unitPowerExpression2617:new org.antlr.runtime.BitSet([0,0,2147483648,1]),FOLLOW_set_in_unitPowerExpression2620:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_IDENT_in_unit2638:new org.antlr.runtime.BitSet([2,0,32,0]),FOLLOW_IDENT_in_unit2641:new org.antlr.runtime.BitSet([2,0,32,0]),FOLLOW_113_in_unit2658:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitMultiplicativeExpression_in_unit2660:new org.antlr.runtime.BitSet([0,0,0,262144]),FOLLOW_114_in_unit2662:new org.antlr.runtime.BitSet([2,0]),FOLLOW_PRIMITIVE_in_primitive2731:new org.antlr.runtime.BitSet([2,0]),FOLLOW_STRING_in_string3200:new org.antlr.runtime.BitSet([2,0]),FOLLOW_assignment_in_synpred5_Formula508:new org.antlr.runtime.BitSet([2,0]),FOLLOW_logicalExpression_in_synpred6_Formula514:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forLoop_in_synpred8_Formula526:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forInLoop_in_synpred9_Formula532:new org.antlr.runtime.BitSet([2,0]),FOLLOW_functionDef_in_synpred11_Formula544:new org.antlr.runtime.BitSet([2,0]),FOLLOW_OR_in_synpred47_Formula1217:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanXORExpression_in_synpred47_Formula1220:new org.antlr.runtime.BitSet([2,0]),FOLLOW_XOR_in_synpred48_Formula1253:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanAndExpression_in_synpred48_Formula1256:new org.antlr.runtime.BitSet([2,0]),FOLLOW_AND_in_synpred49_Formula1288:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_equalityExpression_in_synpred49_Formula1291:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred51_Formula1325:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_relationalExpression_in_synpred51_Formula1332:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred55_Formula1378:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_additiveExpression_in_synpred55_Formula1389:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred57_Formula1436:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_multiplicativeExpression_in_synpred57_Formula1443:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred60_Formula1477:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_arrayExpression_in_synpred60_Formula1486:new org.antlr.runtime.BitSet([2,0]),FOLLOW_COLON_in_synpred61_Formula1538:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_synpred61_Formula1542:new org.antlr.runtime.BitSet([2,0]),FOLLOW_COLON_in_synpred62_Formula1551:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_synpred62_Formula1555:new org.antlr.runtime.BitSet([2,0]),FOLLOW_POW_in_synpred64_Formula1610:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_unaryOrNegate_in_synpred64_Formula1612:new org.antlr.runtime.BitSet([2,0]),FOLLOW_selector_in_synpred68_Formula1744:new org.antlr.runtime.BitSet([2,0]),FOLLOW_funCall_in_synpred68_Formula1746:new org.antlr.runtime.BitSet([2,0]),FOLLOW_material_in_synpred75_Formula1841:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_synpred78_Formula1856:new org.antlr.runtime.BitSet([2,0]),FOLLOW_funCall_in_synpred80_Formula1880:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred85_Formula1946:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred86_Formula1952:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred87_Formula1958:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred88_Formula1963:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred93_Formula1989:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred94_Formula1995:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred95_Formula2000:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred96_Formula2005:new org.antlr.runtime.BitSet([2,0]),FOLLOW_116_in_synpred108_Formula2133:new org.antlr.runtime.BitSet([0,0,1074266144,0]),FOLLOW_arrayName_in_synpred108_Formula2135:new org.antlr.runtime.BitSet([2,0]),FOLLOW_arrayName_in_synpred112_Formula2173:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_NEWLINE_in_synpred112_Formula2175:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_COLON_in_synpred112_Formula2178:new org.antlr.runtime.BitSet([2,0])})}();class Simulator{constructor(){this.randLoc=-1;this.lastRandPos=-1;this.previousRandLists=[];this.valuedPrimitives=[];this.unitsToBases={};this.distanceCache={};this.sliders={};this.ids={};this.idCount=0;this.stochastic=!1}setup(t){this.model=t.model;this.solversCompletedFirstPass=0;this.timeStart=this.model.timeStart;this.timeLength=this.model.timeLength;this.timePause=this.model.timePause;this.timeEnd=plus(this.timeStart,this.timeLength);this.timeStep=this.model.solvers.base.timeStep;this.userTimeStep=this.model.solvers.base.userTimeStep;this.timeUnits=this.timeStart.units;this.timeUnits.addBase();this.oldAggregateSeries=[];this.distanceCache={};this.tasks=new TaskQueue({start:this.timeStart,end:this.timeEnd})}getID(t){if(!this.ids[t]){this.idCount++;this.ids[t]=this.idCount}return this.ids[t]}time(){return this.tasks.time}timeProgressed(){return minus(this.time(),this.timeStart)}frame(t,e){for(var i=t.length,n=0;n<i;n++)t[n].storeValue();this.printStates(e)}step(t){if(!t.completedFirstPass){t.completedFirstPass=!0;this.solversCompletedFirstPass++;this.solversCompletedFirstPass==Object.keys(this.model.solvers).length&&this.config.onCompletedFirstPass&&this.config.onCompletedFirstPass()}if(t.displayed.length>0)for(var e=this.results[t.displayed[0].id].results.length;e<this.results.Time.length;e++)for(var i=0;i<t.displayed.length;i++)this.results[t.displayed[i].id].results.push(this.results.data[e][t.displayed[i].id]);this.config.onStep&&this.config.onStep(t)}sleep(t){if(this.config)if(this.config.silent)this.config.onPause&&(this.shouldSleep=!0);else{window.storyConverter?this.shouldSleep=!1:this.shouldSleep=!0;this.shouldUpdateScripter=t}}resume(){try{this.run()}catch(t){return checkErr(t,this.config)}}completed(){return this.terminated||this.tasks.completed()}terminate(){if(!this.terminated){clearTimeout(this.timer);this.sleep();this.terminated=!0;this.resultsWindow&&this.resultsWindow.scripter.finished()}}run(t){var e=this,i=function(t,n){e.tasks.add(new Task({time:t,expires:1,name:"Interval Pause",priority:1,action:function(){e.sleep(!0);n&&lessThan(plus(t,e.timePause),e.timeEnd)&&i(plus(t,e.timePause),n)}}));e.tasks.add(new Task({time:t,expires:1,name:"Interval Pause",priority:1,action:function(){if(e.valueChange){simulate.valuedPrimitives=[];for(var t in e.model.solvers){for(var i=e.model.solvers[t],n=0;n<i.valued.length;n++)i.valued[n].clearCached();for(n=0;n<i.flows.length;n++)i.flows[n].predict(!0)}e.valueChange=!1}}}))};if(t){this.config=t;for(var n=Object.keys(this.model.solvers),r=0;r<n.length;r++)this.createSolver(this.model.solvers[n[r]]);this.timePause&&!window.storyConverter&&i(plus(this.timeStart,this.timePause),!0);this.tasks.tasks.goMin()}this.wakeUpTime=(new Date).getTime();try{for(;!this.completed();){this.tasks.step();if(this.shouldSleep){for(let t in this.model.solvers)updateDisplayed(this.model.solvers[t]);if(this.shouldUpdateScripter){this.resultsWindow.scripter.endMode="pause";this.shouldUpdateScripter=!1}this.config.onPause&&setTimeout(function(){var t=formatSimResults(this.results),i=t.data.length,n=t.data[i-1];for(var r in n)t[r].results.length<i&&t[r].results.push(n[r]);t.resume=e.resume.bind(this);t.setValue=function(t,e){var i=simpleEquation(""+e,{"-parent":varBank});this.valuedPrimitives.forEach((function(e){if(e.id==t.id)if(i.fullClone){e.dna.equation=i.fullClone();e.equation=i.fullClone()}else{e.dna.equation=i;e.equation=i}}));this.valueChange=!0}.bind(this);e.config.onPause(t)}.bind(this),10);this.shouldSleep=!1;return}}}catch(t){if("STOP"!=t.msg)throw t}this.results=formatSimResults(this.results);this.results.stochastic=this.stochastic;this.config.onSuccess&&this.config.onSuccess(this.results);this.terminate();if(this.resultsWindow){this.results.window=this.resultsWindow;for(let t in this.model.solvers)updateDisplayed(this.model.solvers[t])}return this.results}progress(){return div(minus(this.time(),this.timeStart),this.timeLength).value}printStates(t){var e=parseFloat(this.time().value.toPrecision(20));if(-1==this.results.Time.indexOf(e)){for(var i=this.results.Time.length;i>0;i--)if(this.results.Time[i-1]<e){this.results.Time.splice(i,0,e);this.results.data.splice(i,0,{});break}if(0==i){this.results.Time.splice(0,0,e);this.results.data.splice(0,0,{})}}var n=this.results.data[this.results.Time.indexOf(e)];for(i=0;i<t.length;i++){var r=t[i];if(!(r instanceof State&&isDefined(n[r.id])))if(r instanceof Agents){this.results[r.id].dataMode="agents";n[r.id]={current:r.collectData()}}else{var a=r.value();if(a instanceof Vector&&!a.names){a.recurseApply((t=>this.adjustNum(r,t)));n[r.id]=a;this.results[r.id].dataMode="auto"}else if(a instanceof Vector){a.recurseApply((t=>this.adjustNum(r,t)));n[r.id]=a}else if(a instanceof Agent){n[r.id]=a;this.results[r.id].dataMode="auto"}else n[r.id]=this.adjustNum(r,a)}}}unitsToBase(t,e,i){var n=t.id+"-"+(e?e.id:"");if(n in this.unitsToBases)return this.unitsToBases[n];var r=1;i&&(r=this.timeUnits.toBase);var a=1;if(e){e.addBase();a=e.toBase}this.unitsToBases[n]=fn["/"](fn["/"](sn("#e"+a),t.dna.toBase),sn("#e"+r));return this.unitsToBases[n]}adjustNum(t,e){t.unitless&&e.units&&error(getText("The result of the calculation has units %s, but the primitive is unitless. Please set the units for the primitive so we can determine the proper output.",e.units.toString()),findID(t.id),!0);t instanceof Flow&&!t.dna.flowUnitless&&(e=mult(e,new Material(1,this.timeUnits)));return t instanceof State||!e.units&&!(t instanceof Flow)?"object"==typeof e&&"value"in e?+e.value:e:+(e=fn["*"](e.value,this.unitsToBase(t,e.units,t instanceof Flow)))}createSolver(t){var e=this,i=t.stocks,n=t.flows,r=t.actions,a=t.transitions,s=t.valued,o=t.displayed,l=t.id,u=t.timeStep,h=t.RKOrder;t.RKPosition=1;var c=u.value;if(-1==(c=c.toPrecision()).indexOf("."))var d=0;else d=c.length-c.indexOf(".")-1;for(var m=parseFloat(c.replace(".","")),f=0,g=[],p=Math.ceil((e.timeEnd.value-e.timeStart.value)/u.value),_=0;_<=p+2;_++)g.push(new Material(e.timeStart.value+_*m/Math.pow(10,d),u.units));var v=r.length;for(_=0;_<v;_++)"Condition"!==r[_].dna.trigger&&updateTrigger.call(r[_]);for(v=a.length,_=0;_<v;_++)updateTrigger.call(a[_]);function S(t,e){if(t instanceof Vector){let i=!1;t.recurseApply((function(t){i=i||e(t)}));return i}return e(t)}function N(t){return t&&S(t.toNum(),(function(t){return t instanceof Material&&t.value<0}))}function T(t,e,i){var r=n.length;let a=[];for(let o=0;o<r;o++)n[o].alpha&&n[o].alpha.dna.nonNegative&&((s=n[o].rate)&&S(s.toNum(),(function(t){return t instanceof Material&&t.value>0})))||n[o].omega&&n[o].omega.dna.nonNegative&&N(n[o].rate)?a.push(n[o]):n[o].apply(t,e,i);var s;for(let n=0;n<a.length;n++)a[n].apply(t,e,i)}if(1==h){this.tasks.addEvent((function(t,e,i){T.apply(null,arguments)}));!function i(l,u,h){e.tasks.add(new Task({time:l,expires:1,name:"RK1 Solver - "+t.id,action:function(){simulate.valuedPrimitives=[];if(h){for(var l=n.length,c=0;c<l;c++)n[c].clean();l=s.length;for(c=0;c<l;c++)s[c].clearCached()}e.frame(s,o);for(l=r.length,c=0;c<l;c++)r[c].dna.recalculate&&!r[c].block&&updateTrigger.call(r[c]);l=a.length;for(c=0;c<l;c++)a[c].dna.recalculate&&updateTrigger.call(a[c]);e.step(t);if(u&&f<=p){f++;i(g[f],!0,!0)}}}))}(this.timeStart,!0)}else{if(4!=h)throw"Unknown solution algorithm.";this.tasks.addEvent((function(t,e,i){t.value>0&&T.apply(null,arguments)}));!function u(h,c){e.tasks.add(new Task({time:h,name:"RK4 Solver (Init)  - "+t.id,priority:-10,expires:1,blocker:l+" init",action:function(){for(var e=n.length,i=0;i<e;i++)n[i].clean();simulate.valuedPrimitives=[];e=s.length;for(i=0;i<e;i++)s[i].clearCached();t.RKPosition=1;this.unblock(l+" start");this.block()}}));e.tasks.add(new Task({time:h,name:"RK4 Solver (step 1) - "+t.id,priority:-5,expires:4,blocker:l+" start",action:function(){if(t.RKPosition>1){simulate.valuedPrimitives=[];let t=s.length;for(let e=0;e<t;e++){s[e].clearCached();s[e].pastValues.pop()}}e.frame(s,o);if(4==t.RKPosition){let i=r.length;for(let t=0;t<i;t++)r[t].dna.recalculate&&!r[t].block&&updateTrigger.call(r[t]);i=a.length;for(let t=0;t<i;t++)a[t].dna.recalculate&&updateTrigger.call(a[t]);this.unblock(l+" init");c&&f<=p&&u(g[f+=2],!0);e.step(t)}else if(eq(simulate.time(),simulate.timeEnd))e.step(t);else for(var n=i.length,h=0;h<n;h++)i[h].preserveLevel();this.block();this.unblock(l+" mid")},rollback:function(){var t=i.length;for(let e=0;e<t;e++)i[e].restoreLevel()}}));e.tasks.add(new Task({time:g[f+1],name:"RK4 Solver (step 2,3) - "+t.id,priority:-10,expires:2,blocker:l+" mid",action:function(){simulate.valuedPrimitives=[];let e=s.length;for(let t=0;t<e;t++)s[t]instanceof State||s[t].clearCached();t.RKPosition++;e=n.length;for(let t=0;t<e;t++){n[t].rate=null;n[t].predict()}this.unblock(l+" start");this.block()},timeShift:function(){e.tasks.moveTo(g[f])}}));e.tasks.add(new Task({time:g[f+2],name:"RK4 Solver (step 4) - "+t.id,priority:-30,expires:1,action:function(){simulate.valuedPrimitives=[];let e=s.length;for(let t=0;t<e;t++)s[t]instanceof State||s[t].clearCached();t.RKPosition++;e=n.length;for(let t=0;t<e;t++){n[t].rate=null;n[t].predict()}this.unblock(l+" start")},timeShift:function(){e.tasks.moveTo(g[f])}}))}(this.timeStart,!0)}}}var baseSources=["Degree","Radians?","Ampere","Gram","Second","Meter","(Meters? ?Squared?|Squared? ?Meters?)","(Centimeters? ?Squared?|Squared? ?Centimeters?)","(Centimeters? ?Cubed?|Cubic ?Centimeters?)","(Meters? Cubed?|Cubic ?Meters?)","(Kilometers? ?Cubed?|Cubic ?Kilometers?)","(Inches? Squared?|Squared? ?Inches?)","(Miles? ?Squared?|Squared? ?Miles?)","(Kilometers? Squared?|Squared? ?Kilometers?)","Acre? ?(Feet|Foot)","Meters? ?per ?Seconds?","Meters? ?per ?Seconds? ?Squared?","(Foot|Feet) ?per ?Seconds?","(Foot|Feet) ?per ?Seconds? ?Squared?","Miles? ?per ?Hours?","Miles? ?per ?Hours? ?Squared?","Kilometers? ?per ?Hours?","Kilometers? ?per ?Hours? ?Squared?","Liters? ?per ?Seconds?","(Cubic ?Meters?|Meters? ?Cubed?) ?per ?Seconds?","(Squared? ?Yards?|Yards? ?Squared?)","(Squared? ?(Feet|Foot)|(Feet|Foot) ?Squared?)","(Squared? Millimeters?|Millimeters? ?Squared?)","(Millimeters? ?Cubed?|Cubic ?Millimeters?)","Gallons? ?per ?Seconds?","Gallons? ?per ?Minutes?","Pounds? ?per ?Seconds?","Kilograms? ?per ?Seconds?","Dollars? ?per ?Seconds?","Dollars? ?per ?Hours?","Dollars? ?per ?Days?","Dollars? ?per ?Weeks?","Dollars? ?per ?Months?","Dollars? ?per ?Quarters?","Dollars? ?per ?Years?","Euros? ?per ?Seconds?","Euros? ?per ?Hours?","Euros? ?per ?Days?","Euros? ?per ?Weeks?","Euros? ?per ?Months?","Euros? ?per ?Quarters?","Euros? ?per ?Years?","Centimeters?","Millimeters?","Kilometers?","Inch(es)?","(Foot|Feet)","Yards?","Miles?","Acres?","Hectares?","Liters?","Gallons?","Quarts?","Fluid ?Ounces?","Years?","Quarters?","Months?","Weeks?","Days?","Hours?","Minutes?","Kilograms?","Milligrams?","Ounces?","Pounds?","Tonnes?","Tons?","Watts?","Kilowatts?","Megawatts?","Gigawatts?","Calories?","Kilocalories?","(BTUs?|British ?Thermal ?units?)","Kilojoules?","Joules?","Coulombs?","Volts?","Millivolts?","Kilovolts?","Newtons?","Pounds? ?Force","Atoms?","Molecules?","Farads?","Pascals?","Kilopascals?","Bars?","Atmospheres?","Pounds? ?per ?Squared? ?Inch(es)?"],baseTargets=["Degrees","Degrees","Amperes","Grams","Seconds","Meters","Meters^2","Centimeters^2","Centimeters^3","Meters^3","Kilometers^3","Inches^2","Miles^2","Kilometers^2","Acres,Feet","Meters,Seconds^-1","Meters,Seconds^-2","Feet,Seconds^-1","Feet,Seconds^-2","Miles,Hours^-1","Miles,Hours^-2","Kilometers,Hours^-1","Kilometers,Hours^-2","Liters,Seconds^-1","Meters^3,Seconds^-1","Yards^2","Feet^2","Millimeters^2","Millimeters^3","Gallons,Seconds^-1","Gallons,Minutes^-1","Pounds,Seconds^-1","Kilograms,Seconds^-1","Dollars,Seconds^-1","Dollars,Hours^-1","Dollars,Days^-1","Dollars,Weeks^-1","Dollars,Months^-1","Dollars,Quarters^-1","Dollars,Years^-1","Euros,Seconds^-1","Euros,Hours^-1","Euros,Days^-1","Euros,Weeks^-1","Euros,Months^-1","Euros,Quarters^-1","Euros,Years^-1","Meters","Meters","Meters","Meters","Meters","Meters","Meters","Meters^2","Meters^2","Meters^3","Meters^3","Meters^3","Meters^3","Seconds","Seconds","Seconds","Seconds","Seconds","Seconds","Seconds","Grams","Grams","Grams","Grams","Grams","Grams","Joules,Seconds^-1","Watts","Watts","Watts","Joules","Joules","Joules","Joules","Newtons,Meters","Amperes,Seconds","Watts,Amperes^-1","Volts","Volts","Kilograms,Meters,Seconds^-2","Pounds,Feet per Second Squared","Moles","Moles","Joules,Volts^-2","Newton,Meters^-2","Pascals","Pascals","Pascals","Pascals"],baseScalings=[1,180/Math.PI,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,.01,.001,1e3,.0254,.3048,.9144,1609.344,4046.85642,1e4,.001,.003785,946e-6,3e-5,31536e3,7884e3,2628e3,604800,86400,3600,60,1e3,.001,28.349523,453.59237,1e6,907184.74,1,1e3,1e6,1e9,4.184,4184,1055.05585,1e3,1,1,1,.001,1e3,1,32.17405,0,0,1,1,1e3,1e5,101325,6894],conScalings=[],conTargets=[],conSourceNames=[],conUnitTargets=[],conSourceRegEx=[];function loadUnits(t,e,i){conScalings=i;conTargets=e;conSourceNames=t;for(var n=0;n<baseSources.length;n++){conScalings.push(baseScalings[n]);conTargets.push(baseTargets[n]);conSourceNames.push(baseSources[n])}conSourceRegEx=[];conUnitTargets=[];cachedUnits={};unitsBank={};for(var r=0;r<conTargets.length;r++){conUnitTargets.push(unitsFromString(conTargets[r].toLowerCase()));conSourceRegEx.push(new RegExp("^"+conSourceNames[r]+"$","i"))}}loadUnits([],[],[]);var cachedUnits={},findSourceIndex=function(t){if(t in cachedUnits)return cachedUnits[t];for(var e=conSourceNames.length-1;e>=0;e--)if(""!=cachedUnits[e]&&conSourceRegEx[e].test(t)){cachedUnits[t]=e;return e}cachedUnits[t]=-1;return-1};function Material(t,e){this.value=t;this.units=e}Material.prototype.toNum=function(){return this};Material.prototype.toString=function(){return this.units?"<span class='markup'>{</span>"+this.value+"&nbsp"+this.units.toString()+"<span class='markup'>}</span>":this.value+""};Material.prototype.fullClone=function(){return new Material(this.value,this.units)};Material.prototype.forceUnits=function(t){if(this.units){var e=convertUnits(this.units,t);if(0==e)unitAlert(this.units,t,"forceUnits");else{this.value=fn["*"](this.value,e);this.units=t}}else this.units=t;return this};function unitAlert(t,e,i){throw"MSG: Incompatible units for the "+i+" of "+(t?t.toString():"unitless")+" and "+(e?e.toString():"unitless")+"."}var unitsBank={};function sortAndCollapseUnits(t,e){if(t.length<=1)1==t.length&&(t[0]=t[0].toLowerCase());else{for(var i=[],n=0;n<t.length;n++)i.push({name:t[n].toLowerCase(),exponent:e[n]});i.sort((function(t,e){return t.name.localeCompare(e.name)}));t=[];e=[];for(n=0;n<i.length;n++){t.push(i[n].name);e.push(i[n].exponent)}for(n=0;n<t.length;n++){for(var r=n+1;r<t.length;r++)if(t[n]===t[r]){e[n]=e[n]+e[r];t.splice(r,1);e.splice(r,1);r--}if(0==e[n]){t.splice(n,1);e.splice(n,1);n--}}}return{names:t,exponents:e}}function getUnitStore(t,e,i){if(i){var n=sortAndCollapseUnits(t,e);t=n.names;e=n.exponents}if(0!=t.length){var r=getUnitsId(t,e);unitsBank[r]||(unitsBank[r]=new UnitStore(t,e));return unitsBank[r]}}function getUnitsId(t,e){return t.join(",")+e.join(",")}function UnitStore(t,e){this.names=t;this.exponents=e;this.toBase=null;this.baseUnits=null;this.multiples={};this.id=getUnitsId(this.names,this.exponents)}UnitStore.prototype.addBase=function(){if(!this.toBase){this.toBase=1;for(var t=this.names.slice(),e=this.exponents.slice(),i=!0;i;){i=!1;for(var n=t.length-1;n>=0;n--){var r=findSourceIndex(t[n]);if(-1!==r&&(1!=conUnitTargets[r].names.length||conUnitTargets[r].names[0]!=t[n])){this.toBase=fn["*"](this.toBase,fn.expt(conScalings[r],e[n]));(t=t.concat(conUnitTargets[r].names)).splice(n,1);(e=e.concat(conUnitTargets[r].exponents.map((function(t){return t*e[n]})))).splice(n,1);i=!0;break}}}var a=sortAndCollapseUnits(t,e);this.baseUnits=getUnitStore(a.names,a.exponents)}};UnitStore.prototype.power=function(t){for(var e=this.names.slice(),i=this.exponents.slice(),n=0;n<i.length;n++)i[n]=i[n]*t;return getUnitStore(e,i)};UnitStore.prototype.toStringShort=function(){for(var t="",e=0;e<this.names.length;e++){""!=t&&(t+=",");t+=this.names[e];1!=this.exponents[e]&&(t=t+"^"+this.exponents[e])}return t};UnitStore.prototype.multiply=function(t,e){var i=t.id+";"+e;if(!this.multiples[i]){this.toBase||this.addBase();t.toBase||t.addBase();if(this.baseUnits){var n=this.baseUnits.names.slice(),r=this.baseUnits.exponents.slice();if(t.baseUnits){for(var a=0;a<t.baseUnits.names.length;a++){var s=n.indexOf(t.baseUnits.names[a]);if(-1!=s)r[s]=r[s]+t.baseUnits.exponents[a]*e;else{for(var o=!1,l=0;l<n.length;l++)if(t.baseUnits.names[a]<n[l]){n.splice(l,0,t.baseUnits.names[a]);r.splice(l,0,t.baseUnits.exponents[a]*e);o=!0;break}if(!o){n.push(t.baseUnits.names[a]);r.push(t.baseUnits.exponents[a]*e)}}}for(a=r.length-1;a>=0;a--)if(0==r[a]){r.splice(a,1);n.splice(a,1)}}}else n=t.baseUnits.names.slice(),r=t.baseUnits.exponents.slice();this.multiples[i]=getUnitStore(n,r)}return this.multiples[i]};function unitsFromString(t){var e=[],i=[];if(""!=t)for(var n=t.split(","),r=0;r<n.length;r++){e.push(n[r].split("^")[0]);-1!=n[r].indexOf("^")?i.push(parseFloat(n[r].split("^")[1])):i.push(1)}return getUnitStore(e,i,!0)}var titleCaseReg=/\w\S*/g,titleCaseFunc=function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()},BigInteger;function toTitleCase(t){return t.replace(titleCaseReg,titleCaseFunc)}UnitStore.prototype.toString=function(){for(var t="",e="",i=0,n=0,r=0;r<this.names.length;r++)if(""!=this.names[r]){var a='<span class="unit">'+toTitleCase(this.names[r])+"</span>";1!=this.exponents[r]&&-1!=this.exponents[r]&&(a=a+"<span class='markup'>^</span><sup>"+Math.abs(this.exponents[r])+"</sup>");if(this.exponents[r]>0){i>0&&(t+="<span class='markup'>*</span>");t+=a;i+=1}else{n>0&&(e+="<span class='markup'>*</span>");e+=a;n+=1}}""==t&&(t="Unitless");if(""==e)return'<div class="units">'+t+"</div>";"Unitless"==t&&(t="1");return'<span class="units">'+t+"<hr/><span class='markup'>/(</span>"+e+"<span class='markup'>)</span></span>"};function convertUnits(t,e,i){if(t===e)return 1;if(t&&!e||e&&!t)return i?1:0;t.toBase||t.addBase();e.toBase||e.addBase();return t.baseUnits!==e.baseUnits?0:fn["/"](t.toBase,e.toBase)}BigInteger="undefined"!=typeof require?require("biginteger").BigInteger:this.BigInteger;if(!BigInteger)if("undefined"!=typeof load)load("biginteger.js");else{if(!this.readFile)throw new Error("BigInteger is not defined.");eval(this.readFile("biginteger.js"))}var SchemeNumber=function(){var t=Math.abs,e=Math.floor,i=Math.ceil,r=Math.round,a=Math.pow,s=Math.sqrt,o=Math.atan2,l=(Math.log,Math.exp),u=(Math.atan,Math.cos,Math.sin,Math.tan,Math.LN2),h=Math.LN10,c=isFinite,d=isNaN,m=parseInt,f=parseFloat;function g(){return!1}function p(){return!0}function _(t){return t}function v(){return this}function S(){throw new Error("BUG: unimplemented")}function N(){throw new Error("BUG: Abstract method not overridden for "+this)}function T(){}T.prototype=new Number;function b(){}b.prototype=new T;function E(){}E.prototype=new b;function F(){}F.prototype=new E;function k(){}k.prototype=new F;function L(){}L.prototype=new k;var w,x,y,A=/^(.*[^a-zA-Z]|)([-+].*)i$/,O=/^(.*)([-+].*)i$/,R=/^[-+](nan|inf)\.0$/,P=/[eEsSfFdDlL]/,C=/^([0-9]+\.?|[0-9]*\.[0-9]+)([eEsSfFdDlL][-+]?[0-9]+)?$/,M={2:/^[01]+$/,8:/^[0-7]+$/,10:/^[0-9]+$/,16:/^[0-9a-fA-F]+$/};function I(){return se}function B(){return oe}function D(){ft("&assertion","division by exact zero")}var V,U={},W=[[],["log","floor","ceil","sqrt","abs","atan","cos","sin","tan","exp"],["pow","atan2"]];if((w=function(t){this._=t})===Number){x=_;y=function(t){return t instanceof Number||"number"==typeof t};W[1].concat(W[2]).forEach((function(t){U[t]=Math[t]}))}else{w.prototype=new E;V=new w(0),x=function(t){return 0===t?V:new w(t)};y=function(t){return t instanceof T};W[1].forEach((function(t){var e=Math[t];U[t]=function(t){return x(e(t))}}));W[2].forEach((function(t){var e=Math[t];U[t]=function(t,i){return x(e(t,i))}}));["toFixed","toExponential","toPrecision"].forEach((function(t){var e=Number.prototype[t];w.prototype[t]=function(t){return e.call(this._)}}));w.prototype.valueOf=function(){return this._}}function G(t){if(t instanceof T)return t;var e=t;if("string"!=typeof e){if("number"==typeof e)return x(e);if(e instanceof Number)return x(+e);if(null==e)return null===e?Pt:It;if("number"==typeof(e=e.valueOf()))return x(e);e=String(e)}!1===(e=lt(e))&&ft("&assertion","not a number",t);return e}var q=G;q.VERSION=[1,1,4];var j=U.pow,z=U.log,H=U.floor,K=U.ceil,Q=U.sqrt,Y=U.atan2,X=U.abs,Z=U.atan,J=U.cos,$=U.sin,tt=U.tan,et=U.exp,it={C:["Rectangular","R"],R:["Flonum","ER"],ER:["EQ"],EQ:["EQFraction","EI"],EI:["EINative","EIBig"]},nt={C:b,R:E,ER:F,EQ:k,EI:L,Rectangular:Qt,Flonum:w,EQFraction:ie,EINative:ae,EIBig:Ne},rt={};for(var at in nt)rt[at]={};var st,ot=new Object;function lt(i,n,r){function a(){throw ot}function s(t){void 0!==r&&a();r=t}function o(t){n&&a();n=t}function l(t,e){M[n].test(t)||a();return!1===r?x(e*m(t,n)):ne(e,t,n)}function h(i){if(R.test(i)){r&&a();switch(i){case"+inf.0":return Ct;case"-inf.0":return Mt;default:return It}}var s=1;switch(i[0]){case"-":s=-1;case"+":i=i.substring(1)}var o=i.indexOf("/");if(-1!=o)return l(i.substring(0,o),s).SN_divide(l(i.substring(o+1),1));10!==n&&a();var h=i.indexOf("|");if(-1!==h){var c=i.substring(h+1);M[10].test(c)||a();i=i.substring(0,h);var d=m(c,10);if(0===d)i="0.0";else if(d<53)return function(i,s){var o=lt(i,n,!0);!1!==o&&o.SN_isReal()||a();if(!o.SN_isZero()){var l=o.SN_abs(),h=s-e(l.SN_log()/u)-1,c=ue.SN_expt(me(t(h)));h<0&&(c=c.SN_reciprocal());for(var d=l.SN_multiply(c),m=ue.SN_expt(me(s));d.SN_ge(m);){d=d.SN_divide(ue);c=c.SN_divide(ue)}for(var f=d.SN_add(d);f.SN_lt(m);f=d.SN_add(d)){d=f;c=c.SN_add(c)}var g=d.SN_round().SN_divide(c);o.SN_isNegative()&&(g=g.SN_negate());o=g}r||(o=o.SN_toInexact());return o}(i,d)}var g=(i=i.replace(P,"e")).indexOf("."),p=i.indexOf("e");if(-1===g&&-1===p)return l(i,s);C.test(i)||a();if(!r)return x(s*f(i));var _,v=i.substring(0,-1===g?p:g),S=0;if(-1===p)_=i.substring(g+1);else{_=-1===g?"":i.substring(g+1,p);S=m(i.substring(p+1),10)}return function(t,e,i){return ne(t,e).SN__exp10(i)}(s,v+_,S-_.length)}if(!n||10==n){if(/^-?[0-9]{1,15}$/.test(i))return!1===r?x(m(i,10)):me(m(i,10));n=10}var c=0;try{for(;"#"===i[c];){switch(i[c+1]){case"i":case"I":s(!1);break;case"e":case"E":s(!0);break;case"b":case"B":o(2);break;case"o":case"O":o(8);break;case"d":case"D":o(10);break;case"x":case"X":o(16);break;default:return!1}c+=2}return function(t){var e=t.indexOf("@");if(-1!==e){var i=ht(h(t.substring(0,e)),h(t.substring(e+1)));r&&i.SN_isInexact()&&(i=i.SN_toExact());return i}if("i"!==t[t.length-1])return h(t);if("i"===t)return!1===r?Ht(Pt,x(1)):ce;if("-i"===t)return!1===r?Ht(Pt,x(-1)):de;var a,s,o=(10===n?A:O).exec(t);if(o){a=o[1];s=o[2];a=a?h(a):!1===r?Pt:se;s="+"===s?oe:"-"===s?le:h(s)}else{a=!1===r?Pt:se;s=h(t.substring(0,t.length-1))}return ut(a,s)}(i.substring(c))}catch(t){if(t===ot)return!1;null==i&&ft("&assertion","missing argument");throw t}}function ut(t,e){return t.SN_isExact()&&e.SN_isExact()?zt(t,e):Ht(t.SN_toInexact(),e.SN_toInexact())}function ht(t,e){return Ht(t.SN_multiply(e.SN_cos()),t.SN_multiply(e.SN_sin()))}function ct(t){t.SN_isReal()||ft("&assertion","not a real number",t);return t}function dt(t){(t=G(t)).SN_isReal()||ct(t);return t}q.raise=mt;function mt(t,e,i){var n="SchemeNumber: "+t+": "+e;if(arguments.length>2){y(i)&&(i=i.SN_numberToString());n+=": "+i}throw new Error(n)}function ft(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];G.raise.apply(G,e);mt.apply(this,e)}G.maxIntegerDigits=1e6;q.fn={"eqv?":function(t,e){2===arguments.length||_t(arguments);if(t===e)return!0;t=G(t);e=G(e);return t.SN_eq(e)&&t.SN_isExact()===e.SN_isExact()},"number?":function(t){1===arguments.length||pt(arguments);return y(t)},"complex?":function(t){1===arguments.length||pt(arguments);return y(t)&&t.SN_isComplex()},"real?":function(t){1===arguments.length||pt(arguments);return y(t)&&t.SN_isReal()},"rational?":function(t){1===arguments.length||pt(arguments);return y(t)&&t.SN_isRational()},"integer?":function(t){1===arguments.length||pt(arguments);return y(t)&&t.SN_isInteger()},"real-valued?":Nt,"rational-valued?":function(t){1===arguments.length||pt(arguments);return Nt(t)&&t.SN_realPart().SN_isRational()},"integer-valued?":function(t){1===arguments.length||pt(arguments);return Nt(t)&&t.SN_realPart().SN_isInteger()},"exact?":Tt("SN_isExact"),"inexact?":Tt("SN_isInexact"),inexact:Tt("SN_toInexact"),exact:Tt("SN_toExact"),"=":function(t,e){var i=arguments.length;i>1||St(arguments);t=G(t);for(var n=1;n<i;n++)if(!t.SN_eq(G(arguments[n])))return!1;return!0},"<":bt("SN_lt"),">":bt("SN_gt"),"<=":bt("SN_le"),">=":bt("SN_ge"),"zero?":Tt("SN_isZero"),"positive?":Tt("SN_isPositive"),"negative?":Tt("SN_isNegative"),"odd?":Tt("SN_isOdd"),"even?":Tt("SN_isEven"),"finite?":Tt("SN_isFinite"),"infinite?":Tt("SN_isInfinite"),"nan?":Tt("SN_isNaN"),max:Et("SN_gt"),min:Et("SN_lt"),"+":function(){for(var t=se,e=arguments.length,i=0;i<e;)t=t.SN_add(G(arguments[i++]));return t},"*":function(){for(var t=oe,e=arguments.length,i=0;i<e;)t=t.SN_multiply(G(arguments[i++]));return t},"-":function(t){var e=arguments.length;switch(e){case 0:vt(arguments);case 1:return G(t).SN_negate()}for(var i=G(t),n=1;n<e;)i=i.SN_subtract(G(arguments[n++]));return i},"/":function(t){var e=arguments.length;switch(e){case 0:vt(arguments);case 1:return G(t).SN_reciprocal();case 2:return G(t).SN_divide(G(arguments[1]))}for(var i=oe,n=1;n<e;)i=i.SN_multiply(G(arguments[n++]));return G(t).SN_divide(i)},abs:Tt("SN_abs"),"div-and-mod":kt(!1,2),div:kt(!1,0),mod:kt(!1,1),"div0-and-mod0":kt(!0,2),div0:kt(!0,0),mod0:kt(!0,1),gcd:function(t){for(var e=se,i=t.length,n=!0,r=0;r<i;r++){var a=toInteger(t[r]);n=n&&a.SN_isExact();e=Ee(e,a.SN_abs().SN_toExact())}e=e.SN_abs();return n?e:e.SN_toInexact()},lcm:function(t){for(var e=oe,i=t.length,n=!0,r=0;r<i;r++){var a=toInteger(t[r]);n=n&&a.SN_isExact();a=a.SN_abs().SN_toExact();e=e.SN_multiply(a).SN_divide(Ee(e,a.SN_abs()))}return n?e:e.SN_toInexact()},numerator:Tt("SN_numerator"),denominator:Tt("SN_denominator"),floor:Tt("SN_floor"),ceiling:Tt("SN_ceiling"),truncate:Tt("SN_truncate"),round:Tt("SN_round"),rationalize:function(t,e){_t(arguments);t=G(t);e=G(e);if(!t.SN_isFinite()||!e.SN_isFinite()){ct(t);ct(e);return e.SN_isInfinite()?t.SN_isFinite()?Pt:It:e.SN_isNaN()?e:t}if(e.SN_isZero())return t;e=e.SN_abs();var i=t.SN_subtract(e),n=t.SN_add(e),r=i.SN_floor(),a=n.SN_floor();if(r.SN_ne(a)){var s=r.SN_isNegative();return a.SN_isNegative()!=s?r.SN_isExact()?se:Pt:s?a:i.SN_ceiling()}var o=[];for(;!(i=i.SN_subtract(r)).SN_isZero()&&!(n=n.SN_subtract(r)).SN_isZero();){i=i.SN_reciprocal();n=n.SN_reciprocal();switch((r=i.SN_floor()).SN_compare(n.SN_floor())){case-1:o.push(i.SN_ceiling());break;case 1:o.push(n.SN_ceiling());break;case 0:default:o.push(r);continue}break}var l=se,u=o.length;for(;u--;)l=l.SN_add(o[u]).SN_reciprocal();return l.SN_add(a)},exp:Tt("SN_exp"),log:function(t,e){var i=G(t).SN_log();switch(arguments.length){case 2:(i=i.SN_divide(G(e).SN_log()))._=parseFloat(i._.toPrecision(15));case 1:return i;default:gt("1-2",arguments)}},sin:Tt("SN_sin"),cos:Tt("SN_cos"),tan:Tt("SN_tan"),asin:Tt("SN_asin"),acos:Tt("SN_acos"),atan:function(t,e){switch(arguments.length){case 1:return G(t).SN_atan();case 2:return dt(t).SN_atan2(dt(e));default:gt("1-2",arguments)}},sqrt:Tt("SN_sqrt"),"exact-integer-sqrt":Tt("SN_exactIntegerSqrt"),expt:(st="SN_expt",function(t,e){2===arguments.length||_t(arguments);return G(t)[st](G(e))}),"make-rectangular":function(t,e){2===arguments.length||_t(arguments);return ut(dt(t),dt(e))},"make-polar":function(t,e){2===arguments.length||_t(arguments);return ht(dt(t),dt(e))},"real-part":Tt("SN_realPart"),"imag-part":Tt("SN_imagPart"),magnitude:Tt("SN_magnitude"),angle:Tt("SN_angle"),"number->string":function(t,e,i){var n=e;switch(arguments.length){case 3:i=toInteger(i);assertExact(i);case 2:n=assertExact(toInteger(n)).valueOf();M[n]||ft("&assertion","invalid radix",e);case 1:break;default:gt("1-3",arguments)}return G(t).SN_numberToString(n,i)},"string->number":function(t,e){switch(arguments.length){case 1:case 2:return lt(String(t),e);default:gt("1-2",arguments)}}};function gt(t,e){var i="Function";for(name in fn)if(fn[name]===e.callee){i+=" '"+name+"'";break}ft("&assertion",i+" expected "+t+" argument"+("1"==t?"":"s")+", got "+e.length)}function pt(t){1===t.length||gt(1,t)}function _t(t){2===t.length||gt(2,t)}function vt(t){t.length>0||gt("1 or more",t)}function St(t){t.length>1||gt("2 or more",t)}function Nt(t){1===arguments.length||pt(arguments);return y(t)&&t.SN_imagPart().SN_isZero()}function Tt(t){return function(e){1===arguments.length||pt(arguments);return G(e)[t]()}}function bt(t){return function(e,i){var n=arguments.length;n>1||St(arguments);i=dt(i);if(!dt(e)[t](i))return!1;for(var r=2;r<n;r++){var a=dt(arguments[r]);if(!i[t](a))return!1;i=a}return!0}}function Et(t){return function(e){var i=arguments.length;i>0||vt(arguments);for(var n=dt(e),r=n.SN_isExact(),a=1;a<i;a++){var s=dt(arguments[a]);if(s.SN_isNaN())return s;r&&((r=s.SN_isExact())||(n=n.SN_toInexact()));!1!==s[t](n)&&(n=s)}return r?n:n.SN_toInexact()}}function Ft(t){ft("&assertion","div/mod second argument is zero",t)}function kt(t,e){return function(i,n){2===arguments.length||_t(arguments);i=dt(i);n=dt(n);i.SN_isFinite()||ft("&assertion","div/mod first argument is not finite",i);n.SN_isZero()&&Ft(n);if(!t)switch(e){case 0:return i.SN_div(n);case 1:return i.SN_mod(n);case 2:default:return i.SN_divAndMod(n)}var r=i.SN_divAndMod(n),a=r[1],s=n.SN_abs();if(a.SN_add(a).SN_ge(s))switch(e){case 0:return r[0].SN_add(n.SN_isNegative()?le:oe);case 1:return a.SN_subtract(s);case 2:default:return[r[0].SN_add(n.SN_isNegative()?le:oe),a.SN_subtract(s)]}switch(e){case 0:return r[0];case 1:return a;case 2:default:return r}}}rt.Flonum.SN_isExact=g;rt.Flonum.SN_isInexact=p;rt.Flonum.SN_isComplex=p;rt.Flonum.SN_isReal=p;rt.Flonum.SN_debug=function(){return"Flonum("+this.SN_numberToString()+")"};function Lt(t){return t.toString(2)}function wt(e){var i=Lt(t(e)),n=i.indexOf(".");return-1===n?0:i.length-n-1}function xt(t){return a(2,wt(t))}rt.Flonum.SN_numberToString=function(t,e){if(t&&10!=t&&c(this))return"#i"+this.SN_toExact().SN_numberToString(t);if(!c(this))return d(this)?"+nan.0":this>0?"+inf.0":"-inf.0";var i=(+this).toString();if(-1===i.indexOf(".")){var n=i.indexOf("e");-1===n?i+=".":i=i.substring(0,n)+"."+i.substring(n)}if(null!=e){if(e<53){var r=Lt(+this).replace(/[-+.]/g,"").replace(/^0+/,"").replace(/0+$/,"").length;e<r&&(e=r)}i+="|"+e}return i};rt.Flonum.SN_realPart=v;rt.Flonum.SN_imagPart=function(){return se};rt.Flonum.SN_denominator=function(){return j(2,wt(+assertRational(this)))};rt.Flonum.SN_numerator=function(){return x(this*xt(+assertRational(this)))};rt.Flonum.SN_isInteger=function(){return c(this)&&this==e(this)};rt.Flonum.SN_isFinite=function(){return c(this)};rt.Flonum.SN_isRational=rt.Flonum.SN_isFinite;rt.Flonum.SN_isZero=function(){return 0==this};rt.Flonum.SN_isPositive=function(){return this>0};rt.Flonum.SN_isNegative=function(){return this<0};rt.Flonum.SN_sign=function(){return 0==this?0:this>0?1:-1};rt.Flonum.SN_isUnit=function(){return 1==this||-1==this};rt.Flonum.SN_isInfinite=function(){return!c(this)&&!d(this)};rt.Flonum.SN_isNaN=function(){return d(this)};rt.Flonum.SN_isEven=function(){return 0==(1&this)};rt.Flonum.SN_isOdd=function(){return 1==(1&this)};rt.Flonum.SN_eq=function(t){return t.SN__eq_Flonum(this)};rt.Flonum.SN_ne=function(t){return t.SN__ne_Flonum(this)};rt.Flonum.SN_gt=function(t){return ct(t).SN__gt_Flonum(this)};rt.Flonum.SN_lt=function(t){return ct(t).SN__lt_Flonum(this)};rt.Flonum.SN_ge=function(t){return ct(t).SN__ge_Flonum(this)};rt.Flonum.SN_le=function(t){return ct(t).SN__le_Flonum(this)};rt.Flonum.SN_compare=function(t){return ct(t).SN__compare_Flonum(this)};rt.Flonum.SN__eq_R=function(t){return+t==this};rt.Flonum.SN__ne_R=function(t){return+t!=this};rt.Flonum.SN__gt_R=function(t){return t>this};rt.Flonum.SN__lt_R=function(t){return t<this};rt.Flonum.SN__ge_R=function(t){return t>=this};rt.Flonum.SN__le_R=function(t){return t<=this};rt.Flonum.SN__compare_R=function(t){return+t==this?0:t<this?-1:t>this?1:NaN};function yt(t){return t<9007199254740992&&t>-9007199254740992?me(t):new Ne(function(t){return BigInteger.parse(t.toString(16),16)}(t))}rt.Flonum.SN_toExact=function(){return function(t){c(t)||ft("&implementation-violation","inexact argument has no reasonably close exact equivalent",t);var e,i=xt(t);if(1===i)return yt(t);if(c(i)){e=t*i;i=yt(i)}else{var n=wt(t);e=9007199254740992*t;e*=a(2,n-53);i=ue.SN_expt(me(n))}return ee(yt(e),i)}(+this)};rt.Flonum.SN_toInexact=v;rt.Flonum.SN_add=function(t){return t.SN__add_Flonum(this)};rt.Flonum.SN_subtract=function(t){return t.SN__subtract_Flonum(this)};rt.Flonum.SN_multiply=function(t){return t.SN__multiply_Flonum(this)};rt.Flonum.SN_divide=function(t){return t.SN__divide_Flonum(this)};rt.Flonum.SN__add_R=function(t){return x(t+this)};rt.Flonum.SN__subtract_R=function(t){return x(t-this)};rt.Flonum.SN__multiply_R=function(t){return x(t*this)};rt.Flonum.SN__divide_R=function(t){return x(t/this)};rt.Flonum.SN_negate=function(){return x(-this)};rt.Flonum.SN_abs=function(){return this<0?x(-this):this};rt.Flonum.SN_reciprocal=function(){return x(1/this)};function At(t,n){if(n>0)return e(t/n);if(n<0)return i(t/n);0==n&&Ft(x(n));return NaN}rt.Flonum.SN_divAndMod=function(t){var e=At(this,t=+t);return[x(e),x(this-t*e)]};rt.Flonum.SN_div=function(t){return x(At(this,t))};rt.Flonum.SN_mod=function(t){return x(this-t*At(this,t))};rt.Flonum.SN_square=function(){return x(this*this)};rt.Flonum.SN_round=function(){var t=e(this),i=this-t;return x(i<.5?t:i>.5?t+1:2*r(this/2))};rt.Flonum.SN_truncate=function(){return this<0?K(this):H(this)};rt.Flonum.SN_ceiling=function(){return K(this)};function Ot(t){return function(){return t(this)}}rt.Flonum.SN_abs=Ot(X);rt.Flonum.SN_atan=Ot(Z);rt.Flonum.SN_cos=function(){return sn(J(this)._.toFixed(15))};rt.Flonum.SN_exp=Ot(et);rt.Flonum.SN_floor=Ot(H);rt.Flonum.SN_sin=function(){return sn($(this)._.toFixed(15))};rt.Flonum.SN_tan=function(){return sn(tt(this)._.toFixed(15))};function Rt(t,e){return function(){var i=t(this);return d(i)?e(this):x(i)}}rt.Flonum.SN_acos=Rt(Math.acos,Ut);rt.Flonum.SN_asin=Rt(Math.asin,Vt);rt.Flonum.SN_log=function(){return this<0?Dt(this):z(this)};rt.Flonum.SN_sqrt=function(){return this>=0?x(s(this)):d(this)?this:Ht(Pt,Q(-this))};rt.Flonum.SN_atan2=function(t){return Y(this,t)};rt.Flonum.SN_expt=function(t){return t.SN__expt_Flonum(this)};var Pt=x(0),Ct=x(Number.POSITIVE_INFINITY),Mt=x(Number.NEGATIVE_INFINITY),It=x(Number.NaN),Bt=x(Math.PI);rt.C.SN_isReal=g;rt.C.SN_isRational=g;rt.C.SN_isInteger=g;rt.C.SN_isZero=g;rt.C.SN_isUnit=g;rt.C.SN_isComplex=p;rt.C.SN_numberToString=N;rt.C.toString=function(t){return this.SN_numberToString(t)};rt.C.valueOf=function(){return this.SN_imagPart().SN_isZero()?this.SN_realPart().valueOf():NaN};rt.C.toFixed=N;rt.C.toExponential=N;rt.C.toPrecision=N;rt.C.toLocaleString=function(){return this.toString()};rt.C.SN_debug=function(){return"C"};rt.C.SN_sqrt=function(){return ht(this.SN_magnitude().SN_sqrt(),this.SN_angle().SN_divide(ue))};function Dt(t){return ut(t.SN_magnitude().SN_log(),t.SN_angle())}function Vt(t){return de.SN_multiply(ce.SN_multiply(t).SN_add(oe.SN_subtract(t.SN_square()).SN_sqrt()).SN_log())}function Ut(t){return Bt.SN_divide(ue).SN_subtract(Vt(t))}rt.C.SN_log=function(){return Dt(this)};rt.C.SN_asin=function(){return Vt(this)};rt.C.SN_acos=function(){return Ut(this)};rt.C.SN_atan=function(){return t=this,e=ce.SN_multiply(t),oe.SN_add(e).SN_log().SN_subtract(oe.SN_subtract(e).SN_log()).SN_divide(ue).SN_divide(ce);var t,e};rt.C.SN_sin=function(){var t=ce.SN_multiply(this);return t.SN_exp().SN_subtract(t.SN_negate().SN_exp()).SN_divide(ue).SN_divide(ce)};rt.C.SN_cos=function(){var t=ce.SN_multiply(this);return t.SN_exp().SN_add(t.SN_negate().SN_exp()).SN_divide(ue)};rt.C.SN_tan=function(){return this.SN_sin().SN_divide(this.SN_cos())};rt.R.SN_isReal=p;rt.R.SN_debug=function(){return"R"};rt.R.SN_realPart=v;rt.R.SN_magnitude=function(){return this.SN_abs()};rt.R.SN_angle=function(){return this.SN_isNegative()?Bt:se};rt.R.SN__eq_Flonum=rt.Flonum.SN__eq_R;rt.R.SN__ne_Flonum=rt.Flonum.SN__ne_R;rt.R.SN__eq_Rectangular=function(t){return t._y.SN_isZero()&&t._x.SN_eq(this)};rt.R.SN__ne_Rectangular=function(t){return!t._y.SN_isZero()||t._x.SN_ne(this)};rt.R.SN__gt_Flonum=rt.Flonum.SN__gt_R;rt.R.SN__lt_Flonum=rt.Flonum.SN__lt_R;rt.R.SN__ge_Flonum=rt.Flonum.SN__ge_R;rt.R.SN__le_Flonum=rt.Flonum.SN__le_R;rt.R.SN__compare_Flonum=rt.Flonum.SN__compare_R;rt.R.SN_compare=N;rt.R.SN_gt=function(t){return this.SN_compare(t)>0};rt.R.SN_lt=function(t){return this.SN_compare(t)<0};rt.R.SN_ge=function(t){return this.SN_compare(t)>=0};rt.R.SN_le=function(t){return this.SN_compare(t)<=0};rt.R.SN_add=function(t){return t.SN__add_R(this)};rt.R.SN__add_Flonum=rt.Flonum.SN__add_R;rt.R.SN_subtract=function(t){return t.SN__subtract_R(this)};rt.R.SN__subtract_Flonum=rt.Flonum.SN__subtract_R;rt.R.SN_multiply=function(t){return t.SN__multiply_R(this)};rt.R.SN__multiply_Flonum=rt.Flonum.SN__multiply_R;rt.R.SN_divide=function(t){return t.SN__divide_R(this)};rt.R.SN__divide_Flonum=rt.Flonum.SN__divide_R;function Wt(t,e){if(t.SN_isZero()){if(e.SN_isZero())return x(1);if(e.SN_realPart().SN_isPositive())return Pt;ft("&implementation-restriction","invalid power for zero expt",e)}return t.SN_log().SN_multiply(e).SN_exp()}rt.R.SN__expt_R=function(t){return t.SN_isNegative()?Wt(t,this):j(t,this)};rt.R.SN__expt_EI=rt.R.SN__expt_R;rt.R.SN__expt_EQ=function(t){if(t.SN_isNegative())return Wt(t,this);var e=t.SN_numerator().SN_expt(this),i=t.SN_denominator().SN_expt(this);return e.SN_isExact()&&e.SN_isInteger()&&i.SN_isExact()&&i.SN_isInteger()?new ie(e,i):e.SN_divide(i)};function Gt(t,e){var i=qt(t,e);return[i,t.SN_subtract(i.SN_multiply(e))]}function qt(t,e){return e.SN_isNegative()?t.SN_divide(e).SN_ceiling():t.SN_divide(e).SN_floor()}function jt(t,e){return t.SN_subtract(qt(t,e).SN_multiply(e))}rt.R.SN_divAndMod=function(t){return Gt(this,t)};rt.R.SN_div=function(t){return qt(this,t)};rt.R.SN_mod=function(t){return jt(this,t)};rt.R.SN__divAndMod_R=function(t){return Gt(t,this)};rt.R.SN__div_R=function(t){return qt(t,this)};rt.R.SN__mod_R=function(t){return jt(t,this)};["sqrt","exp","log","sin","cos","tan","asin","acos","atan","atan2"].forEach((function(t){rt.R["SN_"+t]=rt.Flonum["SN_"+t]}));function zt(t,e){return e.SN_isZero()?t:t.SN_isZero()&&e.SN_isUnit()?e.SN_isPositive()?ce:de:new Qt(t,e)}function Ht(t,e){return new Qt(t,e)}function Kt(t,e){return t.SN_isExact()?zt(t,e):new Qt(t,e)}function Qt(t,e){this._x=t;this._y=e}Qt.prototype=new b;function Yt(t,e){return"-"===e[0]||"+"===e[0]?t+e+"i":t+"+"+e+"i"}rt.Rectangular.SN_numberToString=function(t,e){return Yt(this._x.SN_numberToString(t,e),this._y.SN_numberToString(t,e))};rt.Rectangular.toString=function(t){t=t||10;return Yt(this._x.toString(t),this._y.toString(t))};rt.Rectangular.SN_debug=function(){return"Rectangular("+this._x.SN_debug()+", "+this._y.SN_debug()+")"};rt.Rectangular.toFixed=function(t){return Yt(this._x.toFixed(t),this._y.toFixed(t))};rt.Rectangular.toExponential=function(t){return Yt(this._x.toExponential(t),this._y.toExponential(t))};rt.Rectangular.toPrecision=function(t){return Yt(this._x.toPrecision(t),this._y.toPrecision(t))};rt.Rectangular.SN_realPart=function(){return this._x};rt.Rectangular.SN_imagPart=function(){return this._y};rt.Rectangular.SN_isExact=function(){return this._x.SN_isExact()};rt.Rectangular.SN_isInexact=function(){return this._x.SN_isInexact()};rt.Rectangular.SN_toInexact=function(){return this._x.SN_isInexact()?this:Ht(this._x.SN_toInexact(),this._y.SN_toInexact())};rt.Rectangular.SN_toExact=function(){return this._x.SN_isExact()?this:zt(this._x.SN_toExact(),this._y.SN_toExact())};rt.Rectangular.SN_isZero=function(){return this._x.SN_isZero()&&this._y.SN_isZero()};function Xt(t){return t._x.SN_square().SN_add(t._y.SN_square())}rt.Rectangular.SN_isUnit=function(){return Xt(this).SN_eq(oe)};rt.Rectangular.SN_magnitude=function(){return this._x.SN_isZero()?this._y.SN_abs():Xt(this).SN_sqrt()};rt.Rectangular.SN_angle=function(){return this._y.SN_atan2(this._x)};rt.C.SN__eq_Rectangular=N;rt.Rectangular.SN_eq=function(t){return t.SN__eq_Rectangular(this)};rt.Rectangular.SN__eq_Rectangular=function(t){return t._x.SN_eq(this._x)&&t._y.SN_eq(this._y)};rt.Rectangular.SN__eq_R=function(t){return this._y.SN_isZero()&&t.SN_eq(this._x)};rt.C.SN__ne_Rectangular=N;rt.Rectangular.SN_ne=function(t){return t.SN__ne_Rectangular(this)};rt.Rectangular.SN__ne_Rectangular=function(t){return t._x.SN_ne(this._x)||t._y.SN_ne(this._y)};rt.Rectangular.SN__ne_R=function(t){return!this._y.SN_isZero()||t.SN_ne(this._x)};rt.Flonum.SN__add_Rectangular=function(t){return Ht(x(t._x+this),t._y.SN_toInexact())};rt.Flonum.SN__subtract_Rectangular=function(t){return Ht(x(t._x-this),t._y.SN_toInexact())};rt.Flonum.SN__multiply_Rectangular=function(t){return Ht(x(t._x*this),x(t._y*this))};rt.Flonum.SN__divide_Rectangular=function(t){return Ht(x(t._x/this),x(t._y/this))};rt.Flonum.SN__expt_Rectangular=function(t){return ht(j(Xt(t),this/2),x(o(t._y,t._x)*this))};rt.R.SN__add_Rectangular=function(t){return ut(t._x.SN_add(this),t._y)};rt.R.SN__subtract_Rectangular=function(t){return ut(t._x.SN_subtract(this),t._y)};rt.R.SN__multiply_Rectangular=function(t){return Kt(t._x.SN_multiply(this),t._y.SN_multiply(this))};rt.R.SN__divide_Rectangular=function(t){return Kt(t._x.SN_divide(this),t._y.SN_divide(this))};rt.C.SN__add_Rectangular=N;rt.Rectangular.SN_add=function(t){return t.SN__add_Rectangular(this)};rt.Rectangular.SN__add_R=function(t){return ut(t.SN_add(this._x),this._y)};rt.Rectangular.SN__add_Rectangular=function(t){var e=t._x.SN_add(this._x),i=t._y.SN_add(this._y);return(e.SN_isExact()?zt:Ht)(e,i)};rt.Rectangular.SN_negate=function(){return Kt(this._x.SN_negate(),this._y.SN_negate())};rt.C.SN__subtract_Rectangular=N;rt.Rectangular.SN_subtract=function(t){return t.SN__subtract_Rectangular(this)};rt.Rectangular.SN__subtract_R=function(t){return ut(t.SN_subtract(this._x),this._y.SN_negate())};rt.Rectangular.SN__subtract_Rectangular=function(t){var e=t._x.SN_subtract(this._x),i=t._y.SN_subtract(this._y);return(e.SN_isExact()?zt:Ht)(e,i)};rt.C.SN__multiply_Rectangular=N;rt.Rectangular.SN_multiply=function(t){return t.SN__multiply_Rectangular(this)};rt.Rectangular.SN__multiply_R=function(t){return Kt(t.SN_multiply(this._x),t.SN_multiply(this._y))};function Zt(t,e,i,n){return Kt(t.SN_multiply(i).SN_subtract(e.SN_multiply(n)),t.SN_multiply(n).SN_add(e.SN_multiply(i)))}rt.Rectangular.SN__multiply_Rectangular=function(t){return Zt(t._x,t._y,this._x,this._y)};rt.Rectangular.SN_square=function(){return Kt(this._x.SN_square().SN_subtract(this._y.SN_square()),this._x.SN_multiply(this._y).SN_multiply(ue))};rt.Rectangular.SN_reciprocal=function(){var t=Xt(this);return Kt(this._x.SN_divide(t),this._y.SN_divide(t).SN_negate())};rt.C.SN__divide_Rectangular=N;rt.Rectangular.SN_divide=function(t){return t.SN__divide_Rectangular(this)};function Jt(t,e,i){var n=Xt(i);return Zt(t,e,i._x.SN_divide(n),i._y.SN_divide(n).SN_negate())}rt.Rectangular.SN__divide_R=function(t){return Jt(t,t.SN_isExact()?se:Pt,this)};rt.Rectangular.SN__divide_Rectangular=function(t){return Jt(t._x,t._y,this)};rt.Rectangular.SN_expt=function(t){return t.SN__expt_Rectangular(this)};rt.Rectangular.SN__expt_C=function(t){return Wt(t,this)};rt.C.SN__expt_Rectangular=rt.Rectangular.SN__expt_C;rt.Rectangular.SN_exp=function(){return ht(this._x.SN_exp(),this._y)};rt.ER.SN_isExact=p;rt.ER.SN_isInexact=g;rt.ER.SN_toExact=v;rt.ER.SN_toInexact=function(){return x(+this)};rt.ER.SN_isNaN=g;rt.ER.SN_isFinite=p;rt.ER.SN_isInfinite=g;rt.ER.SN_imagPart=I;function $t(t){var e="000000000000000".substring(0,15&t);t>15&&(e+=new Array(1+(t>>4)).join("0000000000000000"));return e}rt.ER.toFixed=function(t){var e=void 0===t?20:m(t,10);if(e>G.maxIntegerDigits)throw new RangeError("fractionDigits exceeds SchemeNumber.maxIntegerDigits: "+t);var i=this,n="";if(i.SN_isNegative()){i=i.SN_negate();n="-"}var r=oe.SN__exp10(-e),a=i.SN_divAndMod(r),s=a[0];a[1].SN_add(a[1]).SN_ge(r)&&(s=oe.SN_add(s));if(s.SN_isZero())return n+"0"+(t>0?"."+$t(t):"");s=s.SN_numberToString();if(0===e)return n+s;var o=e-s.length;if(e>0){o>=0&&(s=$t(o+1)+s);var l=s.length-e;return n+s.substring(0,l)+"."+s.substring(l)}return n+s+$t(-e)};rt.ER.toExponential=function(t){var i=void 0===t?20:m(t);if(i<0)throw new RangeError("SchemeNumber toExponential: negative argument: "+i);if(i>G.maxIntegerDigits)throw new RangeError("fractionDigits exceeds SchemeNumber.maxIntegerDigits: "+t);var n=this,r="";if(n.SN_isNegative()){n=n.SN_negate();r="-"}else if(n.SN_isZero())return"0"+(t>0?"."+$t(i):"")+"e+0";var a=e(n.SN_log()/h),s=oe.SN__exp10(a-i),o=n.SN_divAndMod(s),l=o[0];o[1].SN_add(o[1]).SN_ge(s)&&(l=oe.SN_add(l));if((l=l.SN_numberToString()).length!=i+1){a+=l.length-(i+1);s=oe.SN__exp10(a-i);l=(o=n.SN_divAndMod(s))[0];o[1].SN_add(o[1]).SN_ge(s)&&(l=oe.SN_add(l));if((l=l.SN_numberToString()).length!=i+1)throw new Error("Can not format as exponential: "+this.SN_numberToString())}void 0===t&&(l=l.replace(/(\d)0+$/,"$1"));l.length>1&&(l=l[0]+"."+l.substring(1));return r+l+"e"+(a<0?"":"+")+a};rt.ER.toPrecision=function(t){var e,i;if(void 0===t){if((i=this.SN_toInexact()).SN_isFinite())return(+i).toString();e=21}else{if((e=m(t,10))<1)throw new RangeError("SchemeNumber toPrecision: expected a positive precision, got: "+t);if(e>G.maxIntegerDigits)throw new RangeError("precision exceeds SchemeNumber.maxIntegerDigits: "+t)}var n="";if((i=this).SN_isNegative()){i=i.SN_negate();n="-"}else if(i.SN_isZero())return"0"+(e>1?".":"");var r=i.toExponential(e-1),a=r.indexOf("e"),s=m(r.substring(a+1),10);if(s>=-6&&s<e)if(0===s)r=r.substring(0,a);else{r=r.substring(0,1)+(-1===r.indexOf(".")?"":r.substring(2,a));s<0?r="0."+$t(-1-s)+r:s<e-1&&(r=r.substring(0,s+1)+"."+r.substring(s+1))}else void 0===t&&(r=r.substring(0,a).replace(/\.?0+/,"")+r.substring(a));var o=n+r;return o=o.replace(/(\.\d*?)0+(e|\+|\-|$)/g,"$1$2")};rt.EQ.SN_isRational=p;rt.EQ.SN_eq=function(t){return t.SN__eq_EQ(this)};rt.EQ.SN__eq_EQ=N;rt.EQ.SN_ne=function(t){return t.SN__ne_EQ(this)};rt.EQ.SN__ne_EQ=N;rt.EQ.SN_compare=function(t){return t.SN__compare_EQ(this)};rt.EQ.SN__compare_EQ=N;rt.EQ.SN_add=function(t){return t.SN__add_EQ(this)};rt.EQ.SN__add_EQ=N;rt.EQ.SN_subtract=function(t){return t.SN__subtract_EQ(this)};rt.EQ.SN__subtract_EQ=N;rt.EQ.SN_multiply=function(t){return t.SN__multiply_EQ(this)};rt.EQ.SN__multiply_EQ=N;rt.EQ.SN_divide=function(t){return t.SN__divide_EQ(this)};rt.EQ.SN__divide_EQ=N;rt.EQ.SN_expt=function(t){return t.SN__expt_EQ(this)};function te(t,e){e.SN_isZero()&&D();var i=Ee(t.SN_abs(),e.SN_abs());t=t.SN_div(i);return(e=e.SN_div(i)).SN_isNegative()?ee(t.SN_negate(),e.SN_negate()):ee(t,e)}function ee(t,e){return e===oe?t:new ie(t,e)}function ie(t,e){this._n=t;this._d=e}ie.prototype=new k;rt.EQFraction.SN_numberToString=function(t,e){return this._n.SN_numberToString(t)+"/"+this._d.SN_numberToString(t)};rt.EQFraction.valueOf=function(){var t=this._n,e=this._d,i=t/e;return d(i)?t.SN_isNegative()?-l(t.SN_negate().SN_log()-e.SN_log()):l(t.SN_log()-e.SN_log()):i};rt.EQFraction.SN_debug=function(){return"EQFraction("+this._n.SN_debug()+" / "+this._d.SN_debug()+")"};rt.EQFraction.SN_numerator=function(){return this._n};rt.EQFraction.SN_denominator=function(){return this._d};rt.EQFraction.SN_isPositive=function(){return this._n.SN_isPositive()};rt.EQFraction.SN_isNegative=function(){return this._n.SN_isNegative()};rt.EQFraction.SN__eq_EQ=function(t){return t.SN_numerator().SN_eq(this._n)&&t.SN_denominator().SN_eq(this._d)};rt.EQFraction.SN__ne_EQ=function(t){return t.SN_numerator().SN_ne(this._n)||t.SN_denominator().SN_ne(this._d)};rt.EQFraction.SN__compare_EQ=function(t){var e=t.SN_numerator(),i=t.SN_sign()-this._n.SN_sign();if(0!==i)return i>0?1:-1;var n=t.SN_denominator();return n===this._d?e.SN_compare(this._n):e.SN_multiply(this._d).SN_compare(n.SN_multiply(this._n))};rt.EQFraction.SN_negate=function(){return new ie(this._n.SN_negate(),this._d)};rt.EQFraction.SN_square=function(){return new ie(this._n.SN_square(),this._d.SN_square())};rt.EQFraction.SN_reciprocal=function(){switch(this._n.SN_sign()){case-1:return ee(this._d.SN_negate(),this._n.SN_negate());case 1:return ee(this._d,this._n);case 0:default:D()}};rt.EQFraction.SN_floor=function(){return this._n.SN_div(this._d)};rt.EQFraction.SN_ceiling=function(){return this._n.SN_div(this._d).SN_add(oe)};rt.EQFraction.SN_round=function(){if(this._d.SN_eq(ue)){var t=this._n.SN_div(ue);return t.SN_isEven()?t:t.SN_add(oe)}var e=this._n.SN_divAndMod(this._d),i=e[1];return i.SN_add(i).SN_lt(this._d)?e[0]:e[0].SN_add(oe)};rt.EQFraction.SN_truncate=function(){return this._n.SN_isPositive()?this._n.SN_div(this._d):this._d.SN_isUnit()?this._n:this._n.SN_div(this._d).SN_add(oe)};rt.EQFraction.SN_sign=function(){return this._n.SN_sign()};rt.EQFraction.SN_abs=function(){return this._n.SN_sign()>=0?this:this.SN_negate()};rt.EQFraction.SN__add_EQ=function(t){var e=t.SN_numerator(),i=t.SN_denominator(),n=this._n,r=this._d;return te(e.SN_multiply(r).SN_add(n.SN_multiply(i)),i.SN_multiply(r))};rt.EQFraction.SN__subtract_EQ=function(t){var e=t.SN_numerator(),i=t.SN_denominator(),n=this._n,r=this._d;return te(e.SN_multiply(r).SN_subtract(n.SN_multiply(i)),i.SN_multiply(r))};rt.EQFraction.SN__multiply_EQ=function(t){return te(t.SN_numerator().SN_multiply(this._n),t.SN_denominator().SN_multiply(this._d))};rt.EQFraction.SN__divide_EQ=function(t){return te(t.SN_numerator().SN_multiply(this._d),t.SN_denominator().SN_multiply(this._n))};rt.EQFraction.SN__add_EI=function(t){return ee(t.SN_multiply(this._d).SN_add(this._n),this._d)};rt.EQFraction.SN__subtract_EI=function(t){return ee(t.SN_multiply(this._d).SN_subtract(this._n),this._d)};rt.EQFraction.SN__multiply_EI=function(t){return te(t.SN_multiply(this._n),this._d)};rt.EQFraction.SN__divide_EI=function(t){return te(t.SN_multiply(this._d),this._n)};rt.EQFraction.SN_sqrt=function(){return this._n.SN_sqrt().SN_divide(this._d.SN_sqrt())};rt.EQFraction.SN_log=function(){return this._n.SN_log().SN_subtract(this._d.SN_log())};function ne(t,e,i){var n=m(e,i||10);return n<9007199254740992?me(t*n):Te(e,t,i)}rt.EI.SN_isInteger=p;rt.EI.SN_debug=function(){return"EI"};rt.EI.SN_numerator=v;rt.EI.SN_denominator=function(){return oe};rt.EI.SN_floor=v;rt.EI.SN_ceiling=v;rt.EI.SN_round=v;rt.EI.SN_truncate=v;rt.EI.SN__toBigInteger=N;rt.EI.SN_eq=function(t){return t.SN__eq_EI(this)};rt.EI.SN__eq_EI=function(t){return 0===t.SN__toBigInteger().compare(this.SN__toBigInteger())};rt.EI.SN__eq_EQ=function(t){return t.SN_numerator().SN_eq(this)&&t.SN_denominator().SN_eq(oe)};rt.EI.SN_ne=function(t){return t.SN__ne_EI(this)};rt.EI.SN__ne_EI=function(t){return 0!==t.SN__toBigInteger().compare(this.SN__toBigInteger())};rt.EI.SN__ne_EQ=function(t){return t.SN_numerator().SN_ne(this)||t.SN_denominator().SN_ne(oe)};rt.EI.SN_compare=function(t){return t.SN__compare_EI(this)};rt.EI.SN__compare_EQ=function(t){return t.SN_numerator().SN_compare(t.SN_denominator().SN_multiply(this))};rt.EI.SN__compare_EI=function(t){return t.SN__toBigInteger().compare(this.SN__toBigInteger())};rt.EI.SN_add=function(t){return t.SN__add_EI(this)};rt.EI.SN_subtract=function(t){return t.SN__subtract_EI(this)};rt.EI.SN_multiply=function(t){return t.SN__multiply_EI(this)};rt.EI.SN_reciprocal=function(){return this.SN_isNegative()?ee(le,this.SN_negate()):ee(oe,this)};rt.EI.SN_divAndMod=function(t){return t.SN__divAndMod_EI(this)};rt.EI.SN_div=function(t){return t.SN__div_EI(this)};rt.EI.SN_mod=function(t){return t.SN__mod_EI(this)};rt.EI.SN__add_EI=function(t){return Se(t.SN__toBigInteger().add(this.SN__toBigInteger()))};rt.EI.SN__subtract_EI=function(t){return Se(t.SN__toBigInteger().subtract(this.SN__toBigInteger()))};rt.EI.SN__multiply_EI=function(t){return Se(t.SN__toBigInteger().multiply(this.SN__toBigInteger()))};rt.EI.SN__divAndMod_EI=function(t){var e=this.SN__toBigInteger(),i=t.SN__toBigInteger().divRem(e),n=i[0],r=i[1];if(r.isNegative()){r=r.add(e);n=n.prev()}return[Se(n),Se(r)]};rt.EI.SN__div_EI=function(t){return this.SN__divAndMod_EI(t)[0]};rt.EI.SN__mod_EI=function(t){return this.SN__divAndMod_EI(t)[1]};rt.EI.SN__add_EQ=function(t){var e=t.SN_denominator();return ee(t.SN_numerator().SN_add(e.SN_multiply(this)),e)};rt.EI.SN__subtract_EQ=function(t){var e=t.SN_denominator();return ee(t.SN_numerator().SN_subtract(e.SN_multiply(this)),e)};rt.EI.SN__multiply_EQ=function(t){return te(t.SN_numerator().SN_multiply(this),t.SN_denominator())};rt.EI.SN__divide_EQ=function(t){return te(t.SN_numerator(),t.SN_denominator().SN_multiply(this))};rt.EI.SN_expt=function(t){return t.SN__expt_EI(this)};rt.EI.SN__expt_EI=function(t){var e,i=this.SN_sign(),n=this.SN_abs().valueOf(),r=a(t,n);if(r>-9007199254740992&&r<9007199254740992)e=me(r);else{var s=t.SN_log()*n;s>G.maxIntegerDigits*h&&ft("&implementation-restriction","exact integer would exceed limit of "+ +G.maxIntegerDigits+" digits; adjust SchemeNumber.maxIntegerDigits",s/h);e=new Ne(t.SN__toBigInteger().pow(n))}return i>0?e:e.SN_reciprocal()};function re(t,e){for(var i=e.SN_abs(),n=t,r=oe;i.SN_isPositive();){i.SN_isOdd()&&(r=r.SN_multiply(n));n=n.SN_square();i=i.SN_div(ue)}return e.SN_isNegative()?r.SN_reciprocal():r}rt.EI.SN__expt_ER=function(t){return re(t,this)};rt.EI.SN__expt_C=function(t){return t.SN_isExact()?re(t,this):Wt(t,this)};function ae(t){this._=t}ae.prototype=new L;var se=G.ZERO=new ae(0),oe=G.ONE=new ae(1),le=G.M_ONE=new ae(-1),ue=G.TWO=new ae(2),he=[se,oe,ue],ce=G.I=new Qt(se,oe),de=G.M_I=new Qt(se,le);function me(t){return he[t]||(-1==t?le:new ae(t))}se.SN_isZero=p;se.SN_isPositive=g;se.SN_isNegative=g;se.SN_compare=function(t){return-t.SN_sign()};se.SN_add=G;se.SN_negate=v;se.SN_abs=v;se.SN_multiply=v;se.SN_square=v;se.SN_reciprocal=D;se.SN_subtract=function(t){return t.SN_negate()};se.SN_divide=function(t){t.SN_isZero()&&t.SN_isExact()&&D();return this};se.SN_expt=function(t){switch(t.SN_realPart().SN_sign()){case 1:return this;case 0:return oe;case-1:default:D()}};se.SN_sqrt=v;se.SN_exp=B;se.SN_sin=v;se.SN_cos=B;se.SN_tan=v;se.SN_asin=v;se.SN_atan=v;oe.SN_isUnit=p;oe.SN_abs=v;oe.SN_multiply=G;oe.SN_reciprocal=v;oe.SN_square=v;oe.SN_expt=se.SN_multiply;oe.SN_sqrt=v;oe.SN_log=I;oe.SN_acos=I;le.SN_isUnit=p;le.SN_abs=B;le.SN_multiply=se.SN_subtract;le.SN_reciprocal=v;le.SN_square=B;le.SN_sqrt=function(){return ce};le.SN_expt=function(t){if(!t.SN_isInteger())return Wt(this,t);var e=t.SN_isEven()?oe:le;return t.SN_isExact()?e:e.SN_toInexact()};function fe(t){return t.SN_negate()}function ge(t){return t.SN_reciprocal()}for(at in nt){se["SN__add_"+at]=_;se["SN__subtract_"+at]=_;se["SN__multiply_"+at]=v;se["SN__divide_"+at]=D;se["SN__expt_"+at]=B;oe["SN__multiply_"+at]=_;oe["SN__divide_"+at]=_;oe["SN__expt_"+at]=_;le["SN__multiply_"+at]=fe;le["SN__divide_"+at]=fe;le["SN__expt_"+at]=ge}rt.EINative.valueOf=function(){return this._};rt.EINative.SN_numberToString=function(t,e){return this._.toString(t||10)};rt.EINative.SN_debug=function(){return"EINative("+this._+")"};rt.EINative.SN__toBigInteger=function(){return BigInteger(this._)};rt.EINative.SN_isPositive=function(){return this._>0};rt.EINative.SN_isNegative=function(){return this._<0};rt.EINative.SN_sign=function(){return this._>0?1:0==this._?0:-1};rt.EINative.SN_isEven=function(){return 0==(1&this._)};rt.EINative.SN_isOdd=function(){return 1==(1&this._)};rt.EINative.SN_eq=function(t){return t.SN__eq_EINative(this)};rt.EINative.SN__eq_EINative=function(t){return t._===this._};rt.EINative.SN_ne=function(t){return t.SN__ne_EINative(this)};rt.EINative.SN__ne_EINative=function(t){return t._!==this._};rt.EINative.SN_compare=function(t){return t.SN__compare_EINative(this)};rt.EINative.SN__compare_EINative=function(t){return t._===this._?0:t._>this._?1:-1};function pe(t,e){var i=t+e;return i>-9007199254740992&&i<9007199254740992?me(i):new Ne(BigInteger.add(t,e))}rt.EINative.SN_add=function(t){return t.SN__add_EINative(this)};rt.EINative.SN__add_EINative=function(t){return pe(t._,this._)};rt.EINative.SN_negate=function(){return me(-this._)};rt.EINative.SN_abs=function(){return this._<0?me(-this._):this};rt.EINative.SN_subtract=function(t){return t.SN__subtract_EINative(this)};rt.EINative.SN__subtract_EINative=function(t){return pe(t._,-this._)};rt.EINative.SN_multiply=function(t){return t.SN__multiply_EINative(this)};rt.EINative.SN__multiply_EINative=function(t){var e=t._*this._;return e>-9007199254740992&&e<9007199254740992?me(e):new Ne(BigInteger(t._).multiply(this._))};rt.EINative.SN_square=function(){var t=this._*this._;return t<9007199254740992?me(t):new Ne(BigInteger(this._).square())};rt.EINative.SN_reciprocal=function(){var t=this._;assert(0!==t);return t<0?ee(le,me(-t)):ee(oe,this)};function _e(t,n,r){0===n&&D();var a=n>0?e(t/n):i(t/n);if(0===r)return me(a);var s,o=n*a;s=me(s=o>-9007199254740992?t-o:a>0?t-n-n*(a-1):t+n-n*(a+1));return 1===r?s:[me(a),s]}rt.EINative.SN_div=function(t){return t.SN__div_EINative(this)};rt.EINative.SN__div_EINative=function(t){return _e(t._,this._,0)};rt.EINative.SN_mod=function(t){return t.SN__mod_EINative(this)};rt.EINative.SN__mod_EINative=function(t){return _e(t._,this._,1)};rt.EINative.SN_divAndMod=function(t){return t.SN__divAndMod_EINative(this)};rt.EINative.SN__divAndMod_EINative=function(t){return _e(t._,this._,2)};rt.EINative.SN__exp10=function(t){if(0===this._||0===t)return this;if(t<0){var e=String(this._),i=e.length-1;if("0"===e[i]){for(;"0"===e[i]&&t<0;){t+=1;i-=1}e=me(Number(e.substring(0,i+1)));if(0===t)return e}else e=this;return te(e,t<-15?new Ne(BigInteger.ONE.exp10(-t)):me(Number("1000000000000000".substring(0,1-t))))}if(t<16){var n=m("1000000000000000".substring(0,t+1))*this._;if(n>-9007199254740992&&n<9007199254740992)return me(n)}return new Ne(BigInteger(this._).exp10(t))};rt.EINative.SN_exactIntegerSqrt=function(){var t=e(s(assertNonNegative(this)._));return[me(t),me(this._-t*t)]};var ve=BigInteger(9007199254740992);function Se(t){return t.compareAbs(ve)>=0?new Ne(t):me(t.toJSValue())}function Ne(t){this._=t}Ne.prototype=new L;function Te(t,e,i){n=BigInteger.parse(t,i);e<0&&(n=n.schemeNumber_negate());return new Ne(n)}rt.EIBig.SN_numberToString=function(t){return this._.toString(t)};rt.EIBig.valueOf=function(){return this._.valueOf()};["isZero","isEven","isOdd","sign","isUnit","isPositive","isNegative"].forEach((function(t){rt.EIBig["SN_"+t]=function(){return this._[t]()}}));rt.EIBig.SN_log=function(){var t=x(this._.abs().log());return this._.isPositive()?t:Ht(t,Bt)};rt.EIBig.SN_debug=function(){return"EIBig("+this._.toString()+")"};rt.EIBig.SN__toBigInteger=function(){return this._};rt.EIBig.SN_add=function(t){return t.SN__add_EIBig(this)};rt.EIBig.SN_negate=function(){return new Ne(this._.schemeNumber_negate())};rt.EIBig.SN_abs=function(){return new Ne(this._.abs())};rt.EIBig.SN_subtract=function(t){return t.SN__subtract_EIBig(this)};rt.EIBig.SN_multiply=function(t){return t.SN__multiply_EIBig(this)};rt.EIBig.SN_square=function(){return new Ne(this._.square())};rt.EIBig.SN__exp10=function(t){return 0===t?this:t>0?new Ne(this._.exp10(t)):te(this,oe.SN__exp10(-t))};rt.EIBig.SN_sqrt=function(){var t=x(l(this._.abs().log()/2));return this._.isNegative()?Ht(Pt,t):t};rt.EIBig.SN_exactIntegerSqrt=function(){var t=assertNonNegative(this)._.log()/2/h,i=BigInteger(a(10,t-e(t)).toString()+"e"+e(t));return function(t,e){for(;;){var i=t.divRem(e),n=i[0],r=e.subtract(n);if(r.isZero())return[n,i[1]];if(r.isUnit())return r.isPositive()?[n,n.add(i[1])]:[e,e.add(i[1])];e=n.add(r.quotient(2))}}(this._,i).map(Se)};function be(t,e){for(var i;0!==t;){i=t;t=e%t;e=i}return me(e)}function Ee(t,e){if(t instanceof ae&&e instanceof ae)return be(t.valueOf(),e.valueOf());if((t=t.SN__toBigInteger()).isZero())return e;e=e.SN__toBigInteger();for(var i;;){i=t;if((t=e.remainder(t)).isZero())return new Ne(i);if((e=i).compareAbs(ve)<0)return be(t.valueOf(),e.valueOf())}}function Fe(t){var e=rt[t],i={};function n(t,r,a){t&&t.forEach((function(t){if(!e[r+t]){i[r+t]=a;n(it[t],r,a)}}))}for(var r in e)if(/^SN_/.test(r)){var a=r.lastIndexOf("_");if(-1!==a){var s=e[r];if(s){var o=r.substring(a+1);n(it[o],r.substring(0,a+1),s)}}}for(var l in i)e[l]=i[l]}for(var at in nt)Fe(at);if(w===Number){for(var ke in rt.R)/^SN_/.test(ke)&&!rt.Flonum[ke]&&(rt.Flonum[ke]=rt.R[ke]);for(var ke in rt.C)/^SN_/.test(ke)&&!rt.Flonum[ke]&&(rt.Flonum[ke]=rt.C[ke]);for(var ke in rt.Flonum)rt.C[ke]||(rt.C[ke]=S)}for(var at in nt)for(var ke in rt[at])nt[at].prototype[ke]=rt[at][ke];!function(t){var e="";for(var i in nt)if(/[a-z]/.test(i)){var n=nt[i].prototype;for(ke in n)n[ke]===N&&(e+="Pure virtual: "+i+"."+ke+"\n")}e&&t(e)}(this.alert||this.print||function(t){throw t});G.pluginApi={N:T,C:b,R:E,ER:F,EQ:k,EI:L,pureVirtual:N,raise:ft};G._bogusApi={Flonum:w,Rectangular:Qt,EQFraction:ie,EINative:ae,EIBig:Ne};return G}();if("undefined"!=typeof exports){exports.SchemeNumber=SchemeNumber;for(var name in SchemeNumber.fn)exports[name]=SchemeNumber.fn[name]}function RandList(){this.vals=[]}RandList.prototype.get=function(t){if(t>this.vals.length-1)for(var e=this.vals.length;e<=t;e++)this.vals.push(Math.random());return this.vals[t]};function getRandPos(){return void 0===window.timeStep?0:Math.floor(time.value/timeStep.value)}function Rand(t,e){isUndefined(window.simulate)||(simulate.stochastic=!0);if(null!=t)return Rand()*(e-t)+(0+t);if(isUndefined(window.simulate)||1==simulate.RKOrder)return Math.random();var i=getRandPos();if(i!=simulate.lastRandPos){simulate.randLoc=-1;simulate.lastRandPos=i}for(;simulate.previousRandLists.length<=i;)simulate.previousRandLists.push(new RandList);simulate.randLoc=simulate.randLoc+1;return simulate.previousRandLists[i].get(simulate.randLoc)}function RandNormal(t,e){null==t&&(t=0);null==e&&(e=1);return Math.sqrt(-2*Math.log(1-Rand()))*Math.cos(2*Rand()*3.141593)*e+(0+t)}function RandExp(t){null==t&&(t=1);return-1/t*Math.log(Rand())}function RandLognormal(t,e){var i=Math.log(t)-.5*Math.log(1+Math.pow(e/t,2)),n=Math.sqrt(Math.log(1+Math.pow(e/t,2)));return Math.exp(RandNormal(i,n))}function RandBinomial(t,e){for(var i=0,n=1;n<=t;n++)Rand()<=e&&(i+=1);return i}function RandNegativeBinomial(t,e){for(var i=0,n=0;n<t;){Rand()<=e&&(n+=1);i+=1}return i}function RandPoisson(t){if(t<50){for(var e=Math.exp(-t),i=0,n=1;;){i+=1;if(!((n*=Rand())>e))break}return i-1}var r=.767-3.36/t,a=Math.PI/Math.sqrt(3*t),s=a*t;for(i=Math.log(r)-t-Math.log(a);;){var o=Rand(),l=(s-Math.log((1-o)/o))/a,u=Math.floor(l+.5);if(!(u<0)){var h=Rand(),c=s-a*l;if(c+Math.log(h/Math.pow(1+Math.exp(c),2))<=i+u*Math.log(t)-jStat.gammaln(u+1))return u}}}function RandGamma(t,e){for(var i=1,n=1;n<=t;n++)i*=Rand();return-e*Math.log(i)}function RandBeta(t,e){var i=RandGamma(t,1);return i/(i+RandGamma(e,1))}function RandTriangular(t,e,i){var n=0+t,r=0+e,a=0+i;if(n==r)throw"MSG: Maximum can't equal the minimum for the triangular distribution.";if(a<n||a>r)throw"MSG: The peak must be within the maximum and minimum for the triangular distribution.";var s=(a-n)/(r-n),o=Rand();return o<s?n+Math.sqrt(o*(r-n)*(a-n)):r-Math.sqrt((1-o)*(r-n)*(r-a))}function RandDist(t,e){if(t.length!=e.length)throw"MSG: The lengths of the 'x' and 'y' vectors must be the same.";if(t.length<2)throw"MSG: There must be at least 2 points in a distribution to generate a random number.";for(var i=0,n=0;n<t.length-1;n++)i+=(t[n+1]-t[n])*(e[n+1]+e[n])/2;if(0==i)throw"MSG: The area of the distribution cannot be 0.";var r=i*Rand();for(i=0,n=0;n<t.length-1;n++){var a=(t[n+1]-t[n])*(e[n+1]+e[n])/2;if(r>i&&r<i+a){var s,o=r-i,l=(e[n+1]-e[n])/(t[n+1]-t[n]);s=0==l?o/e[n]:(-e[n]+Math.sqrt(Math.pow(e[n],2)+2*l*o))/l;return t[n]+s}i+=a}}if(!sn){var sn=SchemeNumber,fn=sn.fn,ns=fn["number->string"];sn.raise=function(t,e){throw"division by exact zero"==e?"MSG: You cannot divide by 0.":"BigNum Error: "+e}}var varBank={},functionBank=varBank,functionLoaders=[];function bootCalc(){functionBank=varBank={};varBank["-parent"]=null;varBank.e=new Material(2.718281828459045);varBank.pi=new Material(3.141592653589793);varBank.phi=new Material(1.61803399);for(var t=0;t<functionLoaders.length;t++)functionLoaders[t]();varBank.stringbase=StringBase;varBank.vectorbase=VectorBase;window.ObjectBase&&(varBank.objectbase=ObjectBase);window.AgentBase&&(varBank.agentbase=AgentBase)}var PrimitiveStore=function(t,e){this.primitive=t;this.type=e};Boolean.prototype.toNum=function(){return this.valueOf()};String.prototype.toNum=function(){return this.valueOf()};Number.prototype.toNum=function(){return this.valueOf()};Function.prototype.toNum=function(){return this([])};function UserFunction(){}UserFunction.prototype.toNum=function(){return this.fn?this.fn([]):this([])};var StringObject={},StringBase,VectorObject={},VectorBase={},Vector=function(t,e,i){this.parent=i||VectorBase;this.items=t;this.names=e;this.namesLC=void 0;if(e){this.namesLC=[];for(var n=0;n<e.length;n++)e[n]?this.namesLC.push(e[n].toLowerCase()):this.namesLC.push(void 0)}};Vector.prototype.toNum=function(){if(this.isNum)return this;for(var t=this.fullClone(),e=0;e<t.items.length;e++)t.items[e]=t.items[e].toNum();t.isNum=!0;return t};Vector.prototype.toString=function(){for(var t=[],e=0;e<this.items.length;e++){var i=prepareDisplay(this.items[e].toNum().toString());this.names&&this.names[e]&&(i=this.names[e]+": "+i);t.push(i)}return"{"+t.join(", ")+"}"};Vector.prototype.length=function(){return this.items.length};Vector.prototype.cloneCombine=function(t,e,i,n){return this.fullClone().combine(t,e,i,n)};Vector.prototype.combine=function(t,e,i,n){if(t instanceof Vector&&this.length()!=t.length()&&!this.names&&!t.names)throw"MSG: Vectors must have equal length when combined.";if(t instanceof Vector&&this.names&&t.names){if(!n&&t.depth()>this.depth())return t.combine(this,e,!i);if(!this.keysMatch(t.namesLC)){if(this.items[0]instanceof Vector){for(var r=0;r<this.items.length;r++)this.items[r].combine(t,e,i,!0);return this}throw"MSG: Keys do not match for vector operation."}}for(r=0;r<this.length();r++){var a;if(t instanceof Vector)if(this.names&&t.names){var s=t.namesLC.indexOf(this.namesLC[r]);"*"==this.names&&(s=-2);(isUndefined(s)||-1==s)&&(s=t.names.indexOf("*"));if(isUndefined(s)||-1==s)throw"MSG: Mismatched keys for vector operation.";a=-2==s?void 0:t.items[s]}else a=t.items[r];else a=t;isDefined(a)&&(this.items[r]=i?e(a,this.items[r]):e(this.items[r],a))}if(this.names&&this.names.indexOf("*")>-1&&t instanceof Vector&&t.names){var o=this.items[this.names.indexOf("*")];for(r=0;r<t.names.length;r++)if(t.names[r]&&(-1==this.namesLC.indexOf(t.namesLC[r])||"*"==t.names)){i?this.items.push(e(t.items[r],o)):this.items.push(e(o,t.items[r]));this.names.push(t.names[r]);this.namesLC.push(t.namesLC[r])}}return this};Vector.prototype.collapseDimensions=function(t){if(t instanceof Vector){if(this.depth()==t.depth())return this;for(var e=[],i=this,n=t,r=0;r<this.depth();r++)if(n instanceof Vector)if(void 0===i.namesLC&&void 0===n.namesLC||void 0!==i.namesLC&&void 0!==n.namesLC&&keysMatch(i.namesLC,n.namesLC)){e.push("*");i=i.items[0];n=n.items[0]}else{e.push((function(t){return functionBank.sum(t[0].items)}));i=i.items[0]}else{e.push((function(t){return functionBank.sum(t[0].items)}));i=i.items[0]}if(n.items)throw"MSG: Keys do not match for vector collapsing.";return selectFromMatrix(this,e)}return functionBank.sum([functionBank.flatten([this])])};function keysMatch(t,e){if(-1==e.indexOf("*"))for(var i=0;i<t.length;i++)if("*"!=t[i]){if(isUndefined(t[i]))return!1;if(-1==e.indexOf(t[i]))return!1}if(-1==t.indexOf("*"))for(i=0;i<e.length;i++)if("*"!=e[i]){if(isUndefined(e[i]))return!1;if(-1==t.indexOf(e[i]))return!1}return!0}Vector.prototype.depth=function(){return 0!=this.items.length&&this.items[0]instanceof Vector?this.items[0].depth()+1:1};Vector.prototype.keysMatch=function(t){return!!this.names&&keysMatch(this.namesLC,t)};Vector.prototype.cloneApply=function(t){return this.fullClone().apply(t)};Vector.prototype.apply=function(t){for(var e=0;e<this.items.length;e++)this.items[e]=t(this.items[e],this.names?this.names[e]:void 0);return this};Vector.prototype.stackApply=function(t){return 1==this.depth()?t(this):this.stack().recurseApply(t)};Vector.prototype.stack=function(t){var e=[];t=t||[0];for(var i=this.select(t),n=1;n<this.items.length;n++){t[0]=n;var r=this.select(t);if(i instanceof Vector&&r instanceof Vector){if(i.names&&!r.names||r.names&&!i.names)throw"MSG: Mismatched keys for vector collapsing.";if(i.items.length!=r.items.length)throw"MSG: Vectors of unequal size."}else if(!(i instanceof Vector||r instanceof Vector))throw"MSG: Mismatched keys for vector collapsing."}t[0]=0;t.push(0);for(n=0;n<i.items.length;n++){t[t.length-1]=i.names?i.namesLC[n]:n;if(i.items[n]instanceof Vector)e.push(this.stack(t.slice()));else{for(var a=[],s=0;s<this.items.length;s++){var o=t.slice();o[0]=s;var l=this.select(o);if(l instanceof Vector)throw"MSG: Number where vector expected in vector collapsing.";a.push(l)}var u=new Vector(a);u.terminateApply=!0;e.push(u)}}return new Vector(e,i.names?i.names.slice():void 0)};Vector.prototype.select=function(t){for(var e=this,i=0;i<t.length;i++){if(!e.items)throw"MSG: Number where vector expected in vector collapsing.";if(t[i]instanceof String||"string"==typeof t[i]){var n=e.namesLC.indexOf(t[i].valueOf());if(-1==n)throw"MSG: Mismatched keys for vector collapsing.";e=e.items[n]}else e=e.items[t[i]]}return e};Vector.prototype.recurseApply=function(t){for(var e=0;e<this.items.length;e++)this.items[e]instanceof Vector&&!this.items[e].terminateApply?this.items[e]=this.items[e].recurseApply(t):this.items[e]=t(this.items[e]);return this};Vector.prototype.fullNames=function(){if(this.items[0]instanceof Vector&&this.items[0].names){for(var t=this.items[0].fullNames(),e=[],i=0;i<this.names.length;i++)for(var n=0;n<t.length;n++)e.push([this.names[i]].concat(t[n]));return e}for(e=[],i=0;i<this.names.length;i++)e.push([this.names[i]]);return e};Vector.prototype.clone=function(){for(var t=[],e=0;e<this.items.length;e++)this.items[e]instanceof Vector?t.push(this.items[e].clone()):t.push(this.items[e]);return new Vector(t,this.names?this.names.slice():void 0,this.parent)};Vector.prototype.fullClone=function(){for(var t=[],e=0;e<this.items.length;e++)this.items[e].fullClone?t.push(this.items[e].fullClone()):t.push(this.items[e]);return new Vector(t,this.names?this.names.slice():void 0,this.parent)};Vector.prototype.equals=function(t){if(this.length()!=t.length())return!1;for(var e=0;e<this.items.length;e++)if(!strictEquals(this.items[e],t.items[e]))return!1;return!0};function strictEquals(t,e){if(t instanceof Agent||e instanceof Agent){if(t instanceof Agent&&e instanceof Agent&&t.instanceId==e.instanceId)return!0}else if(t instanceof Vector||e instanceof Vector){if(t instanceof Vector&&e instanceof Vector&&t.equals(e))return!0}else if(eq(t,e))return!0;return!1}function createTree(t){var e=new org.antlr.runtime.ANTLRStringStream(t.replace(/\\n/g,"\n")),i=new FormulaLexer(e),n=new org.antlr.runtime.CommonTokenStream(i),r=new FormulaParser(n),a=convertToObject(r.lines().tree,r);isLocal();return a}function trimTree(t,e){return trimNode(t,e)}function evaluateTree(t,e){evaluatingLine=void 0;try{return evaluateNode(t,e)}catch(t){if(t.returnVal)return t.data;throw t}}function evaluate(t,e){PB["test vector"]=new Primitive(new Vector([new Material(1),new Material(2),new Material(3)],[],VectorBase));PB["test vector 2"]=new Primitive(new Vector([new Material(1.2),new Material(2.9),new Material(3)],[],VectorBase));var i,n=trimTree(createTree(t),PB);try{i=evaluateTree(n,varBank);e||(i=i.toNum())}catch(t){if("PLOT"==t){var r={isPlot:!0,data:[]},a={};a["-parent"]=varBank;for(var s=-100;s<=100;s+=1){a.x=new Material(s/10);r.data.push([s/10,0+evaluateTree(n,a).value])}return r}throw t}if(i instanceof Material){i.value.toPrecision&&(0===i.value?i.value="0":i.value=i.value.toPrecision(21));"."==i.value.substr(i.value.length-1,1)&&(i.value=i.value.substring(0,i.value.length-1));i.value=i.value.replace(/\.?\+\.?/g,"+");i.value=i.value.replace(/\.?\-\.?/g,"-");i.value=i.value.replace(/\.i/g,"i");i.value=i.value.replace(/(\d)i/g,"$1*<i>i</i>");i.value=i.value.replace(/\.e/g,"e");i.value=i.value.replace(/e\+/g,"e");"+inf.0"==i.value?i.value="Infinity":"-inf.0"==i.value&&(i.value="-Infinity")}return i}var TreeNode=function(t,e,i){this.origText=t;this.text=t.toLowerCase();this.typeName=e;this.line=i;this.children=[]};function convertToObject(t,e){var i=t.getToken(),n=new TreeNode(i.getText(),e.getTokenNames()[i.getType()],i.line);if(t.getChildCount()>0)for(var r=t.getChildren(),a=0;a<r.length;a++){n.children.push(convertToObject(r[a],e));!n.line&&n.children[n.children.length-1].line&&(n.line=n.children[n.children.length-1].line)}return n}var funcEvalMap=new Object,evaluatingLine=null;funcEvalMap.LINES=function(t,e){if(0==t.children.length)return new Material(0);for(var i,n=0;n<t.children.length;n++){if("return"==t.children[n].text)throw{returnVal:!0,data:evaluateNode(t.children[n].children[0],e)};i=evaluateNode(t.children[n],e)}return i};funcEvalMap.NEGATE=function(t,e){return negate(evaluateNode(t.children[0],e).toNum())};function negate(t){if(t instanceof Vector)return t.cloneApply(negate);if("boolean"==typeof t)throw"MSG: Cannot convert Booleans to Numbers.";if(t instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";return new Material(fn["-"](t.value),t.units)}funcEvalMap.AND=function(t,e){return funAnd(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function funAnd(t,e){return t instanceof Vector?t.cloneCombine(e,funAnd,!1):e instanceof Vector?e.cloneCombine(t,funAnd,!0):trueValue(t)&&trueValue(e)}funcEvalMap.OR=function(t,e){return funOr(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function funOr(t,e){return t instanceof Vector?t.cloneCombine(e,funOr,!1):e instanceof Vector?e.cloneCombine(t,funOr,!0):trueValue(t)||trueValue(e)}funcEvalMap.XOR=function(t,e){return funXor(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function funXor(t,e){return t instanceof Vector?t.cloneCombine(e,funXor,!1):e instanceof Vector?e.cloneCombine(t,funXor,!0):(trueValue(t)||trueValue(e))&&!(trueValue(t)&&trueValue(e))}funcEvalMap.NOT=function(t,e){return fNot(evaluateNode(t.children[0],e).toNum())};function fNot(t){return t instanceof Vector?t.cloneApply(fNot):!trueValue(t)}funcEvalMap.NOTEQUALS=function(t,e){return neq(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function neq(t,e){if("boolean"==typeof t&&!(e instanceof Vector)||"boolean"==typeof e&&!(t instanceof Vector))return trueValue(t)!=trueValue(e);if((t instanceof String||"string"==typeof t)&&!(e instanceof Vector)||(e instanceof String||"string"==typeof e)&&!(t instanceof Vector))return(t.toLowerCase?t.toLowerCase():t)!=(e.toLowerCase?e.toLowerCase():e);if(t instanceof Vector)return t.cloneCombine(e,neq,!1);if(e instanceof Vector)return e.cloneCombine(t,neq,!0);if(!(t instanceof Material&&e instanceof Material))return t!=e;if(t.units!==e.units){var i=convertUnits(e.units,t.units);if(0===i)return!0;e.value=fn["*"](e.value,i);e.units=t.units}return!fn["="](t.value,e.value)}funcEvalMap.EQUALS=function(t,e){return eq(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function eq(t,e){if("boolean"==typeof t&&!(e instanceof Vector)||"boolean"==typeof e&&!(t instanceof Vector))return trueValue(t)==trueValue(e);if(("string"==typeof t||t instanceof String)&&!(e instanceof Vector)||("string"==typeof e||e instanceof String)&&!(t instanceof Vector))return(t.toLowerCase?t.toLowerCase():t)==(e.toLowerCase?e.toLowerCase():e);if(t instanceof Vector)return t.cloneCombine(e,eq,!1);if(e instanceof Vector)return e.cloneCombine(t,eq,!0);if(!(t instanceof Material&&e instanceof Material))return t==e;if(t.units!==e.units){var i=convertUnits(e.units,t.units);if(0===i)return!1;e.value=fn["*"](e.value,i);e.units=t.units}return fn["="](t.value,e.value)}function comparisonValid(t,e){if(t instanceof String||"string"==typeof t||e instanceof String||"string"==typeof e)throw"MSG: Cannot use Strings in logical inequality comparisons.";if(t instanceof Agent||e instanceof Agent)throw"MSG: Cannot use Agents in logical inequality comparisons."}funcEvalMap.LT=function(t,e){return lessThan(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function lessThan(t,e){comparisonValid(t,e);if(t instanceof Vector)return t.cloneCombine(e,lessThan,!1);if(e instanceof Vector)return e.cloneCombine(t,lessThan,!0);if(t.units!==e.units){var i=convertUnits(e.units,t.units);if(0===i)unitAlert(t.units,e.units,"comparison");else{e.value=fn["*"](e.value,i);e.units=t.units}}return fn["<"](t.value,e.value)}funcEvalMap.LTEQ=function(t,e){return lessThanEq(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function lessThanEq(t,e){comparisonValid(t,e);if(t instanceof Vector)return t.cloneCombine(e,lessThanEq,!1);if(e instanceof Vector)return e.cloneCombine(t,lessThanEq,!0);if(t.units!==e.units){var i=convertUnits(e.units,t.units);if(0===i)unitAlert(t.units,e.units,"comparison");else{e.value=fn["*"](e.value,i);e.units=t.units}}return fn["<="](t.value,e.value)}funcEvalMap.GT=function(t,e){return greaterThan(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function greaterThan(t,e){comparisonValid(t,e);if(t instanceof Vector)return t.cloneCombine(e,greaterThan,!1);if(e instanceof Vector)return e.cloneCombine(t,greaterThan,!0);if(t.units!==e.units){var i=convertUnits(e.units,t.units);if(0===i)unitAlert(t.units,e.units,"comparison");else{e.value=fn["*"](e.value,i);e.units=t.units}}return fn[">"](t.value,e.value)}funcEvalMap.GTEQ=function(t,e){return greaterThanEq(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function greaterThanEq(t,e){comparisonValid(t,e);if(t instanceof Vector)return t.cloneCombine(e,greaterThanEq,!1);if(e instanceof Vector)return e.cloneCombine(t,greaterThanEq,!0);if(t.units!==e.units){var i=convertUnits(e.units,t.units);if(0===i)unitAlert(t.units,e.units,"comparison");else{e.value=fn["*"](e.value,i);e.units=t.units}}return fn[">="](t.value,e.value)}funcEvalMap.PLUS=function(t,e){return plus(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function plus(t,e){if(t instanceof Vector)return t.cloneCombine(e,plus,!1);if(e instanceof Vector)return e.cloneCombine(t,plus,!0);if("boolean"==typeof t||"boolean"==typeof e)throw"MSG: Cannot convert Booleans to Numbers.";if(t instanceof Agent||e instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";if("string"==typeof t||t instanceof String||"string"==typeof e||e instanceof String){var i=new String(t.toString()+e.toString());i.parent=StringBase;return i}if(t.units!==e.units){var n=convertUnits(e.units,t.units);if(0===n)unitAlert(t.units,e.units,"addition");else{e.value=fn["*"](e.value,n);e.units=t.units}}return new Material(fn["+"](t.value,e.value),e.units)}funcEvalMap.MINUS=function(t,e){return minus(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function minus(t,e){if(t instanceof Vector)return t.cloneCombine(e,minus,!1);if(e instanceof Vector)return e.cloneCombine(t,minus,!0);if("boolean"==typeof t||"boolean"==typeof e)throw"MSG: Cannot convert Booleans to Numbers.";if(t instanceof Agent||e instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";if(t.units!==e.units){var i=convertUnits(e.units,t.units);if(0===i)unitAlert(t.units,e.units,"subtraction");else{e.value=fn["*"](e.value,i);e.units=t.units}}return new Material(fn["-"](t.value,e.value),e.units)}funcEvalMap.MULT=function(t,e){return mult(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function mult(t,e){if(t instanceof Vector)return t.cloneCombine(e,mult,!1);if(e instanceof Vector)return e.cloneCombine(t,mult,!0);if("boolean"==typeof t||"boolean"==typeof e)throw"MSG: Cannot convert Booleans to Numbers.";if(t instanceof Agent||e instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";var i=fn["*"](t.value,e.value);if(t.units&&e.units){t.units.addBase();e.units.addBase();return new Material(fn["*"](fn["*"](t.units.toBase,i),e.units.toBase),t.units.multiply(e.units,1))}return t.units?new Material(i,t.units):e.units?new Material(i,e.units):new Material(i)}funcEvalMap.DIV=function(t,e){return div(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function div(t,e){if(t instanceof Vector)return t.cloneCombine(e,div,!1);if(e instanceof Vector)return e.cloneCombine(t,div,!0);if("boolean"==typeof t||"boolean"==typeof e)throw"MSG: Cannot convert Booleans to Numbers.";if(t instanceof Agent||e instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";var i=fn["/"](t.value,e.value);if(t.units&&e.units){t.units.addBase();e.units.addBase();return new Material(fn["/"](fn["*"](t.units.toBase,i),e.units.toBase),t.units.multiply(e.units,-1))}return t.units?new Material(i,t.units):e.units?new Material(i,e.units.power(-1)):new Material(i)}funcEvalMap.POWER=function(t,e){if(1==t.children.length)return evaluateNode(t.children[0],e);for(var i=evaluateNode(t.children[t.children.length-1],e).toNum(),n=t.children.length-1;n>0;n--){var r=evaluateNode(t.children[n-1],e).toNum();if(!(i instanceof Vector)&&i.units)throw"MSG: Exponents may not have units.";i=power(r,i)}return i};function power(t,e){if(t instanceof Vector)return t.cloneCombine(e,power,!1);if(e instanceof Vector)return e.cloneCombine(t,power,!0);if("boolean"==typeof t||"boolean"==typeof e)throw"MSG: Cannot convert Booleans to Numbers.";if(t instanceof Agent||e instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";var i=t.value;"number"==typeof i&&(i=sn("#e"+i));return new Material(fn.expt(i,e.value),t.units?t.units.power(e.value):void 0)}funcEvalMap.MOD=function(t,e){return doMod(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function doMod(t,e){if(t instanceof Vector)return t.cloneCombine(e,doMod,!1);if(e instanceof Vector)return e.cloneCombine(t,doMod,!0);if("boolean"==typeof t||"boolean"==typeof e)throw"MSG: Cannot convert Booleans to Numbers.";if(t instanceof Agent||e instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";if(e.units)throw'MSG: The right hand side of "mod" may not have units.';return new Material(fn.mod(t.value,e.value),t.units)}funcEvalMap.IDENT=function(t,e){for(var i=t.text;!(i in e);){if(!e["-parent"]){if("x"==i&&window.isCalc)throw"PLOT";if("i"==i)return new Material(sn("i"));throw'MSG: The variable or function "'+t.origText+'" does not exist.'}e=e["-parent"]}var n=e[i];n instanceof TreeNode&&"ARRAY"==n.typeName&&(n=evaluateNode(n,e));return!n.fullClone||n instanceof Vector?n:n.fullClone()};funcEvalMap.NEW=function(t,e){var i=evaluateNode(t.children[0],e);if(i instanceof Vector){var n,r,a=new Vector([],void 0,i);try{n=(r=selectFromVector(i,"constructor")).data}catch(t){}if(n)2==t.children.length?callFunction(n,t.children[1],e,a,r.parent):callFunction(n,{children:[]},e,a,r.parent);else if(2==t.children.length&&t.children[1].children.length>0)throw"MSG: No constructor available for '"+t.children[0].text+"'.";return a}throw"MSG: 'New' can only be use to create instances of Vectors."};funcEvalMap.INNER=function(t,e){var i,n,r=evaluateNode(t.children[0],e);if(2==t.children.length&"FUNCALL"==t.children[1].typeName)return callFunction(r,t.children[1],e);e.self&&"parent"==t.children[0].text?i=e.self:r instanceof Function||r instanceof UserFunction||(i=r);for(var a=1;a<t.children.length;a++)if("SELECTOR"==t.children[a].typeName)if("DOTSELECTOR"==t.children[a].children[0].typeName)for(var s=0;s<t.children[a].children[0].children.length;s++){var o=[];t.children[a].children[0].children[s].text?o.push(t.children[a].children[0].children[s].text):o.push(t.children[a].children[0].children[s].valueOf());try{r=selectFromMatrix(r,o)}catch(t){if(!(r instanceof Primitive)||r instanceof Agent)throw t;r=r.toNum();s--}if(!(r instanceof Function||r instanceof UserFunction)){i=r;n=r}}else{if(r instanceof Primitive&&!((r=r.toNum())instanceof Function||r instanceof UserFunction)){i=r;n=r}try{r=selectFromMatrix(r,createMatrixSelector(t.children[a],e,0,!0))}catch(t){if(!(r instanceof Primitive))throw t;r=r.toNum();a--}if(!(r instanceof Function||r instanceof UserFunction)){i=r;n=r}}else if(!((r=callFunction(r,t.children[a],e,i,n))instanceof Function||r instanceof UserFunction)){i=r;n=r}return r};function callFunction(t,e,i,n,r){if("function"!=typeof t&&!(t instanceof UserFunction))throw"MSG: Trying to call a non-function.";var a,s=[],o="";if(e instanceof Array)s=e;else{e.functionFingerprint||(e.functionFingerprint="FINGERPRINT-"+Math.random());o=e.functionFingerprint;if(t.delayEvalParams)for(var l=0;l<e.children.length;l++)s.push({node:e.children[l],scope:i});else for(l=0;l<e.children.length;l++){var u=evaluateNode(e.children[l],i);!u.fullClone||u instanceof Vector||(u=u.fullClone());s.push(u)}}if(t.fn)a=t.fn;else{e.delayEvalParams=t.delayEvalParams;a=t}var h=evaluatingLine,c=a(s,o,n,r);evaluatingLine=h;return c}function createMatrixSelector(t,e,i,n){for(var r=[],a=i=i||0;a<t.children.length;a++){if("MULT"==t.children[a].typeName)r.push("*");else{var s=evaluateNode(t.children[a],e);if("function"==typeof s||s instanceof UserFunction){if("function"==typeof s)var o=s;else o=s.fn;!function(t){r.push((function(e){if(!e[0].stackApply)throw"MSG: Can't apply function across elements of non-vector.";return e[0].stackApply((function(e){return t([e])}))}))}(o)}else r.push(s.toNum())}}return r}function selectFromMatrix(t,e,i){var n=t;n instanceof Vector||(n.vector?n=n.vector:n.parent&&(n=new Vector([],[],n.parent)));isUndefined(i)&&n.fullClone&&(n=n.fullClone());var r=selectFromVector(n,e.shift(),0==e.length?i:void 0,isDefined(i)),a=[];a=r.collapsed?[r.data]:r.data.items;for(;e.length>0;){for(var s=[],o=e.shift(),l=0;l<a.length;l++){if(!(a[l]instanceof Vector))throw"MSG: No element available for: "+o;var u=selectFromVector(a[l],o,0==e.length?i:void 0);if(u.collapsed){if(!i){a[l].items=[u.data];a[l].names=["!!BREAKOUT DATA"]}s=s.concat(u.data)}else{s=s.concat(u.data.items);if(!i){a[l].items=u.data.items;a[l].names=u.data.names}}}a=s}return doBreakouts(r.data)}function doBreakouts(t){if(!(t instanceof Vector))return t;if(1==t.items.length&&t.names&&"!!BREAKOUT DATA"==t.names[0])return doBreakouts(t.items[0]);for(var e=0;e<t.items.length;e++)t.items[e]=doBreakouts(t.items[e]);return t}function selectFromVector(t,e,i,n){if("*"==e)return{data:t};if("function"==typeof e)return{data:e([t]),collapsed:!0};if("parent"==e){if(t.parent)return{data:n?t.parent:t.parent.fullClone(),collapsed:!0};throw"MSG: Vector does not have a parent."}if(e instanceof Vector){for(var r=[],a=t.names?[]:void 0,s=0;s<e.items.length;s++){var o=e.items[s],l=!0;"boolean"==typeof o&&(o?o=new Material(s+1):l=!1);if(l){var u=selectElementFromVector(t,o,i);r.push(u.value);a&&a.push(u.name)}}return{collapsed:!1,parent:t,data:new Vector(r,a,t.parent)}}return{collapsed:!0,parent:t,data:selectElementFromVector(t,e,i).value}}function selectElementFromVector(t,e,i){var n,r=void 0,a=void 0;if(e instanceof String||"string"==typeof e)try{if(isUndefined(i)&&!t.names)throw"MSG: Key '"+e+"' not in vector.";if(t.names){n=-1;for(var s=e.toLowerCase(),o=0;o<t.names.length;o++)if(t.names[o]&&t.names[o].toLowerCase()===s){n=o;break}(n<0||isUndefined(n))&&(n=t.names.indexOf("*"))}if(n<0||isUndefined(n)){if(isUndefined(i))throw"MSG: Key '"+e+"' not in vector.";n=e}}catch(n){if(t.parent)return selectElementFromVector(t.parent,e,i);throw n}else n=parseFloat(e.toNum())-1;if(n instanceof String||"string"==typeof n){if(!t.names){t.names=[];for(o=0;o<t.items.length;o++)t.names.push(void 0)}t.items.push(i);t.names.push(n.valueOf());a=i;r=n}else{if(n<0||!t.items||n>=t.items.length||n%1!=0)throw"MSG: Index "+(1+n)+" is not in the vector.";isUndefined(i)||(t.items[n]=i);a=t.items[n];t.names&&(r=t.names[n])}return{name:r,value:a}}funcEvalMap.ARRAY=function(t,e){if(1==t.children.length&&t.children[0]instanceof Vector)return t.children[0].fullClone();for(var i=[],n=[],r=!1,a=0;a<t.children.length;a++){i.push(evaluateNode(t.children[a].children[0],e));if(t.children[a].children.length>1){t.children[a].children[1].text?n.push(t.children[a].children[1].origText):n.push(t.children[a].children[1].valueOf());r=!0}else n.push(void 0)}return new Vector(i,r?n:void 0)};funcEvalMap.RANGE=function(t,e){if(1==t.children.length)return evaluateNode(t.children[0],e);var i=[],n=evaluateNode(t.children[0],e).toNum(),r=evaluateNode(t.children[t.children.length-1],e).toNum();if(!(n instanceof Material&&r instanceof Material))throw"MSG: Range elements must be numbers.";i.push(n.fullClone());if(n.units!==r.units){if(1!=convertUnits(n.units,r.units))throw"MSG: Units on both sides of ':' must be equal."}var a=2==t.children.length?new Material(1,n.units):evaluateNode(t.children[1],e).toNum();if(!(a instanceof Material))throw"MSG: Range elements must be numbers.";if(eq(n,r));else if(lessThan(n,r))for(var s=plus(n,a);lessThanEq(s,r);){i.push(s);s=plus(s,a)}else if(greaterThan(n,r)){2==t.children.length&&(a=negate(a));for(s=plus(n,a);greaterThanEq(s,r);){i.push(s);s=plus(s,a)}}return new Vector(i)};function makeFunctionCall(t,e,i,n,r){var a=new UserFunction;a.localScope=new Object;a.localScope.nVars=e.length;for(var s=0;s<e.length;s++)a.localScope[s+=""]=e[s];a.localScope["-parent"]=r;a.defaults=i;a.fn=function(e,i,s,o){for(var l=e.length,u=0;u<e.length;u++)e[u].optional&&l--;if(a.localScope.nVars-a.defaults.length>e.length||l>a.localScope.nVars){var h=[];for(u=0;u<a.localScope.nVars;u++)a.defaults.length-(a.localScope.nVars-u)>-1?h.push(a.localScope[u+=""]+"="+a.defaults[a.defaults.length-(a.localScope.nVars-u)]):h.push(a.localScope[u+=""]);throw"MSG: Wrong number of parameters for "+t+"("+h.join(", ")+")."}var c={"-parent":r};for(u=0;u<e.length;u++)c[a.localScope[u+=""]]=e[u];for(u=e.length;u<a.localScope.nVars;u++)c[a.localScope[u+=""]]=a.defaults[a.defaults.length-(a.localScope.nVars-u)];s&&(c.self||(c.self=s));o&&o.parent&&(c.parent=o.parent);try{return evaluateNode(n,c)}catch(t){if(t.returnVal)return t.data;throw t}};return a}funcEvalMap.THROW=function(t,e){throw"MSG: "+evaluateNode(t.children[0],e)};funcEvalMap.TRYCATCH=function(t,e){try{return evaluateNode(t.children[0],e)}catch(n){var i={"-parent":e};i[t.children[2].text]=s("string"==typeof n||n instanceof String?n.substr(5):"An error has occurred.");return evaluateNode(t.children[1],i)}};funcEvalMap.WHILE=function(t,e){for(var i=new Material(0),n={"-parent":e};trueValue(evaluateNode(t.children[0],e).toNum());)i=evaluateNode(t.children[1],n);return i};funcEvalMap.IFTHENELSE=function(t,e){for(var i={"-parent":e},n=0;n<t.children[0].children.length;n++)if(trueValue(evaluateNode(t.children[0].children[n],e).toNum()))return evaluateNode(t.children[1].children[n],i);return t.children[0].children.length!=t.children[1].children.length?evaluateNode(t.children[1].children[n],i):new Material(0)};funcEvalMap.FORIN=function(t,e){var i=new Material(0),n=t.children[0].text,r={"-parent":e},a=evaluateNode(t.children[1],e);if(!(a instanceof Vector))throw"MSG: The in argument of a For-In loop mush be a a vector.";for(var s=0;s<a.items.length;s++){r[n]=a.items[s];i=evaluateNode(t.children[2],r)}return i};funcEvalMap.FOR=function(t,e){var i=new Material(0),n=t.children[0].text,r=evaluateNode(t.children[1].children[0],e).toNum(),a=new Material(1);3==t.children[1].children.length&&(a=evaluateNode(t.children[1].children[2],e).toNum());var s={"-parent":e};s[n]=r;for(;fn[a.value>=0?"<=":">="](s[n].value,evaluateNode(t.children[1].children[1],e).toNum());){i=evaluateNode(t.children[2],s);s[n]=plus(s[n],a)}return i};funcEvalMap.FUNCTION=function(t,e){var i=t.children[0].children[0].text;functionGenerator(i,t.children[0],t.children[1],t.children[2],e);return'"'+i+'" defined'};funcEvalMap.ANONFUNCTION=function(t,e){return functionGenerator(null,t.children[0],t.children[1],t.children[2],e)};funcEvalMap.ASSIGN=function(t,e){var i=t.children.length-1,n=evaluateNode(t.children[t.children.length-1],e);if(i>1&&(!(n instanceof Vector)||n.items.length<i))throw"MSG: Too few elements returned for assignment.";for(var r=0;r<i;r++)if(t.children[r]instanceof PrimitiveStore)1==i?t.children[r].primitive.setValue(n):t.children[r].primitive.setValue(n.items[r]);else{var a=t.children[r].children[0].text;if(t.children[r].children.length>1)var s=createSelector(t.children[r].children[1],e);for(var o,l=e;null!==e["-parent"]&&!isDefined(e[a]);)e=e["-parent"];null===e["-parent"]&&isUndefined(e[a])&&(e=l);o=1==i?n:n.items[r];if(1==t.children[r].children.length)e[a]=o;else{if(!isDefined(e[a]))throw"MSG: The variable '"+t.children[r].children[0].origText+"' does not exist.";selectFromMatrix(e[a],s,o)}}return i>1?new Vector(n.items.slice(0,i)):n};function createSelector(t,e){if("DOTSELECTOR"==t.children[0].typeName){for(var i=[],n=0;n<t.children[0].children.length;n++)t.children[0].children[n].text?i.push(t.children[0].children[n].text):i.push(t.children[0].children[n].valueOf());return i}return createMatrixSelector(t,e,0,!0)}funcEvalMap.MATERIAL=function(t,e){var i=evaluateNode(t.children[0],e).toNum();if(i.units)throw"MSG: Cannot create material where numeric part itself has units.";return new Material(i.value,t.children[1])};function functionGenerator(t,e,i,n,r){for(var a=[],s=[],o=null===t?0:1;o<e.children.length;o++)a.push(e.children[o].text);for(o=0;o<i.children.length;o++)s.push(i.children[o]);if(null===t)return makeFunctionCall(null===t?"Function":t,a,s,n,r);r[t]=makeFunctionCall(t,a,s,n,r)}var unitEvalMap=new Object;unitEvalMap.MULT=function(t){return evaluateUnits(t.children[0]).concat(evaluateUnits(t.children[1]))};unitEvalMap.POW=function(t){var e=1,i=1;if(3==t.children.length){e*=-1;i++}var n=evaluateUnits(t.children[0]),r=evaluateUnits(t.children[i])*e;if(n instanceof Array){for(var a=0;a<n.length;a++)n[a].exponent=n[a].exponent*r;return n}return Math.pow(n,r)};unitEvalMap.DIV=function(t){for(var e=evaluateUnits(t.children[0]),i=evaluateUnits(t.children[1]),n=0;n<i.length;n++)i[n].exponent=-1*i[n].exponent;return e.concat(i)};unitEvalMap.PER=unitEvalMap.DIV;unitEvalMap.UNIT=function(t){for(var e="",i=0;i<t.children.length;i++){e+=t.children[i].text;i<t.children.length-1&&(e+=" ")}return[{id:e,exponent:1}]};unitEvalMap.UNITCLUMP=function(t){var e=evaluateUnits(t.children[0]);if(t.children.length>1)for(var i=1;i<t.children.length;i++)if("NEGATE"==t.children[i].typeName)for(var n=0;n<e.length;n++)e[n].exponent=-1*e[n].exponent;else if("SQUARED"==t.children[i].typeName)for(n=0;n<e.length;n++)e[n].exponent=2*e[n].exponent;else if("CUBED"==t.children[i].typeName)for(n=0;n<e.length;n++)e[n].exponent=3*e[n].exponent;return e};unitEvalMap.INTEGER=function(t){return parseInt(t.text)};unitEvalMap.FLOAT=function(t){return parseFloat(t.text)};function evaluateUnits(t){return t instanceof Material?t.value:unitEvalMap[t.typeName](t)}function evaluateNode(t,e){if(t instanceof TreeNode){evaluatingLine=t.line||evaluatingLine;return funcEvalMap[t.typeName](t,e)}if(!(t instanceof PrimitiveStore))return t;if("totalValue"==t.type){if(!t.primitive.totalContents)throw"MSG: You can only use the double-bracket notation for total conveyor contents on Stock primitives.";return t.primitive.totalContents()}return"object"==t.type?t.primitive:void 0}var trimEvalMap=new Object,AgentBase;trimEvalMap.POWER=function(t,e){if(1==t.children.length)return trimNode(t.children[0],e);for(var i=new TreeNode(t.origText,t.typeName,t.line),n=0;n<t.children.length;n++)i.children.push(trimNode(t.children[n],e));return i};trimEvalMap.INNER=function(t,e){if(1==t.children.length)return trimNode(t.children[0],e);for(var i=new TreeNode(t.origText,t.typeName,t.line),n=0;n<t.children.length;n++)i.children.push(trimNode(t.children[n],e));return i};trimEvalMap.RANGE=trimEvalMap.POWER;trimEvalMap.TRUE=function(t){return!0};trimEvalMap.FALSE=function(t){return!1};trimEvalMap.STRING=function(t){var e,i=t.origText.substr(1,t.origText.length-2);e='"'==t.origText[0]?i.replace(/\\\\/g,"\\\\TEMPTXT\\\\").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\t/g,"\t").replace(/\\b/g,"\b").replace(/\\f/g,"\f").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\\\TEMPTXT\\\\/g,"\\"):i.replace(/\n/,"\\n");(e=new String(e)).vector=new Vector([],[],StringBase);return e};trimEvalMap.INTEGER=function(t){return new Material(sn("#e"+t.text))};trimEvalMap.MATERIAL=function(t,e){for(var i=t.children[0],n=trimNode(t.children[1],e),r=(i=evaluateUnits(i),[]),a=[],s=0;s<i.length;s++){var o=a.indexOf(i[s].id);if(-1==o){r.push(i[s].exponent);a.push(i[s].id)}else r[o]=r[o]+i[s].exponent}if(n instanceof Material){if(n.units)throw"MSG: Cannot create material where numeric part itself has units.";return new Material(n.value,getUnitStore(a,r,!0))}var l=new TreeNode(t.origText,"MATERIAL",t.line);l.children=[n,getUnitStore(a,r,!0)];return l};trimEvalMap.MULT=function(t,e){if(0==t.children.length)return"*";var i=trimNode(t.children[0],e),n=trimNode(t.children[1],e);if(isConst(i)&&isConst(n))return mult(i,n);var r=new TreeNode(t.origText,t.typeName,t.line);r.children=[i,n];return r};trimEvalMap.DIV=function(t,e){var i=trimNode(t.children[0],e),n=trimNode(t.children[1],e);if(isConst(i)&&isConst(n))return div(i,n);var r=new TreeNode(t.origText,t.typeName,t.line);r.children=[i,n];return r};trimEvalMap.PLUS=function(t,e){var i=trimNode(t.children[0],e),n=trimNode(t.children[1],e);if(isConst(i)&&isConst(n))return plus(i,n);var r=new TreeNode(t.origText,t.typeName,t.line);r.children=[i,n];return r};trimEvalMap.MINUS=function(t,e){var i=trimNode(t.children[0],e),n=trimNode(t.children[1],e);if(isConst(i)&&isConst(n))return minus(i,n);var r=new TreeNode(t.origText,t.typeName,t.line);r.children=[i,n];return r};trimEvalMap.FLOAT=trimEvalMap.INTEGER;trimEvalMap.PRIMITIVE=function(t,e){var i;if(void 0===(i="[["==t.text.substr(0,2)?new PrimitiveStore(e[t.text.substr(2,t.text.length-4)],"totalValue"):new PrimitiveStore(e[t.text.substr(1,t.text.length-2)],"object")).primitive)throw"MSG: The primitive <i>"+t.origText+"</i> could not be found.";return i};trimEvalMap.NEGATE=function(t,e){if(0==t.children.length)return new TreeNode(t.origText,t.typeName,t.line);var i=trimNode(t.children[0],e);if(isConst(i))return negate(i);var n=new TreeNode(t.origText,t.typeName,t.line);n.children=[i];return n};trimEvalMap.ARRAY=function(t,e){for(var i=new TreeNode(t.origText,t.typeName,t.line),n=[],r=[],a=!1,s=0;s<t.children.length;s++){i.children.push(trimNode(t.children[s],e));n.push(i.children[s].children[0]);if(i.children[s].children.length>1){i.children[s].children[1].text?r.push(i.children[s].children[1].origText):r.push(i.children[s].children[1].valueOf());a=!0}else r.push(void 0)}var o=!0;for(s=0;s<n.length;s++)if(!isConst(n[s])){o=!1;break}o&&(i.children=[new Vector(n,a?r:void 0)]);return i};function isConst(t){return t instanceof Material||"string"==typeof t||t instanceof String||"boolean"==typeof t||t instanceof Vector}function trimNode(t,e){if(trimEvalMap.hasOwnProperty(t.typeName)){evaluatingLine=t.line||evaluatingLine;return trimEvalMap[t.typeName](t,e)}for(var i=new TreeNode(t.origText,t.typeName,t.line),n=0;n<t.children.length;n++)i.children.push(trimNode(t.children[n],e));return i}function trueValue(t){if("boolean"==typeof t)return t;if(t instanceof Material)return neq(t.value,0);throw"MSG: Only numbers can be used in place of booleans."}function fireEvent(t,e,i){var n,r=t;if(t instanceof Vector)n=t.parent;else if(t.vector instanceof Vector)n=(t=t.vector).parent;else{if(!(t.parent instanceof Vector))return!1;n=t=t.parent}try{var a=selectFromVector(t,e)}catch(t){return!1}i.optional=!0;return callFunction(a.data,[i],varBank,r,n)}function ObjToVec(t){for(var e=Object.keys(t),i=[],n=0;n<e.length;n++)i.push(t[e[n]]);return new Vector(i,e)}functionLoaders.push((function(){defineFunction("RandBeta",{params:[{name:"Alpha",noUnits:!0,noVector:!0},{name:"Beta",noUnits:!0,noVector:!0}]},(function(t){return new Material(RandBeta(t[0].value,t[1].value))}));defineFunction("RandDist",{params:[{name:"Distribution",noUnits:!0,needVector:!0},{name:"Y (in which case Distribution is X)",noUnits:!0,needVector:!0,defaultVal:!1}]},(function(t){var e,i;if(1==t.length||!1===t[1]){var n=t[0];e=[];i=[];for(var r=0;r<n.items.length;r++){e.push(n.items[r].items[0].toNum().value);i.push(n.items[r].items[1].toNum().value)}}else{e=t[0].toNum().items.map((function(t){return t.value}));i=t[1].toNum().items.map((function(t){return t.value}))}return new Material(RandDist(e,i))}));defineFunction("RandBoolean",{params:[{name:"Probability",defaultVal:.5,noUnits:!0,noVector:!0}]},(function(t){var e;e=0!=t.length?t[0].toNum().value:.5;return Rand()<e}));defineFunction("Rand",{params:[{name:"Lower Bound",defaultVal:0,noUnits:!0,noVector:!0},{name:"Upper Bound",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){return 0!=t.length?new Material(Rand(t[0].toNum().value,t[1].toNum().value)):new Material(Rand())}));defineFunction("RandNormal",{params:[{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){return 0!=t.length?new Material(RandNormal(t[0].toNum().value,t[1].toNum().value)):new Material(RandNormal())}));defineFunction("RandExp",{params:[{name:"Rate",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){return 0!=t.length?new Material(RandExp(t[0].toNum().value)):new Material(RandExp())}));defineFunction("RandLognormal",{params:[{name:"Mean",noUnits:!0,noVector:!0},{name:"Standard Deviation",noUnits:!0,noVector:!0}]},(function(t){return new Material(RandLognormal(t[0].toNum().value,t[1].toNum().value))}));defineFunction("RandBinomial",{params:[{name:"Count",noUnits:!0,noVector:!0},{name:"Probability",noUnits:!0,noVector:!0}]},(function(t){return new Material(RandBinomial(t[0].toNum().value,t[1].toNum().value))}));defineFunction("RandNegativeBinomial",{params:[{name:"Successes",noUnits:!0,noVector:!0},{name:"Probability",noUnits:!0,noVector:!0}]},(function(t){return new Material(RandNegativeBinomial(t[0].toNum().value,t[1].toNum().value))}));defineFunction("RandGamma",{params:[{name:"Alpha",noUnits:!0,noVector:!0},{name:"Beta",noUnits:!0,noVector:!0}]},(function(t){return new Material(RandGamma(t[0].toNum().value,t[1].toNum().value))}));defineFunction("RandPoisson",{params:[{name:"Rate",noUnits:!0,noVector:!0}]},(function(t){return new Material(RandPoisson(t[0].toNum().value))}));defineFunction("RandTriangular",{params:[{name:"Minimum",noUnits:!0,noVector:!0},{name:"Maximum",noUnits:!0,noVector:!0},{name:"Peak",noUnits:!0,noVector:!0}]},(function(t){return new Material(RandTriangular(t[0].toNum().value,t[1].toNum().value,t[2].toNum().value))}));defineFunction("Real",{params:[{name:"Number"}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn["real-part"](e.value);return e}));defineFunction("Imag",{params:[{name:"Number"}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn["imag-part"](e.value);return e}));defineFunction("Magnitude",{params:[{name:"Number"}]},(function(t){if(t[0].toNum()instanceof Vector)return functionBank.sqrt([functionBank.sum([mult(t[0],t[0])])]);var e=t[0].toNum();e.value=fn.magnitude(e.value);return e}));defineFunction("Angle",{params:[{name:"Number"}],recurse:!0},(function(t){return new Material(fn.angle(t[0].toNum().value),getUnitStore(["radians"],[1]))}));defineFunction("Abs",{params:[{name:"Number"}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn.abs(e.value);return e}));defineFunction("sin",{params:[{name:"Number"}],recurse:!0},(function(t){var e=t[0].toNum();e.units&&(e=mult(e,new Material(1,getUnitStore(["radians"],[-1]))));if(e.units)throw"MSG: Non-angular units cannot be used in Sin().";return new Material(fn.sin(e.value))}));defineFunction("cos",{params:[{name:"Number"}],recurse:!0},(function(t){var e=t[0].toNum();e.units&&(e=mult(e,new Material(1,getUnitStore(["radians"],[-1]))));if(e.units)throw"MSG: Non-angular units cannot be used in Cos().";return new Material(fn.cos(e.value))}));defineFunction("tan",{params:[{name:"Number"}],recurse:!0},(function(t){var e=t[0].toNum();e.units&&(e=mult(e,new Material(1,getUnitStore(["radians"],[-1]))));if(e.units)throw"MSG: Non-angular units cannot be used in Tan().";return new Material(fn.tan(e.value))}));defineFunction("asin",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.asin(t[0].toNum().value))}));defineFunction("acos",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.acos(t[0].toNum().value))}));defineFunction("atan",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.atan(t[0].toNum().value))}));defineFunction("arcsin",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.asin(t[0].toNum().value),getUnitStore(["radians"],[1]))}));defineFunction("arccos",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.acos(t[0].toNum().value),getUnitStore(["radians"],[1]))}));defineFunction("arctan",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.atan(t[0].toNum().value),getUnitStore(["radians"],[1]))}));defineFunction("Sign",{params:[{name:"Number"}],recurse:!0},(function(t){var e=t[0].toNum();if(e.value<0)return div(new Material(-1),new Material(1));if(e.value>0)return div(new Material(1),new Material(1));if(0==e.value)return new Material(0);throw"MSG: Invalid value for Sign"}));defineFunction("Sqrt",{params:[{name:"Number"}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn.sqrt(e.value);e.units&&(e.units=e.units.power(.5));return e}));defineFunction("Ln",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.log(t[0].toNum().value))}));defineFunction("Log",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.log(t[0].toNum().value,10))}));defineFunction("Logit",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn["-"](fn.log(e.value),fn.log(fn["-"](1,e.value)));return e}));defineFunction("Expit",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn["/"](1,fn["+"](1,fn.exp(fn["-"](e.value))));return e}));defineFunction("Round",{params:[{name:"Number",noUnits:!1}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn.round(e.value);return e}));defineFunction("Ceiling",{params:[{name:"Number",noUnits:!1}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn.ceiling(e.value);return e}));defineFunction("Floor",{params:[{name:"Number",noUnits:!1}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn.floor(e.value);return e}));defineFunction("Exp",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.exp(t[0].toNum().value))}));functionBank.ifthenelse=function(t){testArgumentsSize(t,"IfThenElse",3,3);var e=evaluateNode(t[0].node,t[0].scope).toNum();return e instanceof Vector?function(t,e,i){var n=function(t,e){return t instanceof Vector?t.combine(e,n):[t,e]};e=e.toNum();i=i.toNum();if(e instanceof Vector)var r=e.cloneCombine(i,n);else r=i instanceof Vector?i.cloneCombine(e,(function(t,e){return n(e,t)})):n(e,i);var a=function(t,e){return t instanceof Vector?t.combine(e,a):trueValue(t)?e[0]:e[1]};return t.cloneCombine(r,a)}(e,evaluateNode(t[1].node,t[1].scope),evaluateNode(t[2].node,t[2].scope)):trueValue(e)?evaluateNode(t[1].node,t[1].scope):evaluateNode(t[2].node,t[2].scope)};functionBank.ifthenelse.delayEvalParams=!0;functionBank.map=function(t){testArgumentsSize(t,"Map",2,2);var e,i;(e=t[0].node instanceof Vector?t[0].node:t[0]instanceof Vector?t[0]:evaluateNode(t[0].node,t[1].scope))instanceof Primitive&&(e=e.toNum());if(!(e instanceof Vector))throw"MSG: Map() requires a vector as its first argument.";e=e.fullClone();var n,r={x:null,"-parent":t[1].scope},a=t[1].node;try{i=evaluateNode(a,r)}catch(t){}if(i instanceof Function||i instanceof UserFunction){i.fn&&(i=i.fn);n=function(t,e){return i([t])}}else n=function(t,e){r.x=t;r.key=e||"";return evaluateNode(a,r)};return e.apply(n)};functionBank.map.delayEvalParams=!0;VectorObject.map=functionBank.map;defineFunction("Sample",{object:[functionBank,VectorObject],params:[{name:"Vector",needVector:!0},{name:"Sample Size"},{name:"Repeat",noVector:!0,allowBoolean:!0,defaultVal:!1}]},(function(t){var e=t[0].toNum(),i=t[1].toNum().value;if(0==i)return new Vector([]);var n=e.length(),r=t[2]&&trueValue(t[2].toNum());if(0==n)throw"MSG: Sample() requires a non-empty vector.";var a=[];if(r)for(var s=0;s<i;s++)a.push(e.items[Math.floor(Rand()*n)]);else{if(n<i)throw"MSG: Vector for Sample() is too small for the given sample size.";var o=e.items.slice();for(s=0;s<i;s++)a.push(o.splice(Math.floor(Rand()*o.length),1)[0])}return new Vector(a)}));defineFunction("IndexOf",{object:[functionBank,VectorObject],params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Needle",allowBoolean:!0,allowString:!0}]},(function(e){var i=e[1];if(i instanceof Vector){for(var n=[],r=0;r<i.items.length;r++)n.push(t(i.items[r],e[0]));return new Vector(n)}return t(i,e[0])}));defineFunction("Contains",{object:[functionBank,VectorObject],params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Needle",allowBoolean:!0,noVector:!0,allowString:!0}]},(function(t){return!eq(new Material(0),functionBank.indexof(t))}));defineFunction("Collapse",{params:[{name:"Source",needVector:!0,noUnits:!1},{name:"Target",noVector:!1}]},(function(t){return t[0].toNum().collapseDimensions(t[1].toNum())}));function t(t,e){for(var i=0;i<e.length();i++)if(eq(t,e.items[i]))return new Material(i+1);return new Material(0)}functionBank.filter=function(t){testArgumentsSize(t,"Filter",2,2);var e;(e=t[0].node instanceof Vector?t[0].node:t[0]instanceof Vector?t[0]:evaluateNode(t[0].node,t[0].scope))instanceof Primitive&&(e=e.toNum());if(!(e instanceof Vector))throw"MSG: Filter() requires a vector as its first argument.";e=e.fullClone();var i=functionBank.map(t);return functionBank.select([e,i])};functionBank.filter.delayEvalParams=!0;VectorObject.filter=functionBank.filter;functionBank.join=function(t){for(var e=[],i=[],n=!1,r=0;r<t.length;r++){var a=t[r];a instanceof Primitive&&(a=a.toNum());if(a instanceof Vector){e=e.concat(a.items);if(a.names){i=i.concat(a.names);n=!0}else for(var s=0;s<a.items.length;s++)i.push(void 0)}else{e.push(a);i.push(void 0)}}return new Vector(e,n?i:void 0)};functionBank.repeat=function(t){testArgumentsSize(t,"Repeat",2,2);var e=evaluateNode(t[1].node,t[1].scope).toNum(),i=e;e instanceof Vector&&(i=e.items.length);for(var n=[],r={x:null,"-parent":t[1].scope,key:null},a=0;a<i;a++){e instanceof Vector&&(r.key=e.items[a]);r.x=new Material(a+1);n.push(evaluateNode(t[0].node,r))}return new Vector(n,e instanceof Vector?e.items.slice():void 0)};functionBank.repeat.delayEvalParams=!0;defineFunction("Select",{params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Indexes",noUnits:!0}]},(function(t){t[1].toNum();if(t[1]instanceof Vector){for(var e=t[1].toNum(),i=!0,n=0;n<e.length();n++)if(e.items[n]instanceof Material){i=!1;break}if(1==i){var r=[],a=t[0].names?[]:void 0;if(e.length()!=t[0].length())throw"MSG: Length of vector must be equal for boolean selection.";for(n=0;n<e.length();n++)if(trueValue(e.items[n])){r.push(t[0].items[n]);t[0].names&&a.push(t[0].names[n])}return new Vector(r,a)}for(r=[],a=t[0].names?[]:void 0,n=0;n<e.length();n++){var s=e.items[n].value;if(s<=0||s>t[0].length())throw"MSG: Selected element out of range.";r.push(t[0].items[s-1]);t[0].names&&a.push(t[0].names[s-1])}return new Vector(r,a)}if(t[1].value>0&&t[1].value<=t[0].length())return t[0].items[t[1].value-1];throw"MSG: Selected element out of range."}));defineFunction("Reverse",{allowEmpty:!0,params:{name:"Items..."},prep:function(t){return functionBank.join(t)}},(function(t){return new Vector(t.items.slice().reverse(),t.names?t.names.slice().reverse():void 0)}));defineFunction("Reverse",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.reverse(t)}));defineFunction("Sort",{allowEmpty:!0,params:{name:"Items..."},prep:function(t){return functionBank.join(t).toNum()}},(function(t){return t.stackApply((function(t){for(var e=[],i=0;i<t.items.length;i++)e.push({item:t.items[i],name:t.names?t.names[i]:void 0});var n=e.sort((function(t,e){return lessThan(t.item,e.item)?-1:greaterThan(t.item,e.item)?1:0})),r=t.names?[]:void 0;e=[];for(i=0;i<n.length;i++){e.push(n[i].item);r&&r.push(n[i].name)}return new Vector(e,r)}))}));defineFunction("Sort",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.sort(t)}));defineFunction("Unique",{allowEmpty:!0,params:{name:"Items....",allowBoolean:!0},prep:function(t){return functionBank.join(t).toNum()}},(function(t){if(0==t.items.length)return new Vector([]);for(var e=[],i=t.names?[]:void 0,n=0;n<t.items.length;n++){for(var r=!1,a=0;a<e.length;a++)if(strictEquals(t.items[n],e[a])){r=!0;break}if(!r){e.push(t.items[n]);i&&i.push(t.names[n])}}return new Vector(e,i)}));defineFunction("Unique",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.unique(t)}));defineFunction("Union",{object:[functionBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},(function(t){return functionBank.unique(functionBank.join(t).items)}));defineFunction("Intersection",{object:[functionBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},(function(t){for(var e=t[0],i=t[1],n=[],r=0;r<e.items.length;r++)for(var a=0;a<i.items.length;a++)if(strictEquals(e.items[r],i.items[a])){n.push(e.items[r]);break}return functionBank.unique(n)}));defineFunction("Difference",{object:[functionBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},(function(t){for(var e=t[0],i=t[1],n=[],r=0;r<e.items.length;r++){for(var a=!1,s=0;s<i.items.length;s++)if(strictEquals(e.items[r],i.items[s])){a=!0;break}a||n.push(e.items[r])}for(r=0;r<i.items.length;r++){for(a=!1,s=0;s<e.items.length;s++)if(strictEquals(i.items[r],e.items[s])){a=!0;break}a||n.push(i.items[r])}return functionBank.unique(n)}));defineFunction("Factorial",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(factorial(t[0].toNum().value))}));defineFunction("Max",{params:{name:"Items..."},prep:e},(function(t){return t.stackApply((function(t){var e=t.items;if(e.length>0){for(var i=e[0],n=1;n<e.length;n++)greaterThan(e[n],i)&&(i=e[n]);return i}throw"MSG: You must have at least one element to calculate a max."}))}));defineFunction("Max",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.max(t)}));function e(t,e,i){if(!e)for(var r=0;r<t.length;r++)t[r]=t[r].toNum();return 1==t.length&&t[0]instanceof Vector?i?t[0]:functionBank.flatten([t[0]]):new Vector(function(t){for(var e,i=!1,r=0;r<t.length;r++)if(t[r]instanceof Vector){e=t[r];i=!0;break}if(i)for(r=0;r<t.length;r++)t[r]instanceof Vector||(t[r]=n(e,t[r]));return t}(t))}function i(t){for(var i=0;i<t.length;i++)t[i].toNum&&(t[i]=t[i].toNum());return 1==t.length&&t[0]instanceof Vector?functionBank.flatten([t[0].toNum()]).items:e(t,void 0,!0).items}function n(t,e){for(var i=t.fullClone(),r=0;r<i.items.length;r++)i.items[r]instanceof Vector?i.items[r]=n(i.items[r],e):i.items[r]=e;return i}defineFunction("Lookup",{params:[{name:"Value",noVector:!0},{name:"Value Vector",needVector:!0},{name:"Results Vector",needVector:!0}]},(function(t){var e=t[0].toNum(),i=t[1].toNum(),n=t[2].toNum();if(i.items.length!=n.items.length)throw"MSG: The value and results vectors must be the same length";if(i.items.length<1)throw"MSG: You must have at least one element in your vectors";for(var r=[],a=0;a<i.items.length;a++)r.push({x:i.items[a],y:n.items[a]});r.sort((function(t,e){return greaterThan(t.x,e.x)?1:lessThan(t.x,e.x)?-1:0}));for(a=0;a<r.length;a++){if(eq(r[a].x,e))return r[a].y.fullClone();if(greaterThan(r[a].x,e)){if(0==a)return r[a].y.fullClone();var s=minus(r[a].x,r[a-1].x),o=minus(e,r[a-1].x),l=div(minus(r[a].x,e),s),u=div(o,s);return plus(mult(r[a-1].y,l),mult(r[a].y,u))}}return r[r.length-1].y.fullClone()}));defineFunction("Fill",{object:[functionBank,VectorObject],params:[{name:"Vector",needVector:!0},{name:"Value",allowBoolean:!0}]},(function(t){return n(t[0],t[1])}));defineFunction("Min",{params:{name:"Items..."},prep:e},(function(t){return t.stackApply((function(t){var e=t.items;if(e.length>0){for(var i=e[0],n=1;n<e.length;n++)lessThan(e[n],i)&&(i=e[n]);return i}throw"MSG: You must have at least one element to calculate a median."}))}));defineFunction("Min",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.min(t)}));defineFunction("Mean",{params:{name:"Items..."},prep:i},(function(t){for(var e=t[0],i=1;i<t.length;i++)e=plus(e,t[i]);return div(e,new Material(t.length))}));defineFunction("Mean",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.mean(t)}));defineFunction("Sum",{params:{name:"Items..."},prep:i},(function(t){for(var e=t[0],i=1;i<t.length;i++)e=plus(e,t[i]);return e}));defineFunction("Sum",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.sum(t)}));defineFunction("Product",{params:{name:"Items..."},prep:i},(function(t){for(var e=t[0],i=1;i<t.length;i++)e=mult(e,t[i]);return e}));defineFunction("Product",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.product(t)}));defineFunction("Median",{params:{name:"Items..."},prep:e},(function(t){return t.stackApply((function(t){var e=functionBank.sort([t]).items;if(e.length>0)return Math.floor((e.length-1)/2)==(e.length-1)/2?e[(e.length-1)/2]:div(plus(e[Math.floor((e.length-1)/2)],e[Math.ceil((e.length-1)/2)]),new Material(2));throw"MSG: You must have at least one element to calculate a median."}))}));defineFunction("Median",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.median(t)}));defineFunction("StdDev",{params:{name:"Items..."},prep:e},(function(t){return t.stackApply((function(t){var e=t.items;if(e.length>1){for(var i=functionBank.mean(e),n=power(minus(e[0],i),new Material(2)),r=1;r<e.length;r++)n=plus(n,power(minus(e[r],i),new Material(2)));var a=power(div(n,new Material(e.length-1)),new Material(.5));return functionBank.real([a])}throw"MSG: You must have at least two elements to calculate the standard deviation."}))}));defineFunction("StdDev",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.stddev(t)}));defineFunction("Correlation",{params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},(function(t){var e=t[0].toNum(),i=t[1].toNum();if(e.length()<=1)throw"MSG: You must have at least two elements in your vectors to calculate their correlation.";if(e.length()!=i.length())throw"MSG: The vectors for Correlation() must be of the same size.";var n=functionBank.mean([e]),r=functionBank.mean([i]),a=functionBank.stddev([e]),s=functionBank.stddev([i]);return 0==a.value||0==s.value?new Material(0):div(functionBank.sum([mult(minus(e.clone(),n),minus(i.clone(),r))]),mult(minus(functionBank.count([e]),new Material(1)),mult(a,s)))}));functionBank.count=function(t){t=functionBank.join(t).items;return new Material(sn("#e"+t.length))};functionBank.flatten=function(t){var e=r(functionBank.join(t));return new Vector(e.items,e.hasName?e.names:void 0)};defineFunction("Keys",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return t[0].names?new Vector(t[0].names.filter((function(t){return isDefined(t)})).map((function(t){return s(t)}))):new Vector([])}));defineFunction("Values",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return new Vector(t[0].items)}));defineFunction("Length",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return new Material(sn("#e"+t[0].items.length))}));defineFunction("Count",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return new Material(sn("#e"+t[0].items.length))}));defineFunction("Flatten",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.flatten(t)}));function r(t){for(var e=[],i=[],n=void 0,a=0;a<t.length();a++)if(t.items[a]instanceof Vector){var s=r(t.items[a]);e=e.concat(s.items);i=i.concat(s.names);n=n||s.hasName}else{e.push(t.items[a]);if(t.names){i.push(t.names[a]);n=!0}else i.push(void 0)}return{items:e,names:i,hasName:n}}defineFunction("CDFNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,i=t[1]?t[1].toNum().value:0,n=t[2]?t[2].toNum().value:1;return new Material(jStat.normal.cdf(e,i,n))}));defineFunction("PDFNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,i=t[1]?t[1].toNum().value:0,n=t[2]?t[2].toNum().value:1;return new Material(jStat.normal.pdf(e,i,n))}));defineFunction("InvNormal",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value;if(e<0||e>1)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";var i=t[1]?t[1].toNum().value:0,n=t[2]?t[2].toNum().value:1;return new Material(jStat.normal.inv(e,i,n))}));defineFunction("CDFLogNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,i=t[1]?t[1].toNum().value:0,n=t[2]?t[2].toNum().value:1;return new Material(jStat.lognormal.cdf(e,i,n))}));defineFunction("PDFLogNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,i=t[1]?t[1].toNum().value:0,n=t[2]?t[2].toNum().value:1;return new Material(jStat.lognormal.pdf(e,i,n))}));defineFunction("InvLogNormal",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value;if(e<0||e>1)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";var i=t[1]?t[1].toNum().value:0,n=t[2]?t[2].toNum().value:1;return new Material(jStat.lognormal.inv(e,i,n))}));defineFunction("CDFt",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,i=t[1].toNum().value;if(i<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.studentt.cdf(e,i))}));defineFunction("PDFt",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,i=t[1].toNum().value;if(i<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.studentt.pdf(e,i))}));defineFunction("Invt",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value;if(e<0||e>1)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";var i=t[1].toNum().value;if(i<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.studentt.inv(e,i))}));defineFunction("CDFF",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 1",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 2",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,i=t[1].toNum().value;if(i<=0)throw"MSG: Degrees of Freedom must be greater than 0.";var n=t[2].toNum().value;if(n<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.centralF.cdf(e,i,n))}));defineFunction("PDFF",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 1",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 2",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,i=t[1].toNum().value;if(i<=0)throw"MSG: Degrees of Freedom must be greater than 0.";var n=t[2].toNum().value;if(n<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.centralF.pdf(e,i,n))}));defineFunction("InvF",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 1",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 2",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value;if(e<0||e>1)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";var i=t[1].toNum().value;if(i<=0)throw"MSG: Degrees of Freedom must be greater than 0.";var n=t[2].toNum().value;if(n<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.centralF.inv(e,i,n))}));defineFunction("CDFChiSquared",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,i=t[1].toNum().value;if(i<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.chisquare.cdf(e,i))}));defineFunction("PDFChiSquared",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,i=t[1].toNum().value;if(i<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.chisquare.pdf(e,i))}));defineFunction("InvChiSquared",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value;if(e<0||e>1)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";var i=t[1].toNum().value;if(i<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.chisquare.inv(e,i))}));defineFunction("CDFExponential",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Rate",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,i=t[1].toNum().value;if(i<=0)throw"MSG: Rate must be greater than 0.";return new Material(jStat.exponential.cdf(e,i))}));defineFunction("PDFExponential",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Rate",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,i=t[1].toNum().value;if(i<=0)throw"MSG: Rate must be greater than 0.";return new Material(jStat.exponential.pdf(e,i))}));defineFunction("InvExponential",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"DRate",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value;if(e<0||e>1)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";var i=t[1].toNum().value;if(i<=0)throw"MSG: Rate must be greater than 0.";return new Material(jStat.exponential.inv(e,i))}));defineFunction("CDFPoisson",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Lambda",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,i=t[1].toNum().value;if(i<=0)throw"MSG: Lambda must be greater than 0.";return new Material(jStat.poisson.cdf(e,i))}));defineFunction("PMFPoisson",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Lambda",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,i=t[1].toNum().value;if(i<=0)throw"MSG: Rate must be greater than 0.";return new Material(jStat.poisson.pdf(e,i))}));defineFunction("SetRandSeed",{params:[{name:"Seed Number",noUnits:!0,noVector:!0}]},(function(t){Math.seedrandom(t[0].toNum().value);return"Random Seed Set"}));defineFunction("Alert",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},(function(t){alert(t[0]);return 1}));defineFunction("Console",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},(function(t){console.log(t[0]);return 1}));defineFunction("Prompt",{params:[{name:"Message",allowString:!0,allowBoolean:!0},{name:"Default",defaultVal:"",allowString:!0,allowBoolean:!0}]},(function(t){var e=t[1];e instanceof Material&&!e.units&&(e=e.value);t=prompt(t[0],e);return parseFloat(t).toString()==t?new Material(parseFloat(t)):t}));defineFunction("Confirm",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},(function(t){return confirm(t[0])}));defineFunction("Parse",{object:StringObject,params:[{name:"String",allowString:!0}]},(function(t){return new Material(parseFloat(t[0],10))}));defineFunction("Split",{object:StringObject,params:[{name:"String",needString:!0},{name:"Splitter",needString:!0}]},(function(t){return s(new Vector(t[0].split(t[1])))}));defineFunction("Join",{object:VectorObject,params:[{name:"String",needVector:!0},{name:"Joiner",needString:!0}]},(function(t){return s(t[0].items.join(t[1]))}));defineFunction("Trim",{object:StringObject,params:[{name:"String",needString:!0}],recurse:!0},(function(t){return s(t[0].trim())}));defineFunction("Range",{object:StringObject,params:[{name:"String",needString:!0},{name:"Indexes",noUnits:!0,allowVector:!0}]},(function(t){if(t[1]instanceof Vector){for(var e="",i=0;i<t[1].items.length;i++)e+=t[0].charAt(t[1].items[i].toNum().value-1);return s(e)}return s(t[0].charAt(t[1].toNum().value-1))}));defineFunction("Length",{object:StringObject,params:[{name:"String",needString:!0}]},(function(t){return new Material(t[0].length)}));defineFunction("IndexOf",{object:StringObject,params:[{name:"Haystack",needString:!0},{name:"Needle",needString:!0}]},(function(t){return new Material(t[0].indexOf(t[1])+1)}));defineFunction("Contains",{object:StringObject,params:[{name:"Haystack",needString:!0},{name:"Needle",needString:!0}]},(function(t){return!eq(StringObject.indexof(t),new Material(0))}));defineFunction("Lowercase",{object:StringObject,params:[{name:"String",needString:!0}]},(function(t){return s(t[0].toLowerCase())}));defineFunction("Uppercase",{object:StringObject,params:[{name:"String",needString:!0}]},(function(t){return s(t[0].toUpperCase())}));StringBase=makeObjectBase(StringObject);VectorBase=makeObjectBase(VectorObject)}));function s(t){if(t instanceof Vector)return t.recurseApply(s);var e=new String(t);e.parent=StringBase;return e}function makeObjectBase(t){for(var e=Object.keys(t),i=[],n=0;n<e.length;n++)i.push(objectizeFunction(t[e[n]]));var r=new Vector(i,e);r.parent=void 0;return r}function defineFunction(t,e,i){for(var n,r=e.params,a=Array.isArray(r),s=[],o=r.length,l=0;l<r.length;l++)if(r[l].hasOwnProperty("defaultVal")){o=l;break}for(l=0;l<r.length;l++)if(r[l].vectorize){s.push(l);if(r[l].noVector)throw"MSG: Cannot have a non-vector vectorized parameter. Function '"+t+"', parameter '"+r[l].name+"'."}n=a?e.object?t+"("+r.slice(1).map((function(t){return t.name+(t.hasOwnProperty("defaultVal")?"="+t.defaultVal.toString():"")})).join(", ")+")":t+"("+r.map((function(t){return t.name+(t.hasOwnProperty("defaultVal")?"="+t.defaultVal.toString():"")})).join(", ")+")":t+"(items...)";var u=function(l,h){e.prep&&(l=e.prep(l));if(a&&(l.length>r.length||l.length<o))throw"MSG: Wrong number of parameters for "+n+".";if(!a&&0==l.length&&!e.allowEmpty)throw"MSG: At least one parameter required for "+t+"().";for(var c=0;c<l.length;c++){var d=a?r[c]:r;if(d.noUnits&&l[c].toNum()instanceof Material&&l[c].toNum().units)throw"MSG: "+n+" does not except units for the argument '"+d.name+"'.";if(d.noVector&&l[c]instanceof Vector)throw"MSG: "+n+" does not except vectors for the argument '"+d.name+"'.";if(d.vectorize&&l[c]instanceof Vector&&!l[c].names)throw"MSG: "+n+" does not accepted non-named vectors for the argument '"+d.name+"'.";if(d.needVector){l[c]instanceof Primitive&&(l[c]=l[c].toNum());if(!(l[c]instanceof Vector))throw"MSG: "+n+" requires a vector for the argument '"+d.name+"'."}if(d.needPrimitive&&!(l[c]instanceof Primitive))throw"MSG: "+n+" requires a primitive for the argument '"+d.name+"'.";if(!d.allowBoolean&&"boolean"==typeof l[c])throw"MSG: "+n+" does not accept boolean values for the argument '"+d.name+"'.";!d.needAgent||l[c]instanceof Agent||(l[c]=agent(l[c],n,d.name));if(d.needString&&!("string"==typeof l[c]||l[c]instanceof String))throw"MSG: "+n+" requires a string for the argument '"+d.name+"'.";if(!d.allowString&&!d.needString&&("string"==typeof l[c]||l[c]instanceof String))throw"MSG: "+n+" does not accept string values for the argument '"+d.name+"'.";!d.needAgents||l[c]instanceof Agents||(l[c]=agents(l[c],n,d.name));!d.needPopulation||l[c]instanceof Vector||(l[c]=getPopulation(l[c],n,d.name));if(d.needFunction&&!(l[c]instanceof Function||l[c]instanceof UserFunction))throw"MSG: "+n+" requires a function for the argument '"+d.name+"'."}if(e.recurse)var m=l[0].toNum();if(e.recurse&&m instanceof Vector)return m.cloneApply((function(t){return u([t].concat(l.slice(1)),h)}));if(s.length>0){var f=void 0,g=-1;for(c=0;c<s.length;c++)if(l[s[c]]){if((N=l[s[c]].toNum())instanceof Vector&&N.namesLC)if(f){if(!f.keysMatch(N.namesLC))throw"MSG: Vector keys do not match between parameters '"+r[g].name+"' and '"+r[s[c]].name+"' in "+n+"."}else{f=N;g=s[c]}}if(f){var p=f.namesLC,_=[];for(c=0;c<p.length;c++){for(var v=[],S=0;S<l.length;S++)if(-1==s.indexOf(S))v.push(l[S]);else{var N;(N=l[S].toNum())instanceof Vector&&N.namesLC?v.push(N.select([p[c]])):v.push(N)}var T=i(v,h);if(T instanceof Vector){if(!f.keysMatch(T.namesLC))throw"MSG: Vector keys do not match between parameter '"+r[g].name+"' and calculation result.";_.push(T.select([p[c]]))}else _.push(T)}return new Vector(_,p)}return i(l,h)}return i(l,h)};if(e.object)if(e.object instanceof Array)for(l=0;l<e.object.length;l++)e.object[l][t.toLowerCase()]=u;else e.object[t.toLowerCase()]=u;else functionBank[t.toLowerCase()]=u;e.recurse&&(VectorObject[t.toLowerCase()]=u)}function objectizeFunction(t){var e=function(e,i,n){return t([n].concat(e),i,n)};e.delayEvalParams=t.delayEvalParams;return e}function factorial(t){if(Math.round(t)!=t)throw"MSG: The factorial() function only accepts integers.";if(t<0)throw"MSG: The factorial() function is only defined for integers 0 or larger.";return t>1?t*factorial(t-1):1}function testArgumentsSize(t,e,i,n){if(t.length<i||t.length>n)throw"MSG: Wrong number of parameters for "+e+"()."}var AgentObject={},PrimitiveBase,PrimitiveObject={};functionLoaders.push((function(){defineFunction("Stop",{params:[]},(function(t){throw{msg:"STOP"}}));defineFunction("Pause",{params:[]},(function(t){simulate.sleep(!0);return new Material(0)}));defineFunction("Time",{params:[]},(function(t){return simulate.time().fullClone()}));defineFunction("TimeStep",{params:[]},(function(t){return simulate.timeStep.fullClone()}));defineFunction("TimeLength",{params:[]},(function(t){return simulate.timeLength.fullClone()}));defineFunction("TimeStart",{params:[]},(function(t){return simulate.timeStart.fullClone()}));defineFunction("TimeEnd",{params:[]},(function(t){return simulate.timeEnd.fullClone()}));defineFunction("Seconds",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},(function(t){return mult(0==t.length?simulate.time().fullClone():t[0].toNum(),new Material(1,getUnitStore(["seconds"],[-1])))}));defineFunction("Minutes",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},(function(t){return mult(0==t.length?simulate.time().fullClone():t[0].toNum(),new Material(1,getUnitStore(["minutes"],[-1])))}));defineFunction("Hours",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},(function(t){return mult(0==t.length?simulate.time().fullClone():t[0].toNum(),new Material(1,getUnitStore(["hours"],[-1])))}));defineFunction("Days",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},(function(t){return mult(0==t.length?simulate.time().fullClone():t[0].toNum(),new Material(1,getUnitStore(["days"],[-1])))}));defineFunction("Weeks",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},(function(t){return mult(0==t.length?simulate.time().fullClone():t[0].toNum(),new Material(1,getUnitStore(["weeks"],[-1])))}));defineFunction("Months",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},(function(t){return mult(0==t.length?simulate.time().fullClone():t[0].toNum(),new Material(1,getUnitStore(["months"],[-1])))}));defineFunction("Years",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},(function(t){return mult(0==t.length?simulate.time().fullClone():t[0].toNum(),new Material(1,getUnitStore(["years"],[-1])))}));defineFunction("Seasonal",{params:[{name:"Peak",defaultVal:"0",vectorize:!0}]},(function(t){var e;0==t.length?e=new Material(0,simulate.timeUnits):(e=t[0].fullClone()).units||(e.units=simulate.timeUnits);var i=2*minus(functionBank.time([]),e).forceUnits(createUnitStore("years")).value*3.14159265359;return new Material(Math.cos(i))}));defineFunction("Unitless",{params:[{name:"Value",noVector:!0}]},(function(t){return new Material(t[0].toNum().value)}));defineFunction("PastMean",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},(function(t){return 1==t.length?functionBank.mean(t[0].getPastValues()):functionBank.mean(t[0].getPastValues(t[1].toNum()))}));defineFunction("PastMedian",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},(function(t){return 1==t.length?functionBank.median(t[0].getPastValues()):functionBank.median(t[0].getPastValues(t[1].toNum()))}));defineFunction("PastValues",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},(function(t){var e;e=1==t.length?t[0].getPastValues():t[0].getPastValues(t[1].toNum());return new Vector(e)}));defineFunction("PastStdDev",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},(function(t){var e;return(e=1==t.length?t[0].getPastValues():t[0].getPastValues(t[1].toNum())).length>1?functionBank.stddev(e):new Material(0)}));defineFunction("PastCorrelation",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"[Primitive]",noVector:!0,needPrimitive:!0,object:[functionBank,PrimitiveObject]},{name:"Past Range",vectorize:!0,defaultVal:"All Time"}]},(function(t){var e,i;if("All Time"!=t[2]){e=t[0].getPastValues();i=t[1].getPastValues()}else{e=t[0].getPastValues(t[2].toNum());i=t[1].getPastValues(t[2].toNum())}return e.length>1?functionBank.correlation([new Vector(e),new Vector(i)]):new Material(0)}));defineFunction("PastMax",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},(function(t){return 1==t.length?functionBank.max(t[0].getPastValues()):functionBank.max(t[0].getPastValues(t[1].toNum()))}));defineFunction("PastMin",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},(function(t){return 1==t.length?functionBank.min(t[0].getPastValues()):functionBank.min(t[0].getPastValues(t[1].toNum()))}));defineFunction("Pulse",{params:[{name:"Start Time",vectorize:!0},{name:"Height",vectorize:!0,defaultVal:1},{name:"Width",vectorize:!0,defaultVal:0},{name:"Repeat Period",vectorize:!0,defaultVal:0}]},(function(t){var e=t[0].toNum(),i=new Material(1),n=new Material(0),r=new Material(0);if(t.length>1){i=t[1].toNum();if(t.length>2){n=t[2].toNum();t.length>3&&(r=t[3].toNum())}}e.units||(e.units=simulate.timeUnits);n.units||(n.units=simulate.timeUnits);r.units||(r.units=simulate.timeUnits);if(r.value<=0){if(eq(simulate.time(),e)||greaterThanEq(simulate.time(),e)&&lessThanEq(simulate.time(),plus(e,n)))return i}else if(greaterThanEq(simulate.time(),e)){t=minus(simulate.time(),mult(functionBank.floor([div(minus(simulate.time(),e),r)]),r));var a=minus(simulate.time(),e);if(0==minus(functionBank.round([div(a,r)]),div(a,r)).value||greaterThanEq(t,e)&&lessThanEq(t,plus(e,n)))return i}return new Material(0,i.units)}));defineFunction("Ramp",{params:[{name:"Start Time",vectorize:!0},{name:"Finish Time",vectorize:!0},{name:"Height",vectorize:!0,defaultVal:1}]},(function(t){var e=t[0].toNum(),i=t[1].toNum(),n=new Material(1);3==t.length&&(n=t[2].toNum());e.units||(e.units=simulate.timeUnits);i.units||(i.units=simulate.timeUnits);if(greaterThanEq(simulate.time(),e)){return div(mult(functionBank.min([minus(i,e),minus(simulate.time(),e)]),n),minus(i,e))}return new Material(0,n.units)}));defineFunction("Step",{params:[{name:"Start Time",vectorize:!0},{name:"Height",vectorize:!0,defaultVal:1}]},(function(t){var e=t[0].toNum(),i=new Material(1);2==t.length&&(i=t[1].toNum());e.units||(e.units=simulate.timeUnits);return greaterThanEq(simulate.time(),e)?i:new Material(0,i.units)}));functionBank.staircase=functionBank.step;defineFunction("Smooth",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Period",vectorize:!0},{name:"Initial Value",vectorize:!0,defaultVal:"None"}]},(function(t){if(t[1].toNum().value<=0)throw"MSG: The smoothing period must be greater than 0.";return 2==t.length?t[0].smoothF(t[1].toNum()):t[0].smoothF(t[1].toNum(),t[2].toNum())}));defineFunction("Delay",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Delay",vectorize:!0},{name:"Initial Value",defaultVal:"None",vectorize:!0}]},(function(t){if(t[1].toNum().value<0)throw"MSG: The delay must be greater than or equal to 0.";return 2==t.length?t[0].pastValue(t[1].toNum()):t[0].pastValue(t[1].toNum(),t[2].toNum())}));defineFunction("Delay1",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Delay",vectorize:!0},{name:"Initial Value",vectorize:!0,defaultVal:"None"}]},(function(t){if(t[1].toNum().value<=0)throw"MSG: The delay must be greater than 0.";return 2==t.length?t[0].expDelayF(1,t[1].toNum()):t[0].expDelayF(1,t[1].toNum(),t[2].toNum())}));defineFunction("Delay3",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Delay",vectorize:!0},{name:"Initial Value",vectorize:!0,defaultVal:"None"}]},(function(t){if(t[1].toNum().value<=0)throw"MSG: The delay must be greater than 0.";return 2==t.length?t[0].expDelayF(3,t[1].toNum()):t[0].expDelayF(3,t[1].toNum(),t[2].toNum())}));functionBank.fix=function(t,e){testArgumentsSize(t,"Fix",1,2);var i=-1;2==t.length&&(i=evaluateNode(t[1].node,t[1].scope).toNum());for(var n=null,r=0;r<simulate.oldAggregateSeries.length;r++)if(simulate.oldAggregateSeries[r].match(e)){n=simulate.oldAggregateSeries[r];break}if(null===n){n=new AggregateSeries(e,i);simulate.oldAggregateSeries.push(n)}return n.get(t[0])};functionBank.fix.delayEvalParams=!0;functionBank.populationsize=function(t){testArgumentsSize(t,"PopulationSize",1,1);if(t[0]instanceof Agents)return new Material(sn("#e"+t[0].agents.length));throw"MSG: PopulationSize must be passed an agent population as an argument."};PrimitiveObject.populationsize=functionBank.populationsize;defineFunction("Remove",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent]"}]},(function(t){if(t[0].dead)throw"MSG: Cannot remove an already removed agent.";simulate.tasks.add(new Task({time:simulate.time(),priority:10,expires:1,name:"Remove Agent",action:function(){t[0].die()}}));return new Material(1)}));defineFunction("Add",{object:[functionBank,PrimitiveObject],params:[{name:"[Agent Population]"},{needAgent:!0,name:"[Base]",defaultVal:"Agent Base"}]},(function(t){for(;!(t[0]instanceof Agents)&&null!=t[0].container;)t[0]=t[0].container;if(!(t[0]instanceof Agents))throw"MSG: You must pass an agent population as the first argument to Add().";return 2==t.length?t[0].add(t[1]):t[0].add()}));defineFunction("FindAll",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"}]},(function(t){return t[0]}));defineFunction("ResetTimer",{object:[functionBank,PrimitiveObject],params:[{needPrimitive:!0,name:"[Action]"}]},(function(t){if(!(t[0]instanceof Action))throw"MSG: ResetTimer requires an Action primitive.";t[0].resetTimer();return new Material(0)}));defineFunction("Transition",{object:[functionBank,PrimitiveObject],params:[{needPrimitive:!0,name:"[Transition]"}]},(function(t){if(!(t[0]instanceof Transition))throw"MSG: Transition requires an Transition primitive.";t[0].doTransition();return new Material(0)}));defineFunction("Value",{object:[functionBank,VectorObject,AgentObject],params:[{name:"[Population]"},{needPrimitive:!0,name:"[Primitive]"}]},(function(t){var e=t[1].id,i=null;t[0]instanceof Agents||t[0]instanceof Agent||t[0]instanceof Vector||!t[0]||(t[0]=t[0].toNum());t[0]instanceof Agents&&(i=getPopulation(t[0]));t[0]instanceof Vector&&(i=t[0]);if(null!==i){for(var n=[],r=-1,a=0;a<i.items.length;a++)if(-1!=r)n.push(i.items[a].children[r]);else for(var s=0;s<i.items[a].children.length;s++)if(i.items[a].children[s].id==e){n.push(i.items[a].children[s]);r=s;break}return new Vector(n)}if(t[0]instanceof Agent){for(s=0;s<t[0].children.length;s++)if(t[0].children[s].id==e)return t[0].children[s];throw'MSG: Could not find referenced primitive for "Value()".'}throw'MSG: Invalid type for the first argument of "Value()".'}));defineFunction("SetValue",{object:[functionBank,VectorObject,PrimitiveObject,AgentObject],params:[{name:"[Population]"},{needPrimitive:!0,name:"[Primitive]"},{name:"Value",noVector:!0,allowBoolean:!0}]},(function(t){var e=t[1].id,i=null;t[0]instanceof Agents&&(i=getPopulation(t[0]));t[0]instanceof Vector&&(i=t[0]);if(null!==i){for(var n=0;n<i.length();n++)for(var r=0;r<i.items[n].children.length;r++)i.items[n].children[r].id==e&&i.items[n].children[r].setValue(t[2]);return new Material(1)}if(t[0]instanceof Agent){for(r=0;r<t[0].children.length;r++)if(t[0].children[r].id==e){t[0].children[r].setValue(t[2]);return new Material(1)}throw'MSG: Could not find referenced primitive for "SetValue()".'}throw'MSG: Invalid type for the first argument of "SetValue()".'}));defineFunction("FindIndex",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Index",noVector:!0,noUnits:!0}]},(function(t){for(var e=t[0],i=0;i<e.length();i++)if(e.items[i].index+1==t[1].value)return e.items[i];throw"MSG: Index not found in population."}));defineFunction("FindState",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{needPrimitive:!0,name:"[State]"}]},(function(t){var e=t[0];if(!(t[1]instanceof State||"State"===t[1].dna.type))throw"MSG: FindState() requires a State primitive as its argument.";for(var i=t[1].id,n=[],r=0;r<e.items.length;r++)-1!==e.items[r].stateIDs.indexOf(i)&&n.push(e.items[r]);return new Vector(n)}));defineFunction("FindNotState",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{needPrimitive:!0,name:"[State]"}]},(function(t){var e=t[0];if(!(t[1]instanceof State||"State"===t[1].dna.type))throw"MSG: FindNotState() requires a State primitive as its argument.";for(var i=t[1].id,n=[],r=0;r<e.items.length;r++)-1===e.items[r].stateIDs.indexOf(i)&&n.push(e.items[r]);return new Vector(n)}));defineFunction("FindNearby",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Target"},{name:"Distance Limit",noVector:!0}]},(function(e){var i=e[0],n=t(e[1]);try{var r=agent(e[1])}catch(t){}for(var a=[],s=0;s<i.length();s++){var o=agent(i.items[s]);o!==r&&lessThanEq(distance(n,o),e[2])&&a.push(o)}return new Vector(a)}));defineFunction("FindNearest",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Target"},{noUnits:!0,noVector:!0,defaultVal:1,name:"Count"}]},(function(e){var i=e[0],n=1;if(3==e.length){if((n=e[2].value)<1)throw"MSG: You must select at least one agent in FindNearest().";if(n!=Math.floor(n))throw"MSG: Count must be an integer."}var r=t(e[1]);try{var a=agent(e[1])}catch(t){}for(var s=[],o=0;o<i.items.length;o++){var l=agent(i.items[o]);l!==a&&s.push({distance:distance(r,l),item:l})}if(s.length<n)throw"MSG: Can't find nearest "+n+" agents of a population of size "+s.length+".";var u=[s[0]];for(o=1;o<s.length;o++){for(var h=!1,c=0;c<u.length;c++)if(lessThan(s[o].distance,u[c].distance)){u.splice(c,0,s[o]);h=!0;break}!h&&u.length<n?u.push(s[o]):u.length>n&&(u.length=n)}if(1===u.length)return u[0].item;u.sort((function(t,e){return t.distance-e.distance}));return new Vector(u.map((function(t){return t.item})))}));defineFunction("FindFurthest",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Target"},{noUnits:!0,noVector:!0,defaultVal:1,name:"Count"}]},(function(e){var i=e[0],n=1;if(3===e.length){if((n=e[2].value)<1)throw"MSG: You must select at least one agent in FindFurthest().";if(n!=Math.floor(n))throw"MSG: Count must be an integer."}var r=t(e[1]);try{var a=agent(e[1])}catch(t){}for(var s=[],o=0;o<i.items.length;o++){var l=agent(i.items[o]);l!==a&&s.push({distance:distance(r,l),item:l})}if(s.length<n)throw"MSG: Can't find furthest "+n+" agents of a population of size "+s.length+".";var u=[s[0]];for(o=1;o<s.length;o++){for(var h=!1,c=0;c<u.length;c++)if(greaterThan(s[o].distance,u[c].distance)){u.splice(c,0,s[o]);h=!0;break}!h&&u.length<n?u.push(s[o]):u.length>n&&(u.length=n)}if(1===u.length)return u[0].item;u.sort((function(t,e){return e.distance-t.distance}));return new Vector(u.map((function(t){return t.item})))}));defineFunction("Index",{object:[functionBank,AgentObject],params:[{noVector:!0,needAgent:!0,name:"[Agent]"}]},(function(t){return new Material(sn("#e"+(t[0].index+1)))}));defineFunction("Connect",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"},{name:"Weight",defaultVal:"missing"}]},(function(t){var e=void 0;"missing"!=t[2]&&(e=t[2]);t[1]instanceof Vector?t[1].items.forEach((function(i){t[0].connect(i,e)})):t[0].connect(t[1],e);return new Material(1)}));defineFunction("Unconnect",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"}]},(function(t){t[1]instanceof Vector?t[1].items.forEach((function(e){t[0].unconnect(e)})):t[0].unconnect(t[1]);return new Material(1)}));defineFunction("Connected",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent]"}]},(function(t){return new Vector(t[0].connected.slice())}));defineFunction("ConnectionWeight",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"}]},(function(t){return t[1]instanceof Vector?new Vector(t[1].items.map((function(e){return t[0].connectionWeight(e)}))):t[0].connectionWeight(t[1])}));defineFunction("SetConnectionWeight",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"},{name:"Weight"}]},(function(t){t[1]instanceof Vector?t[1].items.forEach((function(e){t[0].setConnectionWeight(e,t[2])})):t[0].setConnectionWeight(t[1],t[2]);return new Material(1)}));functionBank.die=function(t){console.log(t);throw'MSG: Terminated using "die".'};functionBank.print=function(t){if(2==t.length){console.log(t[0].value.toString());console.log(t[1]);return t[1]}console.log(t[0]);return t[0]};defineFunction("Width",{params:[{needAgents:!0,name:"[Agent Population]"}]},(function(t){return t[0].geoWidth}));defineFunction("Height",{params:[{needAgents:!0,name:"[Agent Population]"}]},(function(t){return t[0].geoHeight}));defineFunction("Distance",{object:[functionBank,AgentObject],params:[{name:"Location 1"},{name:"Location 2"}]},(function(e){e[0]=t(e[0]);e[1]=t(e[1]);return distance(e[0],e[1])}));defineFunction("Location",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent]"}]},(function(t){if(t[0].location)return t[0].location.fullClone();throw"MSG: The location is not defined."}));defineFunction("SetLocation",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent]"},{needVector:!0,name:"Direction"}]},(function(t){var e=t[1].toNum(),i=t[0];i.location=e.fullClone();if(!i.location.names){i.location.names=["x","y"];i.location.namesLC=["x","y"]}return new Material(0)}));defineFunction("Move",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Mover]"},{needVector:!0,name:"Direction"}]},(function(t){var e=t[1].toNum();shiftLocation(t[0],plus(t[0].location,e));return new Material(0)}));function t(t){if(t instanceof Vector){if(2!=t.items.length)throw"MSG: Location vector does not contain exactly two elements.";return t}try{return agent(t).location}catch(t){throw"MSG: Location must be a vector or an agent."}}defineFunction("MoveTowards",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Mover]"},{name:"[Target]"},{name:"Distance",noVector:!0}]},(function(e){var i=e[0],n=t(e[1]),r=i.location,a=minus(n.items[0],r.items[0]),s=minus(n.items[1],r.items[1]);if(0==a.value&&0==s.value)return new Material(1);if(i.container.geoWrap){greaterThan(a,i.container.halfWidth)?a=minus(i.container.geoWidth,a):lessThan(a,negate(i.container.halfWidth))&&(a=minus(a,negate(i.container.geoWidth)));greaterThan(s,i.container.halfHeight)?s=minus(i.container.geoHeight,s):lessThan(s,negate(i.container.halfHeight))&&(s=minus(s,negate(i.container.geoHeight)))}var o=new Vector([a,s],["x","y"]);shiftLocation(e[0],plus(e[0].location,mult(o,div(e[2],distance(e[0],e[1]instanceof Vector?e[1]:agent(e[1]))))));return new Material(1)}));PrimitiveBase=makeObjectBase(PrimitiveObject);AgentBase=makeObjectBase(AgentObject);PrimitiveBase.parent=AgentBase;VectorBase=makeObjectBase(VectorObject)}));function distance(t,e){var i=t instanceof Vector?t:t.location,n=e instanceof Vector?e:e.location,r=i.items[0].toString()+","+i.items[1].toString(),a=n.items[0].toString()+","+n.items[1].toString();if(simulate.distanceCache[r+"-"+a])return simulate.distanceCache[r+"-"+a];if(simulate.distanceCache[a+"-"+r])return simulate.distanceCache[a+"-"+r];var s=minus(i.items[0],n.items[0]),o=minus(i.items[1],n.items[1]),l=null;t instanceof Vector?e instanceof Vector||(l=e.container):l=t.container;if(null!==l&&l.geoWrap){greaterThan(s,l.halfWidth)?s=minus(l.geoWidth,s):lessThan(s,negate(l.halfWidth))&&(s=minus(s,negate(l.geoWidth)));greaterThan(o,l.halfHeight)?o=minus(l.geoHeight,o):lessThan(o,negate(l.halfHeight))&&(o=minus(o,negate(l.geoHeight)))}var u=s.value,h=o.value;s.units!==o.units&&(h=fn["*"](h,convertUnits(s.units,o.units)));var c=fn["real-part"](fn.sqrt(fn["+"](fn["*"](u,u),fn["*"](h,h))));c=new Material(c,s.units);simulate.distanceCache[r+a]=c;return c}function agent(t){(t instanceof Variable||t instanceof Stock)&&(t=t.toNum());if(t instanceof Agent)return t;if(!strictAgentResolution&&t instanceof Primitive)return agent(t.container);throw"MSG: An agent is required here."}function agents(t){if(t instanceof Agents)return t;if(t instanceof Primitive||t instanceof Agent)return agents(t.container);throw"MSG: An agent population is required here."}function getPopulation(t){if(t.items)return t;return t instanceof Agents?new Vector(t.agents.slice()):t.toNum()instanceof Vector?t.toNum():new Vector([agent(t)])}function shiftLocation(t,e){if(t.container.geoWrap){for(;lessThan(e.items[0],new Material(0));)e.items[0]=plus(e.items[0],t.container.geoWidth);for(;greaterThan(e.items[0],t.container.geoWidth);)e.items[0]=minus(e.items[0],t.container.geoWidth);for(;lessThan(e.items[1],new Material(0));)e.items[1]=plus(e.items[1],t.container.geoHeight);for(;greaterThan(e.items[1],t.container.geoHeight);)e.items[1]=minus(e.items[1],t.container.geoHeight)}t.location=e;if(!t.location.names){t.location.names=["x","y"];t.location.namesLC=["x","y"]}}function constraintAlert(t,e,i){error("The "+("max"==e?"maximum":"minimum")+" constraint on the primitive <b>"+clean(getName(findID(t.id)))+"</b> has been violated. The primitive's value attempted to become "+clean(i.value)+" when the "+("max"==e?"maximum":"minimum")+" allowed value is "+("max"==e?t.dna.maxConstraint:t.dna.minConstraint)+".",t,!1)}function error(t,e,i,n,r){var a={msg:t,primitive:e,showEditor:i,line:n,details:r};if(isLocal()){console.log("Error:");console.log(a)}throw a}function testPrimitive(t,e,i){for(var n=0;n<i.length;n++)if(!(t[i[n]]instanceof Primitive))throw"MSG: "+e+"() requires a primitive reference to be passed to it as argument number "+(i[n]+1)+"."}function prepareDisplay(t){return t}class AggregateSeries{constructor(t,e){this.id=t;this.spacing=e;this.oldValues=[]}match(t){return this.id==t}get(t){let e=0;e=this.spacing<0?0:0==this.spacing?Math.floor(div(minus(simulate.time(),simulate.timeStart),simulate.UserTimeStep).value):Math.floor(div(minus(simulate.time(),simulate.timeStart),this.spacing.forceUnits(simulate.timeUnits)).value);for(;this.oldValues.length-1<e;)this.oldValues.push(evaluateNode(t.node,t.scope));return this.oldValues[e].fullClone?this.oldValues[e].fullClone():this.oldValues[e]}}class DataBank{constructor(){this.dataSeries={}}series(){return Object.keys(this.dataSeries)}clone(){for(var t=new DataBank,e=this.series(),i=0;i<e.length;i++)t.dataSeries[e[i]]=this.dataSeries[e[i]];return t}getSeries(t){this.dataSeries[t]||(this.dataSeries[t]=[]);return this.dataSeries[t]}trimValues(t){for(var e=this.series(),i=0;i<e.length;i++){var n=this.getSeries(e[i]);n.length-1>t&&n.splice(t+1,n.length-t+1)}}}class ExpGroup{constructor(t,e,i){this.stocks=[];this.k=e;for(let e=1;e<=t;e++)this.stocks.push(i);this.out=i}moveForward(t){var e=new ExpGroup(this.stocks.length,this.k,new Material(0));e.out=this.stocks[this.stocks.length-1];for(let t=this.stocks.length-1;t>0;t--)e.stocks[t]=plus(mult(this.stocks[t],new Material(1-this.k)),mult(this.stocks[t-1],new Material(this.k)));e.stocks[0]=plus(mult(this.stocks[0],new Material(1-this.k)),mult(t,new Material(this.k)));return e}}class Primitive{constructor(){this.id=null;this.agentId=null;this.index=null;this.instanceId=null;this.container=null;this.dna=null;this.equation=null;this.cachedValue=void 0;this.pastValues=[];this.pastData=new DataBank;this.frozen=!1;this.parent=PrimitiveBase}clone(){let t=new this.constructorFunction;t.dna=this.dna;t.container=this.container;t.agentId=this.agentId;t.index=this.index;t.id=this.id;t.createIds();t.pastValues=this.pastValues.slice(0);this.dna.slider&&(simulate.sliders[this.dna.id]?simulate.sliders[this.dna.id].push(t):simulate.sliders[this.dna.id]=[t]);t.cachedValue=this.cachedValue?this.cachedValue.fullClone():this.cachedValue;this.innerClone(t);return t}clearCached(){this.cachedValue=void 0}storeValue(){isUndefined(this.cachedValue)&&this.value();this.pastValues.push(this.cachedValue)}toNum(){return this.value()}calculateValue(){throw"MSG: "+getText("[%s] does not have a value and can not be used as a value in an equation.",this.dna.name)}createIds(){this.instanceId=simulate.getID(this.agentId+"-"+this.index)}getPastValues(t){let e,i=this.pastValues.slice(),n=Math.ceil(div(simulate.time(),this.dna.solver.userTimeStep).value)+1;i.length<n&&i.push(this.value());if(isUndefined(t))e=i.map((t=>t.fullClone()));else{let n=Math.ceil(div(t.forceUnits(simulate.timeUnits),this.dna.solver.userTimeStep).value);e=[];for(let t=Math.max(0,i.length-1-n);t<i.length;t++)e.push(i[t].fullClone())}return e}pastValue(t,e){let i;i=this.pastValues.length-1<Math.round((simulate.time().value-simulate.timeStart.value)/this.dna.solver.userTimeStep.value)?div(t.forceUnits(simulate.timeUnits),this.dna.solver.userTimeStep).value:div(t.forceUnits(simulate.timeUnits),this.dna.solver.userTimeStep).value+1;if(0==i)return this.value();if(Math.ceil(i)>this.pastValues.length)return isUndefined(e)?this.pastValues.length>0?this.pastValues[0].fullClone():this.value():e;if(i==Math.round(i))return 0==i?value:this.pastValues[this.pastValues.length-i].fullClone();let n,r,a=i-Math.floor(i),s=Math.floor(i);n=0==s?this.value():this.pastValues[this.pastValues.length-s];r=this.pastValues[this.pastValues.length-1-s];return plus(mult(n,new Material(1-a)),mult(r,new Material(a)))}smoothF(t,e){let i=div(this.dna.solver.userTimeStep,t.forceUnits(simulate.timeUnits)).value,n=this.pastData.getSeries("Smooth: "+i+","+e);0==n.length&&(isUndefined(e)?n.push(this.pastValues[0]?this.pastValues[0]:this.value()):n.push(e));let r=Math.floor((simulate.time().value-simulate.timeStart.value)/this.dna.solver.userTimeStep.value);for(let t=n.length-1;t<r;t++){let e=this.pastValues[t]?this.pastValues[t]:this.cachedValue?this.cachedValue:this.pastValues[t-1];n.push(plus(mult(n[t],new Material(1-i)),mult(new Material(i),e)))}return n[n.length-1].fullClone()}expDelayF(t,e,i){this.value();let n=div(this.dna.solver.userTimeStep,e.forceUnits(simulate.timeUnits)).value*t,r=this.pastData.getSeries("ExpDelay: "+t+","+e.value+","+i);if(0==r.length)if(isUndefined(i))r.push(new ExpGroup(t,n,this.pastValues[0]?this.pastValues[0]:this.value()));else{let e=new ExpGroup(t,n,i);r.push(e.moveForward(this.pastValues[0]?this.pastValues[0]:this.value()))}for(let t=r.length;t<this.pastValues.length;t++)r.push(r[t-1].moveForward(this.pastValues[t]));return r[r.length-1].out.fullClone()}testUnits(t,e){if(t instanceof Vector)t.recurseApply((t=>{this.testUnits(t,e);return t}));else{if(!this.dna.units&&t.units)error(getText("Wrong units generated for %s. Expected no units and got %s. Either specify units for the primitive or adjust the equation.","<i>"+clean(this.dna.name)+"</i>","<i>"+clean(t.units.toString())+"</i>"),this,!0);else if(this.dna.units!==t.units){let e=convertUnits(t.units,this.dna.units,!0);if(0==e){if(isLocal()){console.log(t.units);console.log(this.dna.units)}error(getText("Wrong units generated for %s. Expected %s, and got %s.","<i>"+clean(this.dna.name)+"</i>","<i>"+clean(this.dna.units.toString())+"</i>","<i>"+clean(t.units.toString())+"</i>"),this,!0);return}t.value=t.value*e;t.units=this.dna.units}if(this instanceof Flow&&1!=e&&this.dna.flowUnitless){let e=mult(t,new Material(1,simulate.timeUnits));t.value=e.value;t.units=e.units}}}setValue(){throw"MSG: "+getText("You cannot set the value for that primitive.")}printPastValues(){console.log(this.pastValues.map((t=>t.value)))}value(){if(isUndefined(this.cachedValue)&&this.frozen&&this.pastValues.length>0){let t=this.pastValues[this.pastValues.length-1];t.fullClone?this.cachedValue=t.fullClone():this.cachedValue=t}if(isUndefined(this.cachedValue)){if(simulate.valuedPrimitives.indexOf(this)>-1)throw"MSG: "+getText("Circular equation loop identified including the primitives: %s",simulate.valuedPrimitives.slice(simulate.valuedPrimitives.indexOf(this)).map((t=>t.dna.name)).join(", "));simulate.valuedPrimitives.push(this);let t;try{t=this.calculateValue().toNum();if(t instanceof Material&&!isFinite(t.value)){isLocal()&&console.log(t);throw this instanceof Stock?"MSG: "+getText("The stock has become infinite in size. Check the flows into it for rapid growth."):"MSG: "+getText("The result of this calculation is not a number (are you dividing by 0?).")}}catch(t){if(!t.substr)throw t;isLocal()&&console.log(t);"MSG:"==t.substr(0,4)?error(t.substr(4,t.length),this,!0):error(t,this,!0)}if(!(this instanceof State)){this.testUnits(t);this.testConstraints(t)}this.cachedValue=t}return this.cachedValue.fullClone?this.cachedValue.fullClone():this.cachedValue}testConstraints(t){let e=t=>{(1==this.dna.maxConstraintType&&t.value>this.dna.maxConstraint||2==this.dna.maxConstraintType&&t.value>=this.dna.maxConstraint)&&constraintAlert(this,"max",t);(1==this.dna.minConstraintType&&t.value<this.dna.minConstraint||2==this.dna.minConstraintType&&t.value<=this.dna.minConstraint)&&constraintAlert(this,"min",t);return t};t instanceof Vector?t.recurseApply(e):e(t)}setEquation(t,e){if(this instanceof Flow||this instanceof Transition){null!==this.omega&&(e.omega=this.omega);null!==this.alpha&&(e.alpha=this.alpha)}try{this.equation=trimTree(t,e)}catch(t){isLocal()&&console.log(t);error(t.substr(4,t.length),this,!0)}}}class Placeholder extends Primitive{constructor(t,e){super();this.dna=t;this.id=t.id;this.primitive=e}calculateValue(){error(getText("[%s] is a placeholder and cannot be used as a direct value in equations.",clean(this.dna.name)),this.primitive,!0)}}class State extends Primitive{constructor(){super();this.active=null;this.downStreamTransitions=[];this.constructorFunction=State}innerClone(t){t.setValue(this.active)}setValue(t){this.setActive(trueValue(t));this.cachedValue=void 0;simulate.valuedPrimitives=[];this.value();this.agentId&&this.container.updateStates()}calculateValue(){null===this.active&&this.setInitialActive(!0);return this.active?new Material(1):new Material(0)}setInitialActive(t){let e;try{e=evaluateTree(this.equation,globalVars(this)).toNum()}catch(t){if(!t.substr)throw t;isLocal()&&console.log(t);"MSG:"==t.substr(0,4)?error(t.substr(4,t.length),this,!0):error(t,this,!0)}this.setActive(trueValue(e),t);this.agentId&&this.container.updateStates()}setActive(t,e){this.active=t;if(t&&null!==this.dna.residency){let t=this;simulate.tasks.add(new Task({name:"State Residency",time:plus(simulate.time(),this.dna.residency),priority:5,expires:1,action:function(){for(let e=0;e<t.downStreamTransitions.length;e++)scheduleTrigger.call(t.downStreamTransitions[e])}}))}else if(!e){if(t){simulate.transitionPrimitives||(simulate.transitionPrimitives=[]);if(simulate.transitionPrimitives.length>1200&&simulate.transitionPrimitives.indexOf(this)>-1)throw"MSG: "+getText("Circular fully active transition loop identified including the states: %s",simulate.transitionPrimitives.slice(0,5).map((t=>t.dna.name)).join(", "));simulate.transitionPrimitives.push(this)}for(let t=0;t<this.downStreamTransitions.length;t++)scheduleTrigger.call(this.downStreamTransitions[t]);t&&(simulate.transitionPrimitives=[])}}getActive(){null===this.active&&this.setInitialActive(!0);return this.active}}class Transition extends Primitive{constructor(){super();this.alpha=null;this.omega=null;this.scheduledTrigger=null;this.constructorFunction=Transition}innerClone(t){}setEnds(t,e){this.alpha=t;this.omega=e;t&&t.downStreamTransitions.push(this)}canTrigger(){return!this.alpha||this.alpha&&this.alpha.getActive()||this.dna.repeat&&"Condition"!=this.dna.trigger}trigger(){this.scheduledTrigger=null;if(!this.frozen){this.alpha&&this.alpha.setActive(!1);this.omega&&this.omega.setActive(!0);this.agentId&&this.container.updateStates();this.dna.repeat&&"Condition"!=this.dna.trigger&&scheduleTrigger.call(this)}}}function scheduleTrigger(){updateTrigger.call(this,!0)}function clearTrigger(t){if(this.scheduledTrigger&&(t||!this.dna.repeat)){this.scheduledTrigger.kill();this.scheduledTrigger=null}}function updateTrigger(t){t&&clearTrigger.call(this);if(this.canTrigger()){let t;try{t=evaluateTree(this.equation,globalVars(this)).toNum()}catch(t){if(!t.substr)throw t;isLocal()&&console.log(t);"MSG:"==t.substr(0,4)?error(t.substr(4,t.length),this,!0):error(t,this,!0)}if("Condition"==this.dna.trigger)trueValue(t)&&this.trigger();else{t instanceof Material||error(getText("The value of this trigger must evaluate to a number."),this,!0);let e;if("Timeout"==this.dna.trigger){t.units||(t.units=simulate.timeUnits);if(this.scheduledTrigger&&eq(t,this.scheduledTrigger.data.value))return;this.dna.repeat&&0==t.value&&error(getText("A trigger Timeout of 0 with 'Repeat' set to true results in an infinite loop."),this,!0);e=t}else if("Probability"==this.dna.trigger){t.units&&error(getText("The probability for the trigger had units of %s. Probabilities must be unitless.",this.value().units.toString()),this,!0);t=t.value;if(this.scheduledTrigger&&eq(t,this.scheduledTrigger.data.value))return;if(1==t){this.dna.repeat&&error(getText("A trigger probability of 1 with 'Repeat' as true results in an infinite loop."),this,!0);e=new Material(0,simulate.timeUnits)}else if(t>1)error(getText("The probability for the trigger must be less than or equal to 1."),this,!0);else if(t<0)error(getText("The probability for the trigger must be greater than or equal to 0."),this,!0);else if(0==t){if(!this.scheduledTrigger)return}else{e=new Material(RandExp(-Math.log(1-t)),simulate.timeUnits)}}let i=simulate.time();if(this.scheduledTrigger){this.scheduledTrigger.kill();if("Timeout"==this.dna.trigger){if(lessThanEq(e,minus(simulate.time(),this.scheduledTrigger.data.start))){this.scheduledTrigger=null;this.trigger();return}i=this.scheduledTrigger.data.start;e=minus(e,minus(simulate.time(),i));this.scheduledTrigger=null}else if("Probability"==this.dna.trigger){if(0==t){this.scheduledTrigger=null;return}e=minus(this.scheduledTrigger.time,simulate.time());e=mult(e,new Material(-Math.log(1-this.scheduledTrigger.data.value)/-Math.log(1-t)));i=this.scheduledTrigger.data.start;this.scheduledTrigger=null}}e=plus(e,simulate.time());let n=this;this.scheduledTrigger=new Task({name:"Trigger",time:e,priority:5,expires:1,action:function(){n.trigger()},data:{start:i,value:t}});simulate.tasks.add(this.scheduledTrigger)}}}class Action extends Primitive{constructor(){super();this.action=null;this.scheduledTrigger=null;this.block=!1;this.constructorFunction=Action}innerClone(t){}canTrigger(){return!this.block}resetTimer(){scheduleTrigger.call(this)}trigger(){this.scheduledTrigger=null;if(!this.frozen)try{evaluateTree(this.action,globalVars(this));this.dna.repeat?"Condition"!==this.dna.trigger&&scheduleTrigger.call(this):this.block=!0}catch(t){if(!t.substr)throw t;isLocal()&&console.log(t);"MSG:"==t.substr(0,4)?error(t.substr(4,t.length),this,!0):error(t,this,!0)}}}class Agents extends Primitive{constructor(){super();this.size=null;this.agents=null;this.geoWidth=null;this.geoHeight=null;this.halfWidth=null;this.halfHeight=null;this.geoDimUnits=null;this.geoDimUnitsObject=null;this.geoWrap=null;this.DNAs=null;this.stateIds=[];this.constructorFunction=Agents;this.vector=new Vector([],[],PrimitiveBase)}collectData(){let t=[];for(let e=0;e<this.agents.length;e++){let i=this.agents[e];t.push({instanceId:i.instanceId,connected:i.connected.map((t=>t.instanceId)),location:simpleNum(i.location.clone(),this.geoDimUnitsObject),state:i.states.length>0?i.states.slice():null})}return t}states(){return this.stateIds.slice(0)}toNum(){throw"MSG: "+getText("[%s] is a population of agents and cannot be used as a direct value in equations.",clean(this.dna.name))}add(t){this.size=1+parseInt(this.size,10);let e;if(t){e=t.agentClone();e.agentId=this.agentId;e.setIndex(this.size-1);e.createAgentIds();for(let t=0;t<this.DNAs.length;t++){let i=e.children[t],n=this.DNAs[t];i.container=e;linkPrimitive(i,n)}e.updateStates()}else{e=new Agent;e.container=this;e.children=[];e.childrenId={};e.agentId=this.agentId;for(let t=0;t<this.DNAs.length;t++)decodeDNA(this.DNAs[t],e);e.setIndex(this.size-1);e.createAgentIds();for(let t=0;t<this.DNAs.length;t++)linkPrimitive(e.children[t],this.DNAs[t]);setAgentInitialValues(e);let t=getPrimitiveNeighborhood(this,this.dna);if("Custom Function"==this.placement){t.self=e;e.location=simpleUnitsTest(simpleEquation(this.placementFunction,{"-parent":varBank,self:e},t),this.geoDimUnitsObject);if(!e.location.names){e.location.names=["x","y"];e.location.namesLC=["x","y"]}}else e.location=new Vector([mult(this.geoWidth,new Material(Rand())),mult(this.geoHeight,new Material(Rand()))],["x","y"]);if("Custom Function"==this.network){let i=trimTree(createTree(this.networkFunction),t);for(let n=0;n<this.agents.length;n++)e!==this.agents[n]&&trueValue(simpleEquation(this.networkFunction,{"-parent":varBank,a:e,b:this.agents[n]},t,i))&&e.connect(this.agents[n])}}let i=this;simulate.tasks.add(new Task({priority:10,expires:1,name:"Add Agent",time:simulate.time(),action:function(){i.agents.push(e);for(let n=0;n<e.children.length;n++){let r=e.children[n],a=i.DNAs[n];(r instanceof Action||r instanceof Transition)&&"Condition"!=a.trigger&&scheduleTrigger.call(r);if(t)if(r instanceof Action)a.solver.actions.push(r);else if(r instanceof Transition)a.solver.transitions.push(r);else if(!(r instanceof Agents)){a.solver.valued.push(r);r instanceof Flow?a.solver.flows.push(r):r instanceof Stock?a.solver.stocks.push(r):r instanceof State&&a.solver.states.push(r)}}}}));return e}}class Agent{constructor(){this.agentId=null;this.instanceId=null;this.index=null;this.children=null;this.location=null;this.connected=[];this.connectedWeights=[];this.dead=!1;this.constructorFunction=Agent;this.stateIDs=[];this.states=[];this.vector=new Vector([],[],AgentBase)}createIds(){this.instanceId=simulate.getID(this.agentId+"-"+this.index)}toString(){return"Agent "+(this.index+1)}toNum(){return this}updateStates(){this.states=[];this.stateIDs=[];for(let t=0;t<this.children.length;t++)if(this.children[t].active){this.states.push(this.children[t]);this.stateIDs.push(this.children[t].dna.id)}}agentClone(){let t=new Agent;t.dna=this.dna;t.children=[];t.childrenId={};for(let e=0;e<this.children.length;e++){t.children.push(this.children[e].clone());t.childrenId[t.children[e].dna.id]=t.children[e]}t.location=this.location.clone();t.connected=this.connected.slice(0);t.connectedWeights=this.connectedWeights.slice(0);t.container=this.container;return t}setIndex(t){this.index=t;for(let e=0;e<this.children.length;e++)this.children[e].index=t}createAgentIds(){this.createIds();for(let t=0;t<this.children.length;t++)this.children[t].createIds()}die(){for(;this.connected.length>0;)this.unconnect(this.connected[0]);for(let t=0;t<this.container.agents.length;t++)if(this.container.agents[t]==this){this.container.agents.splice(t,1);break}for(let t=0;t<this.children.length;t++){let e=this.children[t],i=e.dna.solver;if(e instanceof Action){i.actions.splice(i.actions.indexOf(e),1);clearTrigger.call(e,!0)}else if(e instanceof Transition){i.transitions.splice(i.transitions.indexOf(e),1);clearTrigger.call(e,!0)}else if(!(e instanceof Agents)){i.valued.splice(i.valued.indexOf(e),1);e instanceof Flow?i.flows.splice(i.flows.indexOf(e),1):e instanceof Stock?i.stocks.splice(i.stocks.indexOf(e),1):e instanceof State&&i.states.splice(i.states.indexOf(e),1)}}this.dead=!0}connect(t,e){let i=void 0===e?new Material(1):e;if(t!==this)if(-1==this.connected.indexOf(t)){if(!(t instanceof Agent))throw"MSG: Only agents may be connected.";this.connected.push(t);this.connectedWeights.push(i);t.connected.push(this);t.connectedWeights.push(i)}else if(void 0!==e){this.connectedWeights[this.connected.indexOf(t)]=e;t.connectedWeights[t.connected.indexOf(t)]=e}}unconnect(t){if(t!==this){let e=this.connected.indexOf(t);if(-1!=e){this.connected.splice(e,1);this.connectedWeights.splice(e,1);e=t.connected.indexOf(this);t.connected.splice(e,1);t.connectedWeights.splice(e,1)}}}connectionWeight(t){if(t!==this){let e=this.connected.indexOf(t);if(-1!=e)return this.connectedWeights[e].fullClone()}throw"MSG: Agents are not connected and so do not have a connection weight."}setConnectionWeight(t,e){if(t!==this){let i=this.connected.indexOf(t);if(-1!=i){this.connectedWeights[i]=e.fullClone();return}}throw"MSG: Agents are not connected and so do not have a connection weight."}}class Stock extends Primitive{constructor(){super();this.level=null;this.constructorFunction=Stock;this.delay=void 0;this.tasks=[];this.initRate=null;this.oldLevel=null}innerClone(t){t.level=this.level;t.oldLevel=this.oldLevel;t.tasks=this.tasks;t.delay=this.delay}setValue(t){this.level=t;this.cachedValue=void 0;simulate.valuedPrimitives=[];this.value()}print(){console.log(this.level.map((t=>t.value)))}preserveLevel(){for(let t=this.tasks.length-1;t>=0;t--)this.tasks[t].data.tentative=!1;this.oldLevel=this.level}restoreLevel(){for(let t=this.tasks.length-1;t>=0;t--)if(this.tasks[t].data.tentative){this.tasks[t].remove();this.tasks.splice(t,1)}this.level=this.oldLevel}setDelay(t){t=t||this.dna.delay;this.delay=t}setInitialValue(){let t;try{t=evaluateTree(this.equation,globalVars(this)).toNum()}catch(t){if(!t.substr)throw t;isLocal()&&console.log(t);"MSG:"==t.substr(0,4)?error(t.substr(4,t.length),this,!0):error(t,this,!0)}"boolean"==typeof t&&(t=new Material(t?1:0));if(t instanceof Vector){let e=this.dna;t.recurseApply((function(t){e.nonNegative&&t.value<0&&(t=new Material(0,e.units));t.units||(t.units=e.units);return t}))}else{this.dna.nonNegative&&t.value<0&&(t=new Material(0,this.dna.units));t.units||(t.units=this.dna.units)}if(isUndefined(this.delay))this.level=t;else{let e=mult(t,div(simulate.userTimeStep,this.delay));this.initRate=div(t,this.delay.forceUnits(simulate.timeUnits));this.level=e;simulate.tasks.addEvent(((t,e,i)=>{if(t.value>0&&lessThanEq(minus(i,simulate.timeStart),minus(this.delay,simulate.userTimeStep))){t=functionBank.min([t,minus(this.delay,minus(e,simulate.timeStart))]);this.level=plus(this.level,mult(t,this.initRate))}}))}}subtract(t,e){this.level=minus(this.level,t);if(this.dna.nonNegative)if(this.level instanceof Vector){let t=this.dna;this.level.recurseApply((function(e){return e.value<0?new Material(0,t.units):e}))}else this.level.value<0&&(this.level=new Material(0,this.dna.units))}add(t,e){if(isUndefined(this.delay)){this.level=plus(this.level,t);if(this.dna.nonNegative)if(this.level instanceof Vector){let t=this.dna;this.level.recurseApply((function(e){return e.value<0?new Material(0,t.units):e}))}else this.level.value<0&&(this.level=new Material(0,this.dna.units))}else this.scheduleAdd(t,e)}scheduleAdd(t,e,i){i=i||this.delay;let n,r=this,a=new Task({time:plus(e,i),data:{amnt:t,tentative:!0},priority:-100,name:"Conveyor Add ("+this.dna.name+")",action:function(){n=r.level;r.level=plus(r.level,t);if(r.dna.nonNegative)if(r.level instanceof Vector){let t=r.dna;r.level.recurseApply((function(e){return e.value<0?new Material(0,t.units):e}))}else r.level.value<0&&(r.level=new Material(0,r.dna.units))},rollback:function(){r.level=n}});this.tasks.push(a);simulate.tasks.add(a)}totalContents(){null===this.level&&this.setInitialValue();if(isDefined(this.delay)){let t=this.level;for(let e=0;e<this.tasks.length;e++)greaterThan(this.tasks[e].time,simulate.time())&&lessThanEq(this.tasks[e].time,plus(simulate.time(),this.delay))&&(t=plus(t,this.tasks[e].data.amnt));let e=minus(this.delay,simulate.userTimeStep);if(greaterThan(e,simulate.timeProgressed())){let i=minus(e,simulate.timeProgressed());t=plus(t,mult(this.initRate,i))}return t}return this.level}calculateValue(){null===this.level&&this.setInitialValue();if(isDefined(this.delay)&&4==this.dna.solver.RKOrder){let t=this.level;for(let e=0;e<this.tasks.length;e++)greaterThan(this.tasks[e].time,simulate.time())&&lessThanEq(this.tasks[e].time,plus(simulate.time(),this.dna.solver.timeStep))&&(t=plus(t,this.tasks[e].data.amnt));return t}return this.level}}class Converter extends Primitive{constructor(){super();this.source=null;this.constructorFunction=Converter}innerClone(t){}setSource(t){this.source=t}getInputValue(){let t;if("*time"==this.source)t=simulate.time();else{t=this.source.value().toNum();t||error(getText("Undefined input value."),this,!1);t instanceof Vector&&error(getText("Converters do not accept vectors as input values."),this,!1)}return t}calculateValue(){return new Material(this.getOutputValue().value,this.dna.units)}getOutputValue(){let t=this.getInputValue();if(0==this.dna.inputs.length)return new Material(0);for(let e=0;e<this.dna.inputs.length;e++)if("discrete"==this.dna.interpolation){if(greaterThan(this.dna.inputs[e],t))return 0==e?this.dna.outputs[0]:this.dna.outputs[e-1]}else if("linear"==this.dna.interpolation){if(eq(this.dna.inputs[e],t))return this.dna.outputs[e];if(greaterThan(this.dna.inputs[e],t)){if(0==e)return this.dna.outputs[0];return div(plus(mult(minus(t,this.dna.inputs[e-1]),this.dna.outputs[e]),mult(minus(this.dna.inputs[e],t),this.dna.outputs[e-1])),minus(this.dna.inputs[e],this.dna.inputs[e-1]))}}return this.dna.outputs[this.dna.outputs.length-1]}}class Variable extends Primitive{constructor(){super();this.constructorFunction=Variable}innerClone(t){}calculateValue(){let t=evaluateTree(this.equation,globalVars(this));if("boolean"==typeof t)t=new Material(t?1:0);else if(t instanceof Vector)return t;t.units||(t.units=this.dna.units);return t}}class Flow extends Primitive{constructor(){super();this.alpha=null;this.omega=null;this.rate=null;this.RKPrimary=[];this.constructorFunction=Flow}innerClone(t){}setEnds(t,e){this.alpha=t;this.omega=e}calculateValue(){this.predict();return this.rate.fullClone()}clean(){this.rate=null;this.RKPrimary=[]}predict(t){if(null===this.rate||t){let e;try{e=evaluateTree(this.equation,globalVars(this)).toNum();if(!(e instanceof Vector||isFinite(e.value)))throw"MSG: "+getText("The result of this calculation is not finite. Flows must have finite values. Are you dividing by 0?")}catch(t){if(!t.substr)throw t;isLocal()&&console.log(t);"MSG:"==t.substr(0,4)?error(t.substr(4,t.length),this,!0):error(t,this,!0)}"boolean"==typeof e&&(e=new Material(e?1:0));this.rate=e.fullClone();if(this.rate instanceof Vector){let t=this.dna;this.rate.recurseApply((function(e){e.units||(e.units=t.units);return e}))}else this.rate.units||(this.rate.units=this.dna.units);this.testUnits(this.rate,!0);this.rate=mult(this.rate,this.dna.solver.timeStep);t&&this.RKPrimary.length>0?this.RKPrimary[this.RKPrimary.length-1]=this.rate:this.RKPrimary.push(this.rate);4==this.dna.solver.RKOrder&&(1==this.dna.solver.RKPosition?this.rate=this.RKPrimary[0]:2==this.dna.solver.RKPosition?this.rate=this.RKPrimary[1]:3==this.dna.solver.RKPosition?this.rate=this.RKPrimary[2]:4==this.dna.solver.RKPosition&&(this.rate=div(plus(plus(plus(this.RKPrimary[0],mult(new Material(2),this.RKPrimary[1])),mult(new Material(2),this.RKPrimary[2])),this.RKPrimary[3]),new Material(6))));this.rate=div(this.rate,this.dna.solver.timeStep);this.dna.onlyPositive&&(this.rate instanceof Vector?this.rate.recurseApply((function(t){return t.value>=0?t:new Material(0,t.units)})):this.rate.value<=0&&(this.rate=new Material(0,this.rate.units)))}}apply(t,e,i){try{if(null===this.rate)return;let i=this.rate.fullClone();i=mult(i,t);let n=i,r=i,a=!1;if(null!==this.alpha){let t=this.alpha.level;if(i instanceof Vector&&(!(t instanceof Vector)||t.depth()<i.depth())){n=i.fullClone().collapseDimensions(t);a=!0}else t instanceof Vector&&(!(i instanceof Vector)||t.depth()>i.depth())&&error(getText("The alpha of the flow is a vector with a higher order than the flow rate. There has to be at least one element in the flow rate for each element in the alpha."),this,!0)}if(null!==this.omega){let t=this.omega.level;if(i instanceof Vector&&(!(t instanceof Vector)||t.depth()<i.depth())){r=i.fullClone().collapseDimensions(t);a=!0}else t instanceof Vector&&(!(i instanceof Vector)||t.depth()>i.depth())&&error(getText("The omega of the flow is a vector with a higher order than the flow rate. There has to be at least one element in the flow rate for each element in the omega."),this,!0)}if(a){null!==this.alpha&&this.alpha.dna.nonNegative&&error(getText("Cannot use non-negative stocks when the flow rate is a vector that needs to be collapsed."),this.alpha,!1);null!==this.omega&&this.omega.dna.nonNegative&&error(getText("Cannot use non-negative stocks when the flow rate is a vector that needs to be collapsed."),this.omega,!1)}else{if(null!==this.omega&&this.omega.dna.nonNegative){let t=plus(this.omega.level.toNum(),i);if(t instanceof Vector){t.recurseApply((function(t){return t.value<0?t:new Material(0,t.units)}));i=minus(i,t)}else t.value<0&&(i=negate(this.omega.level.toNum()))}if(null!==this.alpha&&this.alpha.dna.nonNegative){let t=minus(this.alpha.level.toNum(),i);if(t instanceof Vector){t.recurseApply((function(t){return t.value<0?t:new Material(0,t.units)}));i=minus(i,t);i=minus(i,t)}else t.value<0&&(i=this.alpha.level.toNum())}if(null!==this.omega&&this.omega.dna.nonNegative)if(i instanceof Vector){let t=functionBank.flatten([plus(this.omega.level.toNum(),i)]);for(let e=0;e<t.items.length;e++)t.items[e].value<0&&error(getText("Inconsistent non-negative constraints for flow."),this,!1)}else plus(this.omega.level.toNum(),i).value<0&&error(getText("Inconsistent non-negative constraints for flow."),this,!1)}let s=0;try{if(null!==this.omega){s=1;a?this.omega.add(r,e):this.omega.add(i,e)}if(null!==this.alpha){s=2;a?this.alpha.subtract(n,e):this.alpha.subtract(i,e)}}catch(t){let e="";1==s?e=this.omega:2==s&&(e=this.alpha);error("MSG: Keys do not match for vector operation."==t?getText("Incompatible vector keys for flow %s and connected stock %s.","<i>["+clean(this.dna.name)+"]</i>","<i>["+clean(e.dna.name)+"]</i>"):getText("Incompatible units for flow %s and connected stock %s. Stock has units of %s. The flow should have the equivalent units divided by some time unit such as Years.","<i>["+clean(this.dna.name)+"]</i>","<i>["+clean(e.dna.name)+"]</i>","<i>"+(e.dna.units?clean(e.dna.units.toString()):"unitless")+"</i>"),this,!1)}}catch(t){if(!t.substr)throw t;"MSG:"==t.substr(0,4)?error(t.substr(4,t.length),this,!0):error(t,this,!0)}}}function globalVars(t){return t instanceof Agent?{"-parent":varBank,self:t}:t.container?{"-parent":varBank,self:t.container}:varBank}class TaskQueue{constructor(t){t=t||{};this.tasks=new RedBlackTree;this.onMoveEvents=[];this.setTime(t.start);this.debug=!1;this.end=t.end;this.states={}}print(){console.log("Current Time: "+this.time.value);this.tasks.goMin();for(;null!==this.tasks.current();){console.log(this.tasks.current().name);console.log("    Time: "+this.tasks.current().time.value);console.log("    Priority: "+this.tasks.current().priority);isDefined(this.tasks.current().expires)&&console.log("    Expires: "+this.tasks.current().expires);isDefined(this.tasks.current().skip)&&console.log("    Skip: "+this.tasks.current().skip);this.tasks.next()}}addEvent(t){this.onMoveEvents.push(t)}fireEvents(t,e,i){this.debug&&console.log("Firing Events");for(var n=0;n<this.onMoveEvents.length;n++)this.onMoveEvents[n](t,e,i)}setTime(t){if(isUndefined(this.time)||neq(t,this.time)){var e=this.time;this.time=t;isDefined(e)&&this.fireEvents(minus(t,e),e,t)}}moveTime(t){this.debug&&console.log("Shifting time by: "+t.value);this.moveTo(timePlus(this.time,t))}moveTo(t){if(!eq(this.time,t)){this.debug&&console.log("Shifting time to: "+t.value);if(null!==this.tasks.current()){for(var e=this.tasks.max().time,i=this.tasks.min().time;lessThan(this.time,t)&&!greaterThan(this.time,e);)this.step();for(;greaterThan(this.time,t)&&greaterThan(this.time,i);)this.stepBack()}this.setTime(t);this.debug&&console.log("Time shift to  "+t.value+" completed.")}}add(t){t.queue=this;this.tasks.add(t)}step(){if(isUndefined(this.time)){this.tasks.goMin();this.setTime(this.tasks.current().time)}this.tasks.current().time;if(null!==this.tasks.current()){var t=this.tasks.current().deadAction;this.tasks.current().execute();if(!t&&this.tasks.current().timeShift){this.tasks.current().timeShift();return}this.tasks.next()}if(null!==this.tasks.current())this.setTime(this.tasks.current().time);else{this.tasks.next();this.setTime(mult(this.tasks.max().time,new Material(10)))}}stepBack(){if(isUndefined(this.time)){this.tasks.goMin();this.setTime(this.tasks.current().time)}else{null===this.tasks.current()?this.tasks.goMax():this.tasks.previous();for(var t=this.tasks.current().time;null!==this.tasks.current()&&eq(t,this.tasks.current().time);){this.tasks.current().rollback();this.tasks.previous()}null===this.tasks.current()?this.tasks.goMin():this.tasks.next();this.setTime(this.tasks.current().time)}}atStart(){return isUndefined(this.time)||this.tasks.current()===this.tasks.min()}completed(){return isDefined(this.time)&&(greaterThan(this.time,this.end)||null===this.tasks.current())}remove(t){t==this.tasks.current()&&this.tasks.next();this.tasks.remove(t)}}var TaskId=0,simulate,model;class Task{constructor(t){this.id=TaskId++;this.name=t.name;this.time=t.time;this.action=t.action;this.reverse=t.rollback;this.priority=t.priority||0;this.expires=t.expires;this.skip=t.skip;this.timeShift=t.timeShift;this.data=t.data;this.blocker=t.blocker;this.deadAction=!1;this.deadReverse=!1;this.action&&(this.action.task=this);this.reverse&&(this.action.reverse=this)}execute(){if(this.action&&!this.deadAction&&(!this.blocker||!this.queue.states[this.blocker])){if(isDefined(this.skip)&&this.skip>0){this.skip--;this.queue.debug&&console.log("Skipping: "+this.name)}else{this.queue.debug&&console.log("%c Executing: "+this.name+" (Time: "+this.time.value+")","color:blue");if(isDefined(this.expires)){this.expires--;this.queue.debug&&console.log("    Current count before expire: "+this.expires);if(this.expires<=0){this.queue.debug&&console.log("    Task expired.");this.deadAction=!0}}}this.action()}}rollback(){if(this.reverse&&!this.deadReverse&&(!this.blocker||!this.queue.states[this.blocker])){this.queue.debug&&console.log("Rolling back: "+this.name+" (Time: "+this.time.value+")");if(isDefined(this.expires)&&this.expires<=0){this.queue.debug&&console.log("    Rollback expired.");this.deadReverse=!0}this.reverse()}}reschedule(t){this.queue.remove(this);this.time=t;this.queue.add(this)}remove(){this.queue.remove(this)}kill(){this.deadAction=!0;this.deadReverse=!0}block(t){t=t||this.blocker;this.queue.states[t]=!0}unblock(t){t=t||this.blocker;this.queue.states[t]=!1}compare(t){return eq(t.time,this.time)?t.priority==this.priority?t.id==this.id?0:t.id<this.id?1:-1:t.priority<this.priority?1:-1:lessThan(t.time,this.time)?1:-1}toString(){return this.name+" - "+this.id}}function scheduleRepeated(t,e,i,n,r){for(var a=div(minus(r,i),n),s=0;s<=a;s++){e.time=plus(i,mult(n,new Material(s)));t.add(new Task(e))}}RedBlackNode.VERSION=1;function RedBlackNode(t,e){this._left=null;this._right=null;this._value=t;this._height=1;this.parent=e}RedBlackNode.prototype.add=function(t){var e,i,n,r=t.compare(this._value);if(0!=r){if(r<0)if(null!=this._left){e=this._left.add(t);this._left=e[0];this._left.parent=this;n=e[1]}else n=this._left=new RedBlackNode(t,this);else if(r>0)if(null!=this._right){e=this._right.add(t);this._right=e[0];this._right.parent=this;n=e[1]}else n=this._right=new RedBlackNode(t,this);i=[this.balanceTree(),n]}else i=[this,this];return i};RedBlackNode.prototype.balanceTree=function(){var t,e=null!=this._left?this._left._height:0,i=null!=this._right?this._right._height:0;if(e>i+1)t=this.swingRight();else if(i>e+1)t=this.swingLeft();else{this.setHeight();t=this}return t};RedBlackNode.prototype.join=function(t){var e;if(null==t)e=this;else{var i;if(this._height>t._height){(i=this)._right=t.join(i._right);i._right.parent=i}else{(i=t)._left=this.join(i._left);i._left.parent=i}e=i.balanceTree()}return e};RedBlackNode.prototype.moveLeft=function(){var t=this._right,e=t._left;this._right=e;this._right&&(this._right.parent=this);t._left=this;t._left.parent=t;this.setHeight();t.setHeight();return t};RedBlackNode.prototype.moveRight=function(){var t=this._left,e=t._right;this._left=e;this._left&&(this._left.parent=this);t._right=this;t._right.parent=t;this.setHeight();t.setHeight();return t};RedBlackNode.prototype.remove=function(t){var e,i,n,r=t.compare(this._value);if(0!=r){if(r<0)if(null!=this._left){e=this._left.remove(t);this._left=e[0];this._left&&(this._left.parent=this);n=e[1]}else n=null;else if(null!=this._right){e=this._right.remove(t);this._right=e[0];this._right&&(this._right.parent=this);n=e[1]}else n=null;i=this}else{n=this;if(null==this._left)i=this._right;else if(null==this._right)i=this._left;else{i=this._left.join(this._right);this._left=null;this._right=null}}return null!=n?null!=i?[i.balanceTree(),n]:[i,n]:[this,null]};RedBlackNode.prototype.setHeight=function(){var t=null!=this._left?this._left._height:0,e=null!=this._right?this._right._height:0;this._height=t<e?e+1:t+1};RedBlackNode.prototype.swingLeft=function(){var t=this._right,e=t._left,i=t._right,n=this._left;null!=n&&n._height;if((null!=e?e._height:0)>(null!=i?i._height:0)){this._right=t.moveRight();this._right.parent=this}return this.moveLeft()};RedBlackNode.prototype.swingRight=function(){var t=this._left,e=t._right,i=t._left,n=this._right;null!=n&&n._height;if((null!=e?e._height:0)>(null!=i?i._height:0)){this._left=t.moveLeft();this._left.parent=this}return this.moveRight()};RedBlackNode.prototype.traverse=function(t){null!=this._left&&this._left.traverse(t);t(this);null!=this._right&&this._right.traverse(t)};RedBlackNode.prototype.toString=function(){return this._value.toString()};RedBlackNode.prototype.validateParents=function(){if(this._right){if(this._right.parent!==this){console.log("Invalid right");console.log(this)}this._right.validateParents()}if(this._left){if(this._left.parent!==this){console.log("Invalid left");console.log(this)}this._left.validateParents()}};RedBlackTree.VERSION=1;function RedBlackTree(){this._root=null;this._cursor=null}RedBlackTree.prototype._findNode=function(t){for(var e=this._root;null!=e;){var i=t.compare(e._value);if(0==i)break;e=i<0?e._left:e._right}return e};RedBlackTree.prototype._maxNode=function(t){null==t&&(t=this._root);if(null!=t)for(;null!=t._right;)t=t._right;return t};RedBlackTree.prototype._minNode=function(t){null==t&&(t=this._root);if(null!=t)for(;null!=t._left;)t=t._left;return t};RedBlackTree.prototype._nextNode=function(t){if(null!=t)if(null!=t._right)t=this._minNode(t._right);else{for(;null!=t.parent&&t.parent._right===t;)t=t.parent;t=t.parent}else t=this._minNode(this._root);return t};RedBlackTree.prototype._previousNode=function(t){if(null!=t)if(null!=t._left)t=this._maxNode(t._left);else{for(;null!=t.parent&&t.parent._left===t;)t=t.parent;t=t.parent}else t=this._maxNode(this._root);return t};RedBlackTree.prototype.add=function(t){var e;if(null==this._root)e=this._root=new RedBlackNode(t);else{var i=this._root.add(t);this._root=i[0];this._root.parent=null;e=i[1]}return e};RedBlackTree.prototype.find=function(t){var e=this._findNode(t);return null!=e?e:null};RedBlackTree.prototype.findNext=function(t){var e=this._findNode(t,!0);return null!=(e=this._nextNode(e))?e._value:null};RedBlackTree.prototype.findPrevious=function(t){var e=this._findNode(t,!0);return null!=(e=this._previousNode(e))?e._value:null};RedBlackTree.prototype.max=function(){var t=this._maxNode();return null!=t?t._value:null};RedBlackTree.prototype.min=function(){var t=this._minNode();return null!=t?t._value:null};RedBlackTree.prototype.next=function(){this._cursor=this._nextNode(this._cursor);return this._cursor?this._cursor._value:null};RedBlackTree.prototype.previous=function(){this._cursor=this._previousNode(this._cursor);return this._cursor?this._cursor._value:null};RedBlackTree.prototype.remove=function(t){var e;if(null!=this._root){var i=this._root.remove(t);this._root=i[0];e=i[1]}else e=null;return e};RedBlackTree.prototype.goMin=function(){this._cursor=this._minNode(this._root)};RedBlackTree.prototype.goMax=function(){this._cursor=this._maxNode(this._root)};RedBlackTree.prototype.current=function(){return this._cursor?this._cursor._value:null};RedBlackTree.prototype.traverse=function(t){null!=this._root&&this._root.traverse(t)};RedBlackTree.prototype.toString=function(){var t=[];if(null!=this._root)for(var e=[[this._root,0,"^"]];e.length>0;){for(var i=e.pop(),n=i[0],r=i[1],a="",s=0;s<r;s++)a+="  ";a+=i[2]+"("+n.toString()+")";t.push(a);null!=n._right&&e.push([n._right,r+1,"R"]);null!=n._left&&e.push([n._left,r+1,"L"])}return t.join("\n")};RedBlackTree.prototype.validateParents=function(){if(null!=this._root.parent){console.log("Invalid root node parent");this._root.validateParents()}console.log("done")};var strictUnits=null,strictAgentResolution=!1,strictLinks=!1;function runSimulation(t){try{return innerRunSimulation(t)}catch(e){console.error(e);return checkErr(e,t)}}function checkErr(t,e,i){simulate&&simulate.terminate();isLocal()&&console.log(t);var n;if(t.msg)n={error:t.msg,errorPrimitive:isDefined(t.primitive)?findID(t.primitive.id):null};else{n={error:getText("An unknown simulation error occurred. Please report this issue to the Insight Maker team."),errorPrimitive:null};if("string"==typeof t){"MSG:"===t.substr(0,4)&&(n.error=t.substr(4));t={msg:n.error}}else t.msg=n.msg}simulate.results||(simulate.results={});simulate.results.error=t.msg;e.onError&&e.onError(n);if(e.silent)return n;handleErrorObject(t)}var timeUnits=null;function innerRunSimulation(t){evaluatingLine=null;simulate=new Simulator;t.resultsWindow&&(simulate.resultsWindow=t.resultsWindow);bootCalc();allPlaceholders=[];(model={}).submodels={base:{id:"base",DNAs:[],agents:[{children:[],childrenId:{}}],size:1}};var e=getSetting();strictUnits=isTrue(e.getAttribute("StrictUnits"));strictAgentResolution=isTrue(e.getAttribute("StrictAgentResolution"));strictLinks=isTrue(getSetting().getAttribute("StrictLinks"));if(isDefined(e.getAttribute("Units"))){for(var i=e.getAttribute("Units").split("\n"),n=[],r=[],a=[],s=0;s<i.length;s++){var o=i[s].split("<>");if(o[2]&&""!=o[2].trim()){n.push(o[0]);r.push(o[1]);var l=createUnitStore(o[2]);if(isUndefined(l))throw{msg:'You cannot define a units synonym for "unitless".'};a.push(l.toStringShort())}}loadUnits(n,a,r)}var u=getUnitStore([timeUnits=e.getAttribute("TimeUnits").toLowerCase()],[1]);model.timeLength=new Material(sn("#i"+e.getAttribute("TimeLength")),u);model.timeStart=new Material(sn("#i"+e.getAttribute("TimeStart")),u);model.timeStep=new Material(sn("#i"+e.getAttribute("TimeStep")),u);e.getAttribute("TimePause")>0&&(model.timePause=new Material(sn("#i"+e.getAttribute("TimePause")),u));simulate.timeUnits=u;var h={};h.base={timeStep:new Material(sn("#i"+e.getAttribute("TimeStep")),u),algorithm:e.getAttribute("SolutionAlgorithm"),id:"base",maxLoaded:-1};model.solvers=h;var c=findType("Folder");for(s=0;s<c.length;s++){var d=c[s].getAttribute("Solver");if(d){if((f=JSON.parse(d)).enabled){h[c[s].id]=f;h[c[s].id].timeStep=new Material(sn("#i"+h[c[s].id].timeStep),u);h[c[s].id].id=c[s].id;h[c[s].id].maxLoaded=-1}}}var m=Object.keys(h);for(s=0;s<m.length;s++){var f;(f=h[m[s]]).userTimeStep=f.timeStep;"RK4"==f.algorithm?f.RKOrder=4:f.RKOrder=1;4==f.RKOrder?f.timeStep=div(f.userTimeStep,new Material(2)):f.timeStep=f.userTimeStep;f.stocks=[];f.flows=[];f.transitions=[];f.actions=[];f.states=[];f.valued=[];f.displayed=[]}if(isDefined(e.getAttribute("Macros")))try{evaluateMacros(e.getAttribute("Macros"))}catch(t){var g=[],p=getText("An error with the macros prevented the simulation from running.");if(t.msg)p=p+"<br/><br/>"+t.msg;else if(t.toString&&"MSG:"==t.toString().substr(0,4))p=p+"<br/><br/>"+t.toString().substr(4);else if(t.toString&&t.match&&t.match(/line (\d+)/i)){var _=t.match(/line (\d+)/i)[1];g.push({type:"error",row:void 0!==_?_-1:evaluatingLine-1,text:t})}showMacros(g);throw{msg:p}}var v=primitives();for(s=0;s<v.length;s++)if("Agents"==v[s].value.nodeName){var S=v[s],N=S.getAttribute("Agent"),T=parseInt(N,10);T==N&&(N=T);if(isUndefined(N))throw{msg:getText("You must select a base agent for the primitive %s. You can create agent definitions using Folder primitives.","<i>"+clean(S.getAttribute("name"))+"</i>"),primitive:S,showEditor:!1};var b=new Agents;b.dna=new DNA(S,N);b.id=S.id;b.agentId=N;b.createIds();b.dna.solver=folderSolvers(S,h);b.dna.solver.displayed.push(b);b.geoDimUnits=S.getAttribute("GeoDimUnits");b.geoDimUnitsObject=createUnitStore(S.getAttribute("GeoDimUnits"));b.geoWidth=simpleUnitsTest(simpleEquation(S.getAttribute("GeoWidth")),b.geoDimUnitsObject,S);b.geoHeight=simpleUnitsTest(simpleEquation(S.getAttribute("GeoHeight")),b.geoDimUnitsObject,S);b.halfWidth=div(b.geoWidth,new Material(2));b.halfHeight=div(b.geoHeight,new Material(2));b.geoWrap=isTrue(S.getAttribute("GeoWrap"));b.placement=S.getAttribute("Placement");b.placementFunction=S.getAttribute("PlacementFunction");b.network=S.getAttribute("Network");b.networkFunction=S.getAttribute("NetworkFunction");b.agentBase=findID(N).getAttribute("AgentBase")||"";""!=b.agentBase.trim()&&(b.agentBase=simpleEquation(b.agentBase,varBank));var E=getChildren(findID(N));b.DNAs=[];for(var F=0;F<E.length;F++){modelType(E[F].value.nodeName)&&b.DNAs.push(getDNA(E[F],h));"State"==E[F].value.nodeName&&b.stateIds.push(E[F].id)}b.size=S.getAttribute("Size");b.agents=[];b.dna.agents=b;model.submodels[S.id]=b;model.submodels.base.DNAs.push(b.dna)}else inAgent(v[s])||modelType(v[s].value.nodeName)&&model.submodels.base.DNAs.push(getDNA(v[s],h));for(var k in model.submodels){k=model.submodels[k];for(F=0;F<k.size;F++){var L;if("base"==k.id)L=k.agents[0];else{(L=new Agent).container=k;L.index=F;L.children=[];L.childrenId={};L.agentId=k.id;L.createIds();k.agentBase&&(L.vector.parent=k.agentBase);k.agents.push(L)}for(s=0;s<k.DNAs.length;s++)decodeDNA(k.DNAs[s],L)}}simulate.setup({model:model});for(var k in model.submodels){k=model.submodels[k];for(F=0;F<k.size;F++)for(s=0;s<k.DNAs.length;s++)linkPrimitive(k.agents[F].children[s],k.DNAs[s])}for(var k in model.submodels){k=model.submodels[k];for(F=0;F<k.size;F++)setAgentInitialValues(k.agents[F])}for(var k in model.submodels)if("base"!=k){try{buildNetwork(model.submodels[k])}catch(t){isLocal()&&console.log(t);p=getText("An error with the custom network function prevented the simulation from running.");t.msg?p=p+"<br/><br/>"+t.msg:"MSG:"==t.toString().substr(0,4)&&(p=p+"<br/><br/>"+t.toString().substr(4));throw{msg:p,primitive:model.submodels[k].cell,showEditor:!1}}try{buildPlacements(model.submodels[k])}catch(t){isLocal()&&console.log(t);p=getText("An error with the agent placement function prevented the simulation from running.");t.msg?p=p+"<br/><br/>"+t.msg:"MSG:"==t.toString().substr(0,4)&&(p=p+"<br/><br/>"+t.toString().substr(4));throw{msg:p,primitive:model.submodels[k].cell,showEditor:!1}}}simulate.results={Time:[],data:[]};simulate.displayInformation={ids:[],times:[],objects:[]};model.submodels.base.agents[0].children.forEach((function(t){if(!(t instanceof Action||t instanceof Transition)){simulate.displayInformation.objects.push(t);simulate.displayInformation.ids.push(t.id);var e={};if(t instanceof Agents){e.width=t.geoWidth;e.height=t.geoHeight;e.units=t.geoDimUnitsObject;e.states=t.states()}else t.dna.solver.displayed.push(t);simulate.results[t.id]={data:e,results:[],dataMode:"float"}}}));if(t.silent){if(!t.onPause)return formatSimResults(simulate.run(t));simulate.run(t)}else{var w=div(model.timeLength,model.timeStep);for(s=0;s<=w;s++)simulate.displayInformation.times.push(plus(model.timeStart,mult(model.timeStep,new Material(s))).value);var x=t.onSuccess;t.onSuccess=function(t){updateDisplayed(null);simulate.resultsWindow.results=formatSimResults(simulate.results);x&&x(t)};t.onCompletedFirstPass=function(){if(t.resultsWindow){t.resultsWindow.displayInformation.store.suspendEvents();t.resultsWindow.displayInformation.store.maxLoaded=-1;t.resultsWindow.displayInformation.store.clearFilter();t.resultsWindow.displayInformation.store.removeAll();simulate.displayInformation=t.resultsWindow.displayInformation;var e=t.resultsWindow.displayInformation.scripter;e.simulator=simulate;e.playBut.setGlyph(61516);e.combo.setValue(-1);e.time=0;e.timeIndex=0;e.isFinished=!1;e.updatingSlider=!0;e.slider.setValue(e.minTime);e.updatingSlider=!1;e.advanceTimer();t.resultsWindow.displayInformation.store.resumeEvents();clearInterval(e.animInter);e.animInter=setInterval((function(){e.advanceTimer()}),200);for(var i=0;i<simulate.displayInformation.origIds.length;i++){var n=simulate.displayInformation.origIds[i];if("Agents"==(l=(o=simulate.displayInformation.objects[i]).dna).type){simulate.results[n].states=o.stateIds;simulate.displayInformation.agents[n.toString()].data=simulate.results[n].data;simulate.displayInformation.agents[n.toString()].results=simulate.results[n].results}else if(simulate.results.data[0][n]instanceof Vector&&simulate.results.data[0][n].names){var r=simulate.results.data[0][n].fullNames();simulate.results[n].indexedFullNames=r.slice();for(var a=0;a<r.length;a++)r[a]=r[a].join(", ");simulate.results[n].indexedNames=r}}}else{simulate.displayInformation.colors=[];simulate.displayInformation.headers=[];simulate.displayInformation.agents=[];simulate.displayInformation.displayedHeaders=[];simulate.displayInformation.displayedIds=[];simulate.displayInformation.renderers=[];simulate.displayInformation.elementIds=[];simulate.displayInformation.res=simulate.results;var s=[];simulate.displayInformation.origIds=simulate.displayInformation.ids.slice();for(i=0;i<simulate.displayInformation.origIds.length;i++){n=simulate.displayInformation.origIds[i];var o,l=(o=simulate.displayInformation.objects[i]).dna;simulate.displayInformation.displayedIds.push(n);simulate.displayInformation.displayedHeaders.push(l.name);if("Agents"==l.type){var u=o.stateIds;simulate.results[n].states=u;for(a=0;a<u.length;a++){var h=findID(u[a]);s.push(n);simulate.displayInformation.elementIds.push("e"+n+"-"+u[a]);simulate.displayInformation.headers.push(getName(h));simulate.displayInformation.colors.push(getLineColor(h));"float"==simulate.results[n].dataMode?simulate.displayInformation.renderers.push(commaStr):"agents"==simulate.results[n].dataMode?simulate.displayInformation.renderers.push((function(t){return t})):simulate.displayInformation.renderers.push(void 0)}simulate.displayInformation.agents[n.toString()]={id:n,item:l.cell,data:simulate.results[n].data,results:simulate.results[n].results}}else if(simulate.results.data[0][n]instanceof Vector&&simulate.results.data[0][n].names){var c=getLineColor(l.cell);r=simulate.results.data[0][n].fullNames();simulate.results[n].indexedFullNames=r.slice();for(a=0;a<r.length;a++)r[a]=r[a].join(", ");simulate.results[n].indexedNames=r;for(a=0;a<r.length;a++){s.push(n);simulate.displayInformation.elementIds.push("e"+n+"-"+a);simulate.displayInformation.headers.push(l.name+" ("+r[a]+")");simulate.displayInformation.colors.push(c);simulate.displayInformation.renderers.push(commaStr)}}else{s.push(n);simulate.displayInformation.elementIds.push("e"+n);simulate.displayInformation.headers.push(l.name);simulate.displayInformation.colors.push(getLineColor(l.cell));"float"==simulate.results[n].dataMode?simulate.displayInformation.renderers.push(commaStr):simulate.displayInformation.renderers.push(void 0)}}var d=[{type:"float",name:"Time"},{type:"int",name:"id"}];for(i=0;i<simulate.displayInformation.elementIds.length;i++)d.push({type:"auto",name:simulate.displayInformation.elementIds[i],defaultValue:void 0});simulate.displayInformation.store=new Ext.data.Store({fields:d,data:void 0});simulate.displayInformation.store.maxLoaded=-1;simulate.displayInformation.ids=s}};var y=t.onStep;t.onStep=function(t){var e=!1,i=simulate.progress();if(!simulate.shouldSleep){var n=(new Date).getTime()-simulate.wakeUpTime;if(!simulate.resultsWindow&&n>100||n>600){updateDisplayed(t);e=!0;simulate.timer=setTimeout((function(){simulate.resume()}),20);simulate.sleep()}}1!=i||e||updateDisplayed(t);y&&y(t)};var A=t.onError;t.onError=function(t){try{for(var e in simulate.model.solvers)updateDisplayed(simulate.model.solvers[e])}catch(t){}if(simulate.resultsWindow){simulate.resultsWindow.scripter.pause(!1);simulate.resultsWindow.scripter.finished()}A&&A(t)};simulate.run(t)}}function formatSimResults(t){var e=function(t){return function(e){if(e instanceof Vector){if(e.names){for(var n={},r=0;r<e.names.length;r++)n[e.names[r]]=i(e.items[r]);return n}return e.items.slice().map(i)}return t?e:void 0}},i=e(!0);if(isUndefined((t=deepClone({},t,3,e(!1))).error)){t.error="none";t.errorPrimitive=null}t.names={};for(var n=model.submodels.base.agents[0].children,r=0;r<n.length;r++)t.names[n[r].name]=n[r].id;t.value=function(t){return this[t.id].results};t.lastValue=function(t){return this[t.id].results[this[t.id].results.length-1]};if(t.Time){t.periods=t.Time.length;t.times=t.Time}return t}function createUnitStore(t){if(t&&""!=t.trim()&&"unitless"!=t.trim().toLowerCase())return simpleEquation("{1 "+t+"}").units}function simpleEquation(t,e,i,n){e||(e={});i||(i={});n||(n=trimTree(createTree(t),i));return evaluateTree(n,e)}function simpleNum(t,e){if(t instanceof Vector)return new Vector(t.items.map((function(t){return simpleNum(t,e)})));if(!e&&t.units)throw getText("The result of the calculation has units %s, but no units are specified for the calculation. Please set the units for the calculation so we can determine the proper output.",t.units.toString());if(t.units){t.units.addBase();e.addBase();return 0+fn["*"](t.value,fn["/"](sn("#e"+t.units.toBase),e.toBase))}return 0+t.value}function simpleUnitsTest(t,e,i,n){if(t instanceof Vector)return new Vector(t.items.map((function(t){return simpleUnitsTest(t,e,i,n)})));if(t.units||e){if(t.units){if(t.units===e)return t;var r=convertUnits(t.units,e,!1);if(0==r){if(isLocal()){console.log(t.units);console.log(e)}throw{msg:getText("Wrong units generated. Expected %s, and got %s.","<i>"+clean(e?e.toString():"unitless")+"</i>","<i>"+clean(t.units?t.units.toString():"unitless")+"</i>"),primitive:i,showEditor:n}}t.value=t.value*r;t.units=e;return t}t.units=e;return t}return t}function handleErrorObject(t){if(isLocal()){console.log(t);console.trace&&console.trace()}if(t.msg){if(isDefined(t.primitive)){var e=findID(t.primitive.id);highlight(e);t.showEditor&&showEditor(e,[{type:"error",row:void 0!==t.line?t.line-1:evaluatingLine-1,text:t.details?t.details:"Error"}])}mxUtils.alert(t.msg)}else t.error?mxUtils.alert(t):mxUtils.alert(getText("An unknown model simulation error occurred. Please report this issue to the Insight Maker team."))}function evaluateMacros(t){evaluateTree(trimTree(createTree(t),{}),varBank)}function DNA(t,e){this.type=t.value.nodeName;this.cell=t;e=e||t.id;var i=parseInt(t.id,10);i==t.id?this.id=i:this.id=e;this.name=t.getAttribute("name");this.units=null}function getDNA(t,e){var i=new DNA(t);i.solver=folderSolvers(t,e);if(t){var n=getParent(t);n&&(i.frozen=isTrue(getFrozen(n)))}"Variable"!==i.type&&"Flow"!=i.type||isTrue(t.getAttribute("ShowSlider"))&&(i.slider=!0);if("Flow"==i.type||"Transition"==i.type){null!==t.target&&(i.targetId=orig(t.target).id);null!==t.source&&(i.sourceId=orig(t.source).id)}if("Converter"==i.type)i.value=getValue(t);else try{i.value=createTree(getValue(t))}catch(e){isLocal()&&console.log(e);var r=getText("The primitive %s has an equation error that must be corrected before the model can be run.","<i>["+clean(i.name)+"]</i>");e.substr&&"MSG:"==e.substr(0,4)&&(r+="<br/><br/>"+e.toString().substr(4));var a=void 0;e.match&&e.match(/line (\d+)/i)&&(a=e.match(/line (\d+)/i)[1]);error(r,t,!0,a,e.match?e:void 0)}if("Action"==i.type){i.trigger=t.getAttribute("Trigger");i.repeat=isTrue(t.getAttribute("Repeat"));i.recalculate=isTrue(t.getAttribute("Recalculate"))||"Condition"==i.trigger;try{i.triggerValue=createTree(""+t.getAttribute("Value"))}catch(t){r=getText("The trigger for %s has an equation error that must be corrected before the model can be run.","<i>["+clean(i.name)+"]</i>");t.substr&&"MSG:"==t.substr(0,4)&&(r+="<br/><br/>"+t.toString().substr(4));error(r,i.cell,!1,a)}}else if("Transition"==i.type){i.trigger=t.getAttribute("Trigger");i.repeat=isTrue(t.getAttribute("Repeat"));i.recalculate=isTrue(t.getAttribute("Recalculate"))||"Condition"==i.trigger}else if("State"==i.type)if(isUndefined(t.getAttribute("Residency"))||""==t.getAttribute("Residency").trim())i.residency=null;else try{i.residency=evaluateTree(trimTree(createTree(t.getAttribute("Residency")),{}));i.residency.units||(i.residency.units=simulate.timeUnits);eq(i.residency,new Material(0,simulate.timeUnits))&&(i.residency=null)}catch(e){isLocal()&&console.log(e);throw{msg:getText("Invalid state residency."),primitive:t,showEditor:!1}}else if("Stock"==i.type){i.nonNegative=isTrue(t.getAttribute("NonNegative"));if("Conveyor"==t.getAttribute("StockMode")){i.stockType="Conveyor";try{i.delay=evaluateTree(trimTree(createTree(t.getAttribute("Delay")),{}));i.delay.units||(i.delay.units=simulate.timeUnits)}catch(e){isLocal()&&console.log(e);throw{msg:getText("Invalid stock delay."),primitive:t,showEditor:!1}}}}else if("Flow"==i.type)i.onlyPositive=isTrue(t.getAttribute("OnlyPositive"));else if("Converter"==i.type){i.source=t.getAttribute("Source");i.interpolation="Linear"==t.getAttribute("Interpolation")?"linear":"discrete";if(isUndefined(t.getAttribute("Data"))||""==t.getAttribute("Data").trim())throw{msg:getText("The converter %s does not have any data.","<i>"+clean(i.name)+"</i>"),primitive:t,showEditor:!0};var s,o=t.getAttribute("Data").split(";"),l=[],u=[];s="Time"==i.source?simulate.timeUnits:createUnitStore(orig(findID(i.source)).getAttribute("Units"));for(var h=0;h<o.length;h++){var c=o[h].split(",");l.push(new Material(sn(c[0].trim()),s));u.push(new Material(sn(c[1].trim())))}i.inputs=l;i.outputs=u}if("State"!=i.type){if("Transition"!=i.type&&"Action"!=i.type){var d=t.getAttribute("Units");try{if("Flow"!=i.type||d&&""!=d.trim()&&"unitless"!=d.trim().toLowerCase())i.units=createUnitStore(d);else{i.units=getUnitStore([timeUnits],[-1]);i.flowUnitless=!0}}catch(e){isLocal()&&console.log(e);throw{msg:getText('Invalid units specified for primitive: "%s".',clean(d)),primitive:t,showEditor:!0}}}else"Timeout"==i.trigger&&(i.units=simulate.timeUnits);i.maxConstraint=t.getAttribute("MaxConstraint");i.maxConstraintType=isTrue(t.getAttribute("MaxConstraintUsed"))?1:null;i.minConstraint=t.getAttribute("MinConstraint");i.minConstraintType=isTrue(t.getAttribute("MinConstraintUsed"))?1:null}if(i.units){i.units.addBase();i.toBase=i.units.toBase}else i.toBase=1;i.unitless=!i.units;return i}function folderSolvers(t,e){if(!t||null==t)return e.base;if("Agents"==t.value.nodeName){var i=t.getAttribute("Agent");if(e[i])return e[i]}var n=getParent(t);return n&&e[n.id]?e[n.id]:folderSolvers(n,e)}function decodeDNA(t,e){var i,n=t.type;"Variable"==n?i=new Variable:"State"==n?i=new State:"Transition"==n?i=new Transition:"Action"==n?i=new Action:"Stock"==n?i=new Stock:"Flow"==n?i=new Flow:"Converter"==n&&(i=new Converter);if(i){i.dna=t;i.id=t.id;i.index=e.index;i.agentId=e.agentId;i.container=e;i.createIds();i.frozen=t.frozen;e.children.push(i);e.childrenId[i.id]=i;t.slider&&(simulate.sliders[t.id]?simulate.sliders[t.id].push(i):simulate.sliders[t.id]=[i]);if(i instanceof Action)t.solver.actions.push(i);else if(i instanceof Transition)t.solver.transitions.push(i);else if(!(i instanceof Agents)){t.solver.valued.push(i);i instanceof Flow?t.solver.flows.push(i):i instanceof Stock?t.solver.stocks.push(i):i instanceof State&&t.solver.states.push(i)}}else if("Agents"==n){e.children.push(t.agents);e.childrenId[t.id]=t}}function linkPrimitive(t,e){var i=e.type;if("Agents"!=i){var n=getPrimitiveNeighborhood(t,e);if("Flow"==i||"Transition"==i){var r=null,a=null;if(n["[alpha"]){r=n["[alpha"];n.alpha||(n.alpha=r)}if(n["[omega"]){a=n["[omega"];n.omega||(n.omega=a)}t.setEnds(r,a)}if("Action"==i){try{t.equation=trimTree(e.triggerValue,n)}catch(t){var s=getText("The primitive %s has an equation error that must be corrected before the model can be run.","<i>["+clean(e.name)+"]</i>");t.substr&&"MSG:"==t.substr(0,4)&&(s+="<br/><br/>"+t.toString().substr(4));error(s,e.cell,!1,o)}try{t.action=trimTree(e.value,n)}catch(t){s=getText("The primitive %s has an equation error that must be corrected before the model can be run.","<i>["+clean(e.name)+"]</i>");t.substr&&"MSG:"==t.substr(0,4)&&(s+="<br/><br/>"+t.toString().substr(4));var o=void 0;t.match&&t.match(/line (\d+)/i)&&(o=t.match(/line (\d+)/i)[1]);error(s,e.cell,!0,o,t.match?t:void 0)}}else if("Converter"==i)if("Time"==e.source)t.setSource("*time");else{var l=orig(findID(e.source)).id,u=!1;for(var h in n)if(l==n[h].id){t.setSource(n[h]);u=!0;break}u||error("Converter source could not be found. Please redefine it.",e.cell,!1)}else t.setEquation(e.value,n)}}function setAgentInitialValues(t){for(var e=0;e<t.children.length;e++)if(t.children[e]instanceof Stock){t.children[e].setDelay();try{t.children[e].setInitialValue()}catch(i){isLocal()&&console.log(i);if(!(i instanceof String))throw i;error(i.substr(4,i.length),t.children[e],!0)}}else if(t.children[e]instanceof State)try{null===t.children[e].active&&t.children[e].setInitialActive(!0)}catch(i){isLocal()&&console.log(i);if(!(i instanceof String))throw i;error(i.substr(4,i.length),t.children[e],!0)}}function buildNetwork(t){if("Custom Function"==t.network)for(var e=getPrimitiveNeighborhood(t,t.dna),i=trimTree(createTree(t.networkFunction),e),n=0;n<t.agents.length-1;n++)for(var r=n+1;r<t.agents.length;r++)trueValue(simpleEquation(t.networkFunction,{"-parent":varBank,a:t.agents[n],b:t.agents[r]},e,i))&&t.agents[n].connect(t.agents[r]);else if("None"!=t.network)throw{msg:"Unknown network type: "+t.network+".",primitive:t.cell,showEditor:!1}}function buildPlacements(t,e){var i,n,r;if("Random"==t.placement)t.agents.forEach((function(e){e.location=new Vector([mult(t.geoWidth,new Material(Rand())),mult(t.geoHeight,new Material(Rand()))],["x","y"])}));else if("Custom Function"==t.placement)t.agents.forEach((function(e){var i=getPrimitiveNeighborhood(t,t.dna);i.self=e;e.location=simpleUnitsTest(simpleEquation(t.placementFunction,{"-parent":varBank,self:e},i),t.geoDimUnitsObject);if(!e.location.names){e.location.names=["x","y"];e.location.namesLC=["x","y"]}}));else if("Grid"==t.placement){i=trimTree(createTree("{x: x*width(self), y: y*height(self)}"),{});var a=t.agents.length,s=simpleNum(simpleEquation("width(self)/height(self)",{"-parent":varBank,self:t},{}),t.geoDimUnitsObject);r=Math.sqrt(a/s);n=Math.floor(r*s);!(r=Math.ceil(r))*n>=a&&(n+=1);var o=0;t.agents.forEach((function(e){var a=(o%n+.5)/n,s=(Math.floor(o/n)+.5)/r;e.location=simpleUnitsTest(simpleEquation("{x: x*width(self), y: y*height(self)}",{self:e,x:new Material(a),y:new Material(s),"-parent":varBank},{},i),t.geoDimUnitsObject);o++}))}else if("Ellipse"==t.placement){i=trimTree(createTree("{width(self), height(self)}/2+{sin(index(self)/size*2*3.14159), cos(index(self)/size*2*3.14159)}*{width(self), height(self)}/2"),{});a=new Material(t.agents.length);t.agents.forEach((function(e){e.location=simpleUnitsTest(simpleEquation("{width(self), height(self)}/2+{sin(index(self)/size*2*3.14159), cos(index(self)/size*2*3.14159)}*{width(self), heigh(self)}/2",{self:e,size:a,"-parent":varBank},{},i),t.geoDimUnitsObject)}))}else{if("Network"!=t.placement)throw{msg:"Unknown placement type: "+t.placement+".",primitive:t.cell,showEditor:!1};i=trimTree(createTree("{x: x*width(self), y: y*height(self)}"),{});var l=new Graph,u=t.agents.map((function(t){return l.newNode({data:t})})),h=function(t){for(var e=0;e<u.length;e++)if(u[e].data.data===t)return u[e];return null};t.agents.forEach((function(t){t.connected.forEach((function(e){l.newEdge(h(t),h(e))}))}));for(var c=new Layout.ForceDirected(l,400,600,.5),d=0;d<60;d++){c.applyCoulombsLaw();c.applyHookesLaw();c.attractToCentre();c.updateVelocity(.03);c.updatePosition(.03)}var m=c.getBoundingBox();m.width=m.topright.x-m.bottomleft.x;m.height=m.topright.y-m.bottomleft.y;c.eachNode((function(e,n){var r=function(t){return{x:(t.x-m.bottomleft.x)/m.width,y:(t.y-m.bottomleft.y)/m.height}}(n.p);e.data.data.location=simpleUnitsTest(simpleEquation("{x: x*width(self), y: y*height(self)}",{self:t,x:new Material(r.x),y:new Material(r.y),"-parent":varBank},{},i),t.geoDimUnitsObject)}))}}var allPlaceholders={};function getPrimitiveNeighborhood(t,e){var i=neighborhood(e.cell),n=allPlaceholders[e.id]?allPlaceholders[e.id]:{},r={self:t};if(!i.placeholders&&"Agents"==e.type)for(var a=0;a<t.DNAs.length;a++)n[t.DNAs[a].name.toLowerCase()]=new Placeholder(t.DNAs[a],t);for(var s=0;s<i.length;s++){var o=i[s].item;if("Agents"==o.value.nodeName){r[model.submodels[o.id].dna.name.toLowerCase()]=model.submodels[o.id];if(!i.placeholders)for(a=0;a<model.submodels[o.id].DNAs.length;a++)r[model.submodels[o.id].DNAs[a].name.toLowerCase()]=new Placeholder(model.submodels[o.id].DNAs[a],t)}else if("agent"!=i[s].type){var l=!1;if(t.container&&t.container.childrenId[o.id]){r[u=t.container.childrenId[o.id].dna.name.toLowerCase()]=t.container.childrenId[o.id];l=!0}if(!l&&model.submodels.base.agents[0].childrenId[o.id]){var u;r[u=model.submodels.base.agents[0].childrenId[o.id].dna.name.toLowerCase()]=model.submodels.base.agents[0].childrenId[o.id];l=!0}l||"Flow"!=e.type&&"Transition"!=e.type||o!=findID(o.id)||error(e.type+" primitives may not cross agent boundaries.",e.cell,!1);"Flow"!=e.type&&"Transition"!=e.type||r[u]&&(e.targetId==r[u].id?r["[omega"]=r[u]:e.sourceId==r[u].id&&(r["[alpha"]=r[u]))}}var h=Object.keys(n);for(a=0;a<h.length;a++)r[h[a]]=n[h[a]];allPlaceholders[e.id]=n;return r}function modelType(t){return!("Link"==t||"Picture"==t||"Text"==t||"Button"==t||"Folder"==t||"Setting"==t||"Display"==t||"Ghost"==t)}function updateDisplayed(t){var e=t?t.displayed:[];if(simulate.displayInformation.store){if(e.length>0){var i=[],n=t.maxLoaded;n=isDefined(n)?n+1:0;for(var r=t.maxLoaded,a=n;a<simulate.results.Time.length;a++){var s=simulate.displayInformation.store.getById(a),o={};if(!s){o.id=a;o.Time=simulate.results.Time[a]}if(isUndefined(simulate.results.data[a][e[0].id]));else{r=a;for(var l=0;l<e.length;l++){var u=simulate.displayInformation.ids.indexOf(e[l].id);if(u>-1)if(simulate.results[simulate.displayInformation.ids[u]].states){var h=simulate.results[simulate.displayInformation.ids[u]].states;if(simulate.results.data[a][e[l].id]){for(var c=simulate.results.data[a][e[l].id].current,d={},m=0;m<c.length;m++)if(c[m].state)for(var f=0;f<c[m].state.length;f++)d[c[m].state[f].id.toString()]=d[c[m].state[f].id.toString()]+1||1;for(m=0;m<h.length;m++)o[simulate.displayInformation.elementIds[u+m]]=d[h[m]]||0}}else if(simulate.results[simulate.displayInformation.ids[u]].indexedNames)for(var g=0;u<simulate.displayInformation.ids.length&&simulate.displayInformation.ids[u]==e[l].id;){try{o[simulate.displayInformation.elementIds[u]]=selectFromMatrix(simulate.results.data[a][e[l].id].fullClone(),simulate.results[simulate.displayInformation.ids[u]].indexedFullNames[g].slice())}catch(t){throw{msg:getText("Cannot change vector keys during a simulation."),primitive:e[l].dna.cell,showEditor:!0}}g++;u++}else o[simulate.displayInformation.elementIds[u]]=simulate.results.data[a][e[l].id]}}if(s){s.set(o);s.commit()}else i.push(o)}t.maxLoaded=r;simulate.displayInformation.store.maxLoaded=Math.max(simulate.displayInformation.store.maxLoaded,t.maxLoaded);simulate.displayInformation.store.suspendEvents();simulate.displayInformation.store.add(i);simulate.displayInformation.store.resumeEvents();simulate.displayInformation.store.filter()}if(!simulate.resultsWindow){simulate.resultsWindow=createResultsWindow(simulate.displayInformation,simulate.config);simulate.resultsWindow.scripter.loadTime(0);var p=-1==simulate.resultsWindow.scripter.combo.getValue()?200:100/Math.min(.5,simulate.resultsWindow.scripter.combo.getValue());f=simulate.resultsWindow.scripter;simulate.resultsWindow.scripter.animInter=setInterval((function(){f.advanceTimer()}),p)}simulate.resultsWindow.sliders=simulate.sliders;a==simulate.displayInformation.times.length&&simulate.resultsWindow.scripter.finished()}}module.exports={is_owner:is_owner,translations:translations,analysisCount:analysisCount,isSendingtoServer:isSendingtoServer,waitingToSendToServer:waitingToSendToServer,waitingToSendTimeout:waitingToSendTimeout,primitiveCache:primitiveCache,neighborhoodCache:neighborhoodCache,downloadButton:downloadButton,executeLayout:executeLayout,trusted:trusted,globalVarBank:globalVarBank,primitiveBank:primitiveBank,defaultSolver:defaultSolver,doc:doc,blankGraphTemplate:blankGraphTemplate,FormulaLexer:FormulaLexer,FormulaParser:FormulaParser,baseSources:baseSources,baseTargets:baseTargets,baseScalings:baseScalings,conScalings:conScalings,conTargets:conTargets,conSourceNames:conSourceNames,conUnitTargets:conUnitTargets,conSourceRegEx:conSourceRegEx,cachedUnits:cachedUnits,findSourceIndex:findSourceIndex,unitsBank:unitsBank,titleCaseReg:titleCaseReg,titleCaseFunc:titleCaseFunc,SchemeNumber:SchemeNumber,SchemeNumber:SchemeNumber,functionBank:functionBank,functionLoaders:functionLoaders,PrimitiveStore:PrimitiveStore,StringObject:StringObject,VectorObject:VectorObject,VectorBase:VectorBase,Vector:Vector,TreeNode:TreeNode,funcEvalMap:funcEvalMap,evaluatingLine:evaluatingLine,unitEvalMap:unitEvalMap,trimEvalMap:trimEvalMap,AgentObject:AgentObject,PrimitiveObject:PrimitiveObject,TaskId:TaskId,strictUnits:strictUnits,strictAgentResolution:strictAgentResolution,strictLinks:strictLinks,timeUnits:timeUnits,allPlaceholders:allPlaceholders,isLocal:isLocal,isLocal:isLocal,getText:getText,getText:getText,SimpleNode:SimpleNode,loadXML:loadXML,simpleCloneNode:simpleCloneNode,mxGraphToJson:mxGraphToJson,setAttributeUndoable:setAttributeUndoable,SimpleNode:SimpleNode,loadXML:loadXML,simpleCloneNode:simpleCloneNode,mxGraphToJson:mxGraphToJson,setAttributeUndoable:setAttributeUndoable,getGraphXml:getGraphXml,sendGraphtoServer:sendGraphtoServer,validPrimitiveName:validPrimitiveName,isPrimitive:isPrimitive,cellsContainNodename:cellsContainNodename,connectionType:connectionType,setAllConnectable:setAllConnectable,primitives:primitives,childrenCells:childrenCells,clearPrimitiveCache:clearPrimitiveCache,neighborhood:neighborhood,doubleArray:doubleArray,isValued:isValued,setSaveEnabled:setSaveEnabled,hasDisplay:hasDisplay,urlImage:urlImage,setPicture:setPicture,setLabelPosition:setLabelPosition,removeAgent:removeAgent,deletePrimitive:deletePrimitive,linkBroken:linkBroken,testConverterSource:testConverterSource,downloadModel:downloadModel,getSetting:getSetting,handelCursors:handelCursors,updateProperties:updateProperties,isTrue:isTrue,customUnits:customUnits,orig:orig,currentStyleIs:currentStyleIs,setStyles:setStyles,stringArray:stringArray,quickLabel:quickLabel,processLabel:processLabel,replaceAll:replaceAll,loadBackgroundColor:loadBackgroundColor,isUndefined:isUndefined,isDefined:isDefined,isTouch:isTouch,propagateGhosts:propagateGhosts,propagateName:propagateName,map:map,unitsUsedInModel:unitsUsedInModel,changeNodeName:changeNodeName,cmd:cmd,inAgent:inAgent,parentAgent:parentAgent,isGray:isGray,colourNameToHex:colourNameToHex,flatten:flatten,deepClone:deepClone,exportSvg:exportSvg,getGraphXml:getGraphXml,sendGraphtoServer:sendGraphtoServer,validPrimitiveName:validPrimitiveName,isPrimitive:isPrimitive,cellsContainNodename:cellsContainNodename,connectionType:connectionType,setAllConnectable:setAllConnectable,primitives:primitives,childrenCells:childrenCells,clearPrimitiveCache:clearPrimitiveCache,neighborhood:neighborhood,doubleArray:doubleArray,isValued:isValued,setSaveEnabled:setSaveEnabled,hasDisplay:hasDisplay,urlImage:urlImage,setPicture:setPicture,setLabelPosition:setLabelPosition,removeAgent:removeAgent,deletePrimitive:deletePrimitive,linkBroken:linkBroken,testConverterSource:testConverterSource,downloadModel:downloadModel,getSetting:getSetting,handelCursors:handelCursors,updateProperties:updateProperties,isTrue:isTrue,customUnits:customUnits,orig:orig,currentStyleIs:currentStyleIs,setStyles:setStyles,stringArray:stringArray,quickLabel:quickLabel,processLabel:processLabel,replaceAll:replaceAll,loadBackgroundColor:loadBackgroundColor,isUndefined:isUndefined,isDefined:isDefined,isTouch:isTouch,propagateGhosts:propagateGhosts,propagateName:propagateName,map:map,unitsUsedInModel:unitsUsedInModel,changeNodeName:changeNodeName,cmd:cmd,inAgent:inAgent,parentAgent:parentAgent,isGray:isGray,colourNameToHex:colourNameToHex,flatten:flatten,deepClone:deepClone,exportSvg:exportSvg,showMessage:showMessage,showPrompt:showPrompt,showChoice:showChoice,showURL:showURL,downloadFile:downloadFile,showData:showData,frontWindow:frontWindow,closeAllWindows:closeAllWindows,openFile:openFile,runModel:runModel,simulationRunning:simulationRunning,endRunningSimulation:endRunningSimulation,saveModel:saveModel,clearModel:clearModel,layoutModel:layoutModel,setZoom:setZoom,getTimeStep:getTimeStep,setTimeStep:setTimeStep,getTimeStart:getTimeStart,setTimeStart:setTimeStart,getTimeLength:getTimeLength,setTimeLength:setTimeLength,getPauseInterval:getPauseInterval,setPauseInterval:setPauseInterval,getTimeUnits:getTimeUnits,setTimeUnits:setTimeUnits,getAlgorithm:getAlgorithm,setAlgorithm:setAlgorithm,getMacros:getMacros,setMacros:setMacros,findName:findName,findAll:findAll,findType:findType,findID:findID,findValue:findValue,findNote:findNote,createPrimitive:createPrimitive,createConnector:createConnector,removePrimitive:removePrimitive,highlight:highlight,getSelected:getSelected,setSelected:setSelected,isSelected:isSelected,getID:getID,getType:getType,getName:getName,setName:setName,getUnits:getUnits,setUnits:setUnits,getConstraints:getConstraints,setConstraints:setConstraints,getNote:getNote,setNote:setNote,showNote:showNote,hideNote:hideNote,showEditor:showEditor,getValue:getValue,setValue:setValue,getSize:getSize,getPosition:getPosition,setPosition:setPosition,flash:flash,getShowSlider:getShowSlider,setShowSlider:setShowSlider,getSliderMin:getSliderMin,setSliderMin:setSliderMin,getSliderMax:getSliderMax,setSliderMax:setSliderMax,getSliderStep:getSliderStep,setSliderStep:setSliderStep,getOpacity:getOpacity,setOpacity:setOpacity,getLineColor:getLineColor,setLineColor:setLineColor,getFontColor:getFontColor,setFontColor:setFontColor,getFillColor:getFillColor,setFillColor:setFillColor,getImage:getImage,setImage:setImage,getNonNegative:getNonNegative,setNonNegative:setNonNegative,getStockType:getStockType,setStockType:setStockType,getDelay:getDelay,setDelay:setDelay,getEnds:getEnds,setEnds:setEnds,connected:connected,getResidency:getResidency,setResidency:setResidency,getTriggerType:getTriggerType,setTriggerType:setTriggerType,getTriggerValue:getTriggerValue,setTriggerValue:setTriggerValue,getTriggerRepeat:getTriggerRepeat,setTriggerRepeat:setTriggerRepeat,getTriggerRecalculate:getTriggerRecalculate,setTriggerRecalculate:setTriggerRecalculate,getData:getData,setData:setData,getConverterInput:getConverterInput,setConverterInput:setConverterInput,getInterpolation:getInterpolation,setInterpolation:setInterpolation,pressButton:pressButton,runAction:runAction,getPopulationSize:getPopulationSize,setPopulationSize:setPopulationSize,getAgentBase:getAgentBase,setAgentBase:setAgentBase,getGeometryWrap:getGeometryWrap,setGeometryWrap:setGeometryWrap,getGeometryUnits:getGeometryUnits,setGeometryUnits:setGeometryUnits,getGeometryWidth:getGeometryWidth,setGeometryWidth:setGeometryWidth,getGeometryHeight:getGeometryHeight,setGeometryHeight:setGeometryHeight,getAgentPlacement:getAgentPlacement,setAgentPlacement:setAgentPlacement,getAgentNetwork:getAgentNetwork,setAgentNetwork:setAgentNetwork,collapseFolder:collapseFolder,expandFolder:expandFolder,getCollapsed:getCollapsed,getParent:getParent,setParent:setParent,getFrozen:getFrozen,setFrozen:setFrozen,getChildren:getChildren,getFolderType:getFolderType,setFolderType:setFolderType,getFolderAgentParent:getFolderAgentParent,setFolderAgentParent:setFolderAgentParent,getFolderSolver:getFolderSolver,setFolderSolver:setFolderSolver,excludeType:excludeType,primitiveIndex:primitiveIndex,uniquePrimitives:uniquePrimitives,setGlobal:setGlobal,getGlobal:getGlobal,topBarShown:topBarShown,toggleTopBar:toggleTopBar,sideBarShown:sideBarShown,toggleSideBar:toggleSideBar,updateSideBar:updateSideBar,showMessage:showMessage,showPrompt:showPrompt,showChoice:showChoice,showURL:showURL,downloadFile:downloadFile,showData:showData,frontWindow:frontWindow,closeAllWindows:closeAllWindows,openFile:openFile,runModel:runModel,simulationRunning:simulationRunning,endRunningSimulation:endRunningSimulation,saveModel:saveModel,clearModel:clearModel,layoutModel:layoutModel,setZoom:setZoom,getTimeStep:getTimeStep,setTimeStep:setTimeStep,getTimeStart:getTimeStart,setTimeStart:setTimeStart,getTimeLength:getTimeLength,setTimeLength:setTimeLength,getPauseInterval:getPauseInterval,setPauseInterval:setPauseInterval,getTimeUnits:getTimeUnits,setTimeUnits:setTimeUnits,getAlgorithm:getAlgorithm,setAlgorithm:setAlgorithm,getMacros:getMacros,setMacros:setMacros,findName:findName,findAll:findAll,findType:findType,findID:findID,findValue:findValue,findNote:findNote,createPrimitive:createPrimitive,createConnector:createConnector,removePrimitive:removePrimitive,highlight:highlight,getSelected:getSelected,setSelected:setSelected,isSelected:isSelected,getID:getID,getType:getType,getName:getName,setName:setName,getUnits:getUnits,setUnits:setUnits,getConstraints:getConstraints,setConstraints:setConstraints,getNote:getNote,setNote:setNote,showNote:showNote,hideNote:hideNote,showEditor:showEditor,getValue:getValue,setValue:setValue,getSize:getSize,getPosition:getPosition,setPosition:setPosition,flash:flash,getShowSlider:getShowSlider,setShowSlider:setShowSlider,getSliderMin:getSliderMin,setSliderMin:setSliderMin,getSliderMax:getSliderMax,setSliderMax:setSliderMax,getSliderStep:getSliderStep,setSliderStep:setSliderStep,getOpacity:getOpacity,setOpacity:setOpacity,getLineColor:getLineColor,setLineColor:setLineColor,getFontColor:getFontColor,setFontColor:setFontColor,getFillColor:getFillColor,setFillColor:setFillColor,getImage:getImage,setImage:setImage,getNonNegative:getNonNegative,setNonNegative:setNonNegative,getStockType:getStockType,setStockType:setStockType,getDelay:getDelay,setDelay:setDelay,getEnds:getEnds,setEnds:setEnds,connected:connected,getResidency:getResidency,setResidency:setResidency,getTriggerType:getTriggerType,setTriggerType:setTriggerType,getTriggerValue:getTriggerValue,setTriggerValue:setTriggerValue,getTriggerRepeat:getTriggerRepeat,setTriggerRepeat:setTriggerRepeat,getTriggerRecalculate:getTriggerRecalculate,setTriggerRecalculate:setTriggerRecalculate,getData:getData,setData:setData,getConverterInput:getConverterInput,setConverterInput:setConverterInput,getInterpolation:getInterpolation,setInterpolation:setInterpolation,pressButton:pressButton,runAction:runAction,getPopulationSize:getPopulationSize,setPopulationSize:setPopulationSize,getAgentBase:getAgentBase,setAgentBase:setAgentBase,getGeometryWrap:getGeometryWrap,setGeometryWrap:setGeometryWrap,getGeometryUnits:getGeometryUnits,setGeometryUnits:setGeometryUnits,getGeometryWidth:getGeometryWidth,setGeometryWidth:setGeometryWidth,getGeometryHeight:getGeometryHeight,setGeometryHeight:setGeometryHeight,getAgentPlacement:getAgentPlacement,setAgentPlacement:setAgentPlacement,getAgentNetwork:getAgentNetwork,setAgentNetwork:setAgentNetwork,collapseFolder:collapseFolder,expandFolder:expandFolder,getCollapsed:getCollapsed,getParent:getParent,setParent:setParent,getFrozen:getFrozen,setFrozen:setFrozen,getChildren:getChildren,getFolderType:getFolderType,setFolderType:setFolderType,getFolderAgentParent:getFolderAgentParent,setFolderAgentParent:setFolderAgentParent,getFolderSolver:getFolderSolver,setFolderSolver:setFolderSolver,excludeType:excludeType,primitiveIndex:primitiveIndex,uniquePrimitives:uniquePrimitives,setGlobal:setGlobal,getGlobal:getGlobal,topBarShown:topBarShown,toggleTopBar:toggleTopBar,sideBarShown:sideBarShown,toggleSideBar:toggleSideBar,updateSideBar:updateSideBar,setValuedProperties:setValuedProperties,setConverterInit:setConverterInit,setValuedProperties:setValuedProperties,setConverterInit:setConverterInit,loadUnits:loadUnits,Material:Material,unitAlert:unitAlert,loadUnits:loadUnits,Material:Material,unitAlert:unitAlert,sortAndCollapseUnits:sortAndCollapseUnits,getUnitStore:getUnitStore,getUnitsId:getUnitsId,UnitStore:UnitStore,unitsFromString:unitsFromString,toTitleCase:toTitleCase,convertUnits:convertUnits,sortAndCollapseUnits:sortAndCollapseUnits,getUnitStore:getUnitStore,getUnitsId:getUnitsId,UnitStore:UnitStore,unitsFromString:unitsFromString,toTitleCase:toTitleCase,convertUnits:convertUnits,RandList:RandList,getRandPos:getRandPos,Rand:Rand,RandNormal:RandNormal,RandExp:RandExp,RandLognormal:RandLognormal,RandBinomial:RandBinomial,RandNegativeBinomial:RandNegativeBinomial,RandPoisson:RandPoisson,RandGamma:RandGamma,RandBeta:RandBeta,RandTriangular:RandTriangular,RandDist:RandDist,RandList:RandList,getRandPos:getRandPos,Rand:Rand,RandNormal:RandNormal,RandExp:RandExp,RandLognormal:RandLognormal,RandBinomial:RandBinomial,RandNegativeBinomial:RandNegativeBinomial,RandPoisson:RandPoisson,RandGamma:RandGamma,RandBeta:RandBeta,RandTriangular:RandTriangular,RandDist:RandDist,bootCalc:bootCalc,keysMatch:keysMatch,strictEquals:strictEquals,createTree:createTree,trimTree:trimTree,evaluateTree:evaluateTree,evaluate:evaluate,convertToObject:convertToObject,funAnd:funAnd,funOr:funOr,funXor:funXor,fNot:fNot,neq:neq,eq:eq,comparisonValid:comparisonValid,lessThan:lessThan,lessThanEq:lessThanEq,greaterThan:greaterThan,greaterThanEq:greaterThanEq,plus:plus,minus:minus,mult:mult,div:div,power:power,doMod:doMod,createMatrixSelector:createMatrixSelector,selectFromMatrix:selectFromMatrix,doBreakouts:doBreakouts,selectFromVector:selectFromVector,selectElementFromVector:selectElementFromVector,makeFunctionCall:makeFunctionCall,createSelector:createSelector,functionGenerator:functionGenerator,evaluateUnits:evaluateUnits,evaluateNode:evaluateNode,isConst:isConst,trimNode:trimNode,trueValue:trueValue,isLocal:isLocal,isUndefined:isUndefined,isDefined:isDefined,fireEvent:fireEvent,ObjToVec:ObjToVec,bootCalc:bootCalc,keysMatch:keysMatch,strictEquals:strictEquals,createTree:createTree,trimTree:trimTree,evaluateTree:evaluateTree,evaluate:evaluate,convertToObject:convertToObject,funAnd:funAnd,funOr:funOr,funXor:funXor,fNot:fNot,neq:neq,eq:eq,comparisonValid:comparisonValid,lessThan:lessThan,lessThanEq:lessThanEq,greaterThan:greaterThan,greaterThanEq:greaterThanEq,plus:plus,minus:minus,mult:mult,div:div,power:power,doMod:doMod,createMatrixSelector:createMatrixSelector,selectFromMatrix:selectFromMatrix,doBreakouts:doBreakouts,selectFromVector:selectFromVector,selectElementFromVector:selectElementFromVector,makeFunctionCall:makeFunctionCall,createSelector:createSelector,functionGenerator:functionGenerator,evaluateUnits:evaluateUnits,evaluateNode:evaluateNode,isConst:isConst,trimNode:trimNode,trueValue:trueValue,fireEvent:fireEvent,ObjToVec:ObjToVec,s:s,makeObjectBase:makeObjectBase,factorial:factorial,testArgumentsSize:testArgumentsSize,s:s,makeObjectBase:makeObjectBase,factorial:factorial,testArgumentsSize:testArgumentsSize,distance:distance,agent:agent,agents:agents,getPopulation:getPopulation,shiftLocation:shiftLocation,isUndefined:isUndefined,isDefined:isDefined,constraintAlert:constraintAlert,error:error,testPrimitive:testPrimitive,prepareDisplay:prepareDisplay,distance:distance,agent:agent,agents:agents,getPopulation:getPopulation,shiftLocation:shiftLocation,constraintAlert:constraintAlert,error:error,testPrimitive:testPrimitive,prepareDisplay:prepareDisplay,scheduleTrigger:scheduleTrigger,clearTrigger:clearTrigger,updateTrigger:updateTrigger,globalVars:globalVars,scheduleTrigger:scheduleTrigger,clearTrigger:clearTrigger,updateTrigger:updateTrigger,globalVars:globalVars,scheduleRepeated:scheduleRepeated,scheduleRepeated:scheduleRepeated,RedBlackNode:RedBlackNode,RedBlackNode:RedBlackNode,RedBlackTree:RedBlackTree,RedBlackTree:RedBlackTree,runSimulation:runSimulation,checkErr:checkErr,innerRunSimulation:innerRunSimulation,formatSimResults:formatSimResults,createUnitStore:createUnitStore,simpleEquation:simpleEquation,simpleNum:simpleNum,simpleUnitsTest:simpleUnitsTest,handleErrorObject:handleErrorObject,evaluateMacros:evaluateMacros,DNA:DNA,getDNA:getDNA,folderSolvers:folderSolvers,decodeDNA:decodeDNA,linkPrimitive:linkPrimitive,setAgentInitialValues:setAgentInitialValues,buildNetwork:buildNetwork,buildPlacements:buildPlacements,getPrimitiveNeighborhood:getPrimitiveNeighborhood,modelType:modelType,updateDisplayed:updateDisplayed,runSimulation:runSimulation,checkErr:checkErr,innerRunSimulation:innerRunSimulation,formatSimResults:formatSimResults,createUnitStore:createUnitStore,simpleEquation:simpleEquation,simpleNum:simpleNum,simpleUnitsTest:simpleUnitsTest,handleErrorObject:handleErrorObject,evaluateMacros:evaluateMacros,DNA:DNA,getDNA:getDNA,folderSolvers:folderSolvers,decodeDNA:decodeDNA,linkPrimitive:linkPrimitive,setAgentInitialValues:setAgentInitialValues,buildNetwork:buildNetwork,buildPlacements:buildPlacements,getPrimitiveNeighborhood:getPrimitiveNeighborhood,modelType:modelType,updateDisplayed:updateDisplayed};