const{JSDOM:JSDOM}=require("jsdom"),{window:window}=new JSDOM("<!DOCTYPE html><html><head></head><body>hello</body></html>",{contentType:"text/html",includeNodeLocations:!0,storageQuota:1e7,userAgent:"Chrome/87.0.4280.141"}),{document:document,DOMParser:DOMParser,navigator:navigator,location:location}=window,is_owner=!0;function isLocal(){return!0}var translations={};function getText(t){translations[t]&&(t=translations[t]);for(var e=1;e<arguments.length;e++)t=t.replace("%s",arguments[e]);return t}function SimpleNode(){}SimpleNode.prototype.getAttribute=function(t){return this["@attributes"][t]};SimpleNode.prototype.setAttribute=function(t,e){this["@attributes"][t]=""+e};function loadXML(t){var e=new DOMParser;graph=e.parseFromString(t,"text/xml");graph=mxGraphToJson(graph);graph.children[0].value={nodeName:"root",id:1};graph.children[0].id=1;clearPrimitiveCache();var n=findType(["Flow","Link","Transition"]),i=primitives();n.forEach((function(t){t.source=null;t.target=null;i.forEach((function(e){t.children[0].getAttribute("source")&&t.children[0].getAttribute("source")==e.id&&(t.source=e);t.children[0].getAttribute("target")&&t.children[0].getAttribute("target")==e.id&&(t.target=e)}))}));clearPrimitiveCache();!function t(e){if(e.children){var n=e.children.filter((function(t){return"mxCell"==t.value.nodeName}));n.length>0&&n[0].getAttribute("parent")&&setParent(e,findID(n[0].getAttribute("parent")));e.children=e.children.filter((function(t){return"mxCell"!=t.value.nodeName}));for(var i=e.children.length-1;i>=0;i--)t(e.children[i])}}(graph);clearPrimitiveCache();return graph}function simpleCloneNode(t,e){var n=new SimpleNode;n.value=t.cloneNode(!0);n.parent=e;n.parentNode=e;var i=[1].concat(primitives().map((function(t){return t.id})).filter((function(t){return t})));n["@attributes"]={id:Math.max.apply(null,i)+1};if(t.attributes.length>0)for(var r=0;r<t.attributes.length;r++){var a=t.attributes.item(r);n["@attributes"][a.nodeName]=a.nodeValue}n.id=n["@attributes"].id;return n}function mxGraphToJson(t,e){var n=new SimpleNode;n["@attributes"]={};n.value=t;n.parent=e;n.parentNode=e;if(1==t.nodeType){if(t.attributes.length>0){for(var i=0;i<t.attributes.length;i++){var r=t.attributes.item(i);n["@attributes"][r.nodeName]=r.nodeValue}n.id=n["@attributes"].id}}else if(3==t.nodeType)return null;if(t.hasChildNodes()){n.children=[];for(var a=0;a<t.childNodes.length;a++){var s=t.childNodes.item(a),o=(s.nodeName,mxGraphToJson(s,n));o&&n.children.push(o)}}return n}function setAttributeUndoable(t,e,n){if(t instanceof SimpleNode){t.setAttribute(e,n);clearPrimitiveCache()}else{var i=new mxCellAttributeChange(t,e,n);graph.getModel().execute(i)}}var analysisCount=0;function getGraphXml(t){var e=new mxCodec(mxUtils.createXmlDocument()).encode(t.getModel());return mxUtils.getPrettyXml(e)}var isSendingtoServer=!1,waitingToSendToServer=!1,waitingToSendTimeout=-1;function sendGraphtoServer(t){if(isSendingtoServer)waitingToSendToServer=!0;else if(!unfoldingManager.unfolding){clearTimeout(waitingToSendTimeout);waitingToSendToServer=!1;isSendingtoServer=!0;sendToParent({type:"save",state:{data:getGraphXml(t),title:graph_title,description:graph_description,tags:graph_tags,has_article:has_article,published:published,groups:JSON.stringify(node_groups)}})}}function validPrimitiveName(t,e){if("Stock"==e.value.nodeName||"Variable"==e.value.nodeName||"Converter"==e.value.nodeName||"Flow"==e.value.nodeName||"Display"==e.value.nodeName||"Agents"==e.value.nodeName||"Transition"==e.value.nodeName||"State"==e.value.nodeName){if(t.length>0&&!/[\[\]\(\)\{\}\<\>\'\"]/.test(t))return!0;mxUtils.alert(getText("Primitive names cannot contain brackets, parenthesis, or quotes."));return!1}return!0}function isPrimitive(t){return!("Button"==t.value.nodeName||"Picture"==t.value.nodeName||"Text"==t.value.nodeName)}function cellsContainNodename(t,e){for(var n=0;n<t.length;n++)if(t[n].value.nodeName==e)return!0}function connectionType(){return ribbonPanelItems().down("#connect").pressed?"Flow":"Link"}function setAllConnectable(){graph.setConnectable(!0);for(var t=primitives(),e=0;e<t.length;e++)t[e].setConnectable(!0)}var primitiveCache={};function primitives(t){if(primitiveCache[" "+t])return primitiveCache[" "+t];var e=childrenCells((graph instanceof SimpleNode?graph.children[0]:graph.getModel().getRoot()).children[0]);if(null==t)primitiveCache[" "+t]=e;else{for(var n=[],i=0;i<e.length;i++)e[i].value.nodeName==t&&n.push(e[i]);primitiveCache[" "+t]=n}return primitiveCache[" "+t]}function childrenCells(t){var e=t?t.children:null;if(null!=e){for(var n=[],i=0;i<e.length;i++)"Folder"==e[i].value.nodeName&&(n=n.concat(childrenCells(e[i])));for(i=(e=e.concat(n)).length-1;i>=0;i--)null!=e[i]&&null!=e[i].value||e.splice(i,1);return e}return null}var neighborhoodCache={},propertiesWin;function clearPrimitiveCache(){primitiveCache={};neighborhoodCache={}}function neighborhood(t){var e=inAgent(t);if(neighborhoodCache[t.id])return neighborhoodCache[t.id];var n=[],i=primitives();if(null!=i)if(null!=t){var r=[],a=[];if(["Flow","Link","Transition"].indexOf(t.value.nodeName)>-1){null!==orig(t.source)&&n.push({item:orig(t.source),type:"direct"});null!==orig(t.target)&&n.push({item:orig(t.target),type:"direct"})}"Agents"==t.value.nodeName&&t.getAttribute("Agent")&&(n=n.concat(c(t)));for(var s=0;s<i.length;s++)"Flow"==i[s].value.nodeName?r.push(orig(i[s])):"Link"==i[s].value.nodeName&&a.push(orig(i[s]));for(s=0;s<r.length;s++){r[s].source==t&&n.push({item:r[s],type:"direct",linkHidden:!0});r[s].target==t&&n.push({item:r[s],type:"direct",linkHidden:!0})}for(s=0;s<a.length;s++){if(orig(a[s].source)==t&&isDefined(a[s].target)&&null!==a[s].target){var o=!isTrue(a[s].getAttribute("BiDirectional"));n.push({item:orig(a[s].target),type:"direct",linkHidden:o});n=n.concat(c(a[s].target,o))}if(orig(a[s].target)==t&&isDefined(a[s].source)&&null!==a[s].source&&(!inAgent(orig(a[s].source))||e)){n.push({item:orig(a[s].source),type:"direct"});n=n.concat(c(a[s].source))}}}else for(s=0;s<i.length;s++)isValued(i[s])&&n.push({item:orig(i[s]),type:"direct"});n=n.filter((function(t){return t}));var l=[];for(s=0;s<n.length;s++)if(!n[s].linkHidden||!strictLinks){for(var u=!1,h=0;h<l.length;h++)if(l[h].type==n[s].type&&l[h].item.id==n[s].item.id){u=!0;l[h].linkHidden&&!n[s].linkHidden&&(l[h].linkHidden=!1);break}u||(isValued(n[s].item)||"Agents"==n[s].item.value.nodeName)&&l.push(n[s])}neighborhoodCache[t.id]=l;return l;function c(t,e){var n=[];if("Agents"==orig(t).value.nodeName&&orig(t).getAttribute("Agent")){var i=orig(t).getAttribute("Agent");if(i){getChildren(findID(i)).forEach((function(t){isValued(t)&&"Ghost"!=t.value.nodeName&&n.push({item:t,type:"agent",linkHidden:e,name:t.getAttribute("name")})}))}}return n.sort((function(t,e){return t.name==e.name?0:t.name>e.name?1:-1}))}}function doubleArray(t){for(var e=[],n=0;n<t.length;n++)e.push([t[n],t[n]]);return e}function isValued(t){return!isUndefined(t)&&null!=t&&!isUndefined(orig(t))&&("Converter"==orig(t).value.nodeName||"Flow"==orig(t).value.nodeName||"Stock"==orig(t).value.nodeName||"Variable"==orig(t).value.nodeName||"Transition"==orig(t).value.nodeName||"State"==orig(t).value.nodeName)}function setSaveEnabled(t){if(is_editor&&!is_embed){var e=ribbonPanelItems().getComponent("savebut");if(t&&0==unfoldingManager.unfolding){e.setDisabled(!1);e.setText("Save")}else{e.setDisabled(!0);e.setText("Saved")}}}function hasDisplay(){return cellsContainNodename(primitives(),"Display")}function urlImage(t){return t.getAttribute("Image")&&"http"==t.getAttribute("Image").substring(0,4).toLowerCase()}function setPicture(t){var e=t.getStyle();if("None"==t.getAttribute("Image")||""==t.getAttribute("Image")||" "==t.getAttribute("Image")||"null"==t.getAttribute("Image")||"Folder"==t.value.nodeName&&!t.isCollapsed()){e=mxUtils.setStyle(e,"image","None");e="Display"==t.value.nodeName||"Stock"==t.value.nodeName||"Folder"==t.value.nodeName||"Button"==t.value.nodeName?mxUtils.setStyle(e,"shape","rectangle"):mxUtils.setStyle(e,"shape","ellipse")}else{e=urlImage(t)?mxUtils.setStyle(e,"image",t.getAttribute("Image")):mxUtils.setStyle(e,"image",builder_path+"/images/SD/"+t.getAttribute("Image")+".png");e=isTrue(t.getAttribute("FlipVertical"))?mxUtils.setStyle(e,"imageFlipV",1):mxUtils.setStyle(e,"imageFlipV",0);e=isTrue(t.getAttribute("FlipHorizontal"))?mxUtils.setStyle(e,"imageFlipH",1):mxUtils.setStyle(e,"imageFlipH",0);e=mxUtils.setStyle(e,"shape","image")}var n=new mxStyleChange(graph.getModel(),t,e);graph.getModel().execute(n);propagateGhosts(t)}function setLabelPosition(t){var e=t.getAttribute("LabelPosition"),n=t.getStyle();if("Folder"!=t.value.nodeName||t.isCollapsed()){if("Top"==e){n=mxUtils.setStyle(n,"labelPosition","middle");n=mxUtils.setStyle(n,"align","center");n=mxUtils.setStyle(n,"verticalLabelPosition","top");n=mxUtils.setStyle(n,"verticalAlign","bottom")}else if("Bottom"==e){n=mxUtils.setStyle(n,"labelPosition","middle");n=mxUtils.setStyle(n,"align","center");n=mxUtils.setStyle(n,"verticalLabelPosition","bottom");n=mxUtils.setStyle(n,"verticalAlign","top")}else if("Middle"==e){n=mxUtils.setStyle(n,"labelPosition","middle");n=mxUtils.setStyle(n,"align","center");n=mxUtils.setStyle(n,"verticalLabelPosition","middle");n=mxUtils.setStyle(n,"verticalAlign","middle")}else if("Left"==e){n=mxUtils.setStyle(n,"verticalLabelPosition","middle");n=mxUtils.setStyle(n,"verticalAlign","middle");n=mxUtils.setStyle(n,"labelPosition","left");n=mxUtils.setStyle(n,"align","right")}else if("Right"==e){n=mxUtils.setStyle(n,"verticalLabelPosition","middle");n=mxUtils.setStyle(n,"verticalAlign","middle");n=mxUtils.setStyle(n,"labelPosition","right");n=mxUtils.setStyle(n,"align","left")}}else{n=mxUtils.setStyle(n,"labelPosition",null);n=mxUtils.setStyle(n,"align",null);n=mxUtils.setStyle(n,"verticalLabelPosition",null);n=mxUtils.setStyle(n,"verticalAlign",null)}var i=new mxStyleChange(graph.getModel(),t,n);graph.getModel().execute(i);propagateGhosts(t)}function removeAgent(t){for(var e=primitives("Agents"),n=0;n<e.length;n++)e[n].getAttribute("Agent")==t.id&&e[n].setAttribute("Agent","")}function deletePrimitive(t){var e=primitives(),n=getSetting();if(n.getAttribute("SensitivityPrimitives")){if((a=(r=n.getAttribute("SensitivityPrimitives").split(",")).indexOf(t.id))>-1){r.splice(a,1);n.setAttribute("SensitivityPrimitives",r.join(","))}}"Folder"==t.value.nodeName&&"Agent"==t.getAttribute("Type")&&removeAgent(t);for(var i=0;i<e.length;i++)if("Display"==e[i].value.nodeName){if(e[i].getAttribute("Primitives")){var r,a;if((a=(r=e[i].getAttribute("Primitives").split(",")).indexOf(t.id))>-1){r.splice(a,1);e[i].setAttribute("Primitives",r.join(","))}}}else if("Converter"==e[i].value.nodeName)e[i].getAttribute("Source")==t.id?e[i].setAttribute("Source","Time"):"Link"==t.value.nodeName&&testConverterSource(e[i]);else if("Ghost"==e[i].value.nodeName&&e[i].value.getAttribute("Source")==t.id){var s=e[i];deletePrimitive(s);graph.removeCells([s],!1)}}function linkBroken(t){for(var e=primitives(),n=0;n<e.length;n++)"Converter"==e[n].value.nodeName&&testConverterSource(e[n]);null!==t.getTerminal(!1)&&"Converter"==t.getTerminal(!1).value.nodeName&&void 0!==t.getTerminal(!0)&&isValued(t.getTerminal(!0))&&t.getTerminal(!1).setAttribute("Source",orig(t.getTerminal(!0)).id)}function testConverterSource(t){for(var e=neighborhood(t),n=!1,i=0;i<e.length;i++)e[i].linkHidden||t.getAttribute("Source")==e[i].item.id&&(n=!0);n||t.setAttribute("Source","Time")}function downloadModel(){var t=getGraphXml(graph);surpressCloseWarning=!0;document.getElementById("downloader").title.value=encodeURIComponent(graph_title);document.getElementById("downloader").code.value=encodeURIComponent(t);document.getElementById("downloader").submit()}function getSetting(){for(var t=primitives(),e=0;e<t.length;e++)if("Setting"==t[e].value.nodeName)return t[e];alert("Settings primitive could not be found.");return null}function handelCursors(){graph.container.style.cursor="auto"}function updateProperties(){var t;t=""==graph_title?"Untitled Insight":graph_title;if(propertiesWin){if(""!=graph_title){Ext.getCmp("sinsightTitle").setValue(graph_title);Ext.getCmp("sinsightTags").setValue(graph_tags);$("#sinsightDescription").html(clean(graph_description))}}else propertiesWin=new Ext.Window({applyTo:"property-win",layout:{type:"vbox",align:"stretch"},modal:!0,width:550,title:"Save Insight",autoHeight:!0,minHeight:300,minWidth:450,closable:!0,resizable:!0,autoScroll:!0,closeAction:"hide",defaults:{width:230,labelWidth:150},items:[new Ext.form.TextField({fieldLabel:"Insight Title",name:"sinsightTitle",id:"sinsightTitle",allowBlank:!1,selectOnFocus:!0,value:t,margin:9}),new Ext.form.TextField({fieldLabel:"Tags",name:"sinsightTags",id:"sinsightTags",allowBlank:!0,emptyText:"Environment, Health Care, Finance",value:graph_tags,margin:9}),{xtype:"fieldcontainer",fieldLabel:"Description",allowBlank:!0,items:[Ext.create("Ext.toolbar.Toolbar",{style:{padding:"6px 0px"},enableOverflow:!0,items:[{glyph:61490,tooltip:"Bold",handler:()=>{document.execCommand("bold")}},{glyph:61491,tooltip:"Italic",handler:()=>{document.execCommand("italic")}},{glyph:61645,tooltip:"Underline",handler:()=>{document.execCommand("underline")}},"-",{glyph:61494,tooltip:"Left align",handler:()=>{document.execCommand("justifyLeft")}},{glyph:61495,tooltip:"Center",handler:()=>{document.execCommand("justifyCenter")}},{glyph:61496,tooltip:"Right align",handler:()=>{document.execCommand("justifyRight")}},"-",{glyph:61633,tooltip:"Insert link",handler:()=>{var t=prompt("Enter a URL");if(t){document.execCommand("createLink",!0,t);$("#sinsightDescription a").attr("target","_blank")}}},"-",{glyph:61643,tooltip:"Numbered list",handler:()=>{document.execCommand("insertOrderedList")}},{glyph:61642,tooltip:"Bullet list",handler:()=>{document.execCommand("insertUnorderedList")}}]}),{html:'<div id="sinsightDescription" style="height: 130px; border: solid 1px #cecece; padding: 4px 6px 3px 6px; overflow: auto;" contenteditable>'+clean(graph_description)+"</div>"}],margin:9,minHeight:100,flex:1},{xtype:"fieldcontainer",fieldLabel:"Insight Access",layout:"hbox",defaults:{flex:1,hideLabel:!0},margin:9,items:[{xtype:"segmentedbutton",items:[{glyph:61612,text:"Public Insight",pressed:published,id:"insightPublic",tooltip:"This Insight is public. Anyone can view it, but only you can edit it."},{glyph:61572,text:"Private Insight",pressed:!published,tooltip:"This Insight is private. Only people you have given access to can view it."}]}]},Ext.create("Ext.form.field.Tag",{hidden:0==user_groups.length,fieldLabel:"Share with Groups",name:"sinsightGroups",id:"sinsightGroups",value:node_groups,allowBlank:!0,filterPickList:!0,store:group_titles,margin:9})],buttons:[{text:"Cancel",scale:"large",glyph:61532,handler:function(){propertiesWin.hide()}},{glyph:61452,scale:"large",text:"Save",handler:function(){if(Ext.getCmp("sinsightTitle").validate()){propertiesWin.hide();graph_title=Ext.String.trim(Ext.getCmp("sinsightTitle").getValue());graph_description=clean(Ext.String.trim($("#sinsightDescription").html()));graph_description=graph_description.replace(/^(\u200b|&nbsp;)/g,"");graph_description=graph_description.replace(/(\u200b|&nbsp;)$/g,"");"<br>"!=graph_description&&"<br/>"!=graph_description&&"​"!=graph_description&&"&nbsp;"!=graph_description||(graph_description="");graph_tags=Ext.getCmp("sinsightTags").getValue();node_groups=Ext.getCmp("sinsightGroups").getValue();published=Ext.getCmp("insightPublic").pressed;setSaveEnabled(!0);sendGraphtoServer(graph);selectionChanged(!1)}else showNotification(getText("You must specify a name for the Insight."),"error",!0)}}]});propertiesWin.show();Ext.getCmp("sinsightTitle").focus(!0,300)}function isTrue(t){return"false"!=t&&"No"!=t&&0!=t&&(1==t||-1==t||"True"==t||"true"==t||1==t||"Yes"==t)}function customUnits(){if(void 0!==getSetting().getAttribute("Units")){for(var t=getSetting().getAttribute("Units").split("\n"),e=0;e<t.length;e++)t[e]=t[e].split("<>");return t}return[]}function orig(t){if(t){if("Ghost"===t.value.nodeName){t.origCache||(t.origCache=findID(t.value.getAttribute("Source")));return t.origCache}return t}return null}function currentStyleIs(t){for(var e=graph.getCellStyle(graph.getSelectionCell())[mxConstants.STYLE_FONTSTYLE],n=3;n>=1;n--)(e-=t*Math.pow(2,n))<0&&(e+=t*Math.pow(2,n));return e>=t}function setStyles(){if(!is_embed&&is_editor){var t=!graph.isSelectionEmpty(),e=ribbonPanelItems();if(t){e.down("#bold").setChecked(currentStyleIs(mxConstants.FONT_BOLD));e.down("#italic").setChecked(currentStyleIs(mxConstants.FONT_ITALIC));e.down("#underline").setChecked(currentStyleIs(mxConstants.FONT_UNDERLINE));var n=graph.getCellStyle(graph.getSelectionCell());e.down("#sizeCombo").setValue(n[mxConstants.STYLE_FONTSIZE]);e.down("#fontCombo").setValue(n[mxConstants.STYLE_FONTFAMILY])}else{e.down("#bold").setChecked(!1);e.down("#italic").setChecked(!1);e.down("#underline").setChecked(!1);e.down("#fontCombo").setValue("");e.down("#sizeCombo").setValue("")}}}function stringArray(t,e,n){if(0==t.length)return"";if(1==t.length)return t[0];var i=t.slice(),r=i.pop();return i.join(e)+n+r}function quickLabel(t,e,n){var i=getSetting();return processLabel(t,e,n,i.getAttribute("TimeUnits"),i.getAttribute("TimeStep"),i.getAttribute("SolutionAlgorithm"))}function processLabel(t,e,n,i,r,a){var s="<PERCENTSIGNPLACEHOLDER>";t=replaceAll(t,"%%",s);t=replaceAll(t,"%u",i);t=replaceAll(t,"%t",e);t=replaceAll(t,"%o",n);t=replaceAll(t,"%ts",r);t=replaceAll(t,"%a",a);t=replaceAll(t,s,"%");return clean(t)}function replaceAll(t,e,n){return isUndefined(t)?"":t.replace(new RegExp(e,"g"),n)}function loadBackgroundColor(){mxPanel.el.dom.style["background-color"]=getSetting().getAttribute("BackgroundColor");mxPanel.el.dom.style.backgroundColor=getSetting().getAttribute("BackgroundColor")}function isUndefined(t){return void 0===t}function isDefined(t){return!isUndefined(t)}function isTouch(){return mxClient.IS_TOUCH}function propagateGhosts(t){for(var e=primitives("Ghost"),n=0;n<e.length;n++)if(e[n].getAttribute("Source")==t.id){var i=t.getStyle();i=mxUtils.setStyle(i,"opacity",30);e[n].setStyle(i);setAttributeUndoable(e[n],"name",t.getAttribute("name"))}}function propagateName(t,e){if(isValued(t))for(var n=getName(t),i=new RegExp("\\["+e+"\\]","gi"),r=graph.getConnections(t),a=0;a<r.length;a++)if(r[a].target&&r[a].source){var s;(isValued(s="Flow"==r[a].value.nodeName||"Transition"==r[a].value.nodeName?r[a]:r[a].target.id==t.id?r[a].source:r[a].target)||s&&"Action"==s.value.nodeName)&&setValue(s,getValue(s).replace(i,"["+n+"]"))}}function map(t,e){return t instanceof Array?t.map(e):e(t)}function unitsUsedInModel(){for(var t=primitives(),e=[],n=0;n<t.length;n++){var i=t[n].getAttribute("Units");"Setting"!=t[n].value.nodeName&&isDefined(i)&&null!==i&&"Unitless"!=i&&e.push(i)}return Ext.Array.unique(e)}function changeNodeName(t,e){for(var n=mxUtils.createXmlDocument().createElement(e),i=t.attributes,r=0;r<i.length;r++)n.setAttribute(i[r].name,i[r].value);return n}function cmd(t){return mxClient.IS_MAC?"<span style='color:grey'>(&#8984;"+t+")</span>":"<span style='color:grey'>(Ctrl-"+t+")</span>"}function inAgent(t){if(!t||null==t)return!1;var e=getParent(t);return!(!e||"Agent"!=e.getAttribute("Type"))||inAgent(e)}function parentAgent(t){if(t&&null!=t){var e=getParent(t);return e&&"Agent"==e.getAttribute("Type")?e:parentAgent(e)}}function isGray(t){if(isUndefined(t))return!0;var e;if("#6482B9"==(e="#"==t[0]?t:colourNameToHex(t)))return!0;var n=e[1];if(4==e.length){for(var i=2;i<e.length;i++)if(e[i]!=n)return!1}else if(7==e.length){for(i=1;i<e.length;i+=2)if(e[i]!=n)return!1;for(n=e[2],i=2;i<e.length;i+=2)if(e[i]!=n)return!1}return!0}function colourNameToHex(t){var e={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return void 0!==e[t.toLowerCase()]&&e[t.toLowerCase()]}function flatten(t){var e=[];return function t(n){var i,r,a;for(i=0,r=n.length;i<r;i++){a=n[i];Array.isArray(a)?t(a):e.push(a)}return e}(t)}var downloadButton=function(t){return{xtype:"button",text:"Download CSV",glyph:61677,handler:function(){var e=this.up("gridpanel"),n=e.getStore(),i=e.columns,r="";r+=i.filter((function(t){return!t.hidden})).map((function(t){return'"'+(t.text||t.name).replace(/"/g,'""')+'"'})).join(",");n.each((function(t){var e=[];i.forEach((function(n){var i=n.name||n.dataIndex;if(i){var r=""+t.get(i);e.push('"'+r.replace(/"/g,'""')+'"')}}));r+="\r\n"+e.join(",")}));downloadFile(t,r,"text/csv")}}};function deepClone(t,e,n,i){var r,a,s,o,l,u;if(null!=(r=arguments[1]))for(a in r){s=t[a];if(t!==(o=r[a])){if(i){var h=i(o);if(h){t[a]=h;continue}}if(n>0&&o&&((l=Array.isArray(o))||"object"==typeof o)){if(l){l=!1;u=s&&Array.isArray(s)?s:[]}else u=s&&"object"==typeof srv?s:{};t[a]=deepClone(u,o,n-1,i)}else void 0!==o&&(t[a]=o)}}return t}function exportSvg(){var t=graph.view.scale,e=graph.getGraphBounds(),n=mxUtils.createXmlDocument(),i=null!=n.createElementNS?n.createElementNS(mxConstants.NS_SVG,"svg"):n.createElement("svg");null!=i.style?i.style.backgroundColor="#FFFFFF":i.setAttribute("style","background-color:#FFFFFF");null==n.createElementNS&&i.setAttribute("xmlns",mxConstants.NS_SVG);i.setAttribute("width",Math.ceil(e.width*t+2)+"px");i.setAttribute("height",Math.ceil(e.height*t+2)+"px");i.setAttribute("xmlns:xlink",mxConstants.NS_XLINK);i.setAttribute("version","1.1");var r=null!=n.createElementNS?n.createElementNS(mxConstants.NS_SVG,"g"):n.createElement("g");r.setAttribute("transform","translate(0.5,0.5)");i.appendChild(r);n.appendChild(i);var a=new mxSvgCanvas2D(r);a.translate(Math.floor(1/t-e.x),Math.floor(1/t-e.y));a.scale(t);(new mxImageExport).drawState(graph.getView().getState(graph.model.root),a);downloadFile("Insight Maker Diagram.svg",mxUtils.getXml(i),"text/svg")}function showMessage(t){alert(t)}function showPrompt(t,e){return prompt(t,e)}function showChoice(t){return confirm(t)}function showURL(t){var e=window.open(t,"","scrollbars=yes,menubar=yes,height=500,width=700,resizable=yes,toolbar=yes,location=yes,status=yes");open!=e&&void 0!==e||Ext.Msg.alert("","<big><big><center><a href='"+t+"' target='_blank'><i class='fa fa-external-link-square'></i> Open Link</a></center></big></big>")}function downloadFile(t,e,n){var i=document.createElement("a");document.body.appendChild(i);var r=new Blob([e],{type:n||"octet/stream"}),a=window.URL.createObjectURL(r);i.href=a;i.download=t;i.click();window.URL.revokeObjectURL(a);i.remove()}function showData(t,e,n){n||(n=[Math.min(Ext.getBody().getViewSize().width,640),Math.min(Ext.getBody().getViewSize().height,480)]);for(var i=[],r=0;r<e.length;r++){var a={layout:"fit"};a.title=e[r].name;if("text"==e[r].type.toLowerCase()){var s={xtype:"textareafield",value:e[r].data,readOnly:!0};a.items=[s]}else if("html"==e[r].type.toLowerCase()){var o={title:"Insight Equations",xtype:"box",html:e[r].data,style:"background-color: white",autoScroll:!0};a.items=[o]}else if("table"==e[r].type.toLowerCase()){for(var l={xtype:"grid"},u=[],h=[],c=[],d=0;d<e[r].data.length;d++){u.push({dataIndex:"a"+d,text:e[r].header?e[r].header[d]:""});for(var m="float",f=0;f<e[r].data[d].length;f++)"string"==typeof e[r].data[d][r]&&(m="string");h.push({name:"a"+d,type:m})}for(f=0;f<e[r].data[0].length;f++)c.push({});for(d=0;d<e[r].data.length;d++)for(f=0;f<e[r].data[0].length;f++)c[f]["a"+d]=e[r].data[d][f];l.columns=u;l.store=new Ext.data.JsonStore({fields:h,data:c});e[r].header||(l.hideHeaders=!0);l.dockedItems=[{xtype:"toolbar",dock:"bottom",items:["->",downloadButton(e[r].name)]}];a.items=[l]}else if("chart"==e[r].type.toLowerCase()){var p=["#94ae0a","#115fa6","#a61120","#ff8809","#ffd13e","#a61187","#24ad9a","#7c7474","#a66111"],g=0,_=[];for(d=0;d<e[r].data.length;d++)if(e[r].data[d].color)_.push(e[r].data[d].color);else{_.push(p[g]);g++;g%=p.length}var v=[],S=(h=[{name:"x",type:"numeric"==e[r].xType.toLowerCase()?"float":"string"}],[]);for(c=[],d=0;d<e[r].xData.length;d++)c.push({x:e[r].xData[d]});for(d=0;d<e[r].data.length;d++){h.push({name:"a"+d,type:"float"});v.push({shadow:!1,type:e[r].data[d].fill?"area":e[r].data[d].type.toLowerCase(),title:e[r].data[d].name,colors:[_[d]],axis:"left",xField:"x",yField:"a"+d,showInLegend:!e[r].data[d].hideLegend,showMarkers:!e[r].data[d].hideMarkers,style:{opacity:1,"stroke-width":3},marker:{radius:3},animation:!1});e[r].data[d].fill&&(v[v.length-1].style["stroke-width"]=0);S.push("a"+d);for(f=0;f<e[r].data[d].data.length;f++)c[f]["a"+d]=e[r].data[d].data[f]}var N={xtype:"cartesian",animation:!1,shadow:!1,interactions:"crosszoom",store:new Ext.data.JsonStore({fields:h,data:c}),axes:[{position:"bottom",type:e[r].xType?e[r].xType.toLowerCase():"numeric",grid:!!e[r].verticalGrid&&e[r].verticalGrid,title:{text:e[r].xLabel?e[r].xLabel:"",fontSize:14},fields:["x"],minimum:e[r].xMin,maximum:e[r].xMax},{position:"left",type:"numeric",grid:!!e[r].horizontalGrid&&e[r].horizontalGrid,title:{text:e[r].yLabel?e[r].yLabel:"",fontSize:14},titleMargin:20,fields:S,minimum:e[r].yMin,maximum:e[r].yMax}],series:v};if(e[r].legend&&"none"!=e[r].legend){N.legend={};N.legend.docked=e[r].legend;N.legend.toggleable=!e[r].legendStatic}a.items=[N]}else alert("Unknown tab type: "+e[r].type);i.push(a)}var E=new Ext.Window({title:t,layout:"fit",closeAction:"destroy",border:!1,modal:!1,resizable:!0,closable:!0,maximizable:!0,minimizable:!0,shadow:!0,width:n[0],height:n[1],items:[{xtype:"tabpanel",layout:"fit",items:i}]});E.on("minimize",(function(t){if(t.expandedState){t.expandedState=!1;t.collapse()}else{t.expandedState=!0;E.expand()}}));E.show();return E}function frontWindow(){return Ext.WindowMgr.getActive()}function closeAllWindows(){for(var t;t=Ext.WindowMgr.getActive();)t.close()}function openFile(t){(t=t||{multiple:!1,accept:null,onCompleted:null,onSelected:null,onError:null,read:!1}).read&&(t.read=t.read.toLowerCase());"xlsx"!=t.read||t.accept||(t.accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");var e=document.createElement("input");e.setAttribute("type","file");t.multiple&&e.setAttribute("multiple",!0);t.accept&&e.setAttribute("accept",t.accept);var n=null,i=0,r=function(){$(e).remove();n.length?++i==n.length&&t.onCompleted(n):t.onCompleted(n)},a=function(e){var n={};n.file=e;n.size=e.size;n.name=e.name;n.type=e.type;var i=new FileReader;i.onloadend=function(e){if("xlsx"==t.read)require(["jszip"],(function(){require(["xlsx"],(function(){n.contents=XLSX.read(i.result,{type:"binary"});r()}))}));else{n.contents=i.result;r()}};i.onerror=function(){if(t.onError)t.onError(i.error);else{alert("FileReader error.");console.log("FileReader Error");console.log(i.error)}};i.onabort=function(){if(t.onError)t.onError(i.error);else{alert("FileReader aborted.");console.log("FileReader Error");console.log(i.error)}};if("binary"==t.read)i.readAsBinaryString(e);else if("text"==t.read)i.readAsText(e);else if("xlsx"==t.read)i.readAsBinaryString(e);else{if(t.read)throw"Unknown data read type: "+t.type;setTimeout(r,1)}return n};e.onchange=function(){var i=e.files;t.onSelected&&t.onSelected(i);if(t.onCompleted){void 0===i[0]&&t.onCompleted(null);n=t.multiple?Array.prototype.slice.call(i).map((function(t){return a(t)})):a(i[0])}};document.body.appendChild(e);e.click()}function runModel(t){if(!simulationRunning()||simulate.config.silent||t.resultsWindow){isUndefined(t)?t={silent:graph instanceof SimpleNode}:"boolean"==typeof t&&(t={silent:t});return runSimulation(t)}mxUtils.alert(getText("You have an existing simulation running that has not yet completed. Either close the results window or press the window's 'Stop' button. You may then run a new simulation."));simulate.resultsWindow.show()}function simulationRunning(){return simulate&&!simulate.completed()}function endRunningSimulation(){simulate&&simulate.terminate()}function saveModel(t){t||""==graph_title?updateProperties():unfoldingManager.unfolding||sendGraphtoServer(graph)}function clearModel(){if(graph instanceof SimpleNode){graph.children[0].children[0].children=graph.children[0].children[0].children.filter((function(t){return"Setting"==t.value.nodeName}));clearPrimitiveCache()}else{graph.getModel().beginUpdate();graph.allowButtonSelect=!0;graph.selectAll();graph.allowButtonSelect=!1;graph.removeCells(graph.getSelectionCells(),!1);graph.getModel().endUpdate()}}function layoutModel(t){if("organic"==t){(e=new mxFastOrganicLayout(graph)).forceConstant=50;executeLayout(e,!0)}else if("circular"==t)executeLayout(new mxCircleLayout(graph),!0);else if("hierarchical"==t){var e;(e=new mxCompactTreeLayout(graph)).horizontal=!1;e.resizeParent=!1;e.moveTree=!1;executeLayout(e,!0)}else alert("Unknown layout algorithm: "+t)}var executeLayout=function(t,e,n){var i=graph.getSelectionCell();(null==i||!n&&0==graph.getModel().getChildCount(i))&&(i=graph.getDefaultParent());graph.getModel().beginUpdate();try{t.execute(i)}catch(t){throw t}finally{if(e&&navigator.userAgent.indexOf("Camino")<0){var r=new mxMorphing(graph);r.addListener(mxEvent.DONE,(function(){graph.getModel().endUpdate()}));r.startAnimation()}else graph.getModel().endUpdate()}};function setZoom(t){"fit"==t?graph.fit():"actual"==t?graph.zoomActual():"in"==t?graph.zoomIn():"out"==t?graph.zoomOut():graph.getView().setScale(t)}function getTimeStep(){return parseFloat(getSetting().getAttribute("TimeStep"))}function setTimeStep(t){setAttributeUndoable(getSetting(),"TimeStep",t)}function getTimeStart(){return parseFloat(getSetting().getAttribute("TimeStart"))}function setTimeStart(t){setAttributeUndoable(getSetting(),"TimeStart",t)}function getTimeLength(){return parseFloat(getSetting().getAttribute("TimeLength"))}function setTimeLength(t){setAttributeUndoable(getSetting(),"TimeLength",t)}function getPauseInterval(){return parseFloat(getSetting().getAttribute("TimePause"))}function setPauseInterval(t){setAttributeUndoable(getSetting(),"TimePause",t)}function getTimeUnits(){return getSetting().getAttribute("TimeUnits")}function setTimeUnits(t){setAttributeUndoable(getSetting(),"TimeUnits",t)}function getAlgorithm(){return getSetting().getAttribute("SolutionAlgorithm")}function setAlgorithm(t){setAttributeUndoable(getSetting(),"SolutionAlgorithm",t)}function getMacros(){return getSetting().getAttribute("Macros")}function setMacros(t){setAttributeUndoable(getSetting(),"Macros",t)}function findName(t){var e=map(t,(function(t){for(var e=[],n=findAll(),i=0;i<n.length;i++)isDefined(n[i].getAttribute("name"))&&n[i].getAttribute("name").toLowerCase()==t.toLowerCase()&&e.push(n[i]);return e}));e=(e=flatten(e)).filter((function(t){return null!==t}));return t instanceof Array?e:0==e.length?null:1==e.length?e[0]:e}function findAll(){for(var t=primitives(),e=[],n=0;n<t.length;n++)"Setting"!=t[n].value.nodeName&&"Display"!=t[n].value.nodeName&&e.push(t[n]);return e}function findType(t){var e=map(t,(function(t){return primitives(t)}));return e=flatten(e)}function findID(t){var e=primitives(),n=map(t,(function(t){for(var n=0;n<e.length;n++)if(e[n].id==t)return e[n];return null}));return null===n||t instanceof Array?n:1==n.length?n[0]:n}function findValue(t){var e=findAll();return uniquePrimitives(flatten(map(t,(function(t){for(var n=[],i=0;i<e.length;i++)t instanceof RegExp?t.test(getValue(e[i]))&&n.push(e[i]):getValue(e[i])==t&&n.push(e[i]);return n}))))}function findNote(t){var e=findAll();return uniquePrimitives(flatten(map(t,(function(t){for(var n=[],i=0;i<e.length;i++)t instanceof RegExp?t.test(getNote(e[i]))&&n.push(e[i]):getNote(e[i])==t&&n.push(e[i]);return n}))))}function createPrimitive(t,e,n,i){var r=e.toLowerCase();if(graph instanceof SimpleNode){var a=graph.children[0].children[0],s=simpleCloneNode(primitiveBank[r],a);a.children.push(s);clearPrimitiveCache()}else a=graph.getDefaultParent(),s=graph.insertVertex(a,null,primitiveBank[r].cloneNode(!0),n[0],n[1],i[0],i[1],r);setName(s,t);"Converter"==s.value.nodeName&&setConverterInit(s);if(isValued(s)||"Agents"==s.value.nodeName)for(var o=primitives("Display"),l=0;l<o.length;l++){var u=o[l];if(isTrue(u.getAttribute("AutoAddPrimitives"))&&"Scatterplot"!=u.getAttribute("Type")&&("Map"!=u.getAttribute("Type")||"Agents"==s.value.nodeName)){var h=u.getAttribute("Primitives");if(void 0===h)u.setAttribute("Primitives",s.id);else{var c=h.split(",");c.push(s.id);u.setAttribute("Primitives",c.join(","))}}}return s}function createConnector(t,e,n,i){var r,a=!1,s=e.toLowerCase();if(graph instanceof SimpleNode){var o=graph.children[0].children[0];n&&(o=n.parent);i&&(o=i.parent);var l=simpleCloneNode(primitiveBank[s],o);o.children.push(l);setEnds(l,[n,i]);clearPrimitiveCache()}else{o=graph.getDefaultParent();if(null==i&&null==n){a=!0;n=r=createPrimitive("temp stock xyz","Stock",[300,300],[10,10]);i=r}else if(null==n){a=!0;var u=getPosition(i),h=getSize(i);n=r=createPrimitive("temp stock xyz","Stock",[u[0]+h[0]/2-5,u[1]-120],[10,10])}else if(null==i){a=!0;u=getPosition(n),h=getSize(n);i=r=createPrimitive("temp stock xyz","Stock",[u[0]+h[0]/2-5,u[1]+120+h[1]],[10,10])}l=graph.insertEdge(o,null,primitiveBank[s].cloneNode(!0),n,i,s)}setName(l,t);a&&removePrimitive(r);return l}function removePrimitive(t){t instanceof Array||(t=[t]);if(graph instanceof SimpleNode){var e=findType(["Flow","Transition","Link"]);t.forEach((function(t){t.parent.children.splice(t.parent.children.indexOf(t),1);e.forEach((function(e){if(e.source==t){e.source=null;e.target&&e.target.parent!==e.parent&&setParent(e,e.target.parent)}if(e.target==t){e.target=null;e.source&&e.source.parent!==e.parent&&setParent(e,e.source.parent)}}))}));clearPrimitiveCache()}else graph.removeCells(t,!1)}function highlight(t){for(var e=getParent(t);e;){getCollapsed(e)&&expandFolder(e);e=getParent(e)}setSelected(t);graph.scrollCellToVisible(t)}function getSelected(){return graph.getSelectionCells()}function setSelected(t){graph.allowButtonSelect=!0;t instanceof Array?graph.setSelectionCells(t):graph.setSelectionCells([t]);graph.allowButtonSelect=!1}function isSelected(t){var e=getSelected();return map(t,(function(t){return primitiveIndex(e,t)>-1}))}function getID(t){return map(t,(function(t){return t.id}))}function getType(t){return map(t,(function(t){return t.value.nodeName}))}function getName(t){return map(t,(function(t){return t.getAttribute("name")}))}function setName(t,e){map(t,(function(t){if(validPrimitiveName(String(e),t)){setAttributeUndoable(t,"name",String(e));propagateGhosts(t)}}))}function getUnits(t){return map(t,(function(t){return t.getAttribute("Units")}))}function setUnits(t,e){map(t,(function(t){setAttributeUndoable(t,"Units",String(e))}))}function getConstraints(t){return map(t,(function(t){return[t.getAttribute("MinConstraint"),isTrue(t.getAttribute("MinConstraintUsed")),t.getAttribute("MaxConstraint"),isTrue(t.getAttribute("MaxConstraintUsed"))]}))}function setConstraints(t,e){map(t,(function(t){setAttributeUndoable(t,"MinConstraint",e[0]);setAttributeUndoable(t,"MinConstraintUsed",e[1]);setAttributeUndoable(t,"MaxConstraint",e[2]);setAttributeUndoable(t,"MaxConstraintUsed",e[3])}))}function getNote(t){return map(t,(function(t){return t.getAttribute("Note")}))}function setNote(t,e){map(t,(function(t){setAttributeUndoable(t,"Note",String(e))}))}function showNote(t){return map(t,(function(t){if(null!==t.value.getAttribute("Note",null)&&""!=t.value.getAttribute("Note")){var e=Ext.getCmp("note"+t.id);if(isUndefined(e)){var n=graph.view.getState(t);if(n){new Ext.ToolTip({html:"<big>"+clean(t.value.getAttribute("Note").replace(/\n/g,"<br/>"))+"</big>",autoHide:!1,closable:!0,width:300,draggable:!0,id:"note"+t.id,title:clean(t.value.getAttribute("name")),closeAction:"destroy"}).showAt([n.x+mxPanel.getEl().getLeft()+n.width+4-graph.container.scrollLeft,n.y+mxPanel.getEl().getTop()-graph.container.scrollTop])}}}}))}function hideNote(t){return map(t,(function(t){var e=Ext.getCmp("note"+t.id);isUndefined(e)||e.destroy()}))}function showEditor(t,e){if("Converter"==t.value.nodeName){new ConverterWindow({parent:"",cell:t,oldKeys:t.getAttribute("Data"),interpolation:t.getAttribute("Interpolation")}).show()}else if("Stock"==t.value.nodeName){var n=new Ext.form.field.Checkbox({xtype:"checkboxfield",boxLabel:getText("Restrict this stock to positive values"),checked:getNonNegative(t),autoEl:{"data-qtip":"If checked, the value of the stock will not be allowed to fall below zero. The rates of outflows may be adjusted to ensure this condition is met."}});new EquationWindow({parent:"",cell:t,equation:getValue(t),annotations:e,extra:n,saveExtra:function(e){setNonNegative(t,n.getValue())}}).show()}else if("Flow"==t.value.nodeName){n=new Ext.form.field.Checkbox({xtype:"checkboxfield",boxLabel:getText("Restrict this flow to positive rates"),checked:getNonNegative(t),autoEl:{"data-qtip":"If checked, the flow will not be applied if the calculated rate is less than zero."}});new EquationWindow({parent:"",cell:t,equation:getValue(t),annotations:e,extra:n,saveExtra:function(e){setNonNegative(t,n.getValue())}}).show()}else if("Transition"==t.value.nodeName){var i=function(){var t="Condition"==r.getValue();a.setDisabled(t);s.setDisabled(t)},r=new Ext.form.ComboBox({triggerAction:"all",store:["Timeout","Probability","Condition"],editable:!1,selectOnFocus:!1,value:getTriggerType(t),fieldLabel:"Trigger Type",width:240,listeners:{change:function(){i()}}}),a=new Ext.form.field.Checkbox({xtype:"checkboxfield",boxLabel:getText("Recalculate each time step"),checked:getTriggerRecalculate(t),margin:"0 0 0 15",autoEl:{"data-qtip":"If this is not true, the equation will be evaluated once and the trigger time scheduled based on that calculation. If this is true, the timeout or probability will be recalculated as the state of the system changes."}}),s=new Ext.form.field.Checkbox({xtype:"checkboxfield",boxLabel:getText("Repeat after triggering"),checked:getTriggerRepeat(t),margin:"0 0 0 15",autoEl:{"data-qtip":"If this is true, the transition will be rescheduled after it is triggered. If this is not true, the transition will only be rescheduled if its source state becomes active again."}}),o={xtype:"container",layout:"hbox",items:[r,a,s]};i();new EquationWindow({parent:"",cell:t,equation:getValue(t),annotations:e,extra:o,saveExtra:function(e){setTriggerType(t,r.value);setTriggerRecalculate(t,a.getValue());setTriggerRepeat(t,s.getValue())}}).show()}else{new EquationWindow({parent:"",cell:t,equation:getValue(t),annotations:e}).show()}}function getValue(t){return map(t,(function(t){var e,n=t.value.nodeName;"Stock"==n?e=t.getAttribute("InitialValue"):"Flow"==n?e=t.getAttribute("FlowRate"):"Transition"==n?e=t.getAttribute("Value"):"State"==n?e=t.getAttribute("Active"):"Variable"==n?e=t.getAttribute("Equation"):"Button"==n?e=t.getAttribute("Function"):"Converter"==n?e=t.getAttribute("Data"):"Action"==n?e=t.getAttribute("Action"):"Agents"==n&&(e=t.getAttribute("Size"));return isDefined(e)?e:""}))}function setValue(t,e){map(t,(function(t){if(getValue(t)!=e){var n=t.value.nodeName;if("Stock"==n)setAttributeUndoable(t,"InitialValue",String(e));else if("Flow"==n)setAttributeUndoable(t,"FlowRate",String(e));else if("Transition"==n)setAttributeUndoable(t,"Value",String(e));else if("State"==n)setAttributeUndoable(t,"Active",String(e));else if("Variable"==n)setAttributeUndoable(t,"Equation",String(e));else if("Button"==n)setAttributeUndoable(t,"Function",String(e));else if("Converter"==n)setAttributeUndoable(t,"Data",String(e));else if("Action"==n)setAttributeUndoable(t,"Action",String(e));else if("Agents"==n){if(e<0||Math.round(e)!=e){alert("The agent population size must be a non-negative integer.");return}setAttributeUndoable(t,"Size",parseFloat(e))}}}))}function getSize(t){return map(t,(function(t){if(graph instanceof SimpleNode)return[0,0];var e=graph.getCellBounds(t),n=graph.view.getScale();return[e.width/n,e.height/n]}))}function getPosition(t){return map(t,(function(t){if(graph instanceof SimpleNode)return[0,0];var e=graph.view.getState(t),n=graph.view.getScale();return[e.x/n,e.y/n]}))}function setPosition(t,e){map(t,(function(t){var n=graph.view.getState(t),i=graph.view.getScale(),r=t.geometry,a=n.x/i-r.x,s=n.y/i-r.y,o=r.clone();o.x=e[0]-a;o.y=e[1]-s;graph.getModel().setGeometry(t,o)}))}function flash(t,e,n){map(t,(function(t){"Folder"==t.value.nodeName&&flash(getChildren(t,!1),e,n);var i=getOpacity(t);setOpacity(t,e||0);setTimeout((function(){setOpacity(t,i)}),n||100)}))}function getShowSlider(t){return map(t,(function(t){return isTrue(t.getAttribute("ShowSlider"))}))}function setShowSlider(t,e){map(t,(function(t){setAttributeUndoable(t,"ShowSlider",e)}))}function getSliderMin(t){return map(t,(function(t){return t.getAttribute("SliderMin")}))}function setSliderMin(t,e){map(t,(function(t){setAttributeUndoable(t,"SliderMin",e)}))}function getSliderMax(t){return map(t,(function(t){return t.getAttribute("SliderMax")}))}function setSliderMax(t,e){map(t,(function(t){setAttributeUndoable(t,"SliderMax",e)}))}function getSliderStep(t){return map(t,(function(t){return t.getAttribute("SliderStep")}))}function setSliderStep(t,e){map(t,(function(t){setAttributeUndoable(t,"SliderStep",e)}))}function getOpacity(t){return map(t,(function(t){return graph.getCellStyle(t).opacity}))}function setOpacity(t,e){map(t,(function(t){var n=t.getStyle();n=mxUtils.setStyle(n,"opacity",e);n=mxUtils.setStyle(n,mxConstants.STYLE_TEXT_OPACITY,e);graph.getModel().execute(new mxStyleChange(graph.getModel(),t,n));propagateGhosts(t)}))}function getLineColor(t){return map(t,(function(t){return graph.getCellStyle(t).strokeColor}))}function setLineColor(t,e){map(t,(function(t){var n=t.getStyle();n=mxUtils.setStyle(n,"strokeColor",e);graph.getModel().execute(new mxStyleChange(graph.getModel(),t,n));propagateGhosts(t)}))}function getFontColor(t){return map(t,(function(t){return graph.getCellStyle(t).fontColor}))}function setFontColor(t,e){map(t,(function(t){var n=t.getStyle();n=mxUtils.setStyle(n,"fontColor",e);graph.getModel().execute(new mxStyleChange(graph.getModel(),t,n));propagateGhosts(t)}))}function getFillColor(t){return map(t,(function(t){return graph.getCellStyle(t).fillColor}))}function setFillColor(t,e){map(t,(function(t){var n=t.getStyle();n=mxUtils.setStyle(n,"fillColor",e);graph.getModel().execute(new mxStyleChange(graph.getModel(),t,n));propagateGhosts(t)}))}function getImage(t){return map(t,(function(t){return t.getAttribute("Image")}))}function setImage(t,e){map(t,(function(t){t.setAttribute("Image",e);setPicture(t)}))}function getNonNegative(t){return map(t,(function(t){return"Stock"==t.value.nodeName?isTrue(t.getAttribute("NonNegative")):isTrue(t.getAttribute("OnlyPositive"))}))}function setNonNegative(t,e){map(t,(function(t){if("Stock"==t.value.nodeName)setAttributeUndoable(t,"NonNegative",e);else{setAttributeUndoable(t,"OnlyPositive",e);if(!(t instanceof SimpleNode))if(e)graph.setCellStyles(mxConstants.STYLE_STARTARROW,"",[t]);else{graph.setCellStyles(mxConstants.STYLE_STARTARROW,"block",[t]);graph.setCellStyles("startFill",0,[t])}}}))}function getStockType(t){return map(t,(function(t){return t.getAttribute("StockMode")}))}function setStockType(t,e){map(t,(function(t){setAttributeUndoable(t,"StockMode",e)}))}function getDelay(t){return map(t,(function(t){return t.getAttribute("Delay")}))}function setDelay(t,e){map(t,(function(t){setAttributeUndoable(t,"Delay",e)}))}function getEnds(t){return map(t,(function(t){return[t.source,t.target]}))}function setEnds(t,e){map(t,(function(n){if(t instanceof SimpleNode){n.source=e[0];n.target=e[1];clearPrimitiveCache()}else{var i=new mxTerminalChange(graph.model,n,e[0],!0);graph.getModel().execute(i);i=new mxTerminalChange(graph.model,n,e[1],!1);graph.getModel().execute(i)}}))}function connected(t,e){if(t.isEdge){if(null!==t.source&&t.source.id===e.id)return!0;if(null!==t.target&&t.target.id===e.id)return!0}if(e.isEdge){if(null!==e.source&&e.source.id===t.id)return!0;if(null!==e.target&&e.target.id===t.id)return!0}for(var n=findType(["Flow","Link","Transition"]),i=0;i<n.length;i++)if(null!==n[i].source&&null!==n[i].target){if(n[i].source.id===t.id&&n[i].target.id===e.id)return!0;if(n[i].target.id===t.id&&n[i].source.id===e.id)return!0}return!1}function getResidency(t){return map(t,(function(t){return t.getAttribute("Residency")}))}function setResidency(t,e){map(t,(function(t){setAttributeUndoable(t,"Residency",e)}))}function getTriggerType(t){return map(t,(function(t){return t.getAttribute("Trigger")}))}function setTriggerType(t,e){map(t,(function(t){setAttributeUndoable(t,"Trigger",e)}))}function getTriggerValue(t){return map(t,(function(t){return t.getAttribute("Value")}))}function setTriggerValue(t,e){map(t,(function(t){setAttributeUndoable(t,"Value",e)}))}function getTriggerRepeat(t){return map(t,(function(t){return isTrue(t.getAttribute("Repeat"))}))}function setTriggerRepeat(t,e){map(t,(function(t){setAttributeUndoable(t,"Repeat",e)}))}function getTriggerRecalculate(t){return map(t,(function(t){return isTrue(t.getAttribute("Recalculate"))}))}function setTriggerRecalculate(t,e){map(t,(function(t){setAttributeUndoable(t,"Recalculate",e)}))}function getData(t){return map(t,(function(t){return t.getAttribute("Data")}))}function setData(t,e){map(t,(function(t){setAttributeUndoable(t,"Data",e)}))}function getConverterInput(t){return map(t,(function(t){var e=t.getAttribute("Source");return"Time"==e?null:findID(e)}))}function setConverterInput(t,e){map(t,(function(t){setAttributeUndoable(t,"Source",null==e?"Time":e.id)}))}function getInterpolation(t){return map(t,(function(t){return t.getAttribute("Interpolation")}))}function setInterpolation(t,e){map(t,(function(t){setAttributeUndoable(t,"Interpolation",e)}))}function pressButton(t){"use strict";graph.getModel().beginUpdate();map(t,(function(t){runAction(t.getAttribute("Function"),"<p>There was an error with the Action for the button <i>"+t.getAttribute("name")+"</i>.</p><br/>",t)}));graph.getModel().endUpdate()}var trusted=is_owner;function runAction(code,errHeader,button){try{var msg="This insight is requesting permission to execute custom code. For security reasons, you should only run custom code in trusted insights.\n\nAre you sure you want to run code in this insight?";if(trusted||confirm(msg)){trusted||sendToParent({type:"start_action"});trusted=!0;eval('"use strict;"\n\n'+code)}}catch(t){errHeader=errHeader||"";Ext.Msg.show({title:getText("Action Error"),msg:errHeader+"<p><tt>"+t+"</tt></p><p><b>Code:</b></p><p><tt><pre>"+code+"</pre></tt></p>",buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR});button&&setTimeout((function(){highlight(button)}),100)}}function getPopulationSize(t){return map(t,(function(t){return t.getAttribute("Size")}))}function setPopulationSize(t,e){map(t,(function(t){setAttributeUndoable(t,"Size",e)}))}function getAgentBase(t){return map(t,(function(t){return findID(t.getAttribute("Agent"))}))}function setAgentBase(t,e){map(t,(function(t){setAttributeUndoable(t,"Agent",e.id)}))}function getGeometryWrap(t){return map(t,(function(t){return isTrue(t.getAttribute("GeoWrap"))}))}function setGeometryWrap(t,e){map(t,(function(t){setAttributeUndoable(t,"GeoWrap",e)}))}function getGeometryUnits(t){return map(t,(function(t){return t.getAttribute("GeoDimUnits")}))}function setGeometryUnits(t,e){map(t,(function(t){setAttributeUndoable(t,"GeoDimUnits",e)}))}function getGeometryWidth(t){return map(t,(function(t){return t.getAttribute("GeoWidth")}))}function setGeometryWidth(t,e){map(t,(function(t){setAttributeUndoable(t,"GeoWidth",e)}))}function getGeometryHeight(t){return map(t,(function(t){return t.getAttribute("GeoHeight")}))}function setGeometryHeight(t,e){map(t,(function(t){setAttributeUndoable(t,"GeoHeight",e)}))}function getAgentPlacement(t){return map(t,(function(t){return t.getAttribute("Placement")}))}function setAgentPlacement(t,e){map(t,(function(t){setAttributeUndoable(t,"Placement",e)}))}function getAgentPlacementFunction(t){return map(t,(function(t){return t.getAttribute("PlacementFunction")}))}function setAgentPlacementFunction(t,e){map(t,(function(t){setAttributeUndoable(t,"PlacementFunction",e)}))}function getAgentNetwork(t){return map(t,(function(t){return t.getAttribute("Network")}))}function setAgentNetwork(t,e){map(t,(function(t){setAttributeUndoable(t,"Network",e)}))}function getAgentNetworkFunction(t){return map(t,(function(t){return t.getAttribute("NetworkFunction")}))}function setAgentNetworkFunction(t,e){map(t,(function(t){setAttributeUndoable(t,"NetworkFunction",e)}))}function collapseFolder(t){map(t,(function(t){graph.foldCells(!0,!1,[t])}))}function expandFolder(t){map(t,(function(t){graph.foldCells(!1,!1,[t])}))}function getCollapsed(t){return map(t,(function(t){return t.isCollapsed()}))}function getParent(t){return map(t,(function(t){var e=t.parentNode||t.parent;return e.value&&"root"==e.value.nodeName||"root"==e.nodeName||"1"==e.id?null:e}))}function setParent(t,e,n){if(graph instanceof SimpleNode)null==e&&(e=graph.children[0].children[0]);else var i=null==e?graph.getDefaultParent():e;map(t,(function(t){if(graph instanceof SimpleNode){t.parent.children.splice(t.parent.children.indexOf(t),1);t.parent=e;t.parentNode=e;e.children||(e.children=[]);e.children.push(t)}else{var r=getPosition(t),a=new mxChildChange(graph.getModel(),i,t);graph.getModel().execute(a);n||setPosition(t,r)}}))}function getFrozen(t){return map(t,(function(t){return isTrue(t.getAttribute("Frozen"))}))}function setFrozen(t,e){map(t,(function(t){setAttributeUndoable(t,"Frozen",e)}))}function getChildren(t,e){isUndefined(e)&&(e=!0);return t.children?e?flatten(map(t.children,(function(t){return"Folder"==t.value.nodeName?t.children.concat([t]):t}))):t.children:[]}function getFolderType(t){return map(t,(function(t){return t.getAttribute("Type")}))}function setFolderType(t,e){map(t,(function(t){setAttributeUndoable(t,"Type",e)}))}function getFolderAgentParent(t){return map(t,(function(t){return t.getAttribute("AgentBase")}))}function setFolderAgentParent(t,e){map(t,(function(t){setAttributeUndoable(t,"AgentBase",e)}))}function getFolderSolver(t){return map(t,(function(t){return JSON.parse(t.getAttribute("Solver"))}))}function setFolderSolver(t,e){map(t,(function(t){setAttributeUndoable(t,"Solver",JSON.stringify(e))}))}function excludeType(t,e){var n=function(t,e){if(t instanceof Array){for(var n=[],i=0;i<t.length;i++)t[i].value.nodeName!=e&&n.push(t[i]);return n}return null==t?t:t.value.nodeName==e?null:t};if(Array.isArray(e)){for(var i=0;i<e.length;i++)t=n(t,e[i]);return t}return n(t,e)}function primitiveIndex(t,e){for(var n=0;n<t.length;n++)if(t[n].id==e.id)return n;return-1}function uniquePrimitives(t){for(var e=[],n=0;n<t.length;n++){for(var i=!1,r=0;r<e.length;r++)if(e[r].id==t[n].id){i=!0;break}i||e.push(t[n])}return e}var globalVarBank={};function setGlobal(t,e){globalVarBank["_"+t]=e}function getGlobal(t){return globalVarBank["_"+t]}function topBarShown(){return ribbonPanel.getDockedItems()[0].isVisible()}function toggleTopBar(){var t=ribbonPanel.getDockedItems()[0];if(t.isVisible()){t.hide();try{Ext.get("toplinks-holder").addCls("collapsed")}catch(t){}}else{t.show();try{Ext.get("toplinks-holder").removeCls("collapsed")}catch(t){}}}function sideBarShown(){return!configPanel.collapsed}function toggleSideBar(){sideBarShown()?configPanel.collapse(Ext.Component.DIRECTION_RIGHT,!1):configPanel.expand(!1)}function updateSideBar(){selectionChanged(!0)}if(void 0===org||!org)var org={};void 0!==org.antlr&&org.antlr||(org.antlr={});org.antlr.global=function(){return this}.call(null);org.antlr.namespace=function(){var t,e,n,i=arguments,r=null;for(t=0;t<i.length;t+=1){n=i[t].split(".");r=org.antlr.global;for(e=0;e<n.length;e+=1){r[n[e]]=r[n[e]]||{};r=r[n[e]]}}return r};org.antlr.env=org.antlr.env||{};org.antlr.env.ua=function(){var t,e,n={ie:0,opera:0,gecko:0,webkit:0,mobile:null,air:0,rhino:!1};try{t=navigator.userAgent;/KHTML/.test(t)&&(n.webkit=1);if((e=t.match(/AppleWebKit\/([^\s]*)/))&&e[1]){n.webkit=parseFloat(e[1]);/ Mobile\//.test(t)?n.mobile="Apple":(e=t.match(/NokiaN[^\/]*/))&&(n.mobile=e[0]);(e=t.match(/AdobeAIR\/([^\s]*)/))&&(n.air=e[0])}if(!n.webkit)if((e=t.match(/Opera[\s\/]([^\s]*)/))&&e[1]){n.opera=parseFloat(e[1]);(e=t.match(/Opera Mini[^;]*/))&&(n.mobile=e[0])}else if((e=t.match(/MSIE\s([^;]*)/))&&e[1])n.ie=parseFloat(e[1]);else if(e=t.match(/Gecko\/([^\s]*)/)){n.gecko=1;(e=t.match(/rv:([^\s\)]*)/))&&e[1]&&(n.gecko=parseFloat(e[1]))}}catch(t){}try{void 0===window&&"undefined"!=typeof loadClass&&(n.rhino=!0)}catch(t){}return n}();org.antlr.namespace("org.antlr.runtime.tree");org.antlr.lang=org.antlr.lang||{isArray:function(t){if(t){var e=org.antlr.lang;return e.isNumber(t.length)&&e.isFunction(t.splice)}return!1},isBoolean:function(t){return"boolean"==typeof t},isFunction:function(t){return"function"==typeof t},isNull:function(t){return null===t},isNumber:function(t){return"number"==typeof t&&isFinite(t)},isObject:function(t){return t&&("object"==typeof t||org.antlr.lang.isFunction(t))||!1},isString:function(t){return"string"==typeof t},isUndefined:function(t){return void 0===t},_IEEnumFix:function(t,e){if(org.antlr.env.ua.ie){var n,i=["toString","valueOf"];for(n=0;n<i.length;n+=1){var r=i[n],a=e[r];org.antlr.lang.isFunction(a)&&a!=Object.prototype[r]&&(t[r]=a)}}},extend:function(t,e,n){if(!e||!t)throw new Error("org.antlr.lang.extend failed, please check that all dependencies are included.");var i=function(){};i.prototype=e.prototype;t.prototype=new i;t.prototype.constructor=t;t.superclass=e.prototype;e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e);if(n){for(var r in n)t.prototype[r]=n[r];org.antlr.lang._IEEnumFix(t.prototype,n)}},augmentObject:function(t,e){if(!e||!t)throw new Error("Absorb failed, verify dependencies.");var n,i,r=arguments,a=r[2];if(a&&!0!==a)for(n=2;n<r.length;n+=1)t[r[n]]=e[r[n]];else{for(i in e)!a&&t[i]||(t[i]=e[i]);org.antlr.lang._IEEnumFix(t,e)}},augmentProto:function(t,e){if(!e||!t)throw new Error("Augment failed, verify dependencies.");for(var n=[t.prototype,e.prototype],i=2;i<arguments.length;i+=1)n.push(arguments[i]);org.antlr.lang.augmentObject.apply(this,n)},merge:function(){for(var t={},e=arguments,n=0,i=e.length;n<i;n+=1)org.antlr.lang.augmentObject(t,e[n],!0);return t},isValue:function(t){var e=org.antlr.lang;return e.isObject(t)||e.isString(t)||e.isNumber(t)||e.isBoolean(t)},array:{peek:function(t){if(!org.antlr.lang.isArray(t))throw new Error("org.antlr.lang.array.peek: a is not an array.");var e=t.length;if(e<=0)throw new Error("org.antlr.lang.array.peek: a is empty.");return t[e-1]}}};void 0!==org.antlr.runtime&&org.antlr.runtime||(org.antlr.runtime={});org.antlr.runtime.RecognitionException=function(t){org.antlr.runtime.RecognitionException.superclass.constructor.call(this);this.input=t;this.index=t.index();if(t instanceof org.antlr.runtime.TokenStream){this.token=t.LT(1);this.line=this.token.getLine();this.charPositionInLine=this.token.getCharPositionInLine()}if(t instanceof org.antlr.runtime.tree.TreeNodeStream)this.extractInformationFromTreeNodeStream(t);else if(t instanceof org.antlr.runtime.CharStream){this.c=t.LA(1);this.line=t.getLine();this.charPositionInLine=t.getCharPositionInLine()}else this.c=t.LA(1);this.message=this.toString()};org.antlr.lang.extend(org.antlr.runtime.RecognitionException,Error,{input:null,index:null,token:null,node:null,c:null,line:null,name:"org.antlr.runtime.RecognitionException",charPositionInLine:null,approximateLineInfo:null,extractInformationFromTreeNodeStream:function(t){var e,n,i,r,a,s=t;this.node=s.LT(1);var o=s.getTreeAdaptor(),l=o.getToken(this.node);if(l){this.token=l;if(l.getLine()<=0){a=-1;e=s.LT(a);for(;e;){if((n=o.getToken(e))&&n.getLine()>0){this.line=n.getLine();this.charPositionInLine=n.getCharPositionInLine();this.approximateLineInfo=!0;break}--a;e=s.LT(a)}}else{this.line=l.getLine();this.charPositionInLine=l.getCharPositionInLine()}}else if(this.node instanceof org.antlr.runtime.tree.Tree){this.line=this.node.getLine();this.charPositionInLine=this.node.getCharPositionInLine();this.node instanceof org.antlr.runtime.tree.CommonTree&&(this.token=this.node.token)}else{i=o.getType(this.node);r=o.getText(this.node);this.token=new org.antlr.runtime.CommonToken(i,r)}},getUnexpectedType:function(){if(this.input instanceof org.antlr.runtime.TokenStream)return this.token.getType();if(this.input instanceof org.antlr.runtime.tree.TreeNodeStream){return this.input.getTreeAdaptor().getType(this.node)}return this.c}});org.antlr.runtime.CharStream=function(){};org.antlr.runtime.IntStream=function(){};org.antlr.lang.extend(org.antlr.runtime.CharStream,org.antlr.runtime.IntStream);org.antlr.lang.augmentObject(org.antlr.runtime.CharStream,{EOF:-1});org.antlr.runtime.Token=function(){};org.antlr.lang.augmentObject(org.antlr.runtime.Token,{EOR_TOKEN_TYPE:1,DOWN:2,UP:3,MIN_TOKEN_TYPE:4,EOF:org.antlr.runtime.CharStream.EOF,EOF_TOKEN:null,INVALID_TOKEN_TYPE:0,INVALID_TOKEN:null,SKIP_TOKEN:null,DEFAULT_CHANNEL:0,HIDDEN_CHANNEL:99});org.antlr.runtime.MismatchedTokenException=function(t,e){if(0===arguments.length)this.expecting=org.antlr.runtime.Token.INVALID_TOKEN_TYPE;else{org.antlr.runtime.MismatchedTokenException.superclass.constructor.call(this,e);this.expecting=t}};org.antlr.lang.extend(org.antlr.runtime.MismatchedTokenException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedTokenException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedTokenException"});org.antlr.runtime.UnwantedTokenException=function(t,e){arguments.length>0&&org.antlr.runtime.UnwantedTokenException.superclass.constructor.call(this,t,e)};org.antlr.lang.extend(org.antlr.runtime.UnwantedTokenException,org.antlr.runtime.MismatchedTokenException,{getUnexpectedToken:function(){return this.token},toString:function(){var t=", expected "+this.expecting;this.expecting===org.antlr.runtime.Token.INVALID_TOKEN_TYPE&&(t="");return org.antlr.lang.isValue(this.token)?"UnwantedTokenException(found="+this.token.getText()+t+")":"UnwantedTokenException(found="+t+")"},name:"org.antlr.runtime.UnwantedTokenException"});org.antlr.runtime.CommonToken=function(){var t;this.charPositionInLine=-1;this.channel=0;this.index=-1;if(1==arguments.length)if(org.antlr.lang.isNumber(arguments[0]))this.type=arguments[0];else{t=arguments[0];this.text=t.getText();this.type=t.getType();this.line=t.getLine();this.index=t.getTokenIndex();this.charPositionInLine=t.getCharPositionInLine();this.channel=t.getChannel();if(t instanceof org.antlr.runtime.CommonToken){this.start=t.start;this.stop=t.stop}}else if(2==arguments.length){this.type=arguments[0];this.text=arguments[1];this.channel=0}else if(5==arguments.length){this.input=arguments[0];this.type=arguments[1];this.channel=arguments[2];this.start=arguments[3];this.stop=arguments[4]}};org.antlr.lang.extend(org.antlr.runtime.CommonToken,org.antlr.runtime.Token,{getType:function(){return this.type},setLine:function(t){this.line=t},getText:function(){if(org.antlr.lang.isString(this.text))return this.text;if(!this.input)return null;this.text=this.input.substring(this.start,this.stop);return this.text},setText:function(t){this.text=t},getLine:function(){return this.line},getCharPositionInLine:function(){return this.charPositionInLine},setCharPositionInLine:function(t){this.charPositionInLine=t},getChannel:function(){return this.channel},setChannel:function(t){this.channel=t},setType:function(t){this.type=t},getStartIndex:function(){return this.start},setStartIndex:function(t){this.start=t},getStopIndex:function(){return this.stop},setStopIndex:function(t){this.stop=t},getTokenIndex:function(){return this.index},setTokenIndex:function(t){this.index=t},getInputStream:function(){return this.input},setInputStream:function(t){this.input=t},toString:function(){var t="";this.channel>0&&(t=",channel="+this.channel);var e=this.getText();e=org.antlr.lang.isNull(e)?"<no text>":(e=(e=e.replace(/\n/g,"\\\\n")).replace(/\r/g,"\\\\r")).replace(/\t/g,"\\\\t");return"[@"+this.getTokenIndex()+","+this.start+":"+this.stop+"='"+e+"',<"+this.type+">"+t+","+this.line+":"+this.getCharPositionInLine()+"]"}});org.antlr.lang.augmentObject(org.antlr.runtime.Token,{EOF_TOKEN:new org.antlr.runtime.CommonToken(org.antlr.runtime.CharStream.EOF),INVALID_TOKEN:new org.antlr.runtime.CommonToken(0),SKIP_TOKEN:new org.antlr.runtime.CommonToken(0)},!0);org.antlr.runtime.CommonTokenStream=function(t,e){this.p=-1;this.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL;this.v_discardOffChannelTokens=!1;this.tokens=[];arguments.length>=2?this.channel=e:1===arguments.length&&(this.tokenSource=t)};org.antlr.runtime.TokenStream=function(){};org.antlr.lang.extend(org.antlr.runtime.CommonTokenStream,org.antlr.runtime.TokenStream,{setTokenSource:function(t){this.tokenSource=t;this.tokens=[];this.p=-1;this.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL},fillBuffer:function(){for(var t,e,n=0,i=this.tokenSource.nextToken();org.antlr.lang.isValue(i)&&i.getType()!=org.antlr.runtime.CharStream.EOF;){t=!1;if(this.channelOverrideMap){e=this.channelOverrideMap[i.getType()];org.antlr.lang.isValue(e)&&i.setChannel(e)}(this.discardSet&&this.discardSet[i.getType()]||this.v_discardOffChannelTokens&&i.getChannel()!=this.channel)&&(t=!0);if(!t){i.setTokenIndex(n);this.tokens.push(i);n++}i=this.tokenSource.nextToken()}this.p=0;this.p=this.skipOffTokenChannels(this.p)},consume:function(){if(this.p<this.tokens.length){this.p++;this.p=this.skipOffTokenChannels(this.p)}},skipOffTokenChannels:function(t){for(var e=this.tokens.length;t<e&&this.tokens[t].getChannel()!=this.channel;)t++;return t},skipOffTokenChannelsReverse:function(t){for(;t>=0&&this.tokens[t].getChannel()!=this.channel;)t--;return t},setTokenTypeChannel:function(t,e){this.channelOverrideMap||(this.channelOverrideMap={});this.channelOverrideMap[t]=e},discardTokenType:function(t){this.discardSet||(this.discardSet={});this.discardSet[t]=!0},discardOffChannelTokens:function(t){this.v_discardOffChannelTokens=t},getTokens:function(t,e,n){-1===this.p&&this.fillBuffer();if(0===arguments.length)return this.tokens;org.antlr.lang.isArray(n)?n=new org.antlr.runtime.BitSet(n):org.antlr.lang.isNumber(n)&&(n=org.antlr.runtime.BitSet.of(n));e>=this.tokens.length&&(e=this.tokens.length-1);t<0&&(t=0);if(t>e)return null;var i,r,a=[];for(i=t;i<=e;i++){r=this.tokens[i];this.types&&!n.member(r.getType())||a.push(r)}0===a.length&&(a=null);return a},LT:function(t){-1===this.p&&this.fillBuffer();if(0===t)return null;if(t<0)return this.LB(-1*t);if(this.p+t-1>=this.tokens.length)return org.antlr.runtime.Token.EOF_TOKEN;for(var e=this.p,n=1;n<t;){e=this.skipOffTokenChannels(e+1);n++}return e>=this.tokens.length?org.antlr.runtime.Token.EOF_TOKEN:this.tokens[e]},LB:function(t){-1===this.p&&this.fillBuffer();if(0===t)return null;if(this.p-t<0)return null;for(var e=this.p,n=1;n<=t;){e=this.skipOffTokenChannelsReverse(e-1);n++}return e<0?null:this.tokens[e]},get:function(t){return this.tokens[t]},LA:function(t){return this.LT(t).getType()},mark:function(){-1===this.p&&this.fillBuffer();this.lastMarker=this.index();return this.lastMarker},release:function(t){},size:function(){return this.tokens.length},index:function(){return this.p},rewind:function(t){org.antlr.lang.isNumber(t)||(t=this.lastMarker);this.seek(t)},reset:function(){this.p=0;this.lastMarker=0},seek:function(t){this.p=t},getTokenSource:function(){return this.tokenSource},getSourceName:function(){return this.getTokenSource().getSourceName()},toString:function(t,e){if(0===arguments.length){-1===this.p&&this.fillBuffer();t=0;e=this.tokens.length-1}if(!org.antlr.lang.isNumber(t)&&!org.antlr.lang.isNumber(e)){if(!org.antlr.lang.isValue(t)||!org.antlr.lang.isValue(e))return null;t=t.getTokenIndex();e=e.getTokenIndex()}var n,i="";if(t<0||e<0)return null;-1==this.p&&this.fillBuffer();e>=this.tokens.length&&(e=this.tokens.length-1);for(n=t;n<=e;n++){this.tokens[n];i+=this.tokens[n].getText()}return i}});org.antlr.runtime.TokenRewriteStream=function(){var t=org.antlr.runtime.TokenRewriteStream.superclass;this.programs=null;this.lastRewriteTokenIndexes=null;if(0===arguments.length)this.init();else{t.constructor.apply(this,arguments);this.init()}};!function(){var t=org.antlr.runtime.TokenRewriteStream;org.antlr.lang.augmentObject(t,{DEFAULT_PROGRAM_NAME:"default",PROGRAM_INIT_SIZE:100,MIN_TOKEN_INDEX:0});t.RewriteOperation=function(t,e){this.index=t;this.text=e};t.RewriteOperation.prototype={execute:function(t){return this.index},toString:function(){return this.text}};t.InsertBeforeOp=function(e,n){t.InsertBeforeOp.superclass.constructor.call(this,e,n)};org.antlr.lang.extend(t.InsertBeforeOp,t.RewriteOperation,{execute:function(t){t.push(this.text);return this.index}});t.ReplaceOp=function(e,n,i){t.ReplaceOp.superclass.constructor.call(this,e,i);this.lastIndex=n};org.antlr.lang.extend(t.ReplaceOp,t.RewriteOperation,{execute:function(t){org.antlr.lang.isValue(this.text)&&t.push(this.text);return this.lastIndex+1}});t.DeleteOp=function(e,n){t.DeleteOp.superclass.constructor.call(this,e,n)};org.antlr.lang.extend(t.DeleteOp,t.ReplaceOp);org.antlr.lang.extend(t,org.antlr.runtime.CommonTokenStream,{init:function(){this.programs={};this.programs[t.DEFAULT_PROGRAM_NAME]=[];this.lastRewriteTokenIndexes={}},rollback:function(){var e;if(1===arguments.length){e=t.DEFAULT_PROGRAM_NAME;arguments[0]}else if(2===arguments.length){e=arguments[0];arguments[1]}var n=this.programs[e];n&&(programs[e]=n.slice(t.MIN_TOKEN_INDEX,this.instructionIndex))},deleteProgram:function(e){e=e||t.DEFAULT_PROGRAM_NAME;this.rollback(e,t.MIN_TOKEN_INDEX)},addToSortedRewriteList:function(){var e,n;if(1===arguments.length){e=t.DEFAULT_PROGRAM_NAME;n=arguments[0]}else if(2===arguments.length){e=arguments[0];n=arguments[1]}var i,r,a,s,o,l,u=this.getProgram(e);for(r=0,i=u.length;r<i;r++){if((a=u[r]).index===n.index){if(n instanceof t.ReplaceOp){s=!1;for(l=r;l<u.length&&(o=u[r]).index===n.index;l++)if(o instanceof t.ReplaceOp){u[r]=n;s=!0;break}s||u.splice(l,0,n)}else u.splice(r,0,n);break}if(a.index>n.index){u.splice(r,0,n);break}}r===i&&u.push(n)},insertAfter:function(){var e,n,i;if(2===arguments.length){n=t.DEFAULT_PROGRAM_NAME;e=arguments[0];i=arguments[1]}else if(3===arguments.length){n=arguments[0];e=arguments[1];i=arguments[2]}e instanceof org.antlr.runtime.Token&&(e=e.index);this.insertBefore(n,e+1,i)},insertBefore:function(){var e,n,i;if(2===arguments.length){n=t.DEFAULT_PROGRAM_NAME;e=arguments[0];i=arguments[1]}else if(3===arguments.length){n=arguments[0];e=arguments[1];i=arguments[2]}e instanceof org.antlr.runtime.Token&&(e=e.index);this.addToSortedRewriteList(n,new t.InsertBeforeOp(e,i))},replace:function(){var e,n,i,r;if(2===arguments.length){e=t.DEFAULT_PROGRAM_NAME;n=arguments[0];i=arguments[0];r=arguments[1]}else if(3===arguments.length){e=t.DEFAULT_PROGRAM_NAME;n=arguments[0];i=arguments[1];r=arguments[2]}if(4===arguments.length){e=arguments[0];n=arguments[1];i=arguments[2];r=arguments[3]}n instanceof org.antlr.runtime.Token&&(n=n.index);i instanceof org.antlr.runtime.Token&&(i=i.index);n>i||i<0||n<0||this.addToSortedRewriteList(e,new t.ReplaceOp(n,i,r))},remove:function(){for(var t=[],e=arguments.length-1;e>=0;){t[e]=arguments[e];e--}t.push("");this.replace.apply(this,t)},getLastRewriteTokenIndex:function(e){e=e||t.DEFAULT_PROGRAM_NAME;return this.lastRewriteTokenIndexes[e]||-1},setLastRewriteTokenIndex:function(t,e){this.lastRewriteTokenIndexes[t]=e},getProgram:function(t){var e=this.programs[t];e||(e=this.initializeProgram(t));return e},initializeProgram:function(t){var e=[];this.programs[t]=e;return e},toOriginalString:function(e,n){org.antlr.lang.isNumber(e)||(e=t.MIN_TOKEN_INDEX);org.antlr.lang.isNumber(n)||(n=this.size()-1);var i,r=[];for(i=e;i>=t.MIN_TOKEN_INDEX&&i<=n&&i<this.tokens.length;i++)r.push(this.get(i).getText());return r.join("")},toString:function(){var e,n,i;if(0===arguments.length){e=t.DEFAULT_PROGRAM_NAME;n=t.MIN_TOKEN_INDEX;i=this.size()-1}else if(1===arguments.length){e=arguments[0];n=t.MIN_TOKEN_INDEX;i=this.size()-1}else if(2===arguments.length){e=t.DEFAULT_PROGRAM_NAME;n=arguments[0];i=arguments[1]}var r=this.programs[e];if(!r||0===r.length)return this.toOriginalString(n,i);for(var a,s,o=0,l=n,u=[];l>=t.MIN_TOKEN_INDEX&&l<=i&&l<this.tokens.length;){if(o<r.length){a=r[o];for(;a.index<l&&o<r.length;)++o<r.length&&(a=r[o]);for(;l===a.index&&o<r.length;){l=a.execute(u);++o<r.length&&(a=r[o])}}if(l<=i){u.push(this.get(l).getText());l++}}for(s=o;s<r.length;s++)(a=r[s]).index>=this.size()&&a.execute(u);return u.join("")},toDebugString:function(e,n){org.antlr.lang.isNumber(e)||(e=t.MIN_TOKEN_INDEX);org.antlr.lang.isNumber(n)||(n=this.size()-1);var i,r=[];for(i=e;i>=t.MIN_TOKEN_INDEX&&i<=n&&i<this.tokens.length;i++)r.push(this.get(i));return r.join("")}})}();org.antlr.runtime.ANTLRStringStream=function(t){this.p=0;this.line=1;this.charPositionInLine=0;this.markDepth=0;this.markers=null;this.lastMarker=null;this.data=t;this.n=t.length};org.antlr.lang.extend(org.antlr.runtime.ANTLRStringStream,org.antlr.runtime.CharStream,{reset:function(){this.p=0;this.line=1;this.charPositionInLine=0;this.markDepth=0},consume:function(){if(this.p<this.n){this.charPositionInLine++;if("\n"===this.data.charAt(this.p)){this.line++;this.charPositionInLine=0}this.p++}},LA:function(t){t<0&&t++;var e=this.p+t-1;return e>=this.n||e<0?org.antlr.runtime.CharStream.EOF:this.data.charAt(e)},index:function(){return this.p},size:function(){return this.n},mark:function(){if(!this.markers){this.markers=[];this.markers.push(null)}this.markDepth++;var t=null;if(this.markDepth>=this.markers.length){t={};this.markers.push(t)}else t=this.markers[this.markDepth];t.p=this.p;t.line=this.line;t.charPositionInLine=this.charPositionInLine;this.lastMarker=this.markDepth;return this.markDepth},rewind:function(t){org.antlr.lang.isNumber(t)||(t=this.lastMarker);var e=this.markers[t];this.seek(e.p);this.line=e.line;this.charPositionInLine=e.charPositionInLine;this.release(t)},release:function(t){this.markDepth=t;this.markDepth--},seek:function(t){if(t<=this.p)this.p=t;else for(;this.p<t;)this.consume()},substring:function(t,e){return this.data.substr(t,e-t+1)},getLine:function(){return this.line},getCharPositionInLine:function(){return this.charPositionInLine},setLine:function(t){this.line=t},setCharPositionInLine:function(t){this.charPositionInLine=t},getSourceName:function(){return null}});org.antlr.runtime.ANTLRStringStream.prototype.LT=org.antlr.runtime.ANTLRStringStream.prototype.LA;org.antlr.runtime.ANTLRFileStream=function(t,e){this.fileName=t;if(!org.antlr.env.ua.rhino)throw new Error("ANTLR File I/O is not supported in this JS implementation.");var n=this["loadFileUsingJava"](t,e);org.antlr.runtime.ANTLRFileStream.superclass.constructor.call(this,n)};org.antlr.lang.extend(org.antlr.runtime.ANTLRFileStream,org.antlr.runtime.ANTLRStringStream,{getSourceName:function(){return this.fileName},loadFileUsingJava:function(t,e){var n,i=new java.io.File(t),r=i.length(),a=new java.io.FileInputStream(i);n=e?new java.io.InputStreamReader(a,e):new java.io.InputStreamReader(a);var s=java.lang.reflect.Array.newInstance(java.lang.Character.TYPE,r);n.read(s,0,r);return new String(new java.lang.String(s))}});org.antlr.runtime.BaseRecognizer=function(t){this.state=t||new org.antlr.runtime.RecognizerSharedState};org.antlr.lang.augmentObject(org.antlr.runtime.BaseRecognizer,{MEMO_RULE_FAILED:-2,MEMO_RULE_UNKNOWN:-1,INITIAL_FOLLOW_STACK_SIZE:100,MEMO_RULE_FAILED_I:-2,DEFAULT_TOKEN_CHANNEL:org.antlr.runtime.Token.DEFAULT_CHANNEL,HIDDEN:org.antlr.runtime.Token.HIDDEN_CHANNEL,NEXT_TOKEN_RULE_NAME:"nextToken"});org.antlr.runtime.BaseRecognizer.prototype={reset:function(){var t,e;if(this.state){this.state._fsp=-1;this.state.errorRecovery=!1;this.state.lastErrorIndex=-1;this.state.failed=!1;this.state.syntaxErrors=0;this.state.backtracking=0;if(this.state.ruleMemo)for(t=0,e=this.state.ruleMemo.length;t<e;t++)this.state.ruleMemo[t]=null}},match:function(t,e,n){var i=this.getCurrentInputSymbol(t);if(t.LA(1)===e){t.consume();this.state.errorRecovery=!1;this.state.failed=!1;return i}if(this.state.backtracking>0){this.state.failed=!0;return i}return i=this.recoverFromMismatchedToken(t,e,n)},matchAny:function(t){this.state.errorRecovery=!1;this.state.failed=!1;t.consume()},mismatchIsUnwantedToken:function(t,e){return t.LA(2)===e},mismatchIsMissingToken:function(t,e){if(!e)return!1;if(e.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE)){this.computeContextSensitiveRuleFOLLOW();e=e.or(this.viableTokensFollowingThisRule);this.state._fsp>=0&&e.remove(org.antlr.runtime.Token.EOR_TOKEN_TYPE)}return!(!e.member(t.LA(1))&&!e.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE))},mismatch:function(t,e,n){if(this.mismatchIsUnwantedToken(t,e))throw new org.antlr.runtime.UnwantedTokenException(e,t);if(this.mismatchIsMissingToken(t,n))throw new org.antlr.runtime.MissingTokenException(e,t,null);throw new org.antlr.runtime.MismatchedTokenException(e,t)},reportError:function(t){if(!this.state.errorRecovery){this.state.syntaxErrors++;this.state.errorRecovery=!0;this.displayRecognitionError(this.getTokenNames(),t)}},displayRecognitionError:function(t,e){var n=this.getErrorHeader(e),i=this.getErrorMessage(e,t);this.emitErrorMessage(n+" "+i)},getErrorHeader:function(t){org.antlr.lang.isNumber(t.line)||(t.line=0);return"line "+t.line+":"+t.charPositionInLine},emitErrorMessage:function(t){void 0!==window&&window.alert?alert(t):print(t)},getErrorMessage:function(t,e){var n,i,r=t&&t.getMessage?t.getMessage():null;if(t instanceof org.antlr.runtime.UnwantedTokenException){var a=t;i="<unknown>";i=a.expecting==org.antlr.runtime.Token.EOF?"EOF":e[a.expecting];r="extraneous input "+this.getTokenErrorDisplay(a.getUnexpectedToken())+" expecting "+i}else if(t instanceof org.antlr.runtime.MissingTokenException){i="<unknown>";r="missing "+(i=(n=t).expecting==org.antlr.runtime.Token.EOF?"EOF":e[n.expecting])+" at "+this.getTokenErrorDisplay(t.token)}else if(t instanceof org.antlr.runtime.MismatchedTokenException){i="<unknown>";i=(n=t).expecting==org.antlr.runtime.Token.EOF?"EOF":e[n.expecting];r="mismatched input "+this.getTokenErrorDisplay(t.token)+" expecting "+i}else t instanceof org.antlr.runtime.NoViableAltException?r="no viable alternative at input "+this.getTokenErrorDisplay(t.token):t instanceof org.antlr.runtime.EarlyExitException?r="required (...)+ loop did not match anything at input "+this.getTokenErrorDisplay(t.token):t instanceof org.antlr.runtime.MismatchedSetException||t instanceof org.antlr.runtime.MismatchedNotSetException?r="mismatched input "+this.getTokenErrorDisplay(t.token)+" expecting set "+t.expecting:t instanceof org.antlr.runtime.FailedPredicateException&&(r="rule "+t.ruleName+" failed predicate: {"+t.predicateText+"}?");return r},getNumberOfSyntaxErrors:function(){return this.state.syntaxErrors},getTokenErrorDisplay:function(t){var e=t.getText();org.antlr.lang.isValue(e)||(e=t.getType()==org.antlr.runtime.Token.EOF?"<EOF>":"<"+t.getType()+">");return"'"+(e=(e=(e=e.replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace(/\t/g,"\\t"))+"'"},recover:function(t,e){this.state.lastErrorIndex==t.index()&&t.consume();this.state.lastErrorIndex=t.index();var n=this.computeErrorRecoverySet();this.beginResync();this.consumeUntil(t,n);this.endResync()},beginResync:function(){},endResync:function(){},computeErrorRecoverySet:function(){return this.combineFollows(!1)},computeContextSensitiveRuleFOLLOW:function(){return this.combineFollows(!0)},combineFollows:function(t){var e,n,i=this.state._fsp,r=new org.antlr.runtime.BitSet;for(e=i;e>=0;e--){n=this.state.following[e];r.orInPlace(n);if(t){if(!n.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE))break;e>0&&r.remove(org.antlr.runtime.Token.EOR_TOKEN_TYPE)}}return r},recoverFromMismatchedToken:function(t,e,n){var i=null;if(this.mismatchIsUnwantedToken(t,e)){i=new org.antlr.runtime.UnwantedTokenException(e,t);this.beginResync();t.consume();this.endResync();this.reportError(i);var r=this.getCurrentInputSymbol(t);t.consume();return r}if(this.mismatchIsMissingToken(t,n)){var a=this.getMissingSymbol(t,i,e,n);i=new org.antlr.runtime.MissingTokenException(e,t,a);this.reportError(i);return a}throw i=new org.antlr.runtime.MismatchedTokenException(e,t)},recoverFromMismatchedSet:function(t,e,n){if(this.mismatchIsMissingToken(t,n)){this.reportError(e);return this.getMissingSymbol(t,e,org.antlr.runtime.Token.INVALID_TOKEN_TYPE,n)}throw e},getCurrentInputSymbol:function(t){return null},getMissingSymbol:function(t,e,n,i){return null},consumeUntil:function(t,e){for(var n=t.LA(1);n!=org.antlr.runtime.Token.EOF&&!e.member(n);){t.consume();n=t.LA(1)}},pushFollow:function(t){if(this.state._fsp+1>=this.state.following.length){var e,n=[];for(e=this.state.following.length-1;e>=0;e--)n[e]=this.state.following[e];this.state.following=n}this.state._fsp++;this.state.following[this.state._fsp]=t},getRuleInvocationStack:function(t,e){throw new Error("Not implemented.")},getBacktrackingLevel:function(){return this.state.backtracking},getTokenNames:function(){return null},getGrammarFileName:function(){return null},toStrings:function(t){if(!t)return null;var e,n=[];for(e=0;e<t.length;e++)n.push(t[e].getText());return n},getRuleMemoization:function(t,e){this.state.ruleMemo[t]||(this.state.ruleMemo[t]={});var n=this.state.ruleMemo[t][e];return org.antlr.lang.isNumber(n)?n:org.antlr.runtime.BaseRecognizer.MEMO_RULE_UNKNOWN},alreadyParsedRule:function(t,e){var n=this.getRuleMemoization(e,t.index());if(n==org.antlr.runtime.BaseRecognizer.MEMO_RULE_UNKNOWN)return!1;n==org.antlr.runtime.BaseRecognizer.MEMO_RULE_FAILED?this.state.failed=!0:t.seek(n+1);return!0},memoize:function(t,e,n){var i=this.state.failed?org.antlr.runtime.BaseRecognizer.MEMO_RULE_FAILED:t.index()-1;if(!org.antlr.lang.isValue(this.state.ruleMemo))throw new Error("!!!!!!!!! memo array is null for "+this.getGrammarFileName());if(e>=this.state.ruleMemo.length)throw new Error("!!!!!!!!! memo size is "+this.state.ruleMemo.length+", but rule index is "+e);org.antlr.lang.isValue(this.state.ruleMemo[e])&&(this.state.ruleMemo[e][n]=i)},getRuleMemoizationCacheSize:function(){var t,e=0;for(t=0;this.state.ruleMemo&&t<this.state.ruleMemo.length;t++){var n=this.state.ruleMemo[t];n&&(e+=n.length)}return e},traceIn:function(t,e,n){this.emitErrorMessage("enter "+t+" "+n);this.state.failed&&this.emitErrorMessage(" failed="+this.failed);this.state.backtracking>0&&this.emitErrorMessage(" backtracking="+this.state.backtracking)},traceOut:function(t,e,n){this.emitErrorMessage("exit "+t+" "+n);this.state.failed&&this.emitErrorMessage(" failed="+this.state.failed);this.state.backtracking>0&&this.emitErrorMessage(" backtracking="+this.state.backtracking)}};org.antlr.runtime.Lexer=function(t,e){e&&org.antlr.runtime.Lexer.superclass.constructor.call(this,e);t&&(this.input=t)};org.antlr.lang.extend(org.antlr.runtime.Lexer,org.antlr.runtime.BaseRecognizer,{reset:function(){org.antlr.runtime.Lexer.superclass.reset.call(this);org.antlr.lang.isValue(this.input)&&this.input.seek(0);if(org.antlr.lang.isValue(this.state)){this.state.token=null;this.state.type=org.antlr.runtime.Token.INVALID_TOKEN_TYPE;this.state.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL;this.state.tokenStartCharIndex=-1;this.state.tokenStartCharPositionInLine=-1;this.state.tokenStartLine=-1;this.state.text=null}},nextToken:function(){for(;;){this.state.token=null;this.state.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL;this.state.tokenStartCharIndex=this.input.index();this.state.tokenStartCharPositionInLine=this.input.getCharPositionInLine();this.state.tokenStartLine=this.input.getLine();this.state.text=null;if(this.input.LA(1)===org.antlr.runtime.CharStream.EOF)return org.antlr.runtime.Token.EOF_TOKEN;try{this.mTokens();if(org.antlr.lang.isValue(this.state.token)){if(this.state.token==org.antlr.runtime.Token.SKIP_TOKEN)continue}else this.emit();return this.state.token}catch(t){if(t instanceof org.antlr.runtime.NoViableAltException){this.reportError(t);this.recover(t)}else{if(!(t instanceof org.antlr.runtime.RecognitionException))throw t;this.reportError(t)}}}},skip:function(){this.state.token=org.antlr.runtime.Token.SKIP_TOKEN},setCharStream:function(t){this.input=null;this.reset();this.input=t},getCharStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},emit:function(){if(0===arguments.length){var t=new org.antlr.runtime.CommonToken(this.input,this.state.type,this.state.channel,this.state.tokenStartCharIndex,this.getCharIndex()-1);t.setLine(this.state.tokenStartLine);t.setText(this.state.text);t.setCharPositionInLine(this.state.tokenStartCharPositionInLine);this.state.token=t;return t}this.state.token=arguments[0]},match:function(t){var e,n=0;if(org.antlr.lang.isString(t))for(;n<t.length;){if(this.input.LA(1)!=t.charAt(n)){if(this.state.backtracking>0){this.state.failed=!0;return}e=new org.antlr.runtime.MismatchedTokenException(t.charAt(n),this.input);this.recover(e);throw e}n++;this.input.consume();this.state.failed=!1}else if(org.antlr.lang.isNumber(t)){if(this.input.LA(1)!=t){if(this.state.backtracking>0){this.state.failed=!0;return}e=new org.antlr.runtime.MismatchedTokenException(t,this.input);this.recover(e);throw e}this.input.consume();this.state.failed=!1}},matchAny:function(){this.input.consume()},matchRange:function(t,e){if(this.input.LA(1)<t||this.input.LA(1)>e){if(this.state.backtracking>0){this.state.failed=!0;return}var n=new org.antlr.runtime.MismatchedRangeException(t,e,this.input);this.recover(n);throw n}this.input.consume();this.state.failed=!1},getLine:function(){return this.input.getLine()},getCharPositionInLine:function(){return this.input.getCharPositionInLine()},getCharIndex:function(){return this.input.index()},getText:function(){return org.antlr.lang.isString(this.state.text)?this.state.text:this.input.substring(this.state.tokenStartCharIndex,this.getCharIndex()-1)},setText:function(t){this.state.text=t},reportError:function(t){this.displayRecognitionError(this.getTokenNames(),t)},getErrorMessage:function(t,e){return t instanceof org.antlr.runtime.MismatchedTokenException?"mismatched character "+this.getCharErrorDisplay(t.c)+" expecting "+this.getCharErrorDisplay(t.expecting):t instanceof org.antlr.runtime.NoViableAltException?"no viable alternative at character "+this.getCharErrorDisplay(t.c):t instanceof org.antlr.runtime.EarlyExitException?"required (...)+ loop did not match anything at character "+this.getCharErrorDisplay(t.c):t instanceof org.antlr.runtime.MismatchedNotSetException||t instanceof org.antlr.runtime.MismatchedSetException?"mismatched character "+this.getCharErrorDisplay(t.c)+" expecting set "+t.expecting:t instanceof org.antlr.runtime.MismatchedRangeException?"mismatched character "+this.getCharErrorDisplay(t.c)+" expecting set "+this.getCharErrorDisplay(t.a)+".."+this.getCharErrorDisplay(t.b):org.antlr.runtime.Lexer.superclass.getErrorMessage.call(this,t,e)},getCharErrorDisplay:function(t){var e=t;switch(e){case org.antlr.runtime.Token.EOF:e="<EOF>";break;case"\n":e="\\n";break;case"\t":e="\\t";break;case"\r":e="\\r"}return"'"+e+"'"},recover:function(t){this.input.consume()},traceIn:function(t,e){var n=String.fromCharCode(this.input.LT(1))+" line="+this.getLine()+":"+this.getCharPositionInLine();org.antlr.runtime.Lexer.superclass.traceIn.call(this,t,e,n)},traceOut:function(t,e){var n=String.fromCharCode(this.input.LT(1))+" line="+this.getLine()+":"+this.getCharPositionInLine();org.antlr.runtime.Lexer.superclass.traceOut.call(this,t,e,n)}});org.antlr.runtime.DFA=function(){};org.antlr.runtime.DFA.prototype={predict:function(t){var e,n,i,r=t.mark(),a=0;try{for(;;)if((e=this.special[a])>=0){if(-1===(a=this.specialStateTransition(e,t))){this.noViableAlt(a,t);return 0}t.consume()}else{if(this.accept[a]>=1)return this.accept[a];(n=t.LA(1))===org.antlr.runtime.Token.EOF?n=-1:org.antlr.lang.isString(n)&&(n=n.charCodeAt(0));if(n>=this.min[a]&&n<=this.max[a]){if((i=this.transition[a][n-this.min[a]])<0){if(this.eot[a]>=0){a=this.eot[a];t.consume();continue}this.noViableAlt(a,t);return 0}a=i;t.consume()}else{if(!(this.eot[a]>=0)){if(n==org.antlr.runtime.Token.EOF&&this.eof[a]>=0)return this.accept[this.eof[a]];this.noViableAlt(a,t);return 0}a=this.eot[a];t.consume()}}}finally{t.rewind(r)}},noViableAlt:function(t,e){if(!(this.recognizer.state.backtracking>0)){var n=new org.antlr.runtime.NoViableAltException(this.getDescription(),this.decisionNumber,t,e);this.error(n);throw n}this.recognizer.state.failed=!0},error:function(t){},specialStateTransition:function(t,e){return-1},getDescription:function(){return"n/a"}};org.antlr.lang.augmentObject(org.antlr.runtime.DFA,{unpackEncodedString:function(t){var e,n,i,r,a=[],s=0;for(e=0;e<t.length;e+=2){n=t.charCodeAt(e);65535===(i=t.charCodeAt(e+1))&&(i=-1);for(r=1;r<=n;r++)a[s++]=i}return a},unpackEncodedStringToUnsignedChars:function(t){return org.antlr.runtime.DFA.unpackEncodedString(t)}});org.antlr.runtime.Parser=function(t,e){org.antlr.runtime.Parser.superclass.constructor.call(this,e);this.setTokenStream(t)};org.antlr.lang.extend(org.antlr.runtime.Parser,org.antlr.runtime.BaseRecognizer,{reset:function(){org.antlr.runtime.Parser.superclass.reset.call(this);org.antlr.lang.isValue(this.input)&&this.input.seek(0)},getCurrentInputSymbol:function(t){return t.LT(1)},getMissingSymbol:function(t,e,n,i){var r,a="<missing "+this.getTokenNames()[n]+">",s=new org.antlr.runtime.CommonToken(n,a),o=t.LT(1);if(o.getType()===org.antlr.runtime.Token.EOF){r=o;(o=t.LT(-1))||(o=r)}s.line=o.getLine();s.charPositionInLine=o.getCharPositionInLine();s.channel=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;return s},setTokenStream:function(t){this.input=null;this.reset();this.input=t},getTokenStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},traceIn:function(t,e){org.antlr.runtime.Parser.superclass.traceIn.call(this,t,e,this.input.LT(1))},traceOut:function(t,e){org.antlr.runtime.Parser.superclass.traceOut.call(this,t,e,this.input.LT(1))}});org.antlr.runtime.BitSet=function(t){t||(t=org.antlr.runtime.BitSet.BITS);org.antlr.lang.isArray(t)?this.bits=t:org.antlr.lang.isNumber(t)&&(this.bits=[])};org.antlr.lang.augmentObject(org.antlr.runtime.BitSet,{BITS:32,LOG_BITS:5,MOD_MASK:31,bitMask:function(t){return 1<<(t&org.antlr.runtime.BitSet.MOD_MASK)},numWordsToHold:function(t){return 1+(t>>org.antlr.runtime.BitSet.LOG_BITS)},wordNumber:function(t){return t>>org.antlr.runtime.BitSet.LOG_BITS},of:function(t,e){var n,i,r,a;if(org.antlr.lang.isNumber(t)){if(org.antlr.lang.isNumber(e)){r=new org.antlr.runtime.BitSet(e+1);for(n=t;n<=e;n++){i=org.antlr.runtime.BitSet.wordNumber(n);r.bits[i]|=org.antlr.runtime.BitSet.bitMask(n)}return r}(r=new org.antlr.runtime.BitSet(t+1)).add(t);return r}if(org.antlr.lang.isArray(t)){r=new org.antlr.runtime.BitSet;for(n=t.length-1;n>=0;n--)r.add(t[n]);return r}if(t instanceof org.antlr.runtime.BitSet)return t||null;if(t instanceof org.antlr.runtime.IntervalSet){if(!t)return null;(r=new org.antlr.runtime.BitSet).addAll(t);return r}if(org.antlr.lang.isObject(t)){a=[];for(n in t)org.antlr.lang.isNumber(n)&&a.push(n);return org.antlr.runtime.BitSet.of(a)}}});org.antlr.runtime.BitSet.prototype={add:function(t){var e=org.antlr.runtime.BitSet.wordNumber(t);e>=this.bits.length&&this.growToInclude(t);this.bits[e]|=org.antlr.runtime.BitSet.bitMask(t)},addAll:function(t){var e,n;if(t instanceof org.antlr.runtime.BitSet)this.orInPlace(t);else if(t instanceof org.antlr.runtime.IntervalSet)t;else{if(!org.antlr.lang.isArray(t))return;for(e=0;e<t.length;e++){n=t[e];this.add(n)}}},and:function(t){var e=this.clone();e.andInPlace(t);return e},andInPlace:function(t){var e,n=Math.min(this.bits.length,t.bits.length);for(e=n-1;e>=0;e--)this.bits[e]&=t.bits[e];for(e=n;e<this.bits.length;e++)this.bits[e]=0},clear:function(t){if(0!==arguments.length){var e=org.antlr.runtime.BitSet.wordNumber(t);e>=this.bits.length&&this.growToInclude(t);this.bits[e]&=~org.antlr.runtime.BitSet.bitMask(t)}else{var n;for(n=this.bits.length-1;n>=0;n--)this.bits[n]=0}},clone:function(){var t,e,n=[];for(t=0,e=this.bits.length;t<e;t++)n[t]=this.bits[t];return new org.antlr.runtime.BitSet(n)},size:function(){var t,e,n,i=0;for(t=this.bits.length-1;t>=0;t--)if(0!==(e=this.bits[t]))for(n=org.antlr.runtime.BitSet.BITS-1;n>=0;n--)0!=(e&1<<n)&&i++;return i},equals:function(t){if(!(t&&t instanceof org.antlr.runtime.BitSet))return!1;var e,n=t,i=Math.min(this.bits.length,n.bits.length);for(e=0;e<i;e++)if(this.bits[e]!=n.bits[e])return!1;if(this.bits.length>i){for(e=i+1;e<this.bits.length;e++)if(0!==this.bits[e])return!1}else if(n.bits.length>i)for(e=i+1;e<n.bits.length;e++)if(0!==n.bits[e])return!1;return!0},growToInclude:function(t){Math.max(this.bits.length<<1,org.antlr.runtime.BitSet.numWordsToHold(t));var e,n,i=[];for(e=0,n=this.bits.length;e<n;e++)i[e]=this.bits[e];this.bits=i},member:function(t){var e=org.antlr.runtime.BitSet.wordNumber(t);return!(e>=this.bits.length)&&0!=(this.bits[e]&org.antlr.runtime.BitSet.bitMask(t))},getSingleElement:function(){var t;for(t=0;t<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;t++)if(this.member(t))return t;return-1},isNil:function(){var t;for(t=this.bits.length-1;t>=0;t--)if(0!==this.bits[t])return!1;return!0},complement:function(t){if(t)return t.subtract(this);var e=this.clone();e.notInPlace();return e},notInPlace:function(){var t,e,n,i;if(0===arguments.length)for(n=this.bits.length-1;n>=0;n--)this.bits[n]=~this.bits[n];else{if(1===arguments.length){t=0;e=arguments[0]}else{t=arguments[0];e=arguments[1]}this.growToInclude(e);for(n=t;n<=e;n++){i=org.antlr.runtime.BitSet.wordNumber(n);this.bits[i]^=org.antlr.runtime.BitSet.bitMask(n)}}},or:function(t){if(!t)return this;var e=this.clone();e.orInPlace(t);return e},orInPlace:function(t){if(t){t.bits.length>this.bits.length&&this.setSize(t.bits.length);var e;for(e=Math.min(this.bits.length,t.bits.length)-1;e>=0;e--)this.bits[e]|=t.bits[e]}},remove:function(t){var e=org.antlr.runtime.BitSet.wordNumber(t);e>=this.bits.length&&this.growToInclude(t);this.bits[e]&=~org.antlr.runtime.BitSet.bitMask(t)},setSize:function(t){for(var e=t-this.bits.length;e>=0;){this.bits.push(0);e--}},numBits:function(){return this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS},lengthInLongWords:function(){return this.bits.length},subset:function(t){return!!t&&this.and(t).equals(this)},subtractInPlace:function(t){if(t){var e;for(e=0;e<this.bits.length&&e<t.bits.length;e++)this.bits[e]&=~t.bits[e]}},subtract:function(t){if(!(t&&t instanceof org.antlr.runtime.BitSet))return null;var e=this.clone();e.subtractInPlace(t);return e},toArray:function(){var t,e=[],n=0;for(t=0;t<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;t++)this.member(t)&&(e[n++]=t);return e},toPackedArray:function(){return this.bits},toString:function(){return 0===arguments.length?this.toString1(null):org.antlr.lang.isString(arguments[0])?org.antlr.lang.isValue(arguments[1])?this.toString2(arguments[0],arguments[1]):this.toString1(null):this.toString1(arguments[0])},toString1:function(t){var e,n="{",i=!1;for(e=0;e<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;e++)if(this.member(e)){e>0&&i&&(n+=",");n+=t?t.getTokenDisplayName(e):e.toString();i=!0}return n+"}"},toString2:function(t,e){var n,i="";for(n=0;n<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;n++)if(this.member(n)){i.length>0&&(i+=t);n>=e.size()?i+="'"+n+"'":org.antlr.lang.isValue(e.get(n))?i+=e.get(n):i+="'"+n+"'"}return i}};org.antlr.runtime.ParserRuleReturnScope=function(){};org.antlr.runtime.RuleReturnScope=function(){};org.antlr.lang.extend(org.antlr.runtime.ParserRuleReturnScope,org.antlr.runtime.RuleReturnScope,{getStart:function(){return this.start},getStop:function(){return this.stop}});org.antlr.runtime.RecognizerSharedState=function(){this.following=[];this._fsp=-1;this.errorRecovery=!1;this.lastErrorIndex=-1;this.failed=!1;this.syntaxErrors=0;this.backtracking=0;this.ruleMemo=null;this.token=null;this.tokenStartCharIndex=-1;this.text=null};org.antlr.runtime.tree={};org.antlr.runtime.tree.Tree=function(){};org.antlr.runtime.tree.BaseTree=function(){};org.antlr.lang.extend(org.antlr.runtime.tree.BaseTree,org.antlr.runtime.tree.Tree,{getChild:function(t){return!this.children||t>=this.children.length?null:this.children[t]},getChildren:function(){return this.children},getFirstChildWithType:function(t){var e,n;for(e=0;this.children&&e<this.children.length;e++)if((n=this.children[e]).getType()===t)return n;return null},getChildCount:function(){return this.children?this.children.length:0},addChild:function(t){if(org.antlr.lang.isValue(t)){var e,n,i,r=t;if(r.isNil()){if(this.children&&this.children==r.children)throw new Error("attempt to add child list to itself");if(r.children)if(this.children){e=r.children.length;for(n=0;n<e;n++){i=r.children[n];this.children.push(i);i.setParent(this);i.setChildIndex(this.children.length-1)}}else{this.children=r.children;this.freshenParentAndChildIndexes()}}else{this.children||(this.children=this.createChildrenList());this.children.push(t);r.setParent(this);r.setChildIndex(this.children.length-1)}}},addChildren:function(t){var e,n;for(e=0;e<t.length;e++){n=t[e];this.addChild(n)}},setChild:function(t,e){if(e){if(e.isNil())throw new Error("Can't set single child to a list");this.children||(this.children=this.createChildrenList());this.children[t]=e;e.setParent(this);e.setChildIndex(t)}},deleteChild:function(t){if(!this.children)return null;if(t<0||t>=this.children.length)throw new Error("Index out of bounds.");var e=this.children.splice(t,1)[0];this.freshenParentAndChildIndexes(t);return e},replaceChildren:function(t,e,n){if(!this.children)throw new Error("indexes invalid; no children in list");var i,r=e-t+1,a=n,s=null;a.isNil()?s=a.children:(s=[]).push(a);i=s.length;var o,l,u,h,c,d=s.length,m=r-i;if(0===m){o=0;for(l=t;l<=e;l++){u=s[o];this.children[l]=u;u.setParent(this);u.setChildIndex(l);o++}}else if(m>0){for(o=0;o<d;o++)this.children[t+o]=s[o];for(c=h=t+d;c<=e;c++)this.children.splice(h,1)[0];this.freshenParentAndChildIndexes(t)}else{for(o=0;o<r;o++)this.children[t+o]=s[o];i-r;for(o=r;o<i;o++)this.children.splice(t+o,0,s[o]);this.freshenParentAndChildIndexes(t)}},createChildrenList:function(){return[]},isNil:function(){return!1},freshenParentAndChildIndexes:function(t){org.antlr.lang.isNumber(t)||(t=0);var e,n,i=this.getChildCount();for(e=t;e<i;e++){(n=this.getChild(e)).setChildIndex(e);n.setParent(this)}},sanityCheckParentAndChildIndexes:function(t,e){if(0===arguments.length){t=null;e=-1}if(t!==this.getParent())throw new Error("parents don't match; expected "+t+" found "+this.getParent());if(e!==this.getChildIndex())throw new Error("child indexes don't match; expected "+e+" found "+this.getChildIndex());var n,i=this.getChildCount();for(n=0;n<i;n++)this.getChild(n).sanityCheckParentAndChildIndexes(this,n)},getChildIndex:function(){return 0},setChildIndex:function(t){},getParent:function(){return null},setParent:function(t){},getTree:function(){return this},toStringTree:function(){if(!this.children||0===this.children.length)return this.toString();var t,e="";if(!this.isNil()){e+="(";e+=this.toString();e+=" "}for(t=0;this.children&&t<this.children.length;t++){t>0&&(e+=" ");e+=this.children[t].toStringTree()}this.isNil()||(e+=")");return e},getLine:function(){return 0},getCharPositionInLine:function(){return 0}});org.antlr.runtime.tree.CommonTree=function(t){this.startIndex=-1;this.stopIndex=-1;this.childIndex=-1;this.parent=null;this.token=null;if(t instanceof org.antlr.runtime.tree.CommonTree){org.antlr.runtime.tree.CommonTree.superclass.constructor.call(this,t);this.token=t.token;this.startIndex=t.startIndex;this.stopIndex=t.stopIndex}else t instanceof org.antlr.runtime.CommonToken&&(this.token=t)};org.antlr.lang.extend(org.antlr.runtime.tree.CommonTree,org.antlr.runtime.tree.BaseTree,{getToken:function(){return this.token},dupNode:function(){return new org.antlr.runtime.tree.CommonTree(this)},isNil:function(){return!this.token},getType:function(){return this.token?this.token.getType():org.antlr.runtime.Token.INVALID_TOKEN_TYPE},getText:function(){return this.token?this.token.getText():null},getLine:function(){return this.token&&0!==this.token.getLine()?this.token.getLine():this.getChildCount()>0?this.getChild(0).getLine():0},getCharPositionInLine:function(){return this.token&&-1!==this.token.getCharPositionInLine()?this.token.getCharPositionInLine():this.getChildCount()>0?this.getChild(0).getCharPositionInLine():0},getTokenStartIndex:function(){return this.token?this.token.getTokenIndex():this.startIndex},setTokenStartIndex:function(t){this.startIndex=t},getTokenStopIndex:function(){return this.token?this.token.getTokenIndex():this.stopIndex},setTokenStopIndex:function(t){this.stopIndex=t},getChildIndex:function(){return this.childIndex},getParent:function(){return this.parent},setParent:function(t){this.parent=t},setChildIndex:function(t){this.childIndex=t},toString:function(){return this.isNil()?"nil":this.getType()===org.antlr.runtime.Token.INVALID_TOKEN_TYPE?"<errornode>":this.token?this.token.getText():null}});org.antlr.runtime.tree.Tree.INVALID_NODE=new org.antlr.runtime.tree.CommonTree(org.antlr.runtime.Token.INVALID_TOKEN);org.antlr.runtime.tree.RewriteRuleElementStream=function(t,e,n){this.cursor=0;this.dirty=!1;this.elementDescription=e;this.adaptor=t;if(n)if(org.antlr.lang.isArray(n)){this.singleElement=null;this.elements=n}else this.add(n)};org.antlr.runtime.tree.RewriteRuleElementStream.prototype={reset:function(){this.cursor=0;this.dirty=!0},add:function(t){if(org.antlr.lang.isValue(t))if(this.elements)this.elements.push(t);else if(org.antlr.lang.isValue(this.singleElement)){this.elements=[];this.elements.push(this.singleElement);this.singleElement=null;this.elements.push(t)}else this.singleElement=t},nextTree:function(){var t,e=this.size();if(this.dirty||this.cursor>=e&&1==e){t=this._next();return this.dup(t)}return t=this._next()},_next:function(){var t=this.size();if(0===t)throw new org.antlr.runtime.tree.RewriteEmptyStreamException(this.elementDescription);if(this.cursor>=t){if(1===t)return this.toTree(this.singleElement);throw new org.antlr.runtime.tree.RewriteCardinalityException(this.elementDescription)}if(org.antlr.lang.isValue(this.singleElement)){this.cursor++;return this.toTree(this.singleElement)}var e=this.toTree(this.elements[this.cursor]);this.cursor++;return e},toTree:function(t){return t&&t.getTree?t.getTree():t},hasNext:function(){return org.antlr.lang.isValue(this.singleElement)&&this.cursor<1||this.elements&&this.cursor<this.elements.length},size:function(){var t=0;org.antlr.lang.isValue(this.singleElement)&&(t=1);return this.elements?this.elements.length:t},getDescription:function(){return this.elementDescription}};org.antlr.runtime.tree.RewriteRuleSubtreeStream=function(){var t=org.antlr.runtime.tree.RewriteRuleSubtreeStream.superclass;t.constructor.apply(this,arguments)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleSubtreeStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){var t,e=this.size();if(this.dirty||this.cursor>=e&&1===e){t=this._next();return this.adaptor.dupNode(t)}return t=this._next()},dup:function(t){return this.adaptor.dupTree(t)}});org.antlr.runtime.tree.RewriteRuleTokenStream=function(t,e,n){var i=org.antlr.runtime.tree.RewriteRuleTokenStream.superclass;i.constructor.apply(this,arguments)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleTokenStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){var t=this._next();return this.adaptor.create(t)},nextToken:function(){return this._next()},toTree:function(t){return t},dup:function(t){throw new Error("dup can't be called for a token stream.")}});org.antlr.runtime.tree.BaseTreeAdaptor=function(){this.uniqueNodeID=1};org.antlr.runtime.tree.TreeAdaptor=function(){};org.antlr.lang.extend(org.antlr.runtime.tree.BaseTreeAdaptor,org.antlr.runtime.tree.TreeAdaptor,{nil:function(){return this.create(null)},errorNode:function(t,e,n,i){return new org.antlr.runtime.tree.CommonErrorNode(t,e,n,i)},isNil:function(t){return t.isNil()},dupTree:function(t,e){1===arguments.length&&(e=null);if(!t)return null;var n=this.dupNode(t);this.setChildIndex(n,this.getChildIndex(t));this.setParent(n,e);var i,r,a,s=this.getChildCount(t);for(i=0;i<s;i++){r=this.getChild(t,i);a=this.dupTree(r,t);this.addChild(n,a)}return n},addChild:function(t,e){t&&org.antlr.lang.isValue(e)&&t.addChild(e)},becomeRoot:function(t,e){(t instanceof org.antlr.runtime.Token||!t)&&(t=this.create(t));var n=t,i=e;if(!e)return t;if(n.isNil()){var r=n.getChildCount();if(1===r)n=n.getChild(0);else if(r>1)throw new Error("more than one node as root (TODO: make exception hierarchy)")}n.addChild(i);return n},rulePostProcessing:function(t){var e=t;if(e&&e.isNil())if(0===e.getChildCount())e=null;else if(1===e.getChildCount()){(e=e.getChild(0)).setParent(null);e.setChildIndex(-1)}return e},create:function(t,e){var n;if(2===arguments.length){if(org.antlr.lang.isString(arguments[1])){n=arguments[1];e=this.createToken(t,n);return this.create(e)}(e=this.createToken(e)).setType(t);return this.create(e)}if(3===arguments.length){n=arguments[2];(e=this.createToken(e)).setType(t);e.setText(n);return this.create(e)}},getType:function(t){t.getType();return 0},setType:function(t,e){throw new Error("don't know enough about Tree node")},getText:function(t){return t.getText()},setText:function(t,e){throw new Error("don't know enough about Tree node")},getChild:function(t,e){return t.getChild(e)},setChild:function(t,e,n){t.setChild(e,n)},deleteChild:function(t,e){return t.deleteChild(e)},getChildCount:function(t){return t.getChildCount()},getUniqueID:function(t){this.treeToUniqueIDMap||(this.treeToUniqueIDMap={});var e=this.treeToUniqueIDMap[t];if(org.antlr.lang.isValue(e))return e;var n=this.uniqueNodeID;this.treeToUniqueIDMap[t]=n;this.uniqueNodeID++;return n}});org.antlr.runtime.tree.CommonTreeAdaptor=function(){};org.antlr.lang.extend(org.antlr.runtime.tree.CommonTreeAdaptor,org.antlr.runtime.tree.BaseTreeAdaptor,{dupNode:function(t){return org.antlr.lang.isValue(t)?t.dupNode():null},create:function(t){return arguments.length>1?org.antlr.runtime.tree.CommonTreeAdaptor.superclass.create.apply(this,arguments):new org.antlr.runtime.tree.CommonTree(t)},createToken:function(t){return 2===arguments.length?new org.antlr.runtime.CommonToken(arguments[0],arguments[1]):new org.antlr.runtime.CommonToken(arguments[0])},setTokenBoundaries:function(t,e,n){if(org.antlr.lang.isValue(t)){var i=0,r=0;org.antlr.lang.isValue(e)&&(i=e.getTokenIndex?e.getTokenIndex():e.getStartIndex?e.getStartIndex():e.getTokenStartIndex());org.antlr.lang.isValue(n)&&(r=r.getTokenIndex?n.getTokenIndex():n.getStopIndex?n.getStopIndex():n.getTokenStopIndex());t.setTokenStartIndex(i);t.setTokenStopIndex(r)}},getTokenStartIndex:function(t){return t?t.getTokenStartIndex():-1},getTokenStopIndex:function(t){return t?t.getTokenStopIndex():-1},getText:function(t){return t?t.getText():null},getType:function(t){return t?t.getType():org.antlr.runtime.Token.INVALID_TOKEN_TYPE},getToken:function(t){return t instanceof org.antlr.runtime.tree.CommonTree?t.getToken():null},getChild:function(t,e){return t?t.getChild(e):null},getChildCount:function(t){return t?t.getChildCount():0},getParent:function(t){return t.getParent()},setParent:function(t,e){t.setParent(e)},getChildIndex:function(t){return t.getChildIndex()},setChildIndex:function(t,e){t.setChildIndex(e)},replaceChildren:function(t,e,n,i){t&&t.replaceChildren(e,n,i)}});var FormulaLexer=function(t,e){e||(e=new org.antlr.runtime.RecognizerSharedState);(function(){}).call(this);this.dfa30=new FormulaLexer.DFA30(this);FormulaLexer.superclass.constructor.call(this,t,e)};org.antlr.lang.augmentObject(FormulaLexer,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112});!function(){var t=org.antlr.runtime.Token.HIDDEN_CHANNEL;org.antlr.runtime.Token.EOF;org.antlr.lang.extend(FormulaLexer,org.antlr.runtime.Lexer,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112,getGrammarFileName:function(){return"/Library/WebServer/Documents/calc/Formula.g"}});org.antlr.lang.augmentObject(FormulaLexer.prototype,{mT__113:function(){try{var t=this.T__113,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("(");this.state.type=t;this.state.channel=e}finally{}},mT__114:function(){try{var t=this.T__114,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(")");this.state.type=t;this.state.channel=e}finally{}},mT__115:function(){try{var t=this.T__115,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<-");this.state.type=t;this.state.channel=e}finally{}},mT__116:function(){try{var t=this.T__116,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(".");this.state.type=t;this.state.channel=e}finally{}},mNEWLINE:function(){try{var t=this.NEWLINE,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,n=2;"\r"==this.input.LA(1)&&(n=1);switch(n){case 1:this.match("\r")}this.match("\n");this.state.type=t;this.state.channel=e}finally{}},mWHILESTATEMENT:function(){try{var t=this.WHILESTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mW();this.mH();this.mI();this.mL();this.mE();this.state.type=t;this.state.channel=e}finally{}},mFORSTATEMENT:function(){try{var t=this.FORSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mO();this.mR();this.state.type=t;this.state.channel=e}finally{}},mFROMSTATEMENT:function(){try{var t=this.FROMSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mR();this.mO();this.mM();this.state.type=t;this.state.channel=e}finally{}},mINSTATEMENT:function(){try{var t=this.INSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mI();this.mN();this.state.type=t;this.state.channel=e}finally{}},mTOSTATEMENT:function(){try{var t=this.TOSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mO();this.state.type=t;this.state.channel=e}finally{}},mBYSTATEMENT:function(){try{var t=this.BYSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mB();this.mY();this.state.type=t;this.state.channel=e}finally{}},mLOOPSTATEMENT:function(){try{var t=this.LOOPSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mL();this.mO();this.mO();this.mP();this.state.type=t;this.state.channel=e}finally{}},mIFSTATEMENT:function(){try{var t=this.IFSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mI();this.mF();this.state.type=t;this.state.channel=e}finally{}},mTHENSTATEMENT:function(){try{var t=this.THENSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mH();this.mE();this.mN();this.state.type=t;this.state.channel=e}finally{}},mELSESTATEMENT:function(){try{var t=this.ELSESTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mE();this.mL();this.mS();this.mE();this.state.type=t;this.state.channel=e}finally{}},mFUNCTIONSTATEMENT:function(){try{var t=this.FUNCTIONSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mU();this.mN();this.mC();this.mT();this.mI();this.mO();this.mN();this.state.type=t;this.state.channel=e}finally{}},mENDBLOCK:function(){try{var t=this.ENDBLOCK,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mE();this.mN();this.mD();this.state.type=t;this.state.channel=e}finally{}},mRETURNSTATEMENT:function(){try{var t=this.RETURNSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mR();this.mE();this.mT();this.mU();this.mR();this.mN();this.state.type=t;this.state.channel=e}finally{}},mNEWSTATEMENT:function(){try{var t=this.NEWSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mN();this.mE();this.mW();this.state.type=t;this.state.channel=e}finally{}},mTRYSTATEMENT:function(){try{var t=this.TRYSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mR();this.mY();this.state.type=t;this.state.channel=e}finally{}},mCATCHSTATEMENT:function(){try{var t=this.CATCHSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mC();this.mA();this.mT();this.mC();this.mH();this.state.type=t;this.state.channel=e}finally{}},mTHROWSTATEMENT:function(){try{var t=this.THROWSTATEMENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mH();this.mR();this.mO();this.mW();this.state.type=t;this.state.channel=e}finally{}},mOR:function(){try{var t=this.OR,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,n=2,i=this.input.LA(1);if("|"==i)n=1;else{if("O"!=i&&"o"!=i){throw new org.antlr.runtime.NoViableAltException("",2,0,this.input)}n=2}switch(n){case 1:this.match("||");break;case 2:this.mO();this.mR()}this.state.type=t;this.state.channel=e}finally{}},mXOR:function(){try{var t=this.XOR,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mX();this.mO();this.mR();this.state.type=t;this.state.channel=e}finally{}},mAND:function(){try{var t=this.AND,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,n=2,i=this.input.LA(1);if("&"==i)n=1;else{if("A"!=i&&"a"!=i){throw new org.antlr.runtime.NoViableAltException("",3,0,this.input)}n=2}switch(n){case 1:this.match("&&");break;case 2:this.mA();this.mN();this.mD()}this.state.type=t;this.state.channel=e}finally{}},mEQUALS:function(){try{var t=this.EQUALS,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;if("="!=this.input.LA(1)){throw new org.antlr.runtime.NoViableAltException("",4,0,this.input)}switch("="==this.input.LA(2)?2:1){case 1:this.match("=");break;case 2:this.match("==")}this.state.type=t;this.state.channel=e}finally{}},mNOTEQUALS:function(){try{var t=this.NOTEQUALS,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,n=2,i=this.input.LA(1);if("!"==i)n=1;else{if("<"!=i){throw new org.antlr.runtime.NoViableAltException("",5,0,this.input)}n=2}switch(n){case 1:this.match("!=");break;case 2:this.match("<>")}this.state.type=t;this.state.channel=e}finally{}},mLT:function(){try{var t=this.LT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<");this.state.type=t;this.state.channel=e}finally{}},mLTEQ:function(){try{var t=this.LTEQ,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<=");this.state.type=t;this.state.channel=e}finally{}},mGT:function(){try{var t=this.GT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(">");this.state.type=t;this.state.channel=e}finally{}},mGTEQ:function(){try{var t=this.GTEQ,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(">=");this.state.type=t;this.state.channel=e}finally{}},mPLUS:function(){try{var t=this.PLUS,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("+");this.state.type=t;this.state.channel=e}finally{}},mMINUS:function(){try{var t=this.MINUS,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("-");this.state.type=t;this.state.channel=e}finally{}},mMULT:function(){try{var t=this.MULT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("*");this.state.type=t;this.state.channel=e}finally{}},mDIV:function(){try{var t=this.DIV,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("/");this.state.type=t;this.state.channel=e}finally{}},mMOD:function(){try{var t=this.MOD,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,n=2,i=this.input.LA(1);if("%"==i)n=1;else{if("M"!=i&&"m"!=i){throw new org.antlr.runtime.NoViableAltException("",6,0,this.input)}n=2}switch(n){case 1:this.match("%");break;case 2:this.mM();this.mO();this.mD()}this.state.type=t;this.state.channel=e}finally{}},mPOW:function(){try{var t=this.POW,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("^");this.state.type=t;this.state.channel=e}finally{}},mNOT:function(){try{var t=this.NOT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,n=2,i=this.input.LA(1);if("!"==i)n=1;else{if("N"!=i&&"n"!=i){throw new org.antlr.runtime.NoViableAltException("",7,0,this.input)}n=2}switch(n){case 1:this.match("!");break;case 2:this.mN();this.mO();this.mT()}this.state.type=t;this.state.channel=e}finally{}},mLARR:function(){try{var t=this.LARR,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,n=2,i=this.input.LA(1);if("«"==i)n=1;else{if("<"!=i){throw new org.antlr.runtime.NoViableAltException("",8,0,this.input)}n=2}switch(n){case 1:this.match("«");break;case 2:this.match("<<")}this.state.type=t;this.state.channel=e}finally{}},mRARR:function(){try{var t=this.RARR,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,n=2,i=this.input.LA(1);if("»"==i)n=1;else{if(">"!=i){throw new org.antlr.runtime.NoViableAltException("",9,0,this.input)}n=2}switch(n){case 1:this.match("»");break;case 2:this.match(">>")}this.state.type=t;this.state.channel=e}finally{}},mLCURL:function(){try{var t=this.LCURL,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("{");this.state.type=t;this.state.channel=e}finally{}},mRCURL:function(){try{var t=this.RCURL,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("}");this.state.type=t;this.state.channel=e}finally{}},mINTEGER:function(){try{var t=this.INTEGER,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,n=0;t:for(;;){var i=2,r=this.input.LA(1);r>="0"&&r<="9"&&(i=1);switch(i){case 1:this.matchRange("0","9");break;default:if(n>=1)break t;throw new org.antlr.runtime.EarlyExitException(10,this.input)}n++}var a=2;"e"==this.input.LA(1)&&(a=1);switch(a){case 1:this.match("e");var s=2,o=this.input.LA(1);"+"!=o&&"-"!=o||(s=1);switch(s){case 1:if("+"!=this.input.LA(1)&&"-"!=this.input.LA(1)){var l=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(l);throw l}this.input.consume()}t:for(;;){var u=2,h=this.input.LA(1);h>="0"&&h<="9"&&(u=1);switch(u){case 1:this.matchRange("0","9");break;default:break t}}}this.state.type=t;this.state.channel=e}finally{}},mFLOAT:function(){try{var t=this.FLOAT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;t:for(;;){var n=2,i=this.input.LA(1);i>="0"&&i<="9"&&(n=1);switch(n){case 1:this.matchRange("0","9");break;default:break t}}this.match(".");var r=0;t:for(;;){var a=2,s=this.input.LA(1);s>="0"&&s<="9"&&(a=1);switch(a){case 1:this.matchRange("0","9");break;default:if(r>=1)break t;throw new org.antlr.runtime.EarlyExitException(15,this.input)}r++}var o=2;"e"==this.input.LA(1)&&(o=1);switch(o){case 1:this.match("e");var l=2,u=this.input.LA(1);"+"!=u&&"-"!=u||(l=1);switch(l){case 1:if("+"!=this.input.LA(1)&&"-"!=this.input.LA(1)){var h=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(h);throw h}this.input.consume()}t:for(;;){var c=2,d=this.input.LA(1);d>="0"&&d<="9"&&(c=1);switch(c){case 1:this.matchRange("0","9");break;default:break t}}}this.state.type=t;this.state.channel=e}finally{}},mTRUE:function(){try{var t=this.TRUE,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mR();this.mU();this.mE();this.state.type=t;this.state.channel=e}finally{}},mFALSE:function(){try{var t=this.FALSE,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mA();this.mL();this.mS();this.mE();this.state.type=t;this.state.channel=e}finally{}},mPER:function(){try{var t=this.PER,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mP();this.mE();this.mR();this.state.type=t;this.state.channel=e}finally{}},mSQUARED:function(){try{var t=this.SQUARED,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mS();this.mQ();this.mU();this.mA();this.mR();this.mE();this.mD();this.state.type=t;this.state.channel=e}finally{}},mCUBED:function(){try{var t=this.CUBED,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mC();this.mU();this.mB();this.mE();this.mD();this.state.type=t;this.state.channel=e}finally{}},mIDENT:function(){try{var t=this.IDENT,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;if(!(this.input.LA(1)>="A"&&this.input.LA(1)<="Z"||this.input.LA(1)>="a"&&this.input.LA(1)<="z")){var n=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(n);throw n}this.input.consume();t:for(;;){var i=2,r=this.input.LA(1);(r>="0"&&r<="9"||r>="A"&&r<="Z"||"_"==r||r>="a"&&r<="z")&&(i=1);switch(i){case 1:if(!(this.input.LA(1)>="0"&&this.input.LA(1)<="9"||this.input.LA(1)>="A"&&this.input.LA(1)<="Z"||"_"==this.input.LA(1)||this.input.LA(1)>="a"&&this.input.LA(1)<="z")){n=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(n);throw n}this.input.consume();break;default:break t}}this.state.type=t;this.state.channel=e}finally{}},mPRIMITIVE:function(){try{var t=this.PRIMITIVE,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,n=2;if("["!=this.input.LA(1)){throw new org.antlr.runtime.NoViableAltException("",22,0,this.input)}var i=this.input.LA(2);if(i>="\0"&&i<="Z"||i>="\\"&&i<="￿")n=1;else{if("["!=i){throw new org.antlr.runtime.NoViableAltException("",22,1,this.input)}n=2}switch(n){case 1:this.mLBRACKET();if(!(this.input.LA(1)>="\0"&&this.input.LA(1)<="Z"||this.input.LA(1)>="\\"&&this.input.LA(1)<="￿")){var r=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(r);throw r}this.input.consume();t:for(;;){var a=2,s=this.input.LA(1);"]"==s?a=2:(s>="\0"&&s<="\\"||s>="^"&&s<="￿")&&(a=1);switch(a){case 1:this.matchAny();break;default:break t}}this.mRBRACKET();break;case 2:this.mLBRACKET();this.mLBRACKET();t:for(;;){var o=2,l=this.input.LA(1);"]"==l?o=2:(l>="\0"&&l<="\\"||l>="^"&&l<="￿")&&(o=1);switch(o){case 1:this.matchAny();break;default:break t}}this.mRBRACKET();this.mRBRACKET()}this.state.type=t;this.state.channel=e}finally{}},mLBRACKET:function(){try{var t=this.LBRACKET,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("[");this.state.type=t;this.state.channel=e}finally{}},mRBRACKET:function(){try{var t=this.RBRACKET,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("]");this.state.type=t;this.state.channel=e}finally{}},mCOMMENT:function(){try{var e=this.COMMENT,n=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("/*");t:for(;;){var i=2,r=this.input.LA(1);if("*"==r){var a=this.input.LA(2);"/"==a?i=2:(a>="\0"&&a<="."||a>="0"&&a<="￿")&&(i=1)}else(r>="\0"&&r<=")"||r>="+"&&r<="￿")&&(i=1);switch(i){case 1:this.matchAny();break;default:break t}}this.match("*/");n=t;this.state.type=e;this.state.channel=n}finally{}},mLINE_COMMENT:function(){try{var e=this.LINE_COMMENT,n=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,i=2,r=this.input.LA(1);if("/"==r)i=1;else{if("#"!=r){throw new org.antlr.runtime.NoViableAltException("",24,0,this.input)}i=2}switch(i){case 1:this.match("//");break;case 2:this.match("#")}t:for(;;){var a=2,s=this.input.LA(1);(s>="\0"&&s<="\t"||s>="\v"&&s<="\f"||s>=""&&s<="￿")&&(a=1);switch(a){case 1:if(!(this.input.LA(1)>="\0"&&this.input.LA(1)<="\t"||this.input.LA(1)>="\v"&&this.input.LA(1)<="\f"||this.input.LA(1)>=""&&this.input.LA(1)<="￿")){var o=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(o);throw o}this.input.consume();break;default:break t}}n=t;this.state.type=e;this.state.channel=n}finally{}},mCOLON:function(){try{var t=this.COLON,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(":");this.state.type=t;this.state.channel=e}finally{}},mWS:function(){try{var e=this.WS,n=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,i=0;t:for(;;){var r=2,a=this.input.LA(1);"\t"!=a&&"\f"!=a&&" "!=a||(r=1);switch(r){case 1:if("\t"!=this.input.LA(1)&&"\f"!=this.input.LA(1)&&" "!=this.input.LA(1)){var s=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(s);throw s}this.input.consume();break;default:if(i>=1)break t;throw new org.antlr.runtime.EarlyExitException(26,this.input)}i++}n=t;this.state.type=e;this.state.channel=n}finally{}},mA:function(){try{if("A"!=this.input.LA(1)&&"a"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mB:function(){try{if("B"!=this.input.LA(1)&&"b"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mC:function(){try{if("C"!=this.input.LA(1)&&"c"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mD:function(){try{if("D"!=this.input.LA(1)&&"d"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mE:function(){try{if("E"!=this.input.LA(1)&&"e"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mF:function(){try{if("F"!=this.input.LA(1)&&"f"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mG:function(){try{if("G"!=this.input.LA(1)&&"g"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mH:function(){try{if("H"!=this.input.LA(1)&&"h"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mI:function(){try{if("I"!=this.input.LA(1)&&"i"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mJ:function(){try{if("J"!=this.input.LA(1)&&"j"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mK:function(){try{if("K"!=this.input.LA(1)&&"k"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mL:function(){try{if("L"!=this.input.LA(1)&&"l"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mM:function(){try{if("M"!=this.input.LA(1)&&"m"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mN:function(){try{if("N"!=this.input.LA(1)&&"n"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mO:function(){try{if("O"!=this.input.LA(1)&&"o"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mP:function(){try{if("P"!=this.input.LA(1)&&"p"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mQ:function(){try{if("Q"!=this.input.LA(1)&&"q"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mR:function(){try{if("R"!=this.input.LA(1)&&"r"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mS:function(){try{if("S"!=this.input.LA(1)&&"s"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mT:function(){try{if("T"!=this.input.LA(1)&&"t"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mU:function(){try{if("U"!=this.input.LA(1)&&"u"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mV:function(){try{if("V"!=this.input.LA(1)&&"v"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mW:function(){try{if("W"!=this.input.LA(1)&&"w"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mX:function(){try{if("X"!=this.input.LA(1)&&"x"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mY:function(){try{if("Y"!=this.input.LA(1)&&"y"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mZ:function(){try{if("Z"!=this.input.LA(1)&&"z"!=this.input.LA(1)){var t=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(t);throw t}this.input.consume()}finally{}},mCOMMA:function(){try{var t=this.COMMA,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(",");this.state.type=t;this.state.channel=e}finally{}},mSTRING:function(){try{var t=this.STRING,e=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,n=2,i=this.input.LA(1);if("'"==i)n=1;else{if('"'!=i){throw new org.antlr.runtime.NoViableAltException("",29,0,this.input)}n=2}switch(n){case 1:this.match("'");t:for(;;){var r=2,a=this.input.LA(1);"'"==a?r=2:(a>="\0"&&a<="&"||a>="("&&a<="￿")&&(r=1);switch(r){case 1:this.matchAny();break;default:break t}}this.match("'");break;case 2:this.match('"');t:for(;;){var s=3,o=this.input.LA(1);if("\\"==o){var l=this.input.LA(2);if('"'==l){var u=this.input.LA(3);s=u>="\0"&&u<="￿"?1:2}else(l>="\0"&&l<="!"||l>="#"&&l<="￿")&&(s=2)}else(o>="\0"&&o<="!"||o>="#"&&o<="["||o>="]"&&o<="￿")&&(s=2);switch(s){case 1:this.match('\\"');break;case 2:if(!(this.input.LA(1)>="\0"&&this.input.LA(1)<="!"||this.input.LA(1)>="#"&&this.input.LA(1)<="￿")){var h=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(h);throw h}this.input.consume();break;default:break t}}this.match('"')}this.state.type=t;this.state.channel=e}finally{}},mTokens:function(){switch(this.dfa30.predict(this.input)){case 1:this.mT__113();break;case 2:this.mT__114();break;case 3:this.mT__115();break;case 4:this.mT__116();break;case 5:this.mNEWLINE();break;case 6:this.mWHILESTATEMENT();break;case 7:this.mFORSTATEMENT();break;case 8:this.mFROMSTATEMENT();break;case 9:this.mINSTATEMENT();break;case 10:this.mTOSTATEMENT();break;case 11:this.mBYSTATEMENT();break;case 12:this.mLOOPSTATEMENT();break;case 13:this.mIFSTATEMENT();break;case 14:this.mTHENSTATEMENT();break;case 15:this.mELSESTATEMENT();break;case 16:this.mFUNCTIONSTATEMENT();break;case 17:this.mENDBLOCK();break;case 18:this.mRETURNSTATEMENT();break;case 19:this.mNEWSTATEMENT();break;case 20:this.mTRYSTATEMENT();break;case 21:this.mCATCHSTATEMENT();break;case 22:this.mTHROWSTATEMENT();break;case 23:this.mOR();break;case 24:this.mXOR();break;case 25:this.mAND();break;case 26:this.mEQUALS();break;case 27:this.mNOTEQUALS();break;case 28:this.mLT();break;case 29:this.mLTEQ();break;case 30:this.mGT();break;case 31:this.mGTEQ();break;case 32:this.mPLUS();break;case 33:this.mMINUS();break;case 34:this.mMULT();break;case 35:this.mDIV();break;case 36:this.mMOD();break;case 37:this.mPOW();break;case 38:this.mNOT();break;case 39:this.mLARR();break;case 40:this.mRARR();break;case 41:this.mLCURL();break;case 42:this.mRCURL();break;case 43:this.mINTEGER();break;case 44:this.mFLOAT();break;case 45:this.mTRUE();break;case 46:this.mFALSE();break;case 47:this.mPER();break;case 48:this.mSQUARED();break;case 49:this.mCUBED();break;case 50:this.mIDENT();break;case 51:this.mPRIMITIVE();break;case 52:this.mLBRACKET();break;case 53:this.mRBRACKET();break;case 54:this.mCOMMENT();break;case 55:this.mLINE_COMMENT();break;case 56:this.mCOLON();break;case 57:this.mWS();break;case 58:this.mCOMMA();break;case 59:this.mSTRING()}}},!0);org.antlr.lang.augmentObject(FormulaLexer,{DFA30_eotS:"￿12￿\n&￿&￿&￿JL￿N￿&￿P&￿S\f￿&Z[\\&a\b&&￿&￿&￿&p&￿&v&￿&z&|J&&￿&&￿￿&￿&￿&￿&￿￿&&￿&￿￿&￿￿",DFA30_eofS:"￿",DFA30_minS:"\t￿-0￿HAFHYOLEA￿RO￿N￿=￿*￿O￿.EQ￿\0\f￿IRONL0EU0OSDTWTB0RD￿D￿RU￿L0MCS￿NO0E￿PE0U0CE0AE￿0TE0W￿0￿R￿HD￿R0￿I0￿0￿N0E￿O￿0￿DN￿0￿",DFA30_maxS:"»￿>9￿hunryoneou￿ro￿n￿=>￿/￿o￿9eq￿￿\f￿ironlzryzosdtwtbzrd￿d￿ru￿lzmcs￿noze￿pezuzcezae￿ztezw￿z￿r￿hd￿rz￿iz￿z￿nze￿o￿z￿dn￿z￿",DFA30_acceptS:"￿￿\n￿￿￿￿ !\"￿$￿%'()*￿2￿5789:;,￿&6#￿+￿43￿\t\r\n￿\v￿￿￿￿￿/￿\b￿￿-\f￿￿.￿1￿￿0",DFA30_specialS:"'￿\0u￿}>",DFA30_transitionS:["+￿+￿+-)￿-,\n#*￿￿\n&\f&\b&\v$&\r%\t&&'￿(￿\n&\f&\b&\v$&\r%\t&&!\"-￿￿ ","","",".￿0/","\n3","","4￿4","8\r￿5￿6￿7\v￿8\r￿5￿6￿7",":￿9￿:￿9","<￿;￿=￿<￿;￿=",">￿>","?￿?","@￿A￿@￿A","B￿B","C\t￿D￿C\t￿D","E￿F\v￿E￿F","","G￿G","H￿H","","I￿I","","/","K ","","","","M￿)","","O￿O","","","","","","3￿\n#","Q￿Q","R￿R","","\0T","","","","","","","","","","","","","U￿U","V￿V","W￿W","X￿X","Y￿Y","\n&￿&￿&￿&","\n&￿&￿&￿&","\n&￿&￿&￿&","]\f￿^￿]\f￿^","`￿_￿`￿_","\n&￿&￿&￿&","b￿b","c￿c","d￿d","e￿e","f￿f","g￿g","h￿h","i￿i","\n&￿&￿&￿&","j￿j","k￿k","","","","","","l￿l","","m￿m","n￿n","","","o￿o","\n&￿&￿&￿&","q￿q","r￿r","s￿s","","","","t￿t","u￿u","\n&￿&￿&￿&","w￿w","","x￿x","y￿y","\n&￿&￿&￿&","{￿{","\n&￿&￿&￿&","\n&￿&￿&￿&","}￿}","~￿~","\n&￿&￿&￿&","\n&￿&￿&￿&","\n&￿&￿&￿&","\n&￿&￿&￿&","￿","￿","","\n&￿&￿&￿&","￿","￿","\n&￿&￿&￿&","￿","","\n&￿&￿&￿&","\n&￿&￿&￿&","\n&￿&￿&￿&","","￿","","￿","￿","","","￿","\n&￿&￿&￿&","","￿","\n&￿&￿&￿&","","\n&￿&￿&￿&","","","","￿","\n&￿&￿&￿&","\n&￿&￿&￿&","￿","","￿","","","\n&￿&￿&￿&","","","￿","￿","","\n&￿&￿&￿&","\n&￿&￿&￿&","",""]});org.antlr.lang.augmentObject(FormulaLexer,{DFA30_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_eotS),DFA30_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_eofS),DFA30_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaLexer.DFA30_minS),DFA30_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaLexer.DFA30_maxS),DFA30_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_acceptS),DFA30_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_specialS),DFA30_transition:function(){var t,e=[],n=FormulaLexer.DFA30_transitionS.length;for(t=0;t<n;t++)e.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_transitionS[t]));return e}()});FormulaLexer.DFA30=function(t){this.recognizer=t;this.decisionNumber=30;this.eot=FormulaLexer.DFA30_eot;this.eof=FormulaLexer.DFA30_eof;this.min=FormulaLexer.DFA30_min;this.max=FormulaLexer.DFA30_max;this.accept=FormulaLexer.DFA30_accept;this.special=FormulaLexer.DFA30_special;this.transition=FormulaLexer.DFA30_transition};org.antlr.lang.extend(FormulaLexer.DFA30,org.antlr.runtime.DFA,{getDescription:function(){return"1:1: Tokens : ( T__113 | T__114 | T__115 | T__116 | NEWLINE | WHILESTATEMENT | FORSTATEMENT | FROMSTATEMENT | INSTATEMENT | TOSTATEMENT | BYSTATEMENT | LOOPSTATEMENT | IFSTATEMENT | THENSTATEMENT | ELSESTATEMENT | FUNCTIONSTATEMENT | ENDBLOCK | RETURNSTATEMENT | NEWSTATEMENT | TRYSTATEMENT | CATCHSTATEMENT | THROWSTATEMENT | OR | XOR | AND | EQUALS | NOTEQUALS | LT | LTEQ | GT | GTEQ | PLUS | MINUS | MULT | DIV | MOD | POW | NOT | LARR | RARR | LCURL | RCURL | INTEGER | FLOAT | TRUE | FALSE | PER | SQUARED | CUBED | IDENT | PRIMITIVE | LBRACKET | RBRACKET | COMMENT | LINE_COMMENT | COLON | WS | COMMA | STRING );"},specialStateTransition:function(t,e){var n=t,i=function(t,e){switch(t){case 0:var n=e.LA(1);t=-1;if((t=n>="\0"&&n<="￿"?84:83)>=0)return t}}.call(this.recognizer,t,e);if(!org.antlr.lang.isUndefined(i))return i;var r=new org.antlr.runtime.NoViableAltException(this.getDescription(),30,n,e);this.error(r);throw r},dummy:null})}();var FormulaParser=function(t,e){e||(e=new org.antlr.runtime.RecognizerSharedState);(function(){}).call(this);FormulaParser.superclass.constructor.call(this,t,e);this.dfa5=new FormulaParser.DFA5(this);this.dfa57=new FormulaParser.DFA57(this);this.dfa58=new FormulaParser.DFA58(this);this.dfa65=new FormulaParser.DFA65(this);this.dfa72=new FormulaParser.DFA72(this);this.dfa85=new FormulaParser.DFA85(this);this.adaptor=new org.antlr.runtime.tree.CommonTreeAdaptor};org.antlr.lang.augmentObject(FormulaParser,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112});!function(){var t=11,e=32,n=54,i=60,r=62,a=64,s=69,o=70,l=71,u=82,h=83,c=86,d=88,m=89,f=91,p=93,g=94,_=98,v=100,S=101;org.antlr.lang.extend(FormulaParser,org.antlr.runtime.Parser,{setTreeAdaptor:function(t){this.adaptor=t},getTreeAdaptor:function(){return this.adaptor},getTokenNames:function(){return FormulaParser.tokenNames},getGrammarFileName:function(){return"/Library/WebServer/Documents/calc/Formula.g"}});org.antlr.lang.augmentObject(FormulaParser.prototype,{lines_return:function(){FormulaParser.lines_return=function(){};org.antlr.lang.extend(FormulaParser.lines_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),lines:function(){var t=new FormulaParser.lines_return;t.start=this.input.LT(1);var r=null,a=null,o=null,h=null,c=null,p=null,v=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),S=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EOF"),N=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression");try{t:for(;;){var E=2;this.input.LA(1)==e&&(E=1);switch(E){case 1:a=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_lines160);if(this.state.failed)return t;0===this.state.backtracking&&v.add(a);break;default:break t}}t:for(;;){var T=2,F=this.input.LA(1);(38==F||42==F||F==n||F==i||F>=63&&F<=65||F>=68&&F<=s||F==l||F==u||F>=d&&F<=m||F==f||F>=g&&F<=_||113==F)&&(T=1);switch(T){case 1:this.pushFollow(FormulaParser.FOLLOW_expression_in_lines164);p=this.expression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&N.add(p.getTree());var b=2,L=this.input.LA(1);if(L==e)b=1;else{if(-1!=L){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",3,0,this.input)}b=2}switch(b){case 1:var w=0;e:for(;;){var k=2;this.input.LA(1)==e&&(k=1);switch(k){case 1:o=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_lines168);if(this.state.failed)return t;0===this.state.backtracking&&v.add(o);break;default:if(w>=1)break e;if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.EarlyExitException(2,this.input)}w++}break;case 2:h=this.match(this.input,-1,FormulaParser.FOLLOW_EOF_in_lines171);if(this.state.failed)return t;0===this.state.backtracking&&S.add(h)}break;default:break t}}c=this.match(this.input,-1,FormulaParser.FOLLOW_EOF_in_lines176);if(this.state.failed)return t;0===this.state.backtracking&&S.add(c);if(0===this.state.backtracking){t.tree=r;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);r=this.adaptor.nil();var O=this.adaptor.nil();O=this.adaptor.becomeRoot(this.adaptor.create(14,"LINES"),O);for(;N.hasNext();)this.adaptor.addChild(O,N.nextTree());N.reset();this.adaptor.addChild(r,O);t.tree=r}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(r);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},expression_return:function(){FormulaParser.expression_return=function(){};org.antlr.lang.extend(FormulaParser.expression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),expression:function(){var t=new FormulaParser.expression_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null,a=null,s=null,o=null,l=null,u=null,h=null,c=null;try{switch(this.dfa5.predict(this.input)){case 1:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_assignment_in_expression508);n=this.assignment();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());break;case 2:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_expression514);i=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());break;case 3:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_whileLoop_in_expression520);r=this.whileLoop();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;case 4:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_forLoop_in_expression526);a=this.forLoop();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,a.getTree());break;case 5:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_forInLoop_in_expression532);s=this.forInLoop();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,s.getTree());break;case 6:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_ifThenElse_in_expression538);o=this.ifThenElse();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,o.getTree());break;case 7:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_functionDef_in_expression544);l=this.functionDef();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,l.getTree());break;case 8:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_returnExp_in_expression550);u=this.returnExp();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,u.getTree());break;case 9:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_tryCatch_in_expression556);h=this.tryCatch();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,h.getTree());break;case 10:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_throwExp_in_expression562);c=this.throwExp();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,c.getTree())}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},returnExp_return:function(){FormulaParser.returnExp_return=function(){};org.antlr.lang.extend(FormulaParser.returnExp_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),returnExp:function(){var t=new FormulaParser.returnExp_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null;try{e=this.adaptor.nil();n=this.match(this.input,63,FormulaParser.FOLLOW_RETURNSTATEMENT_in_returnExp574);if(this.state.failed)return t;if(0===this.state.backtracking){r=this.adaptor.create(n);e=this.adaptor.becomeRoot(r,e)}this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_returnExp577);i=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},innerBlock_return:function(){FormulaParser.innerBlock_return=function(){};org.antlr.lang.extend(FormulaParser.innerBlock_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),innerBlock:function(){var t=new FormulaParser.innerBlock_return;t.start=this.input.LT(1);var r=null,a=null,o=null,h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),c=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression");try{t:for(;;){var p=2,v=this.input.LA(1);(38==v||42==v||v==n||v==i||v>=63&&v<=65||v>=68&&v<=s||v==l||v==u||v>=d&&v<=m||v==f||v>=g&&v<=_||113==v)&&(p=1);switch(p){case 1:this.pushFollow(FormulaParser.FOLLOW_expression_in_innerBlock590);o=this.expression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&c.add(o.getTree());var S=0;e:for(;;){var N=2;this.input.LA(1)==e&&(N=1);switch(N){case 1:a=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_innerBlock594);if(this.state.failed)return t;0===this.state.backtracking&&h.add(a);break;default:if(S>=1)break e;if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.EarlyExitException(6,this.input)}S++}break;default:break t}}if(0===this.state.backtracking){t.tree=r;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);r=this.adaptor.nil();var E=this.adaptor.nil();E=this.adaptor.becomeRoot(this.adaptor.create(14,"LINES"),E);if(!c.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;c.hasNext();)this.adaptor.addChild(E,c.nextTree());c.reset();this.adaptor.addChild(r,E);t.tree=r}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(r);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},whileLoop_return:function(){FormulaParser.whileLoop_return=function(){};org.antlr.lang.extend(FormulaParser.whileLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),whileLoop:function(){var t=new FormulaParser.whileLoop_return;t.start=this.input.LT(1);var n=null,i=null,a=null,s=null,o=null,l=null,u=null,h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),c=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),d=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LOOPSTATEMENT"),m=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token WHILESTATEMENT"),f=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),p=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{i=this.match(this.input,38,FormulaParser.FOLLOW_WHILESTATEMENT_in_whileLoop619);if(this.state.failed)return t;0===this.state.backtracking&&m.add(i);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_whileLoop621);l=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&p.add(l.getTree());var g=0;t:for(;;){var _=2;this.input.LA(1)==e&&(_=1);switch(_){case 1:a=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_whileLoop623);if(this.state.failed)return t;0===this.state.backtracking&&h.add(a);break;default:if(g>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.EarlyExitException(8,this.input)}g++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_whileLoop626);u=this.innerBlock();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&f.add(u.getTree());s=this.match(this.input,r,FormulaParser.FOLLOW_ENDBLOCK_in_whileLoop629);if(this.state.failed)return t;0===this.state.backtracking&&c.add(s);o=this.match(this.input,53,FormulaParser.FOLLOW_LOOPSTATEMENT_in_whileLoop631);if(this.state.failed)return t;0===this.state.backtracking&&d.add(o);if(0===this.state.backtracking){t.tree=n;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);n=this.adaptor.nil();var v=this.adaptor.nil();v=this.adaptor.becomeRoot(this.adaptor.create(15,"WHILE"),v);this.adaptor.addChild(v,p.nextTree());this.adaptor.addChild(v,f.nextTree());this.adaptor.addChild(n,v);t.tree=n}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(n);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},forLoop_return:function(){FormulaParser.forLoop_return=function(){};org.antlr.lang.extend(FormulaParser.forLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),forLoop:function(){var n=new FormulaParser.forLoop_return;n.start=this.input.LT(1);var i=null,a=null,o=null,l=null,u=null,h=null,c=null,d=null,m=null,f=null,p=null,g=null,_=null,v=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FORSTATEMENT"),S=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),N=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FROMSTATEMENT"),E=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),T=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token TOSTATEMENT"),F=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),b=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LOOPSTATEMENT"),L=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token BYSTATEMENT"),w=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),k=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{a=this.match(this.input,42,FormulaParser.FOLLOW_FORSTATEMENT_in_forLoop652);if(this.state.failed)return n;0===this.state.backtracking&&v.add(a);o=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_forLoop654);if(this.state.failed)return n;0===this.state.backtracking&&S.add(o);l=this.match(this.input,44,FormulaParser.FOLLOW_FROMSTATEMENT_in_forLoop656);if(this.state.failed)return n;0===this.state.backtracking&&N.add(l);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop658);f=this.logicalExpression();this.state._fsp--;if(this.state.failed)return n;0===this.state.backtracking&&k.add(f.getTree());u=this.match(this.input,48,FormulaParser.FOLLOW_TOSTATEMENT_in_forLoop660);if(this.state.failed)return n;0===this.state.backtracking&&T.add(u);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop662);p=this.logicalExpression();this.state._fsp--;if(this.state.failed)return n;0===this.state.backtracking&&k.add(p.getTree());var O=2;51==this.input.LA(1)&&(O=1);switch(O){case 1:h=this.match(this.input,51,FormulaParser.FOLLOW_BYSTATEMENT_in_forLoop665);if(this.state.failed)return n;0===this.state.backtracking&&L.add(h);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop667);g=this.logicalExpression();this.state._fsp--;if(this.state.failed)return n;0===this.state.backtracking&&k.add(g.getTree())}var x=0;t:for(;;){var y=2;this.input.LA(1)==e&&(y=1);switch(y){case 1:c=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_forLoop671);if(this.state.failed)return n;0===this.state.backtracking&&E.add(c);break;default:if(x>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return n}throw new org.antlr.runtime.EarlyExitException(10,this.input)}x++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_forLoop674);_=this.innerBlock();this.state._fsp--;if(this.state.failed)return n;0===this.state.backtracking&&w.add(_.getTree());d=this.match(this.input,r,FormulaParser.FOLLOW_ENDBLOCK_in_forLoop677);if(this.state.failed)return n;0===this.state.backtracking&&F.add(d);m=this.match(this.input,53,FormulaParser.FOLLOW_LOOPSTATEMENT_in_forLoop679);if(this.state.failed)return n;0===this.state.backtracking&&b.add(m);if(0===this.state.backtracking){n.tree=i;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=n?n.tree:null);i=this.adaptor.nil();var A=this.adaptor.nil();A=this.adaptor.becomeRoot(this.adaptor.create(18,"FOR"),A);this.adaptor.addChild(A,S.nextNode());var R=this.adaptor.nil();R=this.adaptor.becomeRoot(this.adaptor.create(t,"PARAMS"),R);for(;k.hasNext();)this.adaptor.addChild(R,k.nextTree());k.reset();this.adaptor.addChild(A,R);this.adaptor.addChild(A,w.nextTree());this.adaptor.addChild(i,A);n.tree=i}n.stop=this.input.LT(-1);if(0===this.state.backtracking){n.tree=this.adaptor.rulePostProcessing(i);this.adaptor.setTokenBoundaries(n.tree,n.start,n.stop)}}catch(t){if(!(t instanceof org.antlr.runtime.RecognitionException))throw t;this.reportError(t);this.recover(this.input,t);n.tree=this.adaptor.errorNode(this.input,n.start,this.input.LT(-1),t)}return n},forInLoop_return:function(){FormulaParser.forInLoop_return=function(){};org.antlr.lang.extend(FormulaParser.forInLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),forInLoop:function(){var t=new FormulaParser.forInLoop_return;t.start=this.input.LT(1);var n=null,i=null,a=null,o=null,l=null,u=null,h=null,c=null,d=null,m=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FORSTATEMENT"),f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),p=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),g=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),_=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LOOPSTATEMENT"),v=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token INSTATEMENT"),S=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),N=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{i=this.match(this.input,42,FormulaParser.FOLLOW_FORSTATEMENT_in_forInLoop707);if(this.state.failed)return t;0===this.state.backtracking&&m.add(i);a=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_forInLoop709);if(this.state.failed)return t;0===this.state.backtracking&&f.add(a);o=this.match(this.input,46,FormulaParser.FOLLOW_INSTATEMENT_in_forInLoop711);if(this.state.failed)return t;0===this.state.backtracking&&v.add(o);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forInLoop713);c=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&N.add(c.getTree());var E=0;t:for(;;){var T=2;this.input.LA(1)==e&&(T=1);switch(T){case 1:l=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_forInLoop715);if(this.state.failed)return t;0===this.state.backtracking&&p.add(l);break;default:if(E>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.EarlyExitException(11,this.input)}E++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_forInLoop718);d=this.innerBlock();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&S.add(d.getTree());u=this.match(this.input,r,FormulaParser.FOLLOW_ENDBLOCK_in_forInLoop721);if(this.state.failed)return t;0===this.state.backtracking&&g.add(u);h=this.match(this.input,53,FormulaParser.FOLLOW_LOOPSTATEMENT_in_forInLoop723);if(this.state.failed)return t;0===this.state.backtracking&&_.add(h);if(0===this.state.backtracking){t.tree=n;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);n=this.adaptor.nil();var F=this.adaptor.nil();F=this.adaptor.becomeRoot(this.adaptor.create(19,"FORIN"),F);this.adaptor.addChild(F,f.nextNode());this.adaptor.addChild(F,N.nextTree());this.adaptor.addChild(F,S.nextTree());this.adaptor.addChild(n,F);t.tree=n}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(n);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},ifThenElse_return:function(){FormulaParser.ifThenElse_return=function(){};org.antlr.lang.extend(FormulaParser.ifThenElse_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),ifThenElse:function(){var i=new FormulaParser.ifThenElse_return;i.start=this.input.LT(1);var a=null,s=null,o=null,l=null,u=null,h=null,c=null,d=null,m=null,f=null,p=null,g=null,_=null,v=null,S=null,N=null,E=null,T=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IFSTATEMENT"),F=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),b=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),L=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ELSESTATEMENT"),w=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token THENSTATEMENT"),k=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),O=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{s=this.match(this.input,n,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse748);if(this.state.failed)return i;0===this.state.backtracking&&T.add(s);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_ifThenElse750);_=this.logicalExpression();this.state._fsp--;if(this.state.failed)return i;0===this.state.backtracking&&O.add(_.getTree());o=this.match(this.input,55,FormulaParser.FOLLOW_THENSTATEMENT_in_ifThenElse752);if(this.state.failed)return i;0===this.state.backtracking&&w.add(o);var x=0;t:for(;;){var y=2;this.input.LA(1)==e&&(y=1);switch(y){case 1:l=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse755);if(this.state.failed)return i;0===this.state.backtracking&&F.add(l);break;default:if(x>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return i}throw new org.antlr.runtime.EarlyExitException(12,this.input)}x++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse758);v=this.innerBlock();this.state._fsp--;if(this.state.failed)return i;0===this.state.backtracking&&k.add(v.getTree());t:for(;;){var A=2;if(57==this.input.LA(1)){this.input.LA(2)==n&&(A=1)}switch(A){case 1:u=this.match(this.input,57,FormulaParser.FOLLOW_ELSESTATEMENT_in_ifThenElse762);if(this.state.failed)return i;0===this.state.backtracking&&L.add(u);h=this.match(this.input,n,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse764);if(this.state.failed)return i;0===this.state.backtracking&&T.add(h);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_ifThenElse766);S=this.logicalExpression();this.state._fsp--;if(this.state.failed)return i;0===this.state.backtracking&&O.add(S.getTree());c=this.match(this.input,55,FormulaParser.FOLLOW_THENSTATEMENT_in_ifThenElse768);if(this.state.failed)return i;0===this.state.backtracking&&w.add(c);var R=0;e:for(;;){var P=2;this.input.LA(1)==e&&(P=1);switch(P){case 1:d=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse770);if(this.state.failed)return i;0===this.state.backtracking&&F.add(d);break;default:if(R>=1)break e;if(this.state.backtracking>0){this.state.failed=!0;return i}throw new org.antlr.runtime.EarlyExitException(13,this.input)}R++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse773);N=this.innerBlock();this.state._fsp--;if(this.state.failed)return i;0===this.state.backtracking&&k.add(N.getTree());break;default:break t}}var C=2;57==this.input.LA(1)&&(C=1);switch(C){case 1:m=this.match(this.input,57,FormulaParser.FOLLOW_ELSESTATEMENT_in_ifThenElse778);if(this.state.failed)return i;0===this.state.backtracking&&L.add(m);var M=0;t:for(;;){var I=2;this.input.LA(1)==e&&(I=1);switch(I){case 1:f=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse780);if(this.state.failed)return i;0===this.state.backtracking&&F.add(f);break;default:if(M>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return i}throw new org.antlr.runtime.EarlyExitException(15,this.input)}M++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse783);E=this.innerBlock();this.state._fsp--;if(this.state.failed)return i;0===this.state.backtracking&&k.add(E.getTree())}p=this.match(this.input,r,FormulaParser.FOLLOW_ENDBLOCK_in_ifThenElse787);if(this.state.failed)return i;0===this.state.backtracking&&b.add(p);g=this.match(this.input,n,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse789);if(this.state.failed)return i;0===this.state.backtracking&&T.add(g);if(0===this.state.backtracking){i.tree=a;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=i?i.tree:null);a=this.adaptor.nil();var B=this.adaptor.nil();B=this.adaptor.becomeRoot(this.adaptor.create(16,"IFTHENELSE"),B);var D=this.adaptor.nil();D=this.adaptor.becomeRoot(this.adaptor.create(t,"PARAMS"),D);if(!O.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;O.hasNext();)this.adaptor.addChild(D,O.nextTree());O.reset();this.adaptor.addChild(B,D);D=this.adaptor.nil();D=this.adaptor.becomeRoot(this.adaptor.create(t,"PARAMS"),D);if(!k.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;k.hasNext();)this.adaptor.addChild(D,k.nextTree());k.reset();this.adaptor.addChild(B,D);this.adaptor.addChild(a,B);i.tree=a}i.stop=this.input.LT(-1);if(0===this.state.backtracking){i.tree=this.adaptor.rulePostProcessing(a);this.adaptor.setTokenBoundaries(i.tree,i.start,i.stop)}}catch(t){if(!(t instanceof org.antlr.runtime.RecognitionException))throw t;this.reportError(t);this.recover(this.input,t);i.tree=this.adaptor.errorNode(this.input,i.start,this.input.LT(-1),t)}return i},functionDef_return:function(){FormulaParser.functionDef_return=function(){};org.antlr.lang.extend(FormulaParser.functionDef_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),functionDef:function(){var n=new FormulaParser.functionDef_return;n.start=this.input.LT(1);var a=null,l=null,u=null,h=null,c=null,d=null,m=null,f=null,g=null,_=null,v=null,S=null,N=null,E=null,T=null,F=null,b=null,L=null,w=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FUNCTIONSTATEMENT"),k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),O=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),x=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),y=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),R=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),P=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),C=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),M=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue");try{l=this.match(this.input,i,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_functionDef820);if(this.state.failed)return n;0===this.state.backtracking&&w.add(l);u=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_functionDef822);if(this.state.failed)return n;0===this.state.backtracking&&O.add(u);h=this.match(this.input,113,FormulaParser.FOLLOW_113_in_functionDef824);if(this.state.failed)return n;0===this.state.backtracking&&y.add(h);var I=2;this.input.LA(1)==s&&(I=1);switch(I){case 1:c=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_functionDef827);if(this.state.failed)return n;0===this.state.backtracking&&O.add(c);var B=2,D=this.input.LA(1);if(D==o)B=1;else{if(D!=p&&114!=D){if(this.state.backtracking>0){this.state.failed=!0;return n}throw new org.antlr.runtime.NoViableAltException("",18,0,this.input)}B=2}switch(B){case 1:d=this.match(this.input,o,FormulaParser.FOLLOW_EQUALS_in_functionDef831);if(this.state.failed)return n;0===this.state.backtracking&&x.add(d);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_functionDef834);F=this.defaultValue();this.state._fsp--;if(this.state.failed)return n;0===this.state.backtracking&&M.add(F.getTree());break;case 2:t:for(;;){var V=2;if(this.input.LA(1)==p){if(this.input.LA(2)==s){var W=this.input.LA(3);W!=p&&114!=W||(V=1)}}switch(V){case 1:m=this.match(this.input,p,FormulaParser.FOLLOW_COMMA_in_functionDef839);if(this.state.failed)return n;0===this.state.backtracking&&R.add(m);f=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_functionDef841);if(this.state.failed)return n;0===this.state.backtracking&&O.add(f);break;default:break t}}}t:for(;;){var U=2;this.input.LA(1)==p&&(U=1);switch(U){case 1:g=this.match(this.input,p,FormulaParser.FOLLOW_COMMA_in_functionDef848);if(this.state.failed)return n;0===this.state.backtracking&&R.add(g);_=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_functionDef850);if(this.state.failed)return n;0===this.state.backtracking&&O.add(_);v=this.match(this.input,o,FormulaParser.FOLLOW_EQUALS_in_functionDef852);if(this.state.failed)return n;0===this.state.backtracking&&x.add(v);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_functionDef854);b=this.defaultValue();this.state._fsp--;if(this.state.failed)return n;0===this.state.backtracking&&M.add(b.getTree());break;default:break t}}}S=this.match(this.input,114,FormulaParser.FOLLOW_114_in_functionDef861);if(this.state.failed)return n;0===this.state.backtracking&&k.add(S);var G=0;t:for(;;){var j=2;this.input.LA(1)==e&&(j=1);switch(j){case 1:N=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_functionDef863);if(this.state.failed)return n;0===this.state.backtracking&&A.add(N);break;default:if(G>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return n}throw new org.antlr.runtime.EarlyExitException(21,this.input)}G++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_functionDef866);L=this.innerBlock();this.state._fsp--;if(this.state.failed)return n;0===this.state.backtracking&&C.add(L.getTree());E=this.match(this.input,r,FormulaParser.FOLLOW_ENDBLOCK_in_functionDef869);if(this.state.failed)return n;0===this.state.backtracking&&P.add(E);T=this.match(this.input,i,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_functionDef871);if(this.state.failed)return n;0===this.state.backtracking&&w.add(T);if(0===this.state.backtracking){n.tree=a;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=n?n.tree:null);a=this.adaptor.nil();var q=this.adaptor.nil();q=this.adaptor.becomeRoot(this.adaptor.create(20,"FUNCTION"),q);var z=this.adaptor.nil();z=this.adaptor.becomeRoot(this.adaptor.create(t,"PARAMS"),z);for(;O.hasNext();)this.adaptor.addChild(z,O.nextNode());O.reset();this.adaptor.addChild(q,z);z=this.adaptor.nil();z=this.adaptor.becomeRoot(this.adaptor.create(10,"DEFAULTS"),z);for(;M.hasNext();)this.adaptor.addChild(z,M.nextTree());M.reset();this.adaptor.addChild(q,z);this.adaptor.addChild(q,C.nextTree());this.adaptor.addChild(a,q);n.tree=a}n.stop=this.input.LT(-1);if(0===this.state.backtracking){n.tree=this.adaptor.rulePostProcessing(a);this.adaptor.setTokenBoundaries(n.tree,n.start,n.stop)}}catch(t){if(!(t instanceof org.antlr.runtime.RecognitionException))throw t;this.reportError(t);this.recover(this.input,t);n.tree=this.adaptor.errorNode(this.input,n.start,this.input.LT(-1),t)}return n},tryCatch_return:function(){FormulaParser.tryCatch_return=function(){};org.antlr.lang.extend(FormulaParser.tryCatch_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),tryCatch:function(){var t=new FormulaParser.tryCatch_return;t.start=this.input.LT(1);var n=null,i=null,a=null,o=null,l=null,u=null,h=null,c=null,d=null,m=null,f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),p=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token TRYSTATEMENT"),g=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),_=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token CATCHSTATEMENT"),v=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),S=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock");try{i=this.match(this.input,65,FormulaParser.FOLLOW_TRYSTATEMENT_in_tryCatch904);if(this.state.failed)return t;0===this.state.backtracking&&p.add(i);var N=0;t:for(;;){var E=2;this.input.LA(1)==e&&(E=1);switch(E){case 1:a=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_tryCatch906);if(this.state.failed)return t;0===this.state.backtracking&&g.add(a);break;default:if(N>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.EarlyExitException(22,this.input)}N++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_tryCatch909);d=this.innerBlock();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&S.add(d.getTree());o=this.match(this.input,67,FormulaParser.FOLLOW_CATCHSTATEMENT_in_tryCatch911);if(this.state.failed)return t;0===this.state.backtracking&&_.add(o);l=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_tryCatch913);if(this.state.failed)return t;0===this.state.backtracking&&f.add(l);var T=0;t:for(;;){var F=2;this.input.LA(1)==e&&(F=1);switch(F){case 1:u=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_tryCatch915);if(this.state.failed)return t;0===this.state.backtracking&&g.add(u);break;default:if(T>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.EarlyExitException(23,this.input)}T++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_tryCatch919);m=this.innerBlock();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&S.add(m.getTree());h=this.match(this.input,r,FormulaParser.FOLLOW_ENDBLOCK_in_tryCatch921);if(this.state.failed)return t;0===this.state.backtracking&&v.add(h);c=this.match(this.input,65,FormulaParser.FOLLOW_TRYSTATEMENT_in_tryCatch923);if(this.state.failed)return t;0===this.state.backtracking&&p.add(c);if(0===this.state.backtracking){t.tree=n;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);n=this.adaptor.nil();var b=this.adaptor.nil();b=this.adaptor.becomeRoot(this.adaptor.create(30,"TRYCATCH"),b);for(;S.hasNext();)this.adaptor.addChild(b,S.nextTree());S.reset();this.adaptor.addChild(b,f.nextNode());this.adaptor.addChild(n,b);t.tree=n}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(n);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},throwExp_return:function(){FormulaParser.throwExp_return=function(){};org.antlr.lang.extend(FormulaParser.throwExp_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),throwExp:function(){var t=new FormulaParser.throwExp_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token THROWSTATEMENT"),a=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule primaryExpression");try{n=this.match(this.input,68,FormulaParser.FOLLOW_THROWSTATEMENT_in_throwExp945);if(this.state.failed)return t;0===this.state.backtracking&&r.add(n);this.pushFollow(FormulaParser.FOLLOW_primaryExpression_in_throwExp947);i=this.primaryExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&a.add(i.getTree());if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var s=this.adaptor.nil();s=this.adaptor.becomeRoot(this.adaptor.create(31,"THROW"),s);this.adaptor.addChild(s,a.nextTree());this.adaptor.addChild(e,s);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},anonFunctionDef_return:function(){FormulaParser.anonFunctionDef_return=function(){};org.antlr.lang.extend(FormulaParser.anonFunctionDef_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),anonFunctionDef:function(){var a=new FormulaParser.anonFunctionDef_return;a.start=this.input.LT(1);var h=null,c=null,v=null,S=null,N=null,E=null,T=null,F=null,b=null,L=null,w=null,k=null,O=null,x=null,y=null,A=null,R=null,P=null,C=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FUNCTIONSTATEMENT"),M=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),I=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),B=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),D=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),V=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),W=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),U=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),G=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression"),j=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),q=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue");try{c=this.match(this.input,i,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef967);if(this.state.failed)return a;0===this.state.backtracking&&C.add(c);v=this.match(this.input,113,FormulaParser.FOLLOW_113_in_anonFunctionDef970);if(this.state.failed)return a;0===this.state.backtracking&&D.add(v);var z=2;this.input.LA(1)==s&&(z=1);switch(z){case 1:S=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef973);if(this.state.failed)return a;0===this.state.backtracking&&I.add(S);var H=2,K=this.input.LA(1);if(K==o)H=1;else{if(K!=p&&114!=K){if(this.state.backtracking>0){this.state.failed=!0;return a}throw new org.antlr.runtime.NoViableAltException("",25,0,this.input)}H=2}switch(H){case 1:N=this.match(this.input,o,FormulaParser.FOLLOW_EQUALS_in_anonFunctionDef977);if(this.state.failed)return a;0===this.state.backtracking&&B.add(N);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_anonFunctionDef980);y=this.defaultValue();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&q.add(y.getTree());break;case 2:t:for(;;){var Q=2;if(this.input.LA(1)==p){if(this.input.LA(2)==s){var Y=this.input.LA(3);Y!=p&&114!=Y||(Q=1)}}switch(Q){case 1:E=this.match(this.input,p,FormulaParser.FOLLOW_COMMA_in_anonFunctionDef985);if(this.state.failed)return a;0===this.state.backtracking&&W.add(E);T=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef987);if(this.state.failed)return a;0===this.state.backtracking&&I.add(T);break;default:break t}}}t:for(;;){var X=2;this.input.LA(1)==p&&(X=1);switch(X){case 1:F=this.match(this.input,p,FormulaParser.FOLLOW_COMMA_in_anonFunctionDef994);if(this.state.failed)return a;0===this.state.backtracking&&W.add(F);b=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef996);if(this.state.failed)return a;0===this.state.backtracking&&I.add(b);L=this.match(this.input,o,FormulaParser.FOLLOW_EQUALS_in_anonFunctionDef998);if(this.state.failed)return a;0===this.state.backtracking&&B.add(L);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_anonFunctionDef1000);A=this.defaultValue();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&q.add(A.getTree());break;default:break t}}}w=this.match(this.input,114,FormulaParser.FOLLOW_114_in_anonFunctionDef1007);if(this.state.failed)return a;0===this.state.backtracking&&M.add(w);var Z=2,J=this.input.LA(1);if(J==e)Z=1;else{if(!(38==J||42==J||J==n||J==i||J>=63&&J<=65||J>=68&&J<=s||J==l||J==u||J>=d&&J<=m||J==f||J>=g&&J<=_||113==J)){if(this.state.backtracking>0){this.state.failed=!0;return a}throw new org.antlr.runtime.NoViableAltException("",29,0,this.input)}Z=2}switch(Z){case 1:var $=0;t:for(;;){var tt=2;this.input.LA(1)==e&&(tt=1);switch(tt){case 1:k=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_anonFunctionDef1012);if(this.state.failed)return a;0===this.state.backtracking&&V.add(k);break;default:if($>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return a}throw new org.antlr.runtime.EarlyExitException(28,this.input)}$++}this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_anonFunctionDef1015);R=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&j.add(R.getTree());O=this.match(this.input,r,FormulaParser.FOLLOW_ENDBLOCK_in_anonFunctionDef1018);if(this.state.failed)return a;0===this.state.backtracking&&U.add(O);x=this.match(this.input,i,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef1020);if(this.state.failed)return a;0===this.state.backtracking&&C.add(x);break;case 2:this.pushFollow(FormulaParser.FOLLOW_expression_in_anonFunctionDef1025);P=this.expression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&G.add(P.getTree())}if(0===this.state.backtracking){a.tree=h;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);h=this.adaptor.nil();var et=this.adaptor.nil();et=this.adaptor.becomeRoot(this.adaptor.create(21,"ANONFUNCTION"),et);var nt=this.adaptor.nil();nt=this.adaptor.becomeRoot(this.adaptor.create(t,"PARAMS"),nt);for(;I.hasNext();)this.adaptor.addChild(nt,I.nextNode());I.reset();this.adaptor.addChild(et,nt);nt=this.adaptor.nil();nt=this.adaptor.becomeRoot(this.adaptor.create(10,"DEFAULTS"),nt);for(;q.hasNext();)this.adaptor.addChild(nt,q.nextTree());q.reset();this.adaptor.addChild(et,nt);j.hasNext()&&this.adaptor.addChild(et,j.nextTree());j.reset();G.hasNext()&&this.adaptor.addChild(et,G.nextTree());G.reset();this.adaptor.addChild(h,et);a.tree=h}a.stop=this.input.LT(-1);if(0===this.state.backtracking){a.tree=this.adaptor.rulePostProcessing(h);this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop)}}catch(t){if(!(t instanceof org.antlr.runtime.RecognitionException))throw t;this.reportError(t);this.recover(this.input,t);a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),t)}return a},assignment_return:function(){FormulaParser.assignment_return=function(){};org.antlr.lang.extend(FormulaParser.assignment_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),assignment:function(){var e=new FormulaParser.assignment_return;e.start=this.input.LT(1);var n=null,i=null,r=null,a=null,u=null,h=null,c=null,d=null,g=null,_=null,v=null,S=null,N=null,E=null,T=null,F=null,b=null,L=null,w=null,k=null,O=null,x=null,y=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),R=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 115"),P=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),C=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),M=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),I=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token PRIMITIVE"),B=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule assigned"),D=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue"),V=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{var W=2,U=this.input.LA(1);if(U==s){var G=this.input.LA(2);if(113==G)W=1;else{if(!(G==m||G==f||G==p||G>=115&&G<=116)){if(this.state.backtracking>0){this.state.failed=!0;return e}throw new org.antlr.runtime.NoViableAltException("",37,1,this.input)}W=2}}else{if(U!=l){if(this.state.backtracking>0){this.state.failed=!0;return e}throw new org.antlr.runtime.NoViableAltException("",37,0,this.input)}W=2}switch(W){case 1:i=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_assignment1067);if(this.state.failed)return e;0===this.state.backtracking&&A.add(i);r=this.match(this.input,113,FormulaParser.FOLLOW_113_in_assignment1069);if(this.state.failed)return e;0===this.state.backtracking&&C.add(r);var j=2;this.input.LA(1)==s&&(j=1);switch(j){case 1:a=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_assignment1072);if(this.state.failed)return e;0===this.state.backtracking&&A.add(a);var q=2,z=this.input.LA(1);if(z==o)q=1;else{if(z!=p&&114!=z){if(this.state.backtracking>0){this.state.failed=!0;return e}throw new org.antlr.runtime.NoViableAltException("",31,0,this.input)}q=2}switch(q){case 1:u=this.match(this.input,o,FormulaParser.FOLLOW_EQUALS_in_assignment1076);if(this.state.failed)return e;0===this.state.backtracking&&P.add(u);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_assignment1078);b=this.defaultValue();this.state._fsp--;if(this.state.failed)return e;0===this.state.backtracking&&D.add(b.getTree());break;case 2:t:for(;;){var H=2;if(this.input.LA(1)==p){if(this.input.LA(2)==s){var K=this.input.LA(3);K!=p&&114!=K||(H=1)}}switch(H){case 1:h=this.match(this.input,p,FormulaParser.FOLLOW_COMMA_in_assignment1083);if(this.state.failed)return e;0===this.state.backtracking&&M.add(h);c=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_assignment1085);if(this.state.failed)return e;0===this.state.backtracking&&A.add(c);break;default:break t}}}t:for(;;){var Q=2;this.input.LA(1)==p&&(Q=1);switch(Q){case 1:d=this.match(this.input,p,FormulaParser.FOLLOW_COMMA_in_assignment1092);if(this.state.failed)return e;0===this.state.backtracking&&M.add(d);g=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_assignment1094);if(this.state.failed)return e;0===this.state.backtracking&&A.add(g);_=this.match(this.input,o,FormulaParser.FOLLOW_EQUALS_in_assignment1096);if(this.state.failed)return e;0===this.state.backtracking&&P.add(_);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_assignment1098);L=this.defaultValue();this.state._fsp--;if(this.state.failed)return e;0===this.state.backtracking&&D.add(L.getTree());break;default:break t}}}v=this.match(this.input,114,FormulaParser.FOLLOW_114_in_assignment1105);if(this.state.failed)return e;0===this.state.backtracking&&y.add(v);S=this.match(this.input,115,FormulaParser.FOLLOW_115_in_assignment1107);if(this.state.failed)return e;0===this.state.backtracking&&R.add(S);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_assignment1109);w=this.logicalExpression();this.state._fsp--;if(this.state.failed)return e;0===this.state.backtracking&&V.add(w.getTree());if(0===this.state.backtracking){e.tree=n;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=e?e.tree:null);n=this.adaptor.nil();var Y=this.adaptor.nil();Y=this.adaptor.becomeRoot(this.adaptor.create(20,"FUNCTION"),Y);var X=this.adaptor.nil();X=this.adaptor.becomeRoot(this.adaptor.create(t,"PARAMS"),X);for(;A.hasNext();)this.adaptor.addChild(X,A.nextNode());A.reset();this.adaptor.addChild(Y,X);X=this.adaptor.nil();X=this.adaptor.becomeRoot(this.adaptor.create(10,"DEFAULTS"),X);for(;D.hasNext();)this.adaptor.addChild(X,D.nextTree());D.reset();this.adaptor.addChild(Y,X);this.adaptor.addChild(Y,V.nextTree());this.adaptor.addChild(n,Y);e.tree=n}break;case 2:var Z=2,J=this.input.LA(1);if(J==l)Z=1;else{if(J!=s){if(this.state.backtracking>0){this.state.failed=!0;return e}throw new org.antlr.runtime.NoViableAltException("",34,0,this.input)}Z=2}switch(Z){case 1:N=this.match(this.input,l,FormulaParser.FOLLOW_PRIMITIVE_in_assignment1137);if(this.state.failed)return e;0===this.state.backtracking&&I.add(N);break;case 2:this.pushFollow(FormulaParser.FOLLOW_assigned_in_assignment1141);k=this.assigned();this.state._fsp--;if(this.state.failed)return e;0===this.state.backtracking&&B.add(k.getTree())}t:for(;;){var $=2;this.input.LA(1)==p&&($=1);switch($){case 1:E=this.match(this.input,p,FormulaParser.FOLLOW_COMMA_in_assignment1145);if(this.state.failed)return e;0===this.state.backtracking&&M.add(E);var tt=2,et=this.input.LA(1);if(et==l)tt=1;else{if(et!=s){if(this.state.backtracking>0){this.state.failed=!0;return e}throw new org.antlr.runtime.NoViableAltException("",35,0,this.input)}tt=2}switch(tt){case 1:T=this.match(this.input,l,FormulaParser.FOLLOW_PRIMITIVE_in_assignment1148);if(this.state.failed)return e;0===this.state.backtracking&&I.add(T);break;case 2:this.pushFollow(FormulaParser.FOLLOW_assigned_in_assignment1152);O=this.assigned();this.state._fsp--;if(this.state.failed)return e;0===this.state.backtracking&&B.add(O.getTree())}break;default:break t}}F=this.match(this.input,115,FormulaParser.FOLLOW_115_in_assignment1158);if(this.state.failed)return e;0===this.state.backtracking&&R.add(F);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_assignment1160);x=this.logicalExpression();this.state._fsp--;if(this.state.failed)return e;0===this.state.backtracking&&V.add(x.getTree());if(0===this.state.backtracking){e.tree=n;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=e?e.tree:null);n=this.adaptor.nil();Y=this.adaptor.nil();Y=this.adaptor.becomeRoot(this.adaptor.create(5,"ASSIGN"),Y);for(;I.hasNext();)this.adaptor.addChild(Y,I.nextNode());I.reset();for(;B.hasNext();)this.adaptor.addChild(Y,B.nextTree());B.reset();this.adaptor.addChild(Y,V.nextTree());this.adaptor.addChild(n,Y);e.tree=n}}e.stop=this.input.LT(-1);if(0===this.state.backtracking){e.tree=this.adaptor.rulePostProcessing(n);this.adaptor.setTokenBoundaries(e.tree,e.start,e.stop)}}catch(t){if(!(t instanceof org.antlr.runtime.RecognitionException))throw t;this.reportError(t);this.recover(this.input,t);e.tree=this.adaptor.errorNode(this.input,e.start,this.input.LT(-1),t)}return e},assigned_return:function(){FormulaParser.assigned_return=function(){};org.antlr.lang.extend(FormulaParser.assigned_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),assigned:function(){var t=new FormulaParser.assigned_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),a=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule selector");try{n=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_assigned1186);if(this.state.failed)return t;0===this.state.backtracking&&r.add(n);var o=2,l=this.input.LA(1);l!=m&&l!=f&&116!=l||(o=1);switch(o){case 1:this.pushFollow(FormulaParser.FOLLOW_selector_in_assigned1188);i=this.selector();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&a.add(i.getTree())}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var u=this.adaptor.nil();u=this.adaptor.becomeRoot(this.adaptor.create(26,"ASSIGNED"),u);this.adaptor.addChild(u,r.nextNode());a.hasNext()&&this.adaptor.addChild(u,a.nextTree());a.reset();this.adaptor.addChild(e,u);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},logicalExpression_return:function(){FormulaParser.logicalExpression_return=function(){};org.antlr.lang.extend(FormulaParser.logicalExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),logicalExpression:function(){var t=new FormulaParser.logicalExpression_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null,a=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_logicalExpression1214);i=this.booleanXORExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());t:for(;;){var s=2;if(72==this.input.LA(1)){this.input.LA(2);this.synpred47_Formula()&&(s=1)}switch(s){case 1:n=this.match(this.input,72,FormulaParser.FOLLOW_OR_in_logicalExpression1217);if(this.state.failed)return t;if(0===this.state.backtracking){a=this.adaptor.create(n);e=this.adaptor.becomeRoot(a,e)}this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_logicalExpression1220);r=this.booleanXORExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},booleanXORExpression_return:function(){FormulaParser.booleanXORExpression_return=function(){};org.antlr.lang.extend(FormulaParser.booleanXORExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),booleanXORExpression:function(){var t=new FormulaParser.booleanXORExpression_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null,a=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_booleanXORExpression1250);i=this.booleanAndExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());t:for(;;){var s=2;if(73==this.input.LA(1)){this.input.LA(2);this.synpred48_Formula()&&(s=1)}switch(s){case 1:n=this.match(this.input,73,FormulaParser.FOLLOW_XOR_in_booleanXORExpression1253);if(this.state.failed)return t;if(0===this.state.backtracking){a=this.adaptor.create(n);e=this.adaptor.becomeRoot(a,e)}this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_booleanXORExpression1256);r=this.booleanAndExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},booleanAndExpression_return:function(){FormulaParser.booleanAndExpression_return=function(){};org.antlr.lang.extend(FormulaParser.booleanAndExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),booleanAndExpression:function(){var t=new FormulaParser.booleanAndExpression_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null,a=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_booleanAndExpression1285);i=this.equalityExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());t:for(;;){var s=2;if(75==this.input.LA(1)){this.input.LA(2);this.synpred49_Formula()&&(s=1)}switch(s){case 1:n=this.match(this.input,75,FormulaParser.FOLLOW_AND_in_booleanAndExpression1288);if(this.state.failed)return t;if(0===this.state.backtracking){a=this.adaptor.create(n);e=this.adaptor.becomeRoot(a,e)}this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_booleanAndExpression1291);r=this.equalityExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},equalityExpression_return:function(){FormulaParser.equalityExpression_return=function(){};org.antlr.lang.extend(FormulaParser.equalityExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),equalityExpression:function(){var t=new FormulaParser.equalityExpression_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_equalityExpression1322);i=this.relationalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());t:for(;;){var a=2,s=this.input.LA(1);if(s==o||76==s){this.input.LA(2);this.synpred51_Formula()&&(a=1)}switch(a){case 1:n=this.input.LT(1);if(this.input.LA(1)!=o&&76!=this.input.LA(1)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&(e=this.adaptor.becomeRoot(this.adaptor.create(n),e));this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_equalityExpression1332);r=this.relationalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},relationalExpression_return:function(){FormulaParser.relationalExpression_return=function(){};org.antlr.lang.extend(FormulaParser.relationalExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),relationalExpression:function(){var t=new FormulaParser.relationalExpression_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_relationalExpression1374);i=this.additiveExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());t:for(;;){var a=2,s=this.input.LA(1);if(s>=77&&s<=80){this.input.LA(2);this.synpred55_Formula()&&(a=1)}switch(a){case 1:n=this.input.LT(1);if(!(this.input.LA(1)>=77&&this.input.LA(1)<=80)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&(e=this.adaptor.becomeRoot(this.adaptor.create(n),e));this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_relationalExpression1389);r=this.additiveExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},additiveExpression_return:function(){FormulaParser.additiveExpression_return=function(){};org.antlr.lang.extend(FormulaParser.additiveExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),additiveExpression:function(){var t=new FormulaParser.additiveExpression_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_additiveExpression1432);i=this.multiplicativeExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());t:for(;;){var a=2,s=this.input.LA(1);if(s>=81&&s<=u){this.input.LA(2);this.synpred57_Formula()&&(a=1)}switch(a){case 1:n=this.input.LT(1);if(!(this.input.LA(1)>=81&&this.input.LA(1)<=u)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&(e=this.adaptor.becomeRoot(this.adaptor.create(n),e));this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_additiveExpression1443);r=this.multiplicativeExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},multiplicativeExpression_return:function(){FormulaParser.multiplicativeExpression_return=function(){};org.antlr.lang.extend(FormulaParser.multiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),multiplicativeExpression:function(){var t=new FormulaParser.multiplicativeExpression_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_multiplicativeExpression1473);i=this.arrayExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());t:for(;;){var a=2,s=this.input.LA(1);if(s>=h&&s<=85){this.input.LA(2);this.synpred60_Formula()&&(a=1)}switch(a){case 1:n=this.input.LT(1);if(!(this.input.LA(1)>=h&&this.input.LA(1)<=85)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&(e=this.adaptor.becomeRoot(this.adaptor.create(n),e));this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_multiplicativeExpression1486);r=this.arrayExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},arrayExpression_return:function(){FormulaParser.arrayExpression_return=function(){};org.antlr.lang.extend(FormulaParser.arrayExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),arrayExpression:function(){var t=new FormulaParser.arrayExpression_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null,a=null,s=null,o=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COLON"),l=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule negationExpression");try{this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1532);r=this.negationExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&l.add(r.getTree());var u=2;if(this.input.LA(1)==c){this.input.LA(2);this.synpred61_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(u=1)}switch(u){case 1:if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "')}n=this.match(this.input,c,FormulaParser.FOLLOW_COLON_in_arrayExpression1538);if(this.state.failed)return t;0===this.state.backtracking&&o.add(n);if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "')}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1542);a=this.negationExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&l.add(a.getTree())}var h=2;if(this.input.LA(1)==c){this.input.LA(2);this.synpred62_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(h=1)}switch(h){case 1:if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "')}i=this.match(this.input,c,FormulaParser.FOLLOW_COLON_in_arrayExpression1551);if(this.state.failed)return t;0===this.state.backtracking&&o.add(i);if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "')}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1555);s=this.negationExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&l.add(s.getTree())}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var d=this.adaptor.nil();d=this.adaptor.becomeRoot(this.adaptor.create(24,"RANGE"),d);for(;l.hasNext();)this.adaptor.addChild(d,l.nextTree());l.reset();this.adaptor.addChild(e,d);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},negationExpression_return:function(){FormulaParser.negationExpression_return=function(){};org.antlr.lang.extend(FormulaParser.negationExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),negationExpression:function(){var t=new FormulaParser.negationExpression_return;t.start=this.input.LT(1);var e=null,n=null,r=null,o=null,h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),c=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule powerExpression");try{var p=2,v=this.input.LA(1);if(v==u)p=1;else{if(!(v==i||v==a||v==s||v==l||v>=d&&v<=m||v==f||v>=g&&v<=_||113==v)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",48,0,this.input)}p=2}switch(p){case 1:n=this.match(this.input,u,FormulaParser.FOLLOW_MINUS_in_negationExpression1580);if(this.state.failed)return t;0===this.state.backtracking&&h.add(n);this.pushFollow(FormulaParser.FOLLOW_powerExpression_in_negationExpression1582);r=this.powerExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&c.add(r.getTree());if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var S=this.adaptor.nil();S=this.adaptor.becomeRoot(this.adaptor.create(4,"NEGATE"),S);this.adaptor.addChild(S,c.nextTree());this.adaptor.addChild(e,S);t.tree=e}break;case 2:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_powerExpression_in_negationExpression1596);o=this.powerExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,o.getTree())}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},powerExpression_return:function(){FormulaParser.powerExpression_return=function(){};org.antlr.lang.extend(FormulaParser.powerExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),powerExpression:function(){var t=new FormulaParser.powerExpression_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null,a=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token POW"),s=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryOrNegate"),o=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryExpression");try{this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_powerExpression1607);i=this.unaryExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&o.add(i.getTree());t:for(;;){var l=2;if(87==this.input.LA(1)){this.input.LA(2);this.synpred64_Formula()&&(l=1)}switch(l){case 1:n=this.match(this.input,87,FormulaParser.FOLLOW_POW_in_powerExpression1610);if(this.state.failed)return t;0===this.state.backtracking&&a.add(n);this.pushFollow(FormulaParser.FOLLOW_unaryOrNegate_in_powerExpression1612);r=this.unaryOrNegate();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&s.add(r.getTree());break;default:break t}}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var u=this.adaptor.nil();u=this.adaptor.becomeRoot(this.adaptor.create(9,"POWER"),u);this.adaptor.addChild(u,o.nextTree());for(;s.hasNext();)this.adaptor.addChild(u,s.nextTree());s.reset();this.adaptor.addChild(e,u);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},unaryOrNegate_return:function(){FormulaParser.unaryOrNegate_return=function(){};org.antlr.lang.extend(FormulaParser.unaryOrNegate_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unaryOrNegate:function(){var t=new FormulaParser.unaryOrNegate_return;t.start=this.input.LT(1);var e=null,n=null,r=null,o=null,h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),c=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryExpression");try{var p=2,v=this.input.LA(1);if(v==i||v==a||v==s||v==l||v>=d&&v<=m||v==f||v>=g&&v<=_||113==v)p=1;else{if(v!=u){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",50,0,this.input)}p=2}switch(p){case 1:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_unaryOrNegate1639);r=this.unaryExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;case 2:n=this.match(this.input,u,FormulaParser.FOLLOW_MINUS_in_unaryOrNegate1645);if(this.state.failed)return t;0===this.state.backtracking&&h.add(n);this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_unaryOrNegate1647);o=this.unaryExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&c.add(o.getTree());if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var S=this.adaptor.nil();S=this.adaptor.becomeRoot(this.adaptor.create(4,"NEGATE"),S);this.adaptor.addChild(S,c.nextTree());this.adaptor.addChild(e,S);t.tree=e}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},unaryExpression_return:function(){FormulaParser.unaryExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unaryExpression:function(){var t=new FormulaParser.unaryExpression_return;t.start=this.input.LT(1);var e=null,n=null,r=null,o=null,u=null;try{var h=2,c=this.input.LA(1);if(c==d)h=1;else{if(!(c==i||c==a||c==s||c==l||c==m||c==f||c>=g&&c<=_||113==c)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",51,0,this.input)}h=2}switch(h){case 1:e=this.adaptor.nil();n=this.match(this.input,d,FormulaParser.FOLLOW_NOT_in_unaryExpression1675);if(this.state.failed)return t;if(0===this.state.backtracking){u=this.adaptor.create(n);e=this.adaptor.becomeRoot(u,e)}this.pushFollow(FormulaParser.FOLLOW_innerPrimaryExpression_in_unaryExpression1678);r=this.innerPrimaryExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;case 2:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_innerPrimaryExpression_in_unaryExpression1687);o=this.innerPrimaryExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,o.getTree())}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},innerPrimaryExpression_return:function(){FormulaParser.innerPrimaryExpression_return=function(){};org.antlr.lang.extend(FormulaParser.innerPrimaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),innerPrimaryExpression:function(){var t=new FormulaParser.innerPrimaryExpression_return;t.start=this.input.LT(1);var e=null,n=null,i=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule selectionExpression");try{this.pushFollow(FormulaParser.FOLLOW_selectionExpression_in_innerPrimaryExpression1718);n=this.selectionExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&i.add(n.getTree());if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var r=this.adaptor.nil();r=this.adaptor.becomeRoot(this.adaptor.create(25,"INNER"),r);this.adaptor.addChild(r,i.nextTree());this.adaptor.addChild(e,r);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},selectionExpression_return:function(){FormulaParser.selectionExpression_return=function(){};org.antlr.lang.extend(FormulaParser.selectionExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),selectionExpression:function(){var t=new FormulaParser.selectionExpression_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_primaryExpression_in_selectionExpression1738);n=this.primaryExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());t:for(;;){var a=2;switch(this.input.LA(1)){case m:this.input.LA(2);this.synpred68_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(a=1);break;case f:this.input.LA(2);this.synpred68_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(a=1);break;case 116:this.input.LA(2);this.synpred68_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(a=1);break;case 113:this.input.LA(2);this.synpred68_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(a=1)}switch(a){case 1:if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.FailedPredicateException(this.input,"selectionExpression",' this.input.get(this.input.index()-1).getText()!=" "')}var s=2,o=this.input.LA(1);if(o==m||o==f||116==o)s=1;else{if(113!=o){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",52,0,this.input)}s=2}switch(s){case 1:this.pushFollow(FormulaParser.FOLLOW_selector_in_selectionExpression1744);i=this.selector();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());break;case 2:this.pushFollow(FormulaParser.FOLLOW_funCall_in_selectionExpression1746);r=this.funCall();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree())}break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},funCall_return:function(){FormulaParser.funCall_return=function(){};org.antlr.lang.extend(FormulaParser.funCall_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),funCall:function(){var t=new FormulaParser.funCall_return;t.start=this.input.LT(1);var e=null,n=null,r=null,o=null,h=null,c=null,v=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),S=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),N=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),E=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{n=this.match(this.input,113,FormulaParser.FOLLOW_113_in_funCall1761);if(this.state.failed)return t;0===this.state.backtracking&&S.add(n);var T=2,F=this.input.LA(1);(F==i||F==a||F==s||F==l||F==u||F>=d&&F<=m||F==f||F>=g&&F<=_||113==F)&&(T=1);switch(T){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_funCall1765);h=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&E.add(h.getTree());t:for(;;){var b=2;this.input.LA(1)==p&&(b=1);switch(b){case 1:r=this.match(this.input,p,FormulaParser.FOLLOW_COMMA_in_funCall1768);if(this.state.failed)return t;0===this.state.backtracking&&N.add(r);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_funCall1770);c=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&E.add(c.getTree());break;default:break t}}}o=this.match(this.input,114,FormulaParser.FOLLOW_114_in_funCall1777);if(this.state.failed)return t;0===this.state.backtracking&&v.add(o);if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var L=this.adaptor.nil();L=this.adaptor.becomeRoot(this.adaptor.create(6,"FUNCALL"),L);for(;E.hasNext();)this.adaptor.addChild(L,E.nextTree());E.reset();this.adaptor.addChild(e,L);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},primaryExpression_return:function(){FormulaParser.primaryExpression_return=function(){};org.antlr.lang.extend(FormulaParser.primaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),primaryExpression:function(){var t=new FormulaParser.primaryExpression_return;t.start=this.input.LT(1);var e=null,n=null,r=null;try{var o=2,u=this.input.LA(1);if(113==u)o=1;else{if(!(u==i||u==a||u==s||u==l||u==m||u==f||u>=g&&u<=_)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",56,0,this.input)}o=2}switch(o){case 1:e=this.adaptor.nil();this.match(this.input,113,FormulaParser.FOLLOW_113_in_primaryExpression1798);if(this.state.failed)return t;this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_primaryExpression1801);n=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());this.match(this.input,114,FormulaParser.FOLLOW_114_in_primaryExpression1803);if(this.state.failed)return t;break;case 2:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_value_in_primaryExpression1809);r=this.value();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree())}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},value_return:function(){FormulaParser.value_return=function(){};org.antlr.lang.extend(FormulaParser.value_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),value:function(){var t=new FormulaParser.value_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null,a=null,o=null,l=null,u=null,h=null,c=null,d=null;try{switch(this.dfa57.predict(this.input)){case 1:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_number_in_value1823);i=this.number();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());break;case 2:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_bool_in_value1829);r=this.bool();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;case 3:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_string_in_value1835);a=this.string();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,a.getTree());break;case 4:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_material_in_value1841);o=this.material();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,o.getTree());break;case 5:e=this.adaptor.nil();n=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_value1846);if(this.state.failed)return t;if(0===this.state.backtracking){d=this.adaptor.create(n);this.adaptor.addChild(e,d)}break;case 6:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_primitive_in_value1851);l=this.primitive();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,l.getTree());break;case 7:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_array_in_value1856);u=this.array();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,u.getTree());break;case 8:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_anonFunctionDef_in_value1861);h=this.anonFunctionDef();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,h.getTree());break;case 9:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_newObject_in_value1866);c=this.newObject();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,c.getTree())}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},newObject_return:function(){FormulaParser.newObject_return=function(){};org.antlr.lang.extend(FormulaParser.newObject_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),newObject:function(){var t=new FormulaParser.newObject_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null,o=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWSTATEMENT"),u=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule funCall");try{n=this.match(this.input,a,FormulaParser.FOLLOW_NEWSTATEMENT_in_newObject1876);if(this.state.failed)return t;0===this.state.backtracking&&l.add(n);i=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_newObject1878);if(this.state.failed)return t;0===this.state.backtracking&&o.add(i);switch(this.dfa58.predict(this.input)){case 1:this.pushFollow(FormulaParser.FOLLOW_funCall_in_newObject1880);r=this.funCall();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&u.add(r.getTree())}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var h=this.adaptor.nil();h=this.adaptor.becomeRoot(this.adaptor.create(29,"NEW"),h);this.adaptor.addChild(h,o.nextNode());u.hasNext()&&this.adaptor.addChild(h,u.nextTree());u.reset();this.adaptor.addChild(e,h);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},defaultValue_return:function(){FormulaParser.defaultValue_return=function(){};org.antlr.lang.extend(FormulaParser.defaultValue_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),defaultValue:function(){var t=new FormulaParser.defaultValue_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null,a=null,s=null;try{var o=5;switch(this.input.LA(1)){case u:o=1;break;case 95:case 96:o=2;break;case 97:case _:o=3;break;case g:o=4;break;case m:case f:o=5;break;default:if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",59,0,this.input)}switch(o){case 1:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_negnumber_in_defaultValue1906);n=this.negnumber();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,n.getTree());break;case 2:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_number_in_defaultValue1912);i=this.number();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());break;case 3:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_bool_in_defaultValue1918);r=this.bool();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;case 4:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_string_in_defaultValue1924);a=this.string();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,a.getTree());break;case 5:e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_array_in_defaultValue1930);s=this.array();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,s.getTree())}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},array_return:function(){FormulaParser.array_return=function(){};org.antlr.lang.extend(FormulaParser.array_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),array:function(){var t=new FormulaParser.array_return;t.start=this.input.LT(1);var n=null,i=null,r=null,a=null,s=null,o=null,l=null,u=null,h=null,c=null,d=null,g=null,_=null,v=null,S=null,N=null,E=null,T=null,F=null,b=null,L=null,w=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LCURL"),k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),O=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RARR"),x=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),y=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LARR"),A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RCURL"),R=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule label");try{var P=2,C=this.input.LA(1);if(C==m)P=1;else{if(C!=f){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",74,0,this.input)}P=2}switch(P){case 1:i=this.match(this.input,m,FormulaParser.FOLLOW_LARR_in_array1944);if(this.state.failed)return t;0===this.state.backtracking&&y.add(i);t:for(;;){var M=2;if(this.input.LA(1)==e){this.input.LA(2);this.synpred85_Formula()&&(M=1)}switch(M){case 1:r=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array1946);if(this.state.failed)return t;0===this.state.backtracking&&k.add(r);break;default:break t}}switch(this.dfa65.predict(this.input)){case 1:this.pushFollow(FormulaParser.FOLLOW_label_in_array1950);T=this.label();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&R.add(T.getTree());t:for(;;){var I=2;if(this.input.LA(1)==e){this.input.LA(2);this.synpred86_Formula()&&(I=1)}switch(I){case 1:a=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array1952);if(this.state.failed)return t;0===this.state.backtracking&&k.add(a);break;default:break t}}t:for(;;){var B=2;this.input.LA(1)==p&&(B=1);switch(B){case 1:s=this.match(this.input,p,FormulaParser.FOLLOW_COMMA_in_array1956);if(this.state.failed)return t;0===this.state.backtracking&&x.add(s);e:for(;;){var D=2;if(this.input.LA(1)==e){this.input.LA(2);this.synpred87_Formula()&&(D=1)}switch(D){case 1:o=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array1958);if(this.state.failed)return t;0===this.state.backtracking&&k.add(o);break;default:break e}}this.pushFollow(FormulaParser.FOLLOW_label_in_array1961);F=this.label();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&R.add(F.getTree());e:for(;;){var V=2;if(this.input.LA(1)==e){this.input.LA(2);this.synpred88_Formula()&&(V=1)}switch(V){case 1:l=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array1963);if(this.state.failed)return t;0===this.state.backtracking&&k.add(l);break;default:break e}}break;default:break t}}}t:for(;;){var W=2;this.input.LA(1)==e&&(W=1);switch(W){case 1:u=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array1970);if(this.state.failed)return t;0===this.state.backtracking&&k.add(u);break;default:break t}}h=this.match(this.input,90,FormulaParser.FOLLOW_RARR_in_array1973);if(this.state.failed)return t;0===this.state.backtracking&&O.add(h);if(0===this.state.backtracking){t.tree=n;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);n=this.adaptor.nil();var U=this.adaptor.nil();U=this.adaptor.becomeRoot(this.adaptor.create(13,"ARRAY"),U);for(;R.hasNext();)this.adaptor.addChild(U,R.nextTree());R.reset();this.adaptor.addChild(n,U);t.tree=n}break;case 2:c=this.match(this.input,f,FormulaParser.FOLLOW_LCURL_in_array1987);if(this.state.failed)return t;0===this.state.backtracking&&w.add(c);t:for(;;){var G=2;if(this.input.LA(1)==e){this.input.LA(2);this.synpred93_Formula()&&(G=1)}switch(G){case 1:d=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array1989);if(this.state.failed)return t;0===this.state.backtracking&&k.add(d);break;default:break t}}switch(this.dfa72.predict(this.input)){case 1:this.pushFollow(FormulaParser.FOLLOW_label_in_array1993);b=this.label();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&R.add(b.getTree());t:for(;;){var j=2;if(this.input.LA(1)==e){this.input.LA(2);this.synpred94_Formula()&&(j=1)}switch(j){case 1:g=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array1995);if(this.state.failed)return t;0===this.state.backtracking&&k.add(g);break;default:break t}}t:for(;;){var q=2;this.input.LA(1)==p&&(q=1);switch(q){case 1:_=this.match(this.input,p,FormulaParser.FOLLOW_COMMA_in_array1998);if(this.state.failed)return t;0===this.state.backtracking&&x.add(_);e:for(;;){var z=2;if(this.input.LA(1)==e){this.input.LA(2);this.synpred95_Formula()&&(z=1)}switch(z){case 1:v=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array2000);if(this.state.failed)return t;0===this.state.backtracking&&k.add(v);break;default:break e}}this.pushFollow(FormulaParser.FOLLOW_label_in_array2003);L=this.label();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&R.add(L.getTree());e:for(;;){var H=2;if(this.input.LA(1)==e){this.input.LA(2);this.synpred96_Formula()&&(H=1)}switch(H){case 1:S=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array2005);if(this.state.failed)return t;0===this.state.backtracking&&k.add(S);break;default:break e}}break;default:break t}}}t:for(;;){var K=2;this.input.LA(1)==e&&(K=1);switch(K){case 1:N=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_array2012);if(this.state.failed)return t;0===this.state.backtracking&&k.add(N);break;default:break t}}E=this.match(this.input,92,FormulaParser.FOLLOW_RCURL_in_array2015);if(this.state.failed)return t;0===this.state.backtracking&&A.add(E);if(0===this.state.backtracking){t.tree=n;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);n=this.adaptor.nil();U=this.adaptor.nil();U=this.adaptor.becomeRoot(this.adaptor.create(13,"ARRAY"),U);for(;R.hasNext();)this.adaptor.addChild(U,R.nextTree());R.reset();this.adaptor.addChild(n,U);t.tree=n}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(n);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},selector_return:function(){FormulaParser.selector_return=function(){};org.antlr.lang.extend(FormulaParser.selector_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),selector:function(){var t=new FormulaParser.selector_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule dotselector"),a=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule minarray");try{var s=2,o=this.input.LA(1);if(o==m||o==f)s=1;else{if(116!=o){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",75,0,this.input)}s=2}switch(s){case 1:this.pushFollow(FormulaParser.FOLLOW_minarray_in_selector2036);n=this.minarray();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&a.add(n.getTree());break;case 2:this.pushFollow(FormulaParser.FOLLOW_dotselector_in_selector2040);i=this.dotselector();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&r.add(i.getTree())}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var l=this.adaptor.nil();l=this.adaptor.becomeRoot(this.adaptor.create(27,"SELECTOR"),l);a.hasNext()&&this.adaptor.addChild(l,a.nextTree());a.reset();r.hasNext()&&this.adaptor.addChild(l,r.nextTree());r.reset();this.adaptor.addChild(e,l);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},minarray_return:function(){FormulaParser.minarray_return=function(){};org.antlr.lang.extend(FormulaParser.minarray_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),minarray:function(){var t=new FormulaParser.minarray_return;t.start=this.input.LT(1);var e=null,n=null,r=null,o=null,c=null,v=null,S=null,N=null,E=null,T=null,F=null,b=null,L=null;try{var w=2,k=this.input.LA(1);if(k==m)w=1;else{if(k!=f){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",82,0,this.input)}w=2}switch(w){case 1:e=this.adaptor.nil();this.match(this.input,m,FormulaParser.FOLLOW_LARR_in_minarray2067);if(this.state.failed)return t;var O=2,x=this.input.LA(1);if(x==i||x==a||x==s||x==l||x==u||x>=d&&x<=m||x==f||x>=g&&x<=_||113==x)O=1;else{if(x!=h){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",76,0,this.input)}O=2}switch(O){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2072);v=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,v.getTree());break;case 2:n=this.match(this.input,h,FormulaParser.FOLLOW_MULT_in_minarray2074);if(this.state.failed)return t;if(0===this.state.backtracking){T=this.adaptor.create(n);this.adaptor.addChild(e,T)}}t:for(;;){var y=2;this.input.LA(1)==p&&(y=1);switch(y){case 1:this.match(this.input,p,FormulaParser.FOLLOW_COMMA_in_minarray2078);if(this.state.failed)return t;var A=2,R=this.input.LA(1);if(R==i||R==a||R==s||R==l||R==u||R>=d&&R<=m||R==f||R>=g&&R<=_||113==R)A=1;else{if(R!=h){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",77,0,this.input)}A=2}switch(A){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2082);S=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,S.getTree());break;case 2:r=this.match(this.input,h,FormulaParser.FOLLOW_MULT_in_minarray2084);if(this.state.failed)return t;if(0===this.state.backtracking){F=this.adaptor.create(r);this.adaptor.addChild(e,F)}}break;default:break t}}this.match(this.input,90,FormulaParser.FOLLOW_RARR_in_minarray2091);if(this.state.failed)return t;break;case 2:e=this.adaptor.nil();this.match(this.input,f,FormulaParser.FOLLOW_LCURL_in_minarray2097);if(this.state.failed)return t;var P=2,C=this.input.LA(1);if(C==i||C==a||C==s||C==l||C==u||C>=d&&C<=m||C==f||C>=g&&C<=_||113==C)P=1;else{if(C!=h){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",79,0,this.input)}P=2}switch(P){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2102);N=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,N.getTree());break;case 2:o=this.match(this.input,h,FormulaParser.FOLLOW_MULT_in_minarray2104);if(this.state.failed)return t;if(0===this.state.backtracking){b=this.adaptor.create(o);this.adaptor.addChild(e,b)}}t:for(;;){var M=2;this.input.LA(1)==p&&(M=1);switch(M){case 1:this.match(this.input,p,FormulaParser.FOLLOW_COMMA_in_minarray2108);if(this.state.failed)return t;var I=2,B=this.input.LA(1);if(B==i||B==a||B==s||B==l||B==u||B>=d&&B<=m||B==f||B>=g&&B<=_||113==B)I=1;else{if(B!=h){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",80,0,this.input)}I=2}switch(I){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2112);E=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,E.getTree());break;case 2:c=this.match(this.input,h,FormulaParser.FOLLOW_MULT_in_minarray2114);if(this.state.failed)return t;if(0===this.state.backtracking){L=this.adaptor.create(c);this.adaptor.addChild(e,L)}}break;default:break t}}this.match(this.input,92,FormulaParser.FOLLOW_RCURL_in_minarray2121);if(this.state.failed)return t}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},dotselector_return:function(){FormulaParser.dotselector_return=function(){};org.antlr.lang.extend(FormulaParser.dotselector_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),dotselector:function(){var t=new FormulaParser.dotselector_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 116"),a=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule arrayName");try{var s=0;t:for(;;){var o=2;if(116==this.input.LA(1)){this.input.LA(2);this.synpred108_Formula()&&(o=1)}switch(o){case 1:n=this.match(this.input,116,FormulaParser.FOLLOW_116_in_dotselector2133);if(this.state.failed)return t;0===this.state.backtracking&&r.add(n);this.pushFollow(FormulaParser.FOLLOW_arrayName_in_dotselector2135);i=this.arrayName();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&a.add(i.getTree());break;default:if(s>=1)break t;if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.EarlyExitException(83,this.input)}s++}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var l=this.adaptor.nil();l=this.adaptor.becomeRoot(this.adaptor.create(28,"DOTSELECTOR"),l);if(!a.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;a.hasNext();)this.adaptor.addChild(l,a.nextTree());a.reset();this.adaptor.addChild(e,l);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},arrayName_return:function(){FormulaParser.arrayName_return=function(){};org.antlr.lang.extend(FormulaParser.arrayName_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),arrayName:function(){var t=new FormulaParser.arrayName_return;t.start=this.input.LT(1);var e=null,n=null;try{e=this.adaptor.nil();n=this.input.LT(1);if(this.input.LA(1)!=s&&this.input.LA(1)!=h&&this.input.LA(1)!=g){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&this.adaptor.addChild(e,this.adaptor.create(n));this.state.errorRecovery=!1;this.state.failed=!1;t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},label_return:function(){FormulaParser.label_return=function(){};org.antlr.lang.extend(FormulaParser.label_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),label:function(){var t=new FormulaParser.label_return;t.start=this.input.LT(1);var n=null,i=null,r=null,a=null,s=null,o=null,l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COLON"),u=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),h=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule arrayName"),d=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{switch(this.dfa85.predict(this.input)){case 1:this.pushFollow(FormulaParser.FOLLOW_arrayName_in_label2173);s=this.arrayName();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&h.add(s.getTree());t:for(;;){var m=2;this.input.LA(1)==e&&(m=1);switch(m){case 1:i=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_label2175);if(this.state.failed)return t;0===this.state.backtracking&&u.add(i);break;default:break t}}r=this.match(this.input,c,FormulaParser.FOLLOW_COLON_in_label2178);if(this.state.failed)return t;0===this.state.backtracking&&l.add(r)}t:for(;;){var f=2;this.input.LA(1)==e&&(f=1);switch(f){case 1:a=this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_label2182);if(this.state.failed)return t;0===this.state.backtracking&&u.add(a);break;default:break t}}this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_label2185);o=this.logicalExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&d.add(o.getTree());if(0===this.state.backtracking){t.tree=n;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);n=this.adaptor.nil();var p=this.adaptor.nil();p=this.adaptor.becomeRoot(this.adaptor.create(23,"LABEL"),p);this.adaptor.addChild(p,d.nextTree());h.hasNext()&&this.adaptor.addChild(p,h.nextTree());h.reset();this.adaptor.addChild(n,p);t.tree=n}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(n);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},number_return:function(){FormulaParser.number_return=function(){};org.antlr.lang.extend(FormulaParser.number_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),number:function(){var t=new FormulaParser.number_return;t.start=this.input.LT(1);var e=null,n=null;try{e=this.adaptor.nil();n=this.input.LT(1);if(!(this.input.LA(1)>=95&&this.input.LA(1)<=96)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&this.adaptor.addChild(e,this.adaptor.create(n));this.state.errorRecovery=!1;this.state.failed=!1;t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},negnumber_return:function(){FormulaParser.negnumber_return=function(){};org.antlr.lang.extend(FormulaParser.negnumber_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),negnumber:function(){var t=new FormulaParser.negnumber_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),a=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule number");try{n=this.match(this.input,u,FormulaParser.FOLLOW_MINUS_in_negnumber2261);if(this.state.failed)return t;0===this.state.backtracking&&r.add(n);this.pushFollow(FormulaParser.FOLLOW_number_in_negnumber2263);i=this.number();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&a.add(i.getTree());if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var s=this.adaptor.nil();s=this.adaptor.becomeRoot(this.adaptor.create(4,"NEGATE"),s);this.adaptor.addChild(s,a.nextTree());this.adaptor.addChild(e,s);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},bool_return:function(){FormulaParser.bool_return=function(){};org.antlr.lang.extend(FormulaParser.bool_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),bool:function(){var t=new FormulaParser.bool_return;t.start=this.input.LT(1);var e=null,n=null;try{e=this.adaptor.nil();n=this.input.LT(1);if(!(this.input.LA(1)>=97&&this.input.LA(1)<=_)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&this.adaptor.addChild(e,this.adaptor.create(n));this.state.errorRecovery=!1;this.state.failed=!1;t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},material_return:function(){FormulaParser.material_return=function(){};org.antlr.lang.extend(FormulaParser.material_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),material:function(){var t=new FormulaParser.material_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null,a=null,s=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LCURL"),o=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RCURL"),l=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitMultiplicativeExpression"),u=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule additiveExpression");try{n=this.match(this.input,f,FormulaParser.FOLLOW_LCURL_in_material2415);if(this.state.failed)return t;0===this.state.backtracking&&s.add(n);this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_material2417);r=this.additiveExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&u.add(r.getTree());if(" "!=this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.FailedPredicateException(this.input,"material",' this.input.get(this.input.index()-1).getText()==" "')}this.pushFollow(FormulaParser.FOLLOW_unitMultiplicativeExpression_in_material2421);a=this.unitMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&l.add(a.getTree());i=this.match(this.input,92,FormulaParser.FOLLOW_RCURL_in_material2423);if(this.state.failed)return t;0===this.state.backtracking&&o.add(i);if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var h=this.adaptor.nil();h=this.adaptor.becomeRoot(this.adaptor.create(7,"MATERIAL"),h);this.adaptor.addChild(h,l.nextTree());this.adaptor.addChild(h,u.nextTree());this.adaptor.addChild(e,h);t.tree=e}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},unitMultiplicativeExpression_return:function(){FormulaParser.unitMultiplicativeExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unitMultiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitMultiplicativeExpression:function(){var t=new FormulaParser.unitMultiplicativeExpression_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null,a=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2460);i=this.unitInnerMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());t:for(;;){var s=2;99==this.input.LA(1)&&(s=1);switch(s){case 1:n=this.match(this.input,99,FormulaParser.FOLLOW_PER_in_unitMultiplicativeExpression2464);if(this.state.failed)return t;if(0===this.state.backtracking){a=this.adaptor.create(n);e=this.adaptor.becomeRoot(a,e)}this.pushFollow(FormulaParser.FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2467);r=this.unitInnerMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},unitInnerMultiplicativeExpression_return:function(){FormulaParser.unitInnerMultiplicativeExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unitInnerMultiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitInnerMultiplicativeExpression:function(){var t=new FormulaParser.unitInnerMultiplicativeExpression_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2483);i=this.unitClump();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,i.getTree());t:for(;;){var a=2,s=this.input.LA(1);s>=h&&s<=84&&(a=1);switch(a){case 1:n=this.input.LT(1);if(!(this.input.LA(1)>=h&&this.input.LA(1)<=84)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&(e=this.adaptor.becomeRoot(this.adaptor.create(n),e));this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2494);r=this.unitClump();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,r.getTree());break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},unitClump_return:function(){FormulaParser.unitClump_return=function(){};org.antlr.lang.extend(FormulaParser.unitClump_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitClump:function(){var t=new FormulaParser.unitClump_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null,a=null,o=null,l=null,u=null,h=null,c=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token INTEGER"),d=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token SQUARED"),m=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token DIV"),f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token CUBED"),p=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitPowerExpression");try{var g=2,_=this.input.LA(1);if(95==_)g=1;else{if(_!=s&&113!=_){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",93,0,this.input)}g=2}switch(g){case 1:n=this.match(this.input,95,FormulaParser.FOLLOW_INTEGER_in_unitClump2510);if(this.state.failed)return t;0===this.state.backtracking&&c.add(n);i=this.match(this.input,84,FormulaParser.FOLLOW_DIV_in_unitClump2512);if(this.state.failed)return t;0===this.state.backtracking&&m.add(i);this.pushFollow(FormulaParser.FOLLOW_unitPowerExpression_in_unitClump2515);u=this.unitPowerExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&p.add(u.getTree());var N=2;this.input.LA(1)==v&&(N=1);switch(N){case 1:r=this.match(this.input,v,FormulaParser.FOLLOW_CUBED_in_unitClump2517);if(this.state.failed)return t;0===this.state.backtracking&&f.add(r)}var E=2;this.input.LA(1)==S&&(E=1);switch(E){case 1:a=this.match(this.input,S,FormulaParser.FOLLOW_SQUARED_in_unitClump2520);if(this.state.failed)return t;0===this.state.backtracking&&d.add(a)}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var T=this.adaptor.nil();T=this.adaptor.becomeRoot(this.adaptor.create(12,"UNITCLUMP"),T);this.adaptor.addChild(T,p.nextTree());this.adaptor.addChild(T,this.adaptor.create(4,"NEGATE"));for(;f.hasNext();)this.adaptor.addChild(T,f.nextNode());f.reset();for(;d.hasNext();)this.adaptor.addChild(T,d.nextNode());d.reset();this.adaptor.addChild(e,T);t.tree=e}break;case 2:this.pushFollow(FormulaParser.FOLLOW_unitPowerExpression_in_unitClump2543);h=this.unitPowerExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&p.add(h.getTree());var F=2;this.input.LA(1)==v&&(F=1);switch(F){case 1:o=this.match(this.input,v,FormulaParser.FOLLOW_CUBED_in_unitClump2545);if(this.state.failed)return t;0===this.state.backtracking&&f.add(o)}var b=2;this.input.LA(1)==S&&(b=1);switch(b){case 1:l=this.match(this.input,S,FormulaParser.FOLLOW_SQUARED_in_unitClump2548);if(this.state.failed)return t;0===this.state.backtracking&&d.add(l)}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();T=this.adaptor.nil();T=this.adaptor.becomeRoot(this.adaptor.create(12,"UNITCLUMP"),T);this.adaptor.addChild(T,p.nextTree());for(;f.hasNext();)this.adaptor.addChild(T,f.nextNode());f.reset();for(;d.hasNext();)this.adaptor.addChild(T,d.nextNode());d.reset();this.adaptor.addChild(e,T);t.tree=e}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},unitPowerExpression_return:function(){FormulaParser.unitPowerExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unitPowerExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitPowerExpression:function(){var t=new FormulaParser.unitPowerExpression_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null,a=null,s=null,o=null;try{e=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unit_in_unitPowerExpression2610);a=this.unit();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&this.adaptor.addChild(e,a.getTree());t:for(;;){var l=2;87==this.input.LA(1)&&(l=1);switch(l){case 1:n=this.match(this.input,87,FormulaParser.FOLLOW_POW_in_unitPowerExpression2614);if(this.state.failed)return t;if(0===this.state.backtracking){s=this.adaptor.create(n);e=this.adaptor.becomeRoot(s,e)}var h=2;this.input.LA(1)==u&&(h=1);switch(h){case 1:i=this.match(this.input,u,FormulaParser.FOLLOW_MINUS_in_unitPowerExpression2617);if(this.state.failed)return t;if(0===this.state.backtracking){o=this.adaptor.create(i);this.adaptor.addChild(e,o)}}r=this.input.LT(1);if(!(this.input.LA(1)>=95&&this.input.LA(1)<=96)){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();0===this.state.backtracking&&this.adaptor.addChild(e,this.adaptor.create(r));this.state.errorRecovery=!1;this.state.failed=!1;break;default:break t}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},unit_return:function(){FormulaParser.unit_return=function(){};org.antlr.lang.extend(FormulaParser.unit_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unit:function(){var t=new FormulaParser.unit_return;t.start=this.input.LT(1);var e=null,n=null,i=null,r=null,a=null,o=null,l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),u=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),c=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitMultiplicativeExpression");try{var d=2,m=this.input.LA(1);if(m==s)d=1;else{if(113!=m){if(this.state.backtracking>0){this.state.failed=!0;return t}throw new org.antlr.runtime.NoViableAltException("",97,0,this.input)}d=2}switch(d){case 1:n=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_unit2638);if(this.state.failed)return t;0===this.state.backtracking&&u.add(n);t:for(;;){var f=2;this.input.LA(1)==s&&(f=1);switch(f){case 1:i=this.match(this.input,s,FormulaParser.FOLLOW_IDENT_in_unit2641);if(this.state.failed)return t;0===this.state.backtracking&&u.add(i);break;default:break t}}if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();var p=this.adaptor.nil();p=this.adaptor.becomeRoot(this.adaptor.create(8,"UNIT"),p);if(!u.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;u.hasNext();)this.adaptor.addChild(p,u.nextNode());u.reset();this.adaptor.addChild(e,p);t.tree=e}break;case 2:r=this.match(this.input,113,FormulaParser.FOLLOW_113_in_unit2658);if(this.state.failed)return t;0===this.state.backtracking&&h.add(r);this.pushFollow(FormulaParser.FOLLOW_unitMultiplicativeExpression_in_unit2660);o=this.unitMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return t;0===this.state.backtracking&&c.add(o.getTree());a=this.match(this.input,114,FormulaParser.FOLLOW_114_in_unit2662);if(this.state.failed)return t;0===this.state.backtracking&&l.add(a);if(0===this.state.backtracking){t.tree=e;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=t?t.tree:null);e=this.adaptor.nil();p=this.adaptor.nil();p=this.adaptor.becomeRoot(this.adaptor.create(12,"UNITCLUMP"),p);this.adaptor.addChild(p,c.nextTree());this.adaptor.addChild(e,p);t.tree=e}}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},primitive_return:function(){FormulaParser.primitive_return=function(){};org.antlr.lang.extend(FormulaParser.primitive_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),primitive:function(){var t=new FormulaParser.primitive_return;t.start=this.input.LT(1);var e=null,n=null,i=null;try{e=this.adaptor.nil();n=this.match(this.input,l,FormulaParser.FOLLOW_PRIMITIVE_in_primitive2731);if(this.state.failed)return t;if(0===this.state.backtracking){i=this.adaptor.create(n);this.adaptor.addChild(e,i)}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},string_return:function(){FormulaParser.string_return=function(){};org.antlr.lang.extend(FormulaParser.string_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),string:function(){var t=new FormulaParser.string_return;t.start=this.input.LT(1);var e=null,n=null,i=null;try{e=this.adaptor.nil();n=this.match(this.input,g,FormulaParser.FOLLOW_STRING_in_string3200);if(this.state.failed)return t;if(0===this.state.backtracking){i=this.adaptor.create(n);e=this.adaptor.becomeRoot(i,e)}t.stop=this.input.LT(-1);if(0===this.state.backtracking){t.tree=this.adaptor.rulePostProcessing(e);this.adaptor.setTokenBoundaries(t.tree,t.start,t.stop)}}catch(e){if(!(e instanceof org.antlr.runtime.RecognitionException))throw e;this.reportError(e);this.recover(this.input,e);t.tree=this.adaptor.errorNode(this.input,t.start,this.input.LT(-1),e)}return t},synpred5_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_assignment_in_synpred5_Formula508);this.assignment();this.state._fsp--;this.state.failed},synpred6_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_synpred6_Formula514);this.logicalExpression();this.state._fsp--;this.state.failed},synpred8_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_forLoop_in_synpred8_Formula526);this.forLoop();this.state._fsp--;this.state.failed},synpred9_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_forInLoop_in_synpred9_Formula532);this.forInLoop();this.state._fsp--;this.state.failed},synpred11_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_functionDef_in_synpred11_Formula544);this.functionDef();this.state._fsp--;this.state.failed},synpred47_Formula_fragment:function(){this.match(this.input,72,FormulaParser.FOLLOW_OR_in_synpred47_Formula1217);if(!this.state.failed){this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_synpred47_Formula1220);this.booleanXORExpression();this.state._fsp--;this.state.failed}},synpred48_Formula_fragment:function(){this.match(this.input,73,FormulaParser.FOLLOW_XOR_in_synpred48_Formula1253);if(!this.state.failed){this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_synpred48_Formula1256);this.booleanAndExpression();this.state._fsp--;this.state.failed}},synpred49_Formula_fragment:function(){this.match(this.input,75,FormulaParser.FOLLOW_AND_in_synpred49_Formula1288);if(!this.state.failed){this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_synpred49_Formula1291);this.equalityExpression();this.state._fsp--;this.state.failed}},synpred51_Formula_fragment:function(){if(this.input.LA(1)!=o&&76!=this.input.LA(1)){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_synpred51_Formula1332);this.relationalExpression();this.state._fsp--;this.state.failed},synpred55_Formula_fragment:function(){if(!(this.input.LA(1)>=77&&this.input.LA(1)<=80)){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_synpred55_Formula1389);this.additiveExpression();this.state._fsp--;this.state.failed},synpred57_Formula_fragment:function(){if(!(this.input.LA(1)>=81&&this.input.LA(1)<=u)){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_synpred57_Formula1443);this.multiplicativeExpression();this.state._fsp--;this.state.failed},synpred60_Formula_fragment:function(){if(!(this.input.LA(1)>=h&&this.input.LA(1)<=85)){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.MismatchedSetException(null,this.input)}this.input.consume();this.state.errorRecovery=!1;this.state.failed=!1;this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_synpred60_Formula1486);this.arrayExpression();this.state._fsp--;this.state.failed},synpred61_Formula_fragment:function(){if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred61_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}this.match(this.input,c,FormulaParser.FOLLOW_COLON_in_synpred61_Formula1538);if(!this.state.failed){if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred61_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_synpred61_Formula1542);this.negationExpression();this.state._fsp--;this.state.failed}},synpred62_Formula_fragment:function(){if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred62_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}this.match(this.input,c,FormulaParser.FOLLOW_COLON_in_synpred62_Formula1551);if(!this.state.failed){if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred62_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_synpred62_Formula1555);this.negationExpression();this.state._fsp--;this.state.failed}},synpred64_Formula_fragment:function(){this.match(this.input,87,FormulaParser.FOLLOW_POW_in_synpred64_Formula1610);if(!this.state.failed){this.pushFollow(FormulaParser.FOLLOW_unaryOrNegate_in_synpred64_Formula1612);this.unaryOrNegate();this.state._fsp--;this.state.failed}},synpred68_Formula_fragment:function(){if(" "==this.input.get(this.input.index()-1).getText()){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred68_Formula",' this.input.get(this.input.index()-1).getText()!=" "')}var t=2,e=this.input.LA(1);if(e==m||e==f||116==e)t=1;else{if(113!=e){if(this.state.backtracking>0){this.state.failed=!0;return}throw new org.antlr.runtime.NoViableAltException("",119,0,this.input)}t=2}switch(t){case 1:this.pushFollow(FormulaParser.FOLLOW_selector_in_synpred68_Formula1744);this.selector();this.state._fsp--;if(this.state.failed)return;break;case 2:this.pushFollow(FormulaParser.FOLLOW_funCall_in_synpred68_Formula1746);this.funCall();this.state._fsp--;if(this.state.failed)return}},synpred75_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_material_in_synpred75_Formula1841);this.material();this.state._fsp--;this.state.failed},synpred78_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_array_in_synpred78_Formula1856);this.array();this.state._fsp--;this.state.failed},synpred80_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_funCall_in_synpred80_Formula1880);this.funCall();this.state._fsp--;this.state.failed},synpred85_Formula_fragment:function(){this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred85_Formula1946);this.state.failed},synpred86_Formula_fragment:function(){this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred86_Formula1952);this.state.failed},synpred87_Formula_fragment:function(){this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred87_Formula1958);this.state.failed},synpred88_Formula_fragment:function(){this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred88_Formula1963);this.state.failed},synpred93_Formula_fragment:function(){this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred93_Formula1989);this.state.failed},synpred94_Formula_fragment:function(){this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred94_Formula1995);this.state.failed},synpred95_Formula_fragment:function(){this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred95_Formula2000);this.state.failed},synpred96_Formula_fragment:function(){this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred96_Formula2005);this.state.failed},synpred108_Formula_fragment:function(){this.match(this.input,116,FormulaParser.FOLLOW_116_in_synpred108_Formula2133);if(!this.state.failed){this.pushFollow(FormulaParser.FOLLOW_arrayName_in_synpred108_Formula2135);this.arrayName();this.state._fsp--;this.state.failed}},synpred112_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_arrayName_in_synpred112_Formula2173);this.arrayName();this.state._fsp--;if(!this.state.failed){t:for(;;){var t=2;this.input.LA(1)==e&&(t=1);switch(t){case 1:this.match(this.input,e,FormulaParser.FOLLOW_NEWLINE_in_synpred112_Formula2175);if(this.state.failed)return;break;default:break t}}this.match(this.input,c,FormulaParser.FOLLOW_COLON_in_synpred112_Formula2178);this.state.failed}},synpred95_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred95_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred94_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred94_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred80_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred80_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred49_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred49_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred57_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred57_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred68_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred68_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred51_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred51_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred62_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred62_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred64_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred64_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred93_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred93_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred55_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred55_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred85_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred85_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred87_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred87_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred48_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred48_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred86_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred86_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred9_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred9_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred75_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred75_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred96_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred96_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred47_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred47_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred8_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred8_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred112_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred112_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred6_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred6_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred5_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred5_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred60_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred60_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred61_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred61_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred108_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred108_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred11_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred11_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred78_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred78_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e},synpred88_Formula:function(){this.state.backtracking++;var t=this.input.mark();try{this.synpred88_Formula_fragment()}catch(t){alert("impossible: "+t.toString())}var e=!this.state.failed;this.input.rewind(t);this.state.backtracking--;this.state.failed=!1;return e}},!0);org.antlr.lang.augmentObject(FormulaParser,{DFA5_eotS:"￿",DFA5_eofS:"￿",DFA5_minS:"&\0\b￿\0￿\0\b￿",DFA5_maxS:"q\0\b￿\0￿\0\b￿",DFA5_acceptS:"￿\t￿￿\b\t\n",DFA5_specialS:"￿\0\b￿￿\b￿}>",DFA5_transitionS:["\r￿\v￿￿\v￿￿￿\n￿￿￿￿￿","￿","￿","","","","","","","","","￿","","","￿","","","","","","","",""]});org.antlr.lang.augmentObject(FormulaParser,{DFA5_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_eotS),DFA5_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_eofS),DFA5_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA5_minS),DFA5_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA5_maxS),DFA5_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_acceptS),DFA5_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_specialS),DFA5_transition:function(){var t,e=[],n=FormulaParser.DFA5_transitionS.length;for(t=0;t<n;t++)e.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_transitionS[t]));return e}()});FormulaParser.DFA5=function(t){this.recognizer=t;this.decisionNumber=5;this.eot=FormulaParser.DFA5_eot;this.eof=FormulaParser.DFA5_eof;this.min=FormulaParser.DFA5_min;this.max=FormulaParser.DFA5_max;this.accept=FormulaParser.DFA5_accept;this.special=FormulaParser.DFA5_special;this.transition=FormulaParser.DFA5_transition};org.antlr.lang.extend(FormulaParser.DFA5,org.antlr.runtime.DFA,{getDescription:function(){return"120:1: expression : ( assignment | logicalExpression | whileLoop | forLoop | forInLoop | ifThenElse | functionDef | returnExp | tryCatch | throwExp );"},specialStateTransition:function(t,e){var n=t,i=function(t,e){switch(t){case 0:e.LA(1);var n=e.index();e.rewind();t=-1;this.synpred5_Formula()?t=19:this.synpred6_Formula()&&(t=3);e.seek(n);if(t>=0)return t;break;case 1:e.LA(1);var i=e.index();e.rewind();t=-1;this.synpred5_Formula()?t=19:this.synpred6_Formula()&&(t=3);e.seek(i);if(t>=0)return t;break;case 2:e.LA(1);var r=e.index();e.rewind();t=-1;this.synpred6_Formula()?t=3:this.synpred11_Formula()&&(t=20);e.seek(r);if(t>=0)return t;break;case 3:e.LA(1);var a=e.index();e.rewind();t=-1;this.synpred8_Formula()?t=21:this.synpred9_Formula()&&(t=22);e.seek(a);if(t>=0)return t}}.call(this.recognizer,t,e);if(!org.antlr.lang.isUndefined(i))return i;if(this.recognizer.state.backtracking>0){this.recognizer.state.failed=!0;return-1}var r=new org.antlr.runtime.NoViableAltException(this.getDescription(),5,n,e);this.error(r);throw r},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA57_eotS:"\v￿",DFA57_eofS:"\v￿",DFA57_minS:"<￿\0￿",DFA57_maxS:"b￿\0￿",DFA57_acceptS:"￿￿\b\t",DFA57_specialS:"￿\0￿}>",DFA57_transitionS:["\b￿\t￿￿￿￿￿","","","","￿","","","","","",""]});org.antlr.lang.augmentObject(FormulaParser,{DFA57_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_eotS),DFA57_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_eofS),DFA57_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA57_minS),DFA57_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA57_maxS),DFA57_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_acceptS),DFA57_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_specialS),DFA57_transition:function(){var t,e=[],n=FormulaParser.DFA57_transitionS.length;for(t=0;t<n;t++)e.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_transitionS[t]));return e}()});FormulaParser.DFA57=function(t){this.recognizer=t;this.decisionNumber=57;this.eot=FormulaParser.DFA57_eot;this.eof=FormulaParser.DFA57_eof;this.min=FormulaParser.DFA57_min;this.max=FormulaParser.DFA57_max;this.accept=FormulaParser.DFA57_accept;this.special=FormulaParser.DFA57_special;this.transition=FormulaParser.DFA57_transition};org.antlr.lang.extend(FormulaParser.DFA57,org.antlr.runtime.DFA,{getDescription:function(){return"283:1: value : ( number | bool | string | material | IDENT | primitive | array | anonFunctionDef | newObject );"},specialStateTransition:function(t,e){var n=t,i=function(t,e){switch(t){case 0:e.LA(1);var n=e.index();e.rewind();t=-1;this.synpred75_Formula()?t=10:this.synpred78_Formula()&&(t=7);e.seek(n);if(t>=0)return t}}.call(this.recognizer,t,e);if(!org.antlr.lang.isUndefined(i))return i;if(this.recognizer.state.backtracking>0){this.recognizer.state.failed=!0;return-1}var r=new org.antlr.runtime.NoViableAltException(this.getDescription(),57,n,e);this.error(r);throw r},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA58_eotS:"￿",DFA58_eofS:"￿",DFA58_minS:" \0￿",DFA58_maxS:"t\0￿",DFA58_acceptS:"￿￿",DFA58_specialS:"￿\0￿}>",DFA58_transitionS:["￿￿￿\r￿￿￿\r￿￿￿￿","￿","","","","","","","","","","","","","","","","","","","","","","","",""]});org.antlr.lang.augmentObject(FormulaParser,{DFA58_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_eotS),DFA58_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_eofS),DFA58_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA58_minS),DFA58_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA58_maxS),DFA58_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_acceptS),DFA58_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_specialS),DFA58_transition:function(){var t,e=[],n=FormulaParser.DFA58_transitionS.length;for(t=0;t<n;t++)e.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_transitionS[t]));return e}()});FormulaParser.DFA58=function(t){this.recognizer=t;this.decisionNumber=58;this.eot=FormulaParser.DFA58_eot;this.eof=FormulaParser.DFA58_eof;this.min=FormulaParser.DFA58_min;this.max=FormulaParser.DFA58_max;this.accept=FormulaParser.DFA58_accept;this.special=FormulaParser.DFA58_special;this.transition=FormulaParser.DFA58_transition};org.antlr.lang.extend(FormulaParser.DFA58,org.antlr.runtime.DFA,{getDescription:function(){return"296:22: ( funCall )?"},specialStateTransition:function(t,e){var n=t,i=function(t,e){switch(t){case 0:e.LA(1);var n=e.index();e.rewind();t=-1;this.synpred80_Formula()?t=25:" "!=this.input.get(this.input.index()-1).getText()&&" "==this.input.get(this.input.index()-1).getText()||(t=2);e.seek(n);if(t>=0)return t}}.call(this.recognizer,t,e);if(!org.antlr.lang.isUndefined(i))return i;if(this.recognizer.state.backtracking>0){this.recognizer.state.failed=!0;return-1}var r=new org.antlr.runtime.NoViableAltException(this.getDescription(),58,n,e);this.error(r);throw r},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA65_eotS:"￿",DFA65_eofS:"￿",DFA65_minS:" ￿ ￿",DFA65_maxS:"q￿q￿",DFA65_acceptS:"￿￿",DFA65_specialS:"￿}>",DFA65_transitionS:["￿￿￿￿\n￿￿￿￿","","￿￿￿￿\n￿￿￿￿",""]});org.antlr.lang.augmentObject(FormulaParser,{DFA65_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_eotS),DFA65_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_eofS),DFA65_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA65_minS),DFA65_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA65_maxS),DFA65_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_acceptS),DFA65_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_specialS),DFA65_transition:function(){var t,e=[],n=FormulaParser.DFA65_transitionS.length;for(t=0;t<n;t++)e.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_transitionS[t]));return e}()});FormulaParser.DFA65=function(t){this.recognizer=t;this.decisionNumber=65;this.eot=FormulaParser.DFA65_eot;this.eof=FormulaParser.DFA65_eof;this.min=FormulaParser.DFA65_min;this.max=FormulaParser.DFA65_max;this.accept=FormulaParser.DFA65_accept;this.special=FormulaParser.DFA65_special;this.transition=FormulaParser.DFA65_transition};org.antlr.lang.extend(FormulaParser.DFA65,org.antlr.runtime.DFA,{getDescription:function(){return"309:16: ( label ( NEWLINE )* ( ',' ( NEWLINE )* label ( NEWLINE )* )* )?"},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA72_eotS:"￿",DFA72_eofS:"￿",DFA72_minS:" ￿ ￿",DFA72_maxS:"q￿q￿",DFA72_acceptS:"￿￿",DFA72_specialS:"￿}>",DFA72_transitionS:["￿￿￿￿\n￿￿￿￿￿","","￿￿￿￿\n￿￿￿￿￿",""]});org.antlr.lang.augmentObject(FormulaParser,{DFA72_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_eotS),DFA72_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_eofS),DFA72_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA72_minS),DFA72_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA72_maxS),DFA72_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_acceptS),DFA72_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_specialS),DFA72_transition:function(){var t,e=[],n=FormulaParser.DFA72_transitionS.length;for(t=0;t<n;t++)e.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_transitionS[t]));return e}()});FormulaParser.DFA72=function(t){this.recognizer=t;this.decisionNumber=72;this.eot=FormulaParser.DFA72_eot;this.eof=FormulaParser.DFA72_eof;this.min=FormulaParser.DFA72_min;this.max=FormulaParser.DFA72_max;this.accept=FormulaParser.DFA72_accept;this.special=FormulaParser.DFA72_special;this.transition=FormulaParser.DFA72_transition};org.antlr.lang.extend(FormulaParser.DFA72,org.antlr.runtime.DFA,{getDescription:function(){return"310:19: ( label ( NEWLINE )* ( ',' ( NEWLINE )* label ( NEWLINE )* )* )?"},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA85_eotS:"￿",DFA85_eofS:"￿",DFA85_minS:" \0￿\0￿",DFA85_maxS:"q\0￿\0￿",DFA85_acceptS:"￿￿￿",DFA85_specialS:"￿\0￿￿}>",DFA85_transitionS:["￿￿￿\b￿\n￿\n￿￿￿￿","￿","","","","","","","￿","","","","","",""]});org.antlr.lang.augmentObject(FormulaParser,{DFA85_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_eotS),DFA85_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_eofS),DFA85_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA85_minS),DFA85_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA85_maxS),DFA85_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_acceptS),DFA85_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_specialS),DFA85_transition:function(){var t,e=[],n=FormulaParser.DFA85_transitionS.length;for(t=0;t<n;t++)e.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_transitionS[t]));return e}()});FormulaParser.DFA85=function(t){this.recognizer=t;this.decisionNumber=85;this.eot=FormulaParser.DFA85_eot;this.eof=FormulaParser.DFA85_eof;this.min=FormulaParser.DFA85_min;this.max=FormulaParser.DFA85_max;this.accept=FormulaParser.DFA85_accept;this.special=FormulaParser.DFA85_special;this.transition=FormulaParser.DFA85_transition};org.antlr.lang.extend(FormulaParser.DFA85,org.antlr.runtime.DFA,{getDescription:function(){return"331:2: ( arrayName ( NEWLINE )* COLON )?"},specialStateTransition:function(t,e){var n=t,i=function(t,e){switch(t){case 0:e.LA(1);var n=e.index();e.rewind();t=-1;if(this.synpred112_Formula())t=10;else{t=2}e.seek(n);if(t>=0)return t;break;case 1:e.LA(1);var i=e.index();e.rewind();t=-1;if(this.synpred112_Formula())t=10;else{t=2}e.seek(i);if(t>=0)return t}}.call(this.recognizer,t,e);if(!org.antlr.lang.isUndefined(i))return i;if(this.recognizer.state.backtracking>0){this.recognizer.state.failed=!0;return-1}var r=new org.antlr.runtime.NoViableAltException(this.getDescription(),85,n,e);this.error(r);throw r},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{tokenNames:["<invalid>","<EOR>","<DOWN>","<UP>","NEGATE","ASSIGN","FUNCALL","MATERIAL","UNIT","POWER","DEFAULTS","PARAMS","UNITCLUMP","ARRAY","LINES","WHILE","IFTHENELSE","ELSE","FOR","FORIN","FUNCTION","ANONFUNCTION","NUMBER","LABEL","RANGE","INNER","ASSIGNED","SELECTOR","DOTSELECTOR","NEW","TRYCATCH","THROW","NEWLINE","W","H","I","L","E","WHILESTATEMENT","F","O","R","FORSTATEMENT","M","FROMSTATEMENT","N","INSTATEMENT","T","TOSTATEMENT","B","Y","BYSTATEMENT","P","LOOPSTATEMENT","IFSTATEMENT","THENSTATEMENT","S","ELSESTATEMENT","U","C","FUNCTIONSTATEMENT","D","ENDBLOCK","RETURNSTATEMENT","NEWSTATEMENT","TRYSTATEMENT","A","CATCHSTATEMENT","THROWSTATEMENT","IDENT","EQUALS","PRIMITIVE","OR","XOR","X","AND","NOTEQUALS","LT","LTEQ","GT","GTEQ","PLUS","MINUS","MULT","DIV","MOD","COLON","POW","NOT","LARR","RARR","LCURL","RCURL","COMMA","STRING","INTEGER","FLOAT","TRUE","FALSE","PER","CUBED","SQUARED","Q","LBRACKET","RBRACKET","COMMENT","LINE_COMMENT","WS","G","J","K","V","Z","'('","')'","'<-'","'.'"],FOLLOW_NEWLINE_in_lines160:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_expression_in_lines164:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_lines168:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_EOF_in_lines171:new org.antlr.runtime.BitSet([0,2420114496,3406037171,131079]),FOLLOW_EOF_in_lines176:new org.antlr.runtime.BitSet([2,0]),FOLLOW_assignment_in_expression508:new org.antlr.runtime.BitSet([2,0]),FOLLOW_logicalExpression_in_expression514:new org.antlr.runtime.BitSet([2,0]),FOLLOW_whileLoop_in_expression520:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forLoop_in_expression526:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forInLoop_in_expression532:new org.antlr.runtime.BitSet([2,0]),FOLLOW_ifThenElse_in_expression538:new org.antlr.runtime.BitSet([2,0]),FOLLOW_functionDef_in_expression544:new org.antlr.runtime.BitSet([2,0]),FOLLOW_returnExp_in_expression550:new org.antlr.runtime.BitSet([2,0]),FOLLOW_tryCatch_in_expression556:new org.antlr.runtime.BitSet([2,0]),FOLLOW_throwExp_in_expression562:new org.antlr.runtime.BitSet([2,0]),FOLLOW_RETURNSTATEMENT_in_returnExp574:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_returnExp577:new org.antlr.runtime.BitSet([2,0]),FOLLOW_expression_in_innerBlock590:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_innerBlock594:new org.antlr.runtime.BitSet([2,2420114497,3406037171,131079]),FOLLOW_WHILESTATEMENT_in_whileLoop619:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_whileLoop621:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_whileLoop623:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_whileLoop626:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_whileLoop629:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_whileLoop631:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FORSTATEMENT_in_forLoop652:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_forLoop654:new org.antlr.runtime.BitSet([0,4096]),FOLLOW_FROMSTATEMENT_in_forLoop656:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop658:new org.antlr.runtime.BitSet([0,65536]),FOLLOW_TOSTATEMENT_in_forLoop660:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop662:new org.antlr.runtime.BitSet([0,524289]),FOLLOW_BYSTATEMENT_in_forLoop665:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop667:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_forLoop671:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_forLoop674:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_forLoop677:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_forLoop679:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FORSTATEMENT_in_forInLoop707:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_forInLoop709:new org.antlr.runtime.BitSet([0,16384]),FOLLOW_INSTATEMENT_in_forInLoop711:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forInLoop713:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_forInLoop715:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_forInLoop718:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_forInLoop721:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_forInLoop723:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IFSTATEMENT_in_ifThenElse748:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_ifThenElse750:new org.antlr.runtime.BitSet([0,8388608]),FOLLOW_THENSTATEMENT_in_ifThenElse752:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse755:new org.antlr.runtime.BitSet([0,3527410753,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse758:new org.antlr.runtime.BitSet([0,1107296256]),FOLLOW_ELSESTATEMENT_in_ifThenElse762:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IFSTATEMENT_in_ifThenElse764:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_ifThenElse766:new org.antlr.runtime.BitSet([0,8388608]),FOLLOW_THENSTATEMENT_in_ifThenElse768:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse770:new org.antlr.runtime.BitSet([0,3527410753,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse773:new org.antlr.runtime.BitSet([0,1107296256]),FOLLOW_ELSESTATEMENT_in_ifThenElse778:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse780:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse783:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_ifThenElse787:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IFSTATEMENT_in_ifThenElse789:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FUNCTIONSTATEMENT_in_functionDef820:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef822:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_functionDef824:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_functionDef827:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_functionDef831:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_functionDef834:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_functionDef839:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef841:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_functionDef848:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef850:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_functionDef852:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_functionDef854:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_functionDef861:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_functionDef863:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_functionDef866:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_functionDef869:new org.antlr.runtime.BitSet([0,268435456]),FOLLOW_FUNCTIONSTATEMENT_in_functionDef871:new org.antlr.runtime.BitSet([2,0]),FOLLOW_TRYSTATEMENT_in_tryCatch904:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_tryCatch906:new org.antlr.runtime.BitSet([0,2420114497,3406037179,131079]),FOLLOW_innerBlock_in_tryCatch909:new org.antlr.runtime.BitSet([0,0,8,0]),FOLLOW_CATCHSTATEMENT_in_tryCatch911:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_tryCatch913:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_tryCatch915:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_tryCatch919:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_tryCatch921:new org.antlr.runtime.BitSet([0,0,2,0]),FOLLOW_TRYSTATEMENT_in_tryCatch923:new org.antlr.runtime.BitSet([2,0]),FOLLOW_THROWSTATEMENT_in_throwExp945:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_primaryExpression_in_throwExp947:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef967:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_anonFunctionDef970:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_anonFunctionDef973:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_anonFunctionDef977:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_anonFunctionDef980:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_anonFunctionDef985:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_anonFunctionDef987:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_anonFunctionDef994:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_anonFunctionDef996:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_anonFunctionDef998:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_anonFunctionDef1000:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_anonFunctionDef1007:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_NEWLINE_in_anonFunctionDef1012:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_anonFunctionDef1015:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_anonFunctionDef1018:new org.antlr.runtime.BitSet([0,268435456]),FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef1020:new org.antlr.runtime.BitSet([2,0]),FOLLOW_expression_in_anonFunctionDef1025:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_assignment1067:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_assignment1069:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_assignment1072:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_assignment1076:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_assignment1078:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_assignment1083:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_assignment1085:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_assignment1092:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_assignment1094:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_assignment1096:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_assignment1098:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_assignment1105:new org.antlr.runtime.BitSet([0,0,0,524288]),FOLLOW_115_in_assignment1107:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_assignment1109:new org.antlr.runtime.BitSet([2,0]),FOLLOW_PRIMITIVE_in_assignment1137:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_assigned_in_assignment1141:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_COMMA_in_assignment1145:new org.antlr.runtime.BitSet([0,0,160,0]),FOLLOW_PRIMITIVE_in_assignment1148:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_assigned_in_assignment1152:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_115_in_assignment1158:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_assignment1160:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_assigned1186:new org.antlr.runtime.BitSet([2,0,167772160,1048576]),FOLLOW_selector_in_assigned1188:new org.antlr.runtime.BitSet([2,0]),FOLLOW_booleanXORExpression_in_logicalExpression1214:new org.antlr.runtime.BitSet([2,0,256,0]),FOLLOW_OR_in_logicalExpression1217:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanXORExpression_in_logicalExpression1220:new org.antlr.runtime.BitSet([2,0,256,0]),FOLLOW_booleanAndExpression_in_booleanXORExpression1250:new org.antlr.runtime.BitSet([2,0,512,0]),FOLLOW_XOR_in_booleanXORExpression1253:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanAndExpression_in_booleanXORExpression1256:new org.antlr.runtime.BitSet([2,0,512,0]),FOLLOW_equalityExpression_in_booleanAndExpression1285:new org.antlr.runtime.BitSet([2,0,2048,0]),FOLLOW_AND_in_booleanAndExpression1288:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_equalityExpression_in_booleanAndExpression1291:new org.antlr.runtime.BitSet([2,0,2048,0]),FOLLOW_relationalExpression_in_equalityExpression1322:new org.antlr.runtime.BitSet([2,0,4160,0]),FOLLOW_set_in_equalityExpression1325:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_relationalExpression_in_equalityExpression1332:new org.antlr.runtime.BitSet([2,0,4160,0]),FOLLOW_additiveExpression_in_relationalExpression1374:new org.antlr.runtime.BitSet([2,0,122880,0]),FOLLOW_set_in_relationalExpression1378:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_additiveExpression_in_relationalExpression1389:new org.antlr.runtime.BitSet([2,0,122880,0]),FOLLOW_multiplicativeExpression_in_additiveExpression1432:new org.antlr.runtime.BitSet([2,0,393216,0]),FOLLOW_set_in_additiveExpression1436:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_multiplicativeExpression_in_additiveExpression1443:new org.antlr.runtime.BitSet([2,0,393216,0]),FOLLOW_arrayExpression_in_multiplicativeExpression1473:new org.antlr.runtime.BitSet([2,0,3670016,0]),FOLLOW_set_in_multiplicativeExpression1477:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_arrayExpression_in_multiplicativeExpression1486:new org.antlr.runtime.BitSet([2,0,3670016,0]),FOLLOW_negationExpression_in_arrayExpression1532:new org.antlr.runtime.BitSet([2,0,4194304,0]),FOLLOW_COLON_in_arrayExpression1538:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_arrayExpression1542:new org.antlr.runtime.BitSet([2,0,4194304,0]),FOLLOW_COLON_in_arrayExpression1551:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_arrayExpression1555:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_negationExpression1580:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_powerExpression_in_negationExpression1582:new org.antlr.runtime.BitSet([2,0]),FOLLOW_powerExpression_in_negationExpression1596:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unaryExpression_in_powerExpression1607:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_POW_in_powerExpression1610:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_unaryOrNegate_in_powerExpression1612:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_unaryExpression_in_unaryOrNegate1639:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_unaryOrNegate1645:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_unaryExpression_in_unaryOrNegate1647:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NOT_in_unaryExpression1675:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_innerPrimaryExpression_in_unaryExpression1678:new org.antlr.runtime.BitSet([2,0]),FOLLOW_innerPrimaryExpression_in_unaryExpression1687:new org.antlr.runtime.BitSet([2,0]),FOLLOW_selectionExpression_in_innerPrimaryExpression1718:new org.antlr.runtime.BitSet([2,0]),FOLLOW_primaryExpression_in_selectionExpression1738:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_selector_in_selectionExpression1744:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_funCall_in_selectionExpression1746:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_113_in_funCall1761:new org.antlr.runtime.BitSet([0,268435456,3406037153,393223]),FOLLOW_logicalExpression_in_funCall1765:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_funCall1768:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_funCall1770:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_funCall1777:new org.antlr.runtime.BitSet([2,0]),FOLLOW_113_in_primaryExpression1798:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_primaryExpression1801:new org.antlr.runtime.BitSet([0,0,0,262144]),FOLLOW_114_in_primaryExpression1803:new org.antlr.runtime.BitSet([2,0]),FOLLOW_value_in_primaryExpression1809:new org.antlr.runtime.BitSet([2,0]),FOLLOW_number_in_value1823:new org.antlr.runtime.BitSet([2,0]),FOLLOW_bool_in_value1829:new org.antlr.runtime.BitSet([2,0]),FOLLOW_string_in_value1835:new org.antlr.runtime.BitSet([2,0]),FOLLOW_material_in_value1841:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_value1846:new org.antlr.runtime.BitSet([2,0]),FOLLOW_primitive_in_value1851:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_value1856:new org.antlr.runtime.BitSet([2,0]),FOLLOW_anonFunctionDef_in_value1861:new org.antlr.runtime.BitSet([2,0]),FOLLOW_newObject_in_value1866:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWSTATEMENT_in_newObject1876:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_newObject1878:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_funCall_in_newObject1880:new org.antlr.runtime.BitSet([2,0]),FOLLOW_negnumber_in_defaultValue1906:new org.antlr.runtime.BitSet([2,0]),FOLLOW_number_in_defaultValue1912:new org.antlr.runtime.BitSet([2,0]),FOLLOW_bool_in_defaultValue1918:new org.antlr.runtime.BitSet([2,0]),FOLLOW_string_in_defaultValue1924:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_defaultValue1930:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LARR_in_array1944:new org.antlr.runtime.BitSet([0,268435457,3473670305,131079]),FOLLOW_NEWLINE_in_array1946:new org.antlr.runtime.BitSet([0,268435457,3473670305,131079]),FOLLOW_label_in_array1950:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1952:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_COMMA_in_array1956:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_NEWLINE_in_array1958:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_label_in_array1961:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1963:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1970:new org.antlr.runtime.BitSet([0,1,67108864,0]),FOLLOW_RARR_in_array1973:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_array1987:new org.antlr.runtime.BitSet([0,268435457,3674996897,131079]),FOLLOW_NEWLINE_in_array1989:new org.antlr.runtime.BitSet([0,268435457,3674996897,131079]),FOLLOW_label_in_array1993:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_NEWLINE_in_array1995:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_COMMA_in_array1998:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_NEWLINE_in_array2000:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_label_in_array2003:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_NEWLINE_in_array2005:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_NEWLINE_in_array2012:new org.antlr.runtime.BitSet([0,1,268435456,0]),FOLLOW_RCURL_in_array2015:new org.antlr.runtime.BitSet([2,0]),FOLLOW_minarray_in_selector2036:new org.antlr.runtime.BitSet([2,0]),FOLLOW_dotselector_in_selector2040:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LARR_in_minarray2067:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2072:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_MULT_in_minarray2074:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_COMMA_in_minarray2078:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2082:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_MULT_in_minarray2084:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_RARR_in_minarray2091:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_minarray2097:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2102:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_MULT_in_minarray2104:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_COMMA_in_minarray2108:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2112:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_MULT_in_minarray2114:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_RCURL_in_minarray2121:new org.antlr.runtime.BitSet([2,0]),FOLLOW_116_in_dotselector2133:new org.antlr.runtime.BitSet([0,0,1074266144,0]),FOLLOW_arrayName_in_dotselector2135:new org.antlr.runtime.BitSet([2,0,0,1048576]),FOLLOW_set_in_arrayName0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_arrayName_in_label2173:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_NEWLINE_in_label2175:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_COLON_in_label2178:new org.antlr.runtime.BitSet([0,268435457,3406037153,131079]),FOLLOW_NEWLINE_in_label2182:new org.antlr.runtime.BitSet([0,268435457,3406037153,131079]),FOLLOW_logicalExpression_in_label2185:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_number0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_negnumber2261:new org.antlr.runtime.BitSet([0,0,2147483648,1]),FOLLOW_number_in_negnumber2263:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_bool0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_material2415:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_additiveExpression_in_material2417:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitMultiplicativeExpression_in_material2421:new org.antlr.runtime.BitSet([0,0,268435456,0]),FOLLOW_RCURL_in_material2423:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2460:new org.antlr.runtime.BitSet([2,0,0,8]),FOLLOW_PER_in_unitMultiplicativeExpression2464:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2467:new org.antlr.runtime.BitSet([2,0,0,8]),FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2483:new org.antlr.runtime.BitSet([2,0,1572864,0]),FOLLOW_set_in_unitInnerMultiplicativeExpression2487:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2494:new org.antlr.runtime.BitSet([2,0,1572864,0]),FOLLOW_INTEGER_in_unitClump2510:new org.antlr.runtime.BitSet([0,0,1048576,0]),FOLLOW_DIV_in_unitClump2512:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitPowerExpression_in_unitClump2515:new org.antlr.runtime.BitSet([2,0,0,48]),FOLLOW_CUBED_in_unitClump2517:new org.antlr.runtime.BitSet([2,0,0,32]),FOLLOW_SQUARED_in_unitClump2520:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unitPowerExpression_in_unitClump2543:new org.antlr.runtime.BitSet([2,0,0,48]),FOLLOW_CUBED_in_unitClump2545:new org.antlr.runtime.BitSet([2,0,0,32]),FOLLOW_SQUARED_in_unitClump2548:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unit_in_unitPowerExpression2610:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_POW_in_unitPowerExpression2614:new org.antlr.runtime.BitSet([0,0,2147745792,1]),FOLLOW_MINUS_in_unitPowerExpression2617:new org.antlr.runtime.BitSet([0,0,2147483648,1]),FOLLOW_set_in_unitPowerExpression2620:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_IDENT_in_unit2638:new org.antlr.runtime.BitSet([2,0,32,0]),FOLLOW_IDENT_in_unit2641:new org.antlr.runtime.BitSet([2,0,32,0]),FOLLOW_113_in_unit2658:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitMultiplicativeExpression_in_unit2660:new org.antlr.runtime.BitSet([0,0,0,262144]),FOLLOW_114_in_unit2662:new org.antlr.runtime.BitSet([2,0]),FOLLOW_PRIMITIVE_in_primitive2731:new org.antlr.runtime.BitSet([2,0]),FOLLOW_STRING_in_string3200:new org.antlr.runtime.BitSet([2,0]),FOLLOW_assignment_in_synpred5_Formula508:new org.antlr.runtime.BitSet([2,0]),FOLLOW_logicalExpression_in_synpred6_Formula514:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forLoop_in_synpred8_Formula526:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forInLoop_in_synpred9_Formula532:new org.antlr.runtime.BitSet([2,0]),FOLLOW_functionDef_in_synpred11_Formula544:new org.antlr.runtime.BitSet([2,0]),FOLLOW_OR_in_synpred47_Formula1217:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanXORExpression_in_synpred47_Formula1220:new org.antlr.runtime.BitSet([2,0]),FOLLOW_XOR_in_synpred48_Formula1253:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanAndExpression_in_synpred48_Formula1256:new org.antlr.runtime.BitSet([2,0]),FOLLOW_AND_in_synpred49_Formula1288:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_equalityExpression_in_synpred49_Formula1291:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred51_Formula1325:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_relationalExpression_in_synpred51_Formula1332:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred55_Formula1378:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_additiveExpression_in_synpred55_Formula1389:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred57_Formula1436:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_multiplicativeExpression_in_synpred57_Formula1443:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred60_Formula1477:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_arrayExpression_in_synpred60_Formula1486:new org.antlr.runtime.BitSet([2,0]),FOLLOW_COLON_in_synpred61_Formula1538:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_synpred61_Formula1542:new org.antlr.runtime.BitSet([2,0]),FOLLOW_COLON_in_synpred62_Formula1551:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_synpred62_Formula1555:new org.antlr.runtime.BitSet([2,0]),FOLLOW_POW_in_synpred64_Formula1610:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_unaryOrNegate_in_synpred64_Formula1612:new org.antlr.runtime.BitSet([2,0]),FOLLOW_selector_in_synpred68_Formula1744:new org.antlr.runtime.BitSet([2,0]),FOLLOW_funCall_in_synpred68_Formula1746:new org.antlr.runtime.BitSet([2,0]),FOLLOW_material_in_synpred75_Formula1841:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_synpred78_Formula1856:new org.antlr.runtime.BitSet([2,0]),FOLLOW_funCall_in_synpred80_Formula1880:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred85_Formula1946:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred86_Formula1952:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred87_Formula1958:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred88_Formula1963:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred93_Formula1989:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred94_Formula1995:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred95_Formula2000:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred96_Formula2005:new org.antlr.runtime.BitSet([2,0]),FOLLOW_116_in_synpred108_Formula2133:new org.antlr.runtime.BitSet([0,0,1074266144,0]),FOLLOW_arrayName_in_synpred108_Formula2135:new org.antlr.runtime.BitSet([2,0]),FOLLOW_arrayName_in_synpred112_Formula2173:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_NEWLINE_in_synpred112_Formula2175:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_COLON_in_synpred112_Formula2178:new org.antlr.runtime.BitSet([2,0])})}();function Simulator(t){this.randLoc=-1;this.lastRandPos=-1;this.previousRandLists=[];this.valuedPrimitives=[];this.unitsToBases={};this.distanceCache={};this.sliders={};this.ids={};this.idCount=0;this.stochastic=!1}Simulator.prototype.setup=function(t){this.model=t.model;this.solversCompletedFirstPass=0;this.timeStart=this.model.timeStart;this.timeLength=this.model.timeLength;this.timePause=this.model.timePause;this.timeEnd=plus(this.timeStart,this.timeLength);this.timeStep=this.model.solvers.base.timeStep;this.userTimeStep=this.model.solvers.base.userTimeStep;this.timeUnits=this.timeStart.units;this.timeUnits.addBase();this.oldAggregateSeries=[];this.distanceCache={};this.tasks=new TaskQueue({start:this.timeStart,end:this.timeEnd})};Simulator.prototype.getID=function(t){if(!this.ids[t]){this.idCount++;this.ids[t]=this.idCount}return this.ids[t]};Simulator.prototype.time=function(){return this.tasks.time};Simulator.prototype.timeProgressed=function(){return minus(this.time(),this.timeStart)};Simulator.prototype.frame=function(t,e){for(var n=t.length,i=0;i<n;i++)t[i].storeValue();this.printStates(e)};Simulator.prototype.step=function(t){if(!t.completedFirstPass){t.completedFirstPass=!0;this.solversCompletedFirstPass++;this.solversCompletedFirstPass==Object.keys(this.model.solvers).length&&this.config.onCompletedFirstPass&&this.config.onCompletedFirstPass()}if(t.displayed.length>0)for(var e=this.results[t.displayed[0].id].results.length;e<this.results.Time.length;e++)for(var n=0;n<t.displayed.length;n++)this.results[t.displayed[n].id].results.push(this.results.data[e][t.displayed[n].id]);this.config.onStep&&this.config.onStep(t)};Simulator.prototype.sleep=function(t){if(this.config)if(this.config.silent)this.config.onPause&&(this.shouldSleep=!0);else{window.storyConverter?this.shouldSleep=!1:this.shouldSleep=!0;this.shouldUpdateScripter=t}};Simulator.prototype.resume=function(){try{this.run()}catch(t){return checkErr(t,this.config)}};Simulator.prototype.completed=function(){return this.terminated||this.tasks.completed()};Simulator.prototype.terminate=function(){if(!this.terminated){clearTimeout(this.timer);this.sleep();this.terminated=!0;this.resultsWindow&&this.resultsWindow.scripter.finished()}};Simulator.prototype.run=function(t){var e=this,n=function(t,i){e.tasks.add(new Task({time:t,expires:1,name:"Interval Pause",priority:1,action:function(){e.sleep(!0);i&&lessThan(plus(t,e.timePause),e.timeEnd)&&n(plus(t,e.timePause),i)}}));e.tasks.add(new Task({time:t,expires:1,name:"Interval Pause",priority:1,action:function(){if(e.valueChange){simulate.valuedPrimitives=[];for(var t in e.model.solvers){for(var n=e.model.solvers[t],i=0;i<n.valued.length;i++)n.valued[i].clearCached();for(i=0;i<n.flows.length;i++)n.flows[i].predict(!0)}e.valueChange=!1}}}))};if(t){this.config=t;for(var i=Object.keys(this.model.solvers),r=0;r<i.length;r++)this.createSolver(this.model.solvers[i[r]]);this.timePause&&!window.storyConverter&&n(plus(this.timeStart,this.timePause),!0);this.tasks.tasks.goMin()}this.wakeUpTime=(new Date).getTime();try{for(;!this.completed();){this.tasks.step();if(this.shouldSleep){for(let t in this.model.solvers)updateDisplayed(this.model.solvers[t]);if(this.shouldUpdateScripter){this.resultsWindow.scripter.endMode="pause";this.shouldUpdateScripter=!1}this.config.onPause&&setTimeout(function(){var t=formatSimResults(this.results),n=t.data.length,i=t.data[n-1];for(var r in i)t[r].results.length<n&&t[r].results.push(i[r]);t.resume=e.resume.bind(this);t.setValue=function(t,e){var n=simpleEquation(""+e,{"-parent":varBank});this.valuedPrimitives.forEach((function(e){if(e.id==t.id)if(n.fullClone){e.dna.equation=n.fullClone();e.equation=n.fullClone()}else{e.dna.equation=n;e.equation=n}}));this.valueChange=!0}.bind(this);e.config.onPause(t)}.bind(this),10);this.shouldSleep=!1;return}}}catch(t){if("STOP"!=t.msg)throw t}this.results=formatSimResults(this.results);this.results.stochastic=this.stochastic;this.config.onSuccess&&this.config.onSuccess(this.results);this.terminate();if(this.resultsWindow){this.results.window=this.resultsWindow;for(let t in this.model.solvers)updateDisplayed(this.model.solvers[t])}return this.results};Simulator.prototype.progress=function(){return div(minus(this.time(),this.timeStart),this.timeLength).value};Simulator.prototype.printStates=function(t){var e=parseFloat(this.time().value.toPrecision(20));if(-1==this.results.Time.indexOf(e)){for(var n=this.results.Time.length;n>0;n--)if(this.results.Time[n-1]<e){this.results.Time.splice(n,0,e);this.results.data.splice(n,0,{});break}if(0==n){this.results.Time.splice(0,0,e);this.results.data.splice(0,0,{})}}var i=this.results.data[this.results.Time.indexOf(e)];for(n=0;n<t.length;n++){var r=t[n];if(!(r instanceof State&&isDefined(i[r.id])))if(r instanceof Agents){this.results[r.id].dataMode="agents";i[r.id]={current:r.collectData()}}else{var a=r.value();if(a instanceof Vector&&!a.names){a.recurseApply((t=>this.adjustNum(r,t)));i[r.id]=a;this.results[r.id].dataMode="auto"}else if(a instanceof Vector){a.recurseApply((t=>this.adjustNum(r,t)));i[r.id]=a}else if(a instanceof Agent){i[r.id]=a;this.results[r.id].dataMode="auto"}else i[r.id]=this.adjustNum(r,a)}}};Simulator.prototype.unitsToBase=function(t,e,n){var i=t.id+"-"+(e?e.id:"");if(i in this.unitsToBases)return this.unitsToBases[i];var r=1;n&&(r=this.timeUnits.toBase);var a=1;if(e){e.addBase();a=e.toBase}this.unitsToBases[i]=fn["/"](fn["/"](sn("#e"+a),t.dna.toBase),sn("#e"+r));return this.unitsToBases[i]};Simulator.prototype.adjustNum=function(t,e){t.unitless&&e.units&&error(getText("The result of the calculation has units %s, but the primitive is unitless. Please set the units for the primitive so we can determine the proper output.",e.units.toString()),findID(t.id),!0);t instanceof Flow&&!t.dna.flowUnitless&&(e=mult(e,new Material(1,this.timeUnits)));return t instanceof State||!e.units&&!(t instanceof Flow)?"object"==typeof e&&"value"in e?+e.value:e:+(e=fn["*"](e.value,this.unitsToBase(t,e.units,t instanceof Flow)))};Simulator.prototype.createSolver=function(t){var e=this,n=t.stocks,i=t.flows,r=t.actions,a=t.transitions,s=t.valued,o=t.displayed,l=t.id,u=t.timeStep,h=t.RKOrder;t.RKPosition=1;var c=u.value;if(-1==(c=c.toPrecision()).indexOf("."))var d=0;else d=c.length-c.indexOf(".")-1;for(var m=parseFloat(c.replace(".","")),f=0,p=[],g=Math.ceil((e.timeEnd.value-e.timeStart.value)/u.value),_=0;_<=g+2;_++)p.push(new Material(e.timeStart.value+_*m/Math.pow(10,d),u.units));var v=r.length;for(_=0;_<v;_++)"Condition"!==r[_].dna.trigger&&updateTrigger.call(r[_]);for(v=a.length,_=0;_<v;_++)updateTrigger.call(a[_]);function S(t,e){if(t instanceof Vector){var n=!1;t.recurseApply((function(t){n=n||e(t)}));return n}return e(t)}function N(t){return t&&S(t.toNum(),(function(t){return t instanceof Material&&t.value<0}))}function E(t,e,n){for(var r,a=i.length,s=[],o=0;o<a;o++)i[o].alpha&&i[o].alpha.dna.nonNegative&&((r=i[o].rate)&&S(r.toNum(),(function(t){return t instanceof Material&&t.value>0})))||i[o].omega&&i[o].omega.dna.nonNegative&&N(i[o].rate)?s.push(i[o]):i[o].apply(t,e,n);for(o=0;o<s.length;o++)s[o].apply(t,e,n)}if(1==h){this.tasks.addEvent((function(t,e,n){E.apply(null,arguments)}));!function n(l,u,h){e.tasks.add(new Task({time:l,expires:1,name:"RK1 Solver - "+t.id,action:function(){simulate.valuedPrimitives=[];if(h){for(var l=i.length,c=0;c<l;c++)i[c].clean();l=s.length;for(c=0;c<l;c++)s[c].clearCached()}e.frame(s,o);for(l=r.length,c=0;c<l;c++)r[c].dna.recalculate&&!r[c].block&&updateTrigger.call(r[c]);l=a.length;for(c=0;c<l;c++)a[c].dna.recalculate&&updateTrigger.call(a[c]);e.step(t);if(u&&f<=g){f++;n(p[f],!0,!0)}}}))}(this.timeStart,!0)}else{if(4!=h)throw"Unknown solution algorithm.";this.tasks.addEvent((function(t,e,n){t.value>0&&E.apply(null,arguments)}));!function u(h,c){e.tasks.add(new Task({time:h,name:"RK4 Solver (Init)  - "+t.id,priority:-10,expires:1,blocker:l+" init",action:function(){for(var e=i.length,n=0;n<e;n++)i[n].clean();simulate.valuedPrimitives=[];e=s.length;for(n=0;n<e;n++)s[n].clearCached();t.RKPosition=1;this.unblock(l+" start");this.block()}}));e.tasks.add(new Task({time:h,name:"RK4 Solver (step 1) - "+t.id,priority:-5,expires:4,blocker:l+" start",action:function(){if(t.RKPosition>1){simulate.valuedPrimitives=[];for(var i=s.length,h=0;h<i;h++){s[h].clearCached();s[h].pastValues.pop()}}e.frame(s,o);if(4==t.RKPosition){for(i=r.length,h=0;h<i;h++)r[h].dna.recalculate&&!r[h].block&&updateTrigger.call(r[h]);i=a.length;for(h=0;h<i;h++)a[h].dna.recalculate&&updateTrigger.call(a[h]);this.unblock(l+" init");c&&f<=g&&u(p[f+=2],!0);e.step(t)}else if(eq(simulate.time(),simulate.timeEnd))e.step(t);else for(i=n.length,h=0;h<i;h++)n[h].preserveLevel();this.block();this.unblock(l+" mid")},rollback:function(){for(var t=n.length,e=0;e<t;e++)n[e].restoreLevel()}}));e.tasks.add(new Task({time:p[f+1],name:"RK4 Solver (step 2,3) - "+t.id,priority:-10,expires:2,blocker:l+" mid",action:function(){simulate.valuedPrimitives=[];for(var e=s.length,n=0;n<e;n++)s[n]instanceof State||s[n].clearCached();t.RKPosition++;e=i.length;for(n=0;n<e;n++){i[n].rate=null;i[n].predict()}this.unblock(l+" start");this.block()},timeShift:function(){e.tasks.moveTo(p[f])}}));e.tasks.add(new Task({time:p[f+2],name:"RK4 Solver (step 4) - "+t.id,priority:-30,expires:1,action:function(){simulate.valuedPrimitives=[];for(var e=s.length,n=0;n<e;n++)s[n]instanceof State||s[n].clearCached();t.RKPosition++;e=i.length;for(n=0;n<e;n++){i[n].rate=null;i[n].predict()}this.unblock(l+" start")},timeShift:function(){e.tasks.moveTo(p[f])}}))}(this.timeStart,!0)}};var baseSources=["Degree","Radians?","Ampere","Gram","Second","Meter","(Meters? ?Squared?|Squared? ?Meters?)","(Centimeters? ?Squared?|Squared? ?Centimeters?)","(Centimeters? ?Cubed?|Cubic ?Centimeters?)","(Meters? Cubed?|Cubic ?Meters?)","(Kilometers? ?Cubed?|Cubic ?Kilometers?)","(Inches? Squared?|Squared? ?Inches?)","(Miles? ?Squared?|Squared? ?Miles?)","(Kilometers? Squared?|Squared? ?Kilometers?)","Acre? ?(Feet|Foot)","Meters? ?per ?Seconds?","Meters? ?per ?Seconds? ?Squared?","(Foot|Feet) ?per ?Seconds?","(Foot|Feet) ?per ?Seconds? ?Squared?","Miles? ?per ?Hours?","Miles? ?per ?Hours? ?Squared?","Kilometers? ?per ?Hours?","Kilometers? ?per ?Hours? ?Squared?","Liters? ?per ?Seconds?","(Cubic ?Meters?|Meters? ?Cubed?) ?per ?Seconds?","(Squared? ?Yards?|Yards? ?Squared?)","(Squared? ?(Feet|Foot)|(Feet|Foot) ?Squared?)","(Squared? Millimeters?|Millimeters? ?Squared?)","(Millimeters? ?Cubed?|Cubic ?Millimeters?)","Gallons? ?per ?Seconds?","Gallons? ?per ?Minutes?","Pounds? ?per ?Seconds?","Kilograms? ?per ?Seconds?","Dollars? ?per ?Seconds?","Dollars? ?per ?Hours?","Dollars? ?per ?Days?","Dollars? ?per ?Weeks?","Dollars? ?per ?Months?","Dollars? ?per ?Quarters?","Dollars? ?per ?Years?","Euros? ?per ?Seconds?","Euros? ?per ?Hours?","Euros? ?per ?Days?","Euros? ?per ?Weeks?","Euros? ?per ?Months?","Euros? ?per ?Quarters?","Euros? ?per ?Years?","Centimeters?","Millimeters?","Kilometers?","Inch(es)?","(Foot|Feet)","Yards?","Miles?","Acres?","Hectares?","Liters?","Gallons?","Quarts?","Fluid ?Ounces?","Years?","Quarters?","Months?","Weeks?","Days?","Hours?","Minutes?","Kilograms?","Milligrams?","Ounces?","Pounds?","Tonnes?","Tons?","Watts?","Kilowatts?","Megawatts?","Gigawatts?","Calories?","Kilocalories?","(BTUs?|British ?Thermal ?units?)","Kilojoules?","Joules?","Coulombs?","Volts?","Millivolts?","Kilovolts?","Newtons?","Pounds? ?Force","Atoms?","Molecules?","Farads?","Pascals?","Kilopascals?","Bars?","Atmospheres?","Pounds? ?per ?Squared? ?Inch(es)?"],baseTargets=["Degrees","Degrees","Amperes","Grams","Seconds","Meters","Meters^2","Centimeters^2","Centimeters^3","Meters^3","Kilometers^3","Inches^2","Miles^2","Kilometers^2","Acres,Feet","Meters,Seconds^-1","Meters,Seconds^-2","Feet,Seconds^-1","Feet,Seconds^-2","Miles,Hours^-1","Miles,Hours^-2","Kilometers,Hours^-1","Kilometers,Hours^-2","Liters,Seconds^-1","Meters^3,Seconds^-1","Yards^2","Feet^2","Millimeters^2","Millimeters^3","Gallons,Seconds^-1","Gallons,Minutes^-1","Pounds,Seconds^-1","Kilograms,Seconds^-1","Dollars,Seconds^-1","Dollars,Hours^-1","Dollars,Days^-1","Dollars,Weeks^-1","Dollars,Months^-1","Dollars,Quarters^-1","Dollars,Years^-1","Euros,Seconds^-1","Euros,Hours^-1","Euros,Days^-1","Euros,Weeks^-1","Euros,Months^-1","Euros,Quarters^-1","Euros,Years^-1","Meters","Meters","Meters","Meters","Meters","Meters","Meters","Meters^2","Meters^2","Meters^3","Meters^3","Meters^3","Meters^3","Seconds","Seconds","Seconds","Seconds","Seconds","Seconds","Seconds","Grams","Grams","Grams","Grams","Grams","Grams","Joules,Seconds^-1","Watts","Watts","Watts","Joules","Joules","Joules","Joules","Newtons,Meters","Amperes,Seconds","Watts,Amperes^-1","Volts","Volts","Kilograms,Meters,Seconds^-2","Pounds,Feet per Second Squared","Moles","Moles","Joules,Volts^-2","Newton,Meters^-2","Pascals","Pascals","Pascals","Pascals"],baseScalings=[1,180/Math.PI,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,.01,.001,1e3,.0254,.3048,.9144,1609.344,4046.85642,1e4,.001,.003785,946e-6,3e-5,31536e3,7884e3,2628e3,604800,86400,3600,60,1e3,.001,28.349523,453.59237,1e6,907184.74,1,1e3,1e6,1e9,4.184,4184,1055.05585,1e3,1,1,1,.001,1e3,1,32.17405,0,0,1,1,1e3,1e5,101325,6894],conScalings=[],conTargets=[],conSourceNames=[],conUnitTargets=[],conSourceRegEx=[];function loadUnits(t,e,n){conScalings=n;conTargets=e;conSourceNames=t;for(var i=0;i<baseSources.length;i++){conScalings.push(baseScalings[i]);conTargets.push(baseTargets[i]);conSourceNames.push(baseSources[i])}conSourceRegEx=[];conUnitTargets=[];cachedUnits={};unitsBank={};for(var r=0;r<conTargets.length;r++){conUnitTargets.push(unitsFromString(conTargets[r].toLowerCase()));conSourceRegEx.push(new RegExp("^"+conSourceNames[r]+"$","i"))}}loadUnits([],[],[]);var cachedUnits={},findSourceIndex=function(t){if(t in cachedUnits)return cachedUnits[t];for(var e=conSourceNames.length-1;e>=0;e--)if(""!=cachedUnits[e]&&conSourceRegEx[e].test(t)){cachedUnits[t]=e;return e}cachedUnits[t]=-1;return-1};function Material(t,e){this.value=t;this.units=e}Material.prototype.toNum=function(){return this};Material.prototype.toString=function(){return this.units?"<span class='markup'>{</span>"+this.value+"&nbsp"+this.units.toString()+"<span class='markup'>}</span>":this.value+""};Material.prototype.fullClone=function(){return new Material(this.value,this.units)};Material.prototype.forceUnits=function(t){if(this.units){var e=convertUnits(this.units,t);if(0==e)unitAlert(this.units,t,"forceUnits");else{this.value=fn["*"](this.value,e);this.units=t}}else this.units=t;return this};function unitAlert(t,e,n){throw"MSG: Incompatible units for the "+n+" of "+(t?t.toString():"unitless")+" and "+(e?e.toString():"unitless")+"."}var unitsBank={};function sortAndCollapseUnits(t,e){if(t.length<=1)1==t.length&&(t[0]=t[0].toLowerCase());else{for(var n=[],i=0;i<t.length;i++)n.push({name:t[i].toLowerCase(),exponent:e[i]});n.sort((function(t,e){return t.name.localeCompare(e.name)}));t=[];e=[];for(i=0;i<n.length;i++){t.push(n[i].name);e.push(n[i].exponent)}for(i=0;i<t.length;i++){for(var r=i+1;r<t.length;r++)if(t[i]===t[r]){e[i]=e[i]+e[r];t.splice(r,1);e.splice(r,1);r--}if(0==e[i]){t.splice(i,1);e.splice(i,1);i--}}}return{names:t,exponents:e}}function getUnitStore(t,e,n){if(n){var i=sortAndCollapseUnits(t,e);t=i.names;e=i.exponents}if(0!=t.length){var r=getUnitsId(t,e);unitsBank[r]||(unitsBank[r]=new UnitStore(t,e));return unitsBank[r]}}function getUnitsId(t,e){return t.join(",")+e.join(",")}function UnitStore(t,e){this.names=t;this.exponents=e;this.toBase=null;this.baseUnits=null;this.multiples={};this.id=getUnitsId(this.names,this.exponents)}UnitStore.prototype.addBase=function(){if(!this.toBase){this.toBase=1;for(var t=this.names.slice(),e=this.exponents.slice(),n=!0;n;){n=!1;for(var i=t.length-1;i>=0;i--){var r=findSourceIndex(t[i]);if(-1!==r&&(1!=conUnitTargets[r].names.length||conUnitTargets[r].names[0]!=t[i])){this.toBase=fn["*"](this.toBase,fn.expt(conScalings[r],e[i]));(t=t.concat(conUnitTargets[r].names)).splice(i,1);(e=e.concat(conUnitTargets[r].exponents.map((function(t){return t*e[i]})))).splice(i,1);n=!0;break}}}var a=sortAndCollapseUnits(t,e);this.baseUnits=getUnitStore(a.names,a.exponents)}};UnitStore.prototype.power=function(t){for(var e=this.names.slice(),n=this.exponents.slice(),i=0;i<n.length;i++)n[i]=n[i]*t;return getUnitStore(e,n)};UnitStore.prototype.toStringShort=function(){for(var t="",e=0;e<this.names.length;e++){""!=t&&(t+=",");t+=this.names[e];1!=this.exponents[e]&&(t=t+"^"+this.exponents[e])}return t};UnitStore.prototype.multiply=function(t,e){var n=t.id+";"+e;if(!this.multiples[n]){this.toBase||this.addBase();t.toBase||t.addBase();if(this.baseUnits){var i=this.baseUnits.names.slice(),r=this.baseUnits.exponents.slice();if(t.baseUnits){for(var a=0;a<t.baseUnits.names.length;a++){var s=i.indexOf(t.baseUnits.names[a]);if(-1!=s)r[s]=r[s]+t.baseUnits.exponents[a]*e;else{for(var o=!1,l=0;l<i.length;l++)if(t.baseUnits.names[a]<i[l]){i.splice(l,0,t.baseUnits.names[a]);r.splice(l,0,t.baseUnits.exponents[a]*e);o=!0;break}if(!o){i.push(t.baseUnits.names[a]);r.push(t.baseUnits.exponents[a]*e)}}}for(a=r.length-1;a>=0;a--)if(0==r[a]){r.splice(a,1);i.splice(a,1)}}}else i=t.baseUnits.names.slice(),r=t.baseUnits.exponents.slice();this.multiples[n]=getUnitStore(i,r)}return this.multiples[n]};function unitsFromString(t){var e=[],n=[];if(""!=t)for(var i=t.split(","),r=0;r<i.length;r++){e.push(i[r].split("^")[0]);-1!=i[r].indexOf("^")?n.push(parseFloat(i[r].split("^")[1])):n.push(1)}return getUnitStore(e,n,!0)}var titleCaseReg=/\w\S*/g,titleCaseFunc=function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()},BigInteger;function toTitleCase(t){return t.replace(titleCaseReg,titleCaseFunc)}UnitStore.prototype.toString=function(){for(var t="",e="",n=0,i=0,r=0;r<this.names.length;r++)if(""!=this.names[r]){var a='<span class="unit">'+toTitleCase(this.names[r])+"</span>";1!=this.exponents[r]&&-1!=this.exponents[r]&&(a=a+"<span class='markup'>^</span><sup>"+Math.abs(this.exponents[r])+"</sup>");if(this.exponents[r]>0){n>0&&(t+="<span class='markup'>*</span>");t+=a;n+=1}else{i>0&&(e+="<span class='markup'>*</span>");e+=a;i+=1}}""==t&&(t="Unitless");if(""==e)return'<div class="units">'+t+"</div>";"Unitless"==t&&(t="1");return'<span class="units">'+t+"<hr/><span class='markup'>/(</span>"+e+"<span class='markup'>)</span></span>"};function convertUnits(t,e,n){if(t===e)return 1;if(t&&!e||e&&!t)return n?1:0;t.toBase||t.addBase();e.toBase||e.addBase();return t.baseUnits!==e.baseUnits?0:fn["/"](t.toBase,e.toBase)}BigInteger="undefined"!=typeof require?require("biginteger").BigInteger:this.BigInteger;if(!BigInteger)if("undefined"!=typeof load)load("biginteger.js");else{if(!this.readFile)throw new Error("BigInteger is not defined.");eval(this.readFile("biginteger.js"))}var SchemeNumber=function(){var t=Math.abs,e=Math.floor,i=Math.ceil,r=Math.round,a=Math.pow,s=Math.sqrt,o=Math.atan2,l=(Math.log,Math.exp),u=(Math.atan,Math.cos,Math.sin,Math.tan,Math.LN2),h=Math.LN10,c=isFinite,d=isNaN,m=parseInt,f=parseFloat;function p(){return!1}function g(){return!0}function _(t){return t}function v(){return this}function S(){throw new Error("BUG: unimplemented")}function N(){throw new Error("BUG: Abstract method not overridden for "+this)}function E(){}E.prototype=new Number;function T(){}T.prototype=new E;function F(){}F.prototype=new T;function b(){}b.prototype=new F;function L(){}L.prototype=new b;function w(){}w.prototype=new L;var k,O,x,y=/^(.*[^a-zA-Z]|)([-+].*)i$/,A=/^(.*)([-+].*)i$/,R=/^[-+](nan|inf)\.0$/,P=/[eEsSfFdDlL]/,C=/^([0-9]+\.?|[0-9]*\.[0-9]+)([eEsSfFdDlL][-+]?[0-9]+)?$/,M={2:/^[01]+$/,8:/^[0-7]+$/,10:/^[0-9]+$/,16:/^[0-9a-fA-F]+$/};function I(){return he}function B(){return ce}function D(){vt("&assertion","division by exact zero")}var V,W={},U=[[],["log","floor","ceil","sqrt","abs","atan","cos","sin","tan","exp"],["pow","atan2"]];if((k=function(t){this._=t})===Number){O=_;x=function(t){return t instanceof Number||"number"==typeof t};U[1].concat(U[2]).forEach((function(t){W[t]=Math[t]}))}else{k.prototype=new F;V=new k(0),O=function(t){return 0===t?V:new k(t)};x=function(t){return t instanceof E};U[1].forEach((function(t){var e=Math[t];W[t]=function(t){return O(e(t))}}));U[2].forEach((function(t){var e=Math[t];W[t]=function(t,n){return O(e(t,n))}}));["toFixed","toExponential","toPrecision"].forEach((function(t){var e=Number.prototype[t];k.prototype[t]=function(t){return e.call(this._)}}));k.prototype.valueOf=function(){return this._}}function G(t){if(t instanceof E)return t;var e=t;if("string"!=typeof e){if("number"==typeof e)return O(e);if(e instanceof Number)return O(+e);if(null==e)return null===e?Bt:Wt;if("number"==typeof(e=e.valueOf()))return O(e);e=String(e)}!1===(e=lt(e))&&vt("&assertion","not a number",t);return e}var j=G;j.VERSION=[1,1,4];var q=W.pow,z=W.log,H=W.floor,K=W.ceil,Q=W.sqrt,Y=W.atan2,X=W.abs,Z=W.atan,J=W.cos,$=W.sin,tt=W.tan,et=W.exp,nt={C:["Rectangular","R"],R:["Flonum","ER"],ER:["EQ"],EQ:["EQFraction","EI"],EI:["EINative","EIBig"]},it={C:T,R:F,ER:b,EQ:L,EI:w,Rectangular:Jt,Flonum:k,EQFraction:se,EINative:ue,EIBig:be},rt={};for(var at in it)rt[at]={};var st,ot=new Object;function lt(n,i,r){function a(){throw ot}function s(t){void 0!==r&&a();r=t}function o(t){i&&a();i=t}function l(t,e){M[i].test(t)||a();return!1===r?O(e*m(t,i)):oe(e,t,i)}function h(n){if(R.test(n)){r&&a();switch(n){case"+inf.0":return Dt;case"-inf.0":return Vt;default:return Wt}}var s=1;switch(n[0]){case"-":s=-1;case"+":n=n.substring(1)}var o=n.indexOf("/");if(-1!=o)return l(n.substring(0,o),s).SN_divide(l(n.substring(o+1),1));10!==i&&a();var h=n.indexOf("|");if(-1!==h){var c=n.substring(h+1);M[10].test(c)||a();n=n.substring(0,h);var d=m(c,10);if(0===d)n="0.0";else if(d<53)return function(n,s){var o=lt(n,i,!0);!1!==o&&o.SN_isReal()||a();if(!o.SN_isZero()){var l=o.SN_abs(),h=s-e(l.SN_log()/u)-1,c=me.SN_expt(_e(t(h)));h<0&&(c=c.SN_reciprocal());for(var d=l.SN_multiply(c),m=me.SN_expt(_e(s));d.SN_ge(m);){d=d.SN_divide(me);c=c.SN_divide(me)}for(var f=d.SN_add(d);f.SN_lt(m);f=d.SN_add(d)){d=f;c=c.SN_add(c)}var p=d.SN_round().SN_divide(c);o.SN_isNegative()&&(p=p.SN_negate());o=p}r||(o=o.SN_toInexact());return o}(n,d)}var p=(n=n.replace(P,"e")).indexOf("."),g=n.indexOf("e");if(-1===p&&-1===g)return l(n,s);C.test(n)||a();if(!r)return O(s*f(n));var _,v=n.substring(0,-1===p?g:p),S=0;if(-1===g)_=n.substring(p+1);else{_=-1===p?"":n.substring(p+1,g);S=m(n.substring(g+1),10)}return function(t,e,n){return oe(t,e).SN__exp10(n)}(s,v+_,S-_.length)}if(!i||10==i){if(/^-?[0-9]{1,15}$/.test(n))return!1===r?O(m(n,10)):_e(m(n,10));i=10}var c=0;try{for(;"#"===n[c];){switch(n[c+1]){case"i":case"I":s(!1);break;case"e":case"E":s(!0);break;case"b":case"B":o(2);break;case"o":case"O":o(8);break;case"d":case"D":o(10);break;case"x":case"X":o(16);break;default:return!1}c+=2}return function(t){var e=t.indexOf("@");if(-1!==e){var n=ht(h(t.substring(0,e)),h(t.substring(e+1)));r&&n.SN_isInexact()&&(n=n.SN_toExact());return n}if("i"!==t[t.length-1])return h(t);if("i"===t)return!1===r?Xt(Bt,O(1)):pe;if("-i"===t)return!1===r?Xt(Bt,O(-1)):ge;var a,s,o=(10===i?y:A).exec(t);if(o){a=o[1];s=o[2];a=a?h(a):!1===r?Bt:he;s="+"===s?ce:"-"===s?de:h(s)}else{a=!1===r?Bt:he;s=h(t.substring(0,t.length-1))}return ut(a,s)}(n.substring(c))}catch(t){if(t===ot)return!1;null==n&&vt("&assertion","missing argument");throw t}}function ut(t,e){return t.SN_isExact()&&e.SN_isExact()?Yt(t,e):Xt(t.SN_toInexact(),e.SN_toInexact())}function ht(t,e){return Xt(t.SN_multiply(e.SN_cos()),t.SN_multiply(e.SN_sin()))}function ct(t){t.SN_isReal()||vt("&assertion","not a real number",t);return t}function dt(t){(t=G(t)).SN_isReal()||ct(t);return t}function mt(t){(t=G(t)).SN_isInteger()||function(t){(t=G(t)).SN_isInteger()||vt("&assertion","not an integer",t)}(t);return t}function ft(t){t.SN_isRational()||vt("&assertion","not a rational number",t);return t}function pt(t){t.SN_isNegative()&&vt("&assertion","negative number",t);return t}function gt(t){t.SN_isInexact()&&vt("&assertion","inexact number",t);return t}j.raise=_t;function _t(t,e,n){var i="SchemeNumber: "+t+": "+e;if(arguments.length>2){x(n)&&(n=n.SN_numberToString());i+=": "+n}throw new Error(i)}function vt(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];G.raise.apply(G,e);_t.apply(this,e)}G.maxIntegerDigits=1e6;j.fn={"eqv?":function(t,e){2===arguments.length||Et(arguments);if(t===e)return!0;t=G(t);e=G(e);return t.SN_eq(e)&&t.SN_isExact()===e.SN_isExact()},"number?":function(t){1===arguments.length||Nt(arguments);return x(t)},"complex?":function(t){1===arguments.length||Nt(arguments);return x(t)&&t.SN_isComplex()},"real?":function(t){1===arguments.length||Nt(arguments);return x(t)&&t.SN_isReal()},"rational?":function(t){1===arguments.length||Nt(arguments);return x(t)&&t.SN_isRational()},"integer?":function(t){1===arguments.length||Nt(arguments);return x(t)&&t.SN_isInteger()},"real-valued?":bt,"rational-valued?":function(t){1===arguments.length||Nt(arguments);return bt(t)&&t.SN_realPart().SN_isRational()},"integer-valued?":function(t){1===arguments.length||Nt(arguments);return bt(t)&&t.SN_realPart().SN_isInteger()},"exact?":Lt("SN_isExact"),"inexact?":Lt("SN_isInexact"),inexact:Lt("SN_toInexact"),exact:Lt("SN_toExact"),"=":function(t,e){var n=arguments.length;n>1||Ft(arguments);t=G(t);for(var i=1;i<n;i++)if(!t.SN_eq(G(arguments[i])))return!1;return!0},"<":wt("SN_lt"),">":wt("SN_gt"),"<=":wt("SN_le"),">=":wt("SN_ge"),"zero?":Lt("SN_isZero"),"positive?":Lt("SN_isPositive"),"negative?":Lt("SN_isNegative"),"odd?":Lt("SN_isOdd"),"even?":Lt("SN_isEven"),"finite?":Lt("SN_isFinite"),"infinite?":Lt("SN_isInfinite"),"nan?":Lt("SN_isNaN"),max:kt("SN_gt"),min:kt("SN_lt"),"+":function(){for(var t=he,e=arguments.length,n=0;n<e;)t=t.SN_add(G(arguments[n++]));return t},"*":function(){for(var t=ce,e=arguments.length,n=0;n<e;)t=t.SN_multiply(G(arguments[n++]));return t},"-":function(t){var e=arguments.length;switch(e){case 0:Tt(arguments);case 1:return G(t).SN_negate()}for(var n=G(t),i=1;i<e;)n=n.SN_subtract(G(arguments[i++]));return n},"/":function(t){var e=arguments.length;switch(e){case 0:Tt(arguments);case 1:return G(t).SN_reciprocal();case 2:return G(t).SN_divide(G(arguments[1]))}for(var n=ce,i=1;i<e;)n=n.SN_multiply(G(arguments[i++]));return G(t).SN_divide(n)},abs:Lt("SN_abs"),"div-and-mod":xt(!1,2),div:xt(!1,0),mod:xt(!1,1),"div0-and-mod0":xt(!0,2),div0:xt(!0,0),mod0:xt(!0,1),gcd:function(t){for(var e=he,n=t.length,i=!0,r=0;r<n;r++){var a=mt(t[r]);i=i&&a.SN_isExact();e=ke(e,a.SN_abs().SN_toExact())}e=e.SN_abs();return i?e:e.SN_toInexact()},lcm:function(t){for(var e=ce,n=t.length,i=!0,r=0;r<n;r++){var a=mt(t[r]);i=i&&a.SN_isExact();a=a.SN_abs().SN_toExact();e=e.SN_multiply(a).SN_divide(ke(e,a.SN_abs()))}return i?e:e.SN_toInexact()},numerator:Lt("SN_numerator"),denominator:Lt("SN_denominator"),floor:Lt("SN_floor"),ceiling:Lt("SN_ceiling"),truncate:Lt("SN_truncate"),round:Lt("SN_round"),rationalize:function(t,e){Et(arguments);t=G(t);e=G(e);if(!t.SN_isFinite()||!e.SN_isFinite()){ct(t);ct(e);return e.SN_isInfinite()?t.SN_isFinite()?Bt:Wt:e.SN_isNaN()?e:t}if(e.SN_isZero())return t;e=e.SN_abs();var n=t.SN_subtract(e),i=t.SN_add(e),r=n.SN_floor(),a=i.SN_floor();if(r.SN_ne(a)){var s=r.SN_isNegative();return a.SN_isNegative()!=s?r.SN_isExact()?he:Bt:s?a:n.SN_ceiling()}var o=[];for(;!(n=n.SN_subtract(r)).SN_isZero()&&!(i=i.SN_subtract(r)).SN_isZero();){n=n.SN_reciprocal();i=i.SN_reciprocal();switch((r=n.SN_floor()).SN_compare(i.SN_floor())){case-1:o.push(n.SN_ceiling());break;case 1:o.push(i.SN_ceiling());break;case 0:default:o.push(r);continue}break}var l=he,u=o.length;for(;u--;)l=l.SN_add(o[u]).SN_reciprocal();return l.SN_add(a)},exp:Lt("SN_exp"),log:function(t,e){var n=G(t).SN_log();switch(arguments.length){case 2:(n=n.SN_divide(G(e).SN_log()))._=parseFloat(n._.toPrecision(15));case 1:return n;default:St("1-2",arguments)}},sin:Lt("SN_sin"),cos:Lt("SN_cos"),tan:Lt("SN_tan"),asin:Lt("SN_asin"),acos:Lt("SN_acos"),atan:function(t,e){switch(arguments.length){case 1:return G(t).SN_atan();case 2:return dt(t).SN_atan2(dt(e));default:St("1-2",arguments)}},sqrt:Lt("SN_sqrt"),"exact-integer-sqrt":Lt("SN_exactIntegerSqrt"),expt:(st="SN_expt",function(t,e){2===arguments.length||Et(arguments);return G(t)[st](G(e))}),"make-rectangular":function(t,e){2===arguments.length||Et(arguments);return ut(dt(t),dt(e))},"make-polar":function(t,e){2===arguments.length||Et(arguments);return ht(dt(t),dt(e))},"real-part":Lt("SN_realPart"),"imag-part":Lt("SN_imagPart"),magnitude:Lt("SN_magnitude"),angle:Lt("SN_angle"),"number->string":function(t,e,n){var i=e;switch(arguments.length){case 3:gt(n=mt(n));case 2:i=gt(mt(i)).valueOf();M[i]||vt("&assertion","invalid radix",e);case 1:break;default:St("1-3",arguments)}return G(t).SN_numberToString(i,n)},"string->number":function(t,e){switch(arguments.length){case 1:case 2:return lt(String(t),e);default:St("1-2",arguments)}}};function St(t,e){var n="Function";for(name in fn)if(fn[name]===e.callee){n+=" '"+name+"'";break}vt("&assertion",n+" expected "+t+" argument"+("1"==t?"":"s")+", got "+e.length)}function Nt(t){1===t.length||St(1,t)}function Et(t){2===t.length||St(2,t)}function Tt(t){t.length>0||St("1 or more",t)}function Ft(t){t.length>1||St("2 or more",t)}function bt(t){1===arguments.length||Nt(arguments);return x(t)&&t.SN_imagPart().SN_isZero()}function Lt(t){return function(e){1===arguments.length||Nt(arguments);return G(e)[t]()}}function wt(t){return function(e,n){var i=arguments.length;i>1||Ft(arguments);n=dt(n);if(!dt(e)[t](n))return!1;for(var r=2;r<i;r++){var a=dt(arguments[r]);if(!n[t](a))return!1;n=a}return!0}}function kt(t){return function(e){var n=arguments.length;n>0||Tt(arguments);for(var i=dt(e),r=i.SN_isExact(),a=1;a<n;a++){var s=dt(arguments[a]);if(s.SN_isNaN())return s;r&&((r=s.SN_isExact())||(i=i.SN_toInexact()));!1!==s[t](i)&&(i=s)}return r?i:i.SN_toInexact()}}function Ot(t){vt("&assertion","div/mod second argument is zero",t)}function xt(t,e){return function(n,i){2===arguments.length||Et(arguments);n=dt(n);i=dt(i);n.SN_isFinite()||vt("&assertion","div/mod first argument is not finite",n);i.SN_isZero()&&Ot(i);if(!t)switch(e){case 0:return n.SN_div(i);case 1:return n.SN_mod(i);case 2:default:return n.SN_divAndMod(i)}var r=n.SN_divAndMod(i),a=r[1],s=i.SN_abs();if(a.SN_add(a).SN_ge(s))switch(e){case 0:return r[0].SN_add(i.SN_isNegative()?de:ce);case 1:return a.SN_subtract(s);case 2:default:return[r[0].SN_add(i.SN_isNegative()?de:ce),a.SN_subtract(s)]}switch(e){case 0:return r[0];case 1:return a;case 2:default:return r}}}rt.Flonum.SN_isExact=p;rt.Flonum.SN_isInexact=g;rt.Flonum.SN_isComplex=g;rt.Flonum.SN_isReal=g;rt.Flonum.SN_debug=function(){return"Flonum("+this.SN_numberToString()+")"};function yt(t){return t.toString(2)}function At(e){var n=yt(t(e)),i=n.indexOf(".");return-1===i?0:n.length-i-1}function Rt(t){return a(2,At(t))}rt.Flonum.SN_numberToString=function(t,e){if(t&&10!=t&&c(this))return"#i"+this.SN_toExact().SN_numberToString(t);if(!c(this))return d(this)?"+nan.0":this>0?"+inf.0":"-inf.0";var n=(+this).toString();if(-1===n.indexOf(".")){var i=n.indexOf("e");-1===i?n+=".":n=n.substring(0,i)+"."+n.substring(i)}if(null!=e){if(e<53){var r=yt(+this).replace(/[-+.]/g,"").replace(/^0+/,"").replace(/0+$/,"").length;e<r&&(e=r)}n+="|"+e}return n};rt.Flonum.SN_realPart=v;rt.Flonum.SN_imagPart=function(){return he};rt.Flonum.SN_denominator=function(){return q(2,At(+ft(this)))};rt.Flonum.SN_numerator=function(){return O(this*Rt(+ft(this)))};rt.Flonum.SN_isInteger=function(){return c(this)&&this==e(this)};rt.Flonum.SN_isFinite=function(){return c(this)};rt.Flonum.SN_isRational=rt.Flonum.SN_isFinite;rt.Flonum.SN_isZero=function(){return 0==this};rt.Flonum.SN_isPositive=function(){return this>0};rt.Flonum.SN_isNegative=function(){return this<0};rt.Flonum.SN_sign=function(){return 0==this?0:this>0?1:-1};rt.Flonum.SN_isUnit=function(){return 1==this||-1==this};rt.Flonum.SN_isInfinite=function(){return!c(this)&&!d(this)};rt.Flonum.SN_isNaN=function(){return d(this)};rt.Flonum.SN_isEven=function(){return 0==(1&this)};rt.Flonum.SN_isOdd=function(){return 1==(1&this)};rt.Flonum.SN_eq=function(t){return t.SN__eq_Flonum(this)};rt.Flonum.SN_ne=function(t){return t.SN__ne_Flonum(this)};rt.Flonum.SN_gt=function(t){return ct(t).SN__gt_Flonum(this)};rt.Flonum.SN_lt=function(t){return ct(t).SN__lt_Flonum(this)};rt.Flonum.SN_ge=function(t){return ct(t).SN__ge_Flonum(this)};rt.Flonum.SN_le=function(t){return ct(t).SN__le_Flonum(this)};rt.Flonum.SN_compare=function(t){return ct(t).SN__compare_Flonum(this)};rt.Flonum.SN__eq_R=function(t){return+t==this};rt.Flonum.SN__ne_R=function(t){return+t!=this};rt.Flonum.SN__gt_R=function(t){return t>this};rt.Flonum.SN__lt_R=function(t){return t<this};rt.Flonum.SN__ge_R=function(t){return t>=this};rt.Flonum.SN__le_R=function(t){return t<=this};rt.Flonum.SN__compare_R=function(t){return+t==this?0:t<this?-1:t>this?1:NaN};function Pt(t){return t<9007199254740992&&t>-9007199254740992?_e(t):new be(function(t){return BigInteger.parse(t.toString(16),16)}(t))}rt.Flonum.SN_toExact=function(){return function(t){c(t)||vt("&implementation-violation","inexact argument has no reasonably close exact equivalent",t);var e,n=Rt(t);if(1===n)return Pt(t);if(c(n)){e=t*n;n=Pt(n)}else{var i=At(t);e=9007199254740992*t;e*=a(2,i-53);n=me.SN_expt(_e(i))}return ae(Pt(e),n)}(+this)};rt.Flonum.SN_toInexact=v;rt.Flonum.SN_add=function(t){return t.SN__add_Flonum(this)};rt.Flonum.SN_subtract=function(t){return t.SN__subtract_Flonum(this)};rt.Flonum.SN_multiply=function(t){return t.SN__multiply_Flonum(this)};rt.Flonum.SN_divide=function(t){return t.SN__divide_Flonum(this)};rt.Flonum.SN__add_R=function(t){return O(t+this)};rt.Flonum.SN__subtract_R=function(t){return O(t-this)};rt.Flonum.SN__multiply_R=function(t){return O(t*this)};rt.Flonum.SN__divide_R=function(t){return O(t/this)};rt.Flonum.SN_negate=function(){return O(-this)};rt.Flonum.SN_abs=function(){return this<0?O(-this):this};rt.Flonum.SN_reciprocal=function(){return O(1/this)};function Ct(t,n){if(n>0)return e(t/n);if(n<0)return i(t/n);0==n&&Ot(O(n));return NaN}rt.Flonum.SN_divAndMod=function(t){var e=Ct(this,t=+t);return[O(e),O(this-t*e)]};rt.Flonum.SN_div=function(t){return O(Ct(this,t))};rt.Flonum.SN_mod=function(t){return O(this-t*Ct(this,t))};rt.Flonum.SN_square=function(){return O(this*this)};rt.Flonum.SN_round=function(){var t=e(this),n=this-t;return O(n<.5?t:n>.5?t+1:2*r(this/2))};rt.Flonum.SN_truncate=function(){return this<0?K(this):H(this)};rt.Flonum.SN_ceiling=function(){return K(this)};function Mt(t){return function(){return t(this)}}rt.Flonum.SN_abs=Mt(X);rt.Flonum.SN_atan=Mt(Z);rt.Flonum.SN_cos=function(){return sn(J(this)._.toFixed(15))};rt.Flonum.SN_exp=Mt(et);rt.Flonum.SN_floor=Mt(H);rt.Flonum.SN_sin=function(){return sn($(this)._.toFixed(15))};rt.Flonum.SN_tan=function(){return sn(tt(this)._.toFixed(15))};function It(t,e){return function(){var n=t(this);return d(n)?e(this):O(n)}}rt.Flonum.SN_acos=It(Math.acos,qt);rt.Flonum.SN_asin=It(Math.asin,jt);rt.Flonum.SN_log=function(){return this<0?Gt(this):z(this)};rt.Flonum.SN_sqrt=function(){return this>=0?O(s(this)):d(this)?this:Xt(Bt,Q(-this))};rt.Flonum.SN_atan2=function(t){return Y(this,t)};rt.Flonum.SN_expt=function(t){return t.SN__expt_Flonum(this)};var Bt=O(0),Dt=O(Number.POSITIVE_INFINITY),Vt=O(Number.NEGATIVE_INFINITY),Wt=O(Number.NaN),Ut=O(Math.PI);rt.C.SN_isReal=p;rt.C.SN_isRational=p;rt.C.SN_isInteger=p;rt.C.SN_isZero=p;rt.C.SN_isUnit=p;rt.C.SN_isComplex=g;rt.C.SN_numberToString=N;rt.C.toString=function(t){return this.SN_numberToString(t)};rt.C.valueOf=function(){return this.SN_imagPart().SN_isZero()?this.SN_realPart().valueOf():NaN};rt.C.toFixed=N;rt.C.toExponential=N;rt.C.toPrecision=N;rt.C.toLocaleString=function(){return this.toString()};rt.C.SN_debug=function(){return"C"};rt.C.SN_sqrt=function(){return ht(this.SN_magnitude().SN_sqrt(),this.SN_angle().SN_divide(me))};function Gt(t){return ut(t.SN_magnitude().SN_log(),t.SN_angle())}function jt(t){return ge.SN_multiply(pe.SN_multiply(t).SN_add(ce.SN_subtract(t.SN_square()).SN_sqrt()).SN_log())}function qt(t){return Ut.SN_divide(me).SN_subtract(jt(t))}rt.C.SN_log=function(){return Gt(this)};rt.C.SN_asin=function(){return jt(this)};rt.C.SN_acos=function(){return qt(this)};rt.C.SN_atan=function(){return t=this,e=pe.SN_multiply(t),ce.SN_add(e).SN_log().SN_subtract(ce.SN_subtract(e).SN_log()).SN_divide(me).SN_divide(pe);var t,e};rt.C.SN_sin=function(){var t=pe.SN_multiply(this);return t.SN_exp().SN_subtract(t.SN_negate().SN_exp()).SN_divide(me).SN_divide(pe)};rt.C.SN_cos=function(){var t=pe.SN_multiply(this);return t.SN_exp().SN_add(t.SN_negate().SN_exp()).SN_divide(me)};rt.C.SN_tan=function(){return this.SN_sin().SN_divide(this.SN_cos())};rt.R.SN_isReal=g;rt.R.SN_debug=function(){return"R"};rt.R.SN_realPart=v;rt.R.SN_magnitude=function(){return this.SN_abs()};rt.R.SN_angle=function(){return this.SN_isNegative()?Ut:he};rt.R.SN__eq_Flonum=rt.Flonum.SN__eq_R;rt.R.SN__ne_Flonum=rt.Flonum.SN__ne_R;rt.R.SN__eq_Rectangular=function(t){return t._y.SN_isZero()&&t._x.SN_eq(this)};rt.R.SN__ne_Rectangular=function(t){return!t._y.SN_isZero()||t._x.SN_ne(this)};rt.R.SN__gt_Flonum=rt.Flonum.SN__gt_R;rt.R.SN__lt_Flonum=rt.Flonum.SN__lt_R;rt.R.SN__ge_Flonum=rt.Flonum.SN__ge_R;rt.R.SN__le_Flonum=rt.Flonum.SN__le_R;rt.R.SN__compare_Flonum=rt.Flonum.SN__compare_R;rt.R.SN_compare=N;rt.R.SN_gt=function(t){return this.SN_compare(t)>0};rt.R.SN_lt=function(t){return this.SN_compare(t)<0};rt.R.SN_ge=function(t){return this.SN_compare(t)>=0};rt.R.SN_le=function(t){return this.SN_compare(t)<=0};rt.R.SN_add=function(t){return t.SN__add_R(this)};rt.R.SN__add_Flonum=rt.Flonum.SN__add_R;rt.R.SN_subtract=function(t){return t.SN__subtract_R(this)};rt.R.SN__subtract_Flonum=rt.Flonum.SN__subtract_R;rt.R.SN_multiply=function(t){return t.SN__multiply_R(this)};rt.R.SN__multiply_Flonum=rt.Flonum.SN__multiply_R;rt.R.SN_divide=function(t){return t.SN__divide_R(this)};rt.R.SN__divide_Flonum=rt.Flonum.SN__divide_R;function zt(t,e){if(t.SN_isZero()){if(e.SN_isZero())return O(1);if(e.SN_realPart().SN_isPositive())return Bt;vt("&implementation-restriction","invalid power for zero expt",e)}return t.SN_log().SN_multiply(e).SN_exp()}rt.R.SN__expt_R=function(t){return t.SN_isNegative()?zt(t,this):q(t,this)};rt.R.SN__expt_EI=rt.R.SN__expt_R;rt.R.SN__expt_EQ=function(t){if(t.SN_isNegative())return zt(t,this);var e=t.SN_numerator().SN_expt(this),n=t.SN_denominator().SN_expt(this);return e.SN_isExact()&&e.SN_isInteger()&&n.SN_isExact()&&n.SN_isInteger()?new se(e,n):e.SN_divide(n)};function Ht(t,e){var n=Kt(t,e);return[n,t.SN_subtract(n.SN_multiply(e))]}function Kt(t,e){return e.SN_isNegative()?t.SN_divide(e).SN_ceiling():t.SN_divide(e).SN_floor()}function Qt(t,e){return t.SN_subtract(Kt(t,e).SN_multiply(e))}rt.R.SN_divAndMod=function(t){return Ht(this,t)};rt.R.SN_div=function(t){return Kt(this,t)};rt.R.SN_mod=function(t){return Qt(this,t)};rt.R.SN__divAndMod_R=function(t){return Ht(t,this)};rt.R.SN__div_R=function(t){return Kt(t,this)};rt.R.SN__mod_R=function(t){return Qt(t,this)};["sqrt","exp","log","sin","cos","tan","asin","acos","atan","atan2"].forEach((function(t){rt.R["SN_"+t]=rt.Flonum["SN_"+t]}));function Yt(t,e){return e.SN_isZero()?t:t.SN_isZero()&&e.SN_isUnit()?e.SN_isPositive()?pe:ge:new Jt(t,e)}function Xt(t,e){return new Jt(t,e)}function Zt(t,e){return t.SN_isExact()?Yt(t,e):new Jt(t,e)}function Jt(t,e){this._x=t;this._y=e}Jt.prototype=new T;function $t(t,e){return"-"===e[0]||"+"===e[0]?t+e+"i":t+"+"+e+"i"}rt.Rectangular.SN_numberToString=function(t,e){return $t(this._x.SN_numberToString(t,e),this._y.SN_numberToString(t,e))};rt.Rectangular.toString=function(t){t=t||10;return $t(this._x.toString(t),this._y.toString(t))};rt.Rectangular.SN_debug=function(){return"Rectangular("+this._x.SN_debug()+", "+this._y.SN_debug()+")"};rt.Rectangular.toFixed=function(t){return $t(this._x.toFixed(t),this._y.toFixed(t))};rt.Rectangular.toExponential=function(t){return $t(this._x.toExponential(t),this._y.toExponential(t))};rt.Rectangular.toPrecision=function(t){return $t(this._x.toPrecision(t),this._y.toPrecision(t))};rt.Rectangular.SN_realPart=function(){return this._x};rt.Rectangular.SN_imagPart=function(){return this._y};rt.Rectangular.SN_isExact=function(){return this._x.SN_isExact()};rt.Rectangular.SN_isInexact=function(){return this._x.SN_isInexact()};rt.Rectangular.SN_toInexact=function(){return this._x.SN_isInexact()?this:Xt(this._x.SN_toInexact(),this._y.SN_toInexact())};rt.Rectangular.SN_toExact=function(){return this._x.SN_isExact()?this:Yt(this._x.SN_toExact(),this._y.SN_toExact())};rt.Rectangular.SN_isZero=function(){return this._x.SN_isZero()&&this._y.SN_isZero()};function te(t){return t._x.SN_square().SN_add(t._y.SN_square())}rt.Rectangular.SN_isUnit=function(){return te(this).SN_eq(ce)};rt.Rectangular.SN_magnitude=function(){return this._x.SN_isZero()?this._y.SN_abs():te(this).SN_sqrt()};rt.Rectangular.SN_angle=function(){return this._y.SN_atan2(this._x)};rt.C.SN__eq_Rectangular=N;rt.Rectangular.SN_eq=function(t){return t.SN__eq_Rectangular(this)};rt.Rectangular.SN__eq_Rectangular=function(t){return t._x.SN_eq(this._x)&&t._y.SN_eq(this._y)};rt.Rectangular.SN__eq_R=function(t){return this._y.SN_isZero()&&t.SN_eq(this._x)};rt.C.SN__ne_Rectangular=N;rt.Rectangular.SN_ne=function(t){return t.SN__ne_Rectangular(this)};rt.Rectangular.SN__ne_Rectangular=function(t){return t._x.SN_ne(this._x)||t._y.SN_ne(this._y)};rt.Rectangular.SN__ne_R=function(t){return!this._y.SN_isZero()||t.SN_ne(this._x)};rt.Flonum.SN__add_Rectangular=function(t){return Xt(O(t._x+this),t._y.SN_toInexact())};rt.Flonum.SN__subtract_Rectangular=function(t){return Xt(O(t._x-this),t._y.SN_toInexact())};rt.Flonum.SN__multiply_Rectangular=function(t){return Xt(O(t._x*this),O(t._y*this))};rt.Flonum.SN__divide_Rectangular=function(t){return Xt(O(t._x/this),O(t._y/this))};rt.Flonum.SN__expt_Rectangular=function(t){return ht(q(te(t),this/2),O(o(t._y,t._x)*this))};rt.R.SN__add_Rectangular=function(t){return ut(t._x.SN_add(this),t._y)};rt.R.SN__subtract_Rectangular=function(t){return ut(t._x.SN_subtract(this),t._y)};rt.R.SN__multiply_Rectangular=function(t){return Zt(t._x.SN_multiply(this),t._y.SN_multiply(this))};rt.R.SN__divide_Rectangular=function(t){return Zt(t._x.SN_divide(this),t._y.SN_divide(this))};rt.C.SN__add_Rectangular=N;rt.Rectangular.SN_add=function(t){return t.SN__add_Rectangular(this)};rt.Rectangular.SN__add_R=function(t){return ut(t.SN_add(this._x),this._y)};rt.Rectangular.SN__add_Rectangular=function(t){var e=t._x.SN_add(this._x),n=t._y.SN_add(this._y);return(e.SN_isExact()?Yt:Xt)(e,n)};rt.Rectangular.SN_negate=function(){return Zt(this._x.SN_negate(),this._y.SN_negate())};rt.C.SN__subtract_Rectangular=N;rt.Rectangular.SN_subtract=function(t){return t.SN__subtract_Rectangular(this)};rt.Rectangular.SN__subtract_R=function(t){return ut(t.SN_subtract(this._x),this._y.SN_negate())};rt.Rectangular.SN__subtract_Rectangular=function(t){var e=t._x.SN_subtract(this._x),n=t._y.SN_subtract(this._y);return(e.SN_isExact()?Yt:Xt)(e,n)};rt.C.SN__multiply_Rectangular=N;rt.Rectangular.SN_multiply=function(t){return t.SN__multiply_Rectangular(this)};rt.Rectangular.SN__multiply_R=function(t){return Zt(t.SN_multiply(this._x),t.SN_multiply(this._y))};function ee(t,e,n,i){return Zt(t.SN_multiply(n).SN_subtract(e.SN_multiply(i)),t.SN_multiply(i).SN_add(e.SN_multiply(n)))}rt.Rectangular.SN__multiply_Rectangular=function(t){return ee(t._x,t._y,this._x,this._y)};rt.Rectangular.SN_square=function(){return Zt(this._x.SN_square().SN_subtract(this._y.SN_square()),this._x.SN_multiply(this._y).SN_multiply(me))};rt.Rectangular.SN_reciprocal=function(){var t=te(this);return Zt(this._x.SN_divide(t),this._y.SN_divide(t).SN_negate())};rt.C.SN__divide_Rectangular=N;rt.Rectangular.SN_divide=function(t){return t.SN__divide_Rectangular(this)};function ne(t,e,n){var i=te(n);return ee(t,e,n._x.SN_divide(i),n._y.SN_divide(i).SN_negate())}rt.Rectangular.SN__divide_R=function(t){return ne(t,t.SN_isExact()?he:Bt,this)};rt.Rectangular.SN__divide_Rectangular=function(t){return ne(t._x,t._y,this)};rt.Rectangular.SN_expt=function(t){return t.SN__expt_Rectangular(this)};rt.Rectangular.SN__expt_C=function(t){return zt(t,this)};rt.C.SN__expt_Rectangular=rt.Rectangular.SN__expt_C;rt.Rectangular.SN_exp=function(){return ht(this._x.SN_exp(),this._y)};rt.ER.SN_isExact=g;rt.ER.SN_isInexact=p;rt.ER.SN_toExact=v;rt.ER.SN_toInexact=function(){return O(+this)};rt.ER.SN_isNaN=p;rt.ER.SN_isFinite=g;rt.ER.SN_isInfinite=p;rt.ER.SN_imagPart=I;function ie(t){var e="000000000000000".substring(0,15&t);t>15&&(e+=new Array(1+(t>>4)).join("0000000000000000"));return e}rt.ER.toFixed=function(t){var e=void 0===t?20:m(t,10);if(e>G.maxIntegerDigits)throw new RangeError("fractionDigits exceeds SchemeNumber.maxIntegerDigits: "+t);var n=this,i="";if(n.SN_isNegative()){n=n.SN_negate();i="-"}var r=ce.SN__exp10(-e),a=n.SN_divAndMod(r),s=a[0];a[1].SN_add(a[1]).SN_ge(r)&&(s=ce.SN_add(s));if(s.SN_isZero())return i+"0"+(t>0?"."+ie(t):"");s=s.SN_numberToString();if(0===e)return i+s;var o=e-s.length;if(e>0){o>=0&&(s=ie(o+1)+s);var l=s.length-e;return i+s.substring(0,l)+"."+s.substring(l)}return i+s+ie(-e)};rt.ER.toExponential=function(t){var n=void 0===t?20:m(t);if(n<0)throw new RangeError("SchemeNumber toExponential: negative argument: "+n);if(n>G.maxIntegerDigits)throw new RangeError("fractionDigits exceeds SchemeNumber.maxIntegerDigits: "+t);var i=this,r="";if(i.SN_isNegative()){i=i.SN_negate();r="-"}else if(i.SN_isZero())return"0"+(t>0?"."+ie(n):"")+"e+0";var a=e(i.SN_log()/h),s=ce.SN__exp10(a-n),o=i.SN_divAndMod(s),l=o[0];o[1].SN_add(o[1]).SN_ge(s)&&(l=ce.SN_add(l));if((l=l.SN_numberToString()).length!=n+1){a+=l.length-(n+1);s=ce.SN__exp10(a-n);l=(o=i.SN_divAndMod(s))[0];o[1].SN_add(o[1]).SN_ge(s)&&(l=ce.SN_add(l));if((l=l.SN_numberToString()).length!=n+1)throw new Error("Can not format as exponential: "+this.SN_numberToString())}void 0===t&&(l=l.replace(/(\d)0+$/,"$1"));l.length>1&&(l=l[0]+"."+l.substring(1));return r+l+"e"+(a<0?"":"+")+a};rt.ER.toPrecision=function(t){var e,n;if(void 0===t){if((n=this.SN_toInexact()).SN_isFinite())return(+n).toString();e=21}else{if((e=m(t,10))<1)throw new RangeError("SchemeNumber toPrecision: expected a positive precision, got: "+t);if(e>G.maxIntegerDigits)throw new RangeError("precision exceeds SchemeNumber.maxIntegerDigits: "+t)}var i="";if((n=this).SN_isNegative()){n=n.SN_negate();i="-"}else if(n.SN_isZero())return"0"+(e>1?".":"");var r=n.toExponential(e-1),a=r.indexOf("e"),s=m(r.substring(a+1),10);if(s>=-6&&s<e)if(0===s)r=r.substring(0,a);else{r=r.substring(0,1)+(-1===r.indexOf(".")?"":r.substring(2,a));s<0?r="0."+ie(-1-s)+r:s<e-1&&(r=r.substring(0,s+1)+"."+r.substring(s+1))}else void 0===t&&(r=r.substring(0,a).replace(/\.?0+/,"")+r.substring(a));var o=i+r;return o=o.replace(/(\.\d*?)0+(e|\+|\-|$)/g,"$1$2")};rt.EQ.SN_isRational=g;rt.EQ.SN_eq=function(t){return t.SN__eq_EQ(this)};rt.EQ.SN__eq_EQ=N;rt.EQ.SN_ne=function(t){return t.SN__ne_EQ(this)};rt.EQ.SN__ne_EQ=N;rt.EQ.SN_compare=function(t){return t.SN__compare_EQ(this)};rt.EQ.SN__compare_EQ=N;rt.EQ.SN_add=function(t){return t.SN__add_EQ(this)};rt.EQ.SN__add_EQ=N;rt.EQ.SN_subtract=function(t){return t.SN__subtract_EQ(this)};rt.EQ.SN__subtract_EQ=N;rt.EQ.SN_multiply=function(t){return t.SN__multiply_EQ(this)};rt.EQ.SN__multiply_EQ=N;rt.EQ.SN_divide=function(t){return t.SN__divide_EQ(this)};rt.EQ.SN__divide_EQ=N;rt.EQ.SN_expt=function(t){return t.SN__expt_EQ(this)};function re(t,e){e.SN_isZero()&&D();var n=ke(t.SN_abs(),e.SN_abs());t=t.SN_div(n);return(e=e.SN_div(n)).SN_isNegative()?ae(t.SN_negate(),e.SN_negate()):ae(t,e)}function ae(t,e){return e===ce?t:new se(t,e)}function se(t,e){this._n=t;this._d=e}se.prototype=new L;rt.EQFraction.SN_numberToString=function(t,e){return this._n.SN_numberToString(t)+"/"+this._d.SN_numberToString(t)};rt.EQFraction.valueOf=function(){var t=this._n,e=this._d,n=t/e;return d(n)?t.SN_isNegative()?-l(t.SN_negate().SN_log()-e.SN_log()):l(t.SN_log()-e.SN_log()):n};rt.EQFraction.SN_debug=function(){return"EQFraction("+this._n.SN_debug()+" / "+this._d.SN_debug()+")"};rt.EQFraction.SN_numerator=function(){return this._n};rt.EQFraction.SN_denominator=function(){return this._d};rt.EQFraction.SN_isPositive=function(){return this._n.SN_isPositive()};rt.EQFraction.SN_isNegative=function(){return this._n.SN_isNegative()};rt.EQFraction.SN__eq_EQ=function(t){return t.SN_numerator().SN_eq(this._n)&&t.SN_denominator().SN_eq(this._d)};rt.EQFraction.SN__ne_EQ=function(t){return t.SN_numerator().SN_ne(this._n)||t.SN_denominator().SN_ne(this._d)};rt.EQFraction.SN__compare_EQ=function(t){var e=t.SN_numerator(),n=t.SN_sign()-this._n.SN_sign();if(0!==n)return n>0?1:-1;var i=t.SN_denominator();return i===this._d?e.SN_compare(this._n):e.SN_multiply(this._d).SN_compare(i.SN_multiply(this._n))};rt.EQFraction.SN_negate=function(){return new se(this._n.SN_negate(),this._d)};rt.EQFraction.SN_square=function(){return new se(this._n.SN_square(),this._d.SN_square())};rt.EQFraction.SN_reciprocal=function(){switch(this._n.SN_sign()){case-1:return ae(this._d.SN_negate(),this._n.SN_negate());case 1:return ae(this._d,this._n);case 0:default:D()}};rt.EQFraction.SN_floor=function(){return this._n.SN_div(this._d)};rt.EQFraction.SN_ceiling=function(){return this._n.SN_div(this._d).SN_add(ce)};rt.EQFraction.SN_round=function(){if(this._d.SN_eq(me)){var t=this._n.SN_div(me);return t.SN_isEven()?t:t.SN_add(ce)}var e=this._n.SN_divAndMod(this._d),n=e[1];return n.SN_add(n).SN_lt(this._d)?e[0]:e[0].SN_add(ce)};rt.EQFraction.SN_truncate=function(){return this._n.SN_isPositive()?this._n.SN_div(this._d):this._d.SN_isUnit()?this._n:this._n.SN_div(this._d).SN_add(ce)};rt.EQFraction.SN_sign=function(){return this._n.SN_sign()};rt.EQFraction.SN_abs=function(){return this._n.SN_sign()>=0?this:this.SN_negate()};rt.EQFraction.SN__add_EQ=function(t){var e=t.SN_numerator(),n=t.SN_denominator(),i=this._n,r=this._d;return re(e.SN_multiply(r).SN_add(i.SN_multiply(n)),n.SN_multiply(r))};rt.EQFraction.SN__subtract_EQ=function(t){var e=t.SN_numerator(),n=t.SN_denominator(),i=this._n,r=this._d;return re(e.SN_multiply(r).SN_subtract(i.SN_multiply(n)),n.SN_multiply(r))};rt.EQFraction.SN__multiply_EQ=function(t){return re(t.SN_numerator().SN_multiply(this._n),t.SN_denominator().SN_multiply(this._d))};rt.EQFraction.SN__divide_EQ=function(t){return re(t.SN_numerator().SN_multiply(this._d),t.SN_denominator().SN_multiply(this._n))};rt.EQFraction.SN__add_EI=function(t){return ae(t.SN_multiply(this._d).SN_add(this._n),this._d)};rt.EQFraction.SN__subtract_EI=function(t){return ae(t.SN_multiply(this._d).SN_subtract(this._n),this._d)};rt.EQFraction.SN__multiply_EI=function(t){return re(t.SN_multiply(this._n),this._d)};rt.EQFraction.SN__divide_EI=function(t){return re(t.SN_multiply(this._d),this._n)};rt.EQFraction.SN_sqrt=function(){return this._n.SN_sqrt().SN_divide(this._d.SN_sqrt())};rt.EQFraction.SN_log=function(){return this._n.SN_log().SN_subtract(this._d.SN_log())};function oe(t,e,n){var i=m(e,n||10);return i<9007199254740992?_e(t*i):Le(e,t,n)}rt.EI.SN_isInteger=g;rt.EI.SN_debug=function(){return"EI"};rt.EI.SN_numerator=v;rt.EI.SN_denominator=function(){return ce};rt.EI.SN_floor=v;rt.EI.SN_ceiling=v;rt.EI.SN_round=v;rt.EI.SN_truncate=v;rt.EI.SN__toBigInteger=N;rt.EI.SN_eq=function(t){return t.SN__eq_EI(this)};rt.EI.SN__eq_EI=function(t){return 0===t.SN__toBigInteger().compare(this.SN__toBigInteger())};rt.EI.SN__eq_EQ=function(t){return t.SN_numerator().SN_eq(this)&&t.SN_denominator().SN_eq(ce)};rt.EI.SN_ne=function(t){return t.SN__ne_EI(this)};rt.EI.SN__ne_EI=function(t){return 0!==t.SN__toBigInteger().compare(this.SN__toBigInteger())};rt.EI.SN__ne_EQ=function(t){return t.SN_numerator().SN_ne(this)||t.SN_denominator().SN_ne(ce)};rt.EI.SN_compare=function(t){return t.SN__compare_EI(this)};rt.EI.SN__compare_EQ=function(t){return t.SN_numerator().SN_compare(t.SN_denominator().SN_multiply(this))};rt.EI.SN__compare_EI=function(t){return t.SN__toBigInteger().compare(this.SN__toBigInteger())};rt.EI.SN_add=function(t){return t.SN__add_EI(this)};rt.EI.SN_subtract=function(t){return t.SN__subtract_EI(this)};rt.EI.SN_multiply=function(t){return t.SN__multiply_EI(this)};rt.EI.SN_reciprocal=function(){return this.SN_isNegative()?ae(de,this.SN_negate()):ae(ce,this)};rt.EI.SN_divAndMod=function(t){return t.SN__divAndMod_EI(this)};rt.EI.SN_div=function(t){return t.SN__div_EI(this)};rt.EI.SN_mod=function(t){return t.SN__mod_EI(this)};rt.EI.SN__add_EI=function(t){return Fe(t.SN__toBigInteger().add(this.SN__toBigInteger()))};rt.EI.SN__subtract_EI=function(t){return Fe(t.SN__toBigInteger().subtract(this.SN__toBigInteger()))};rt.EI.SN__multiply_EI=function(t){return Fe(t.SN__toBigInteger().multiply(this.SN__toBigInteger()))};rt.EI.SN__divAndMod_EI=function(t){var e=this.SN__toBigInteger(),n=t.SN__toBigInteger().divRem(e),i=n[0],r=n[1];if(r.isNegative()){r=r.add(e);i=i.prev()}return[Fe(i),Fe(r)]};rt.EI.SN__div_EI=function(t){return this.SN__divAndMod_EI(t)[0]};rt.EI.SN__mod_EI=function(t){return this.SN__divAndMod_EI(t)[1]};rt.EI.SN__add_EQ=function(t){var e=t.SN_denominator();return ae(t.SN_numerator().SN_add(e.SN_multiply(this)),e)};rt.EI.SN__subtract_EQ=function(t){var e=t.SN_denominator();return ae(t.SN_numerator().SN_subtract(e.SN_multiply(this)),e)};rt.EI.SN__multiply_EQ=function(t){return re(t.SN_numerator().SN_multiply(this),t.SN_denominator())};rt.EI.SN__divide_EQ=function(t){return re(t.SN_numerator(),t.SN_denominator().SN_multiply(this))};rt.EI.SN_expt=function(t){return t.SN__expt_EI(this)};rt.EI.SN__expt_EI=function(t){var e,n=this.SN_sign(),i=this.SN_abs().valueOf(),r=a(t,i);if(r>-9007199254740992&&r<9007199254740992)e=_e(r);else{var s=t.SN_log()*i;s>G.maxIntegerDigits*h&&vt("&implementation-restriction","exact integer would exceed limit of "+ +G.maxIntegerDigits+" digits; adjust SchemeNumber.maxIntegerDigits",s/h);e=new be(t.SN__toBigInteger().pow(i))}return n>0?e:e.SN_reciprocal()};function le(t,e){for(var n=e.SN_abs(),i=t,r=ce;n.SN_isPositive();){n.SN_isOdd()&&(r=r.SN_multiply(i));i=i.SN_square();n=n.SN_div(me)}return e.SN_isNegative()?r.SN_reciprocal():r}rt.EI.SN__expt_ER=function(t){return le(t,this)};rt.EI.SN__expt_C=function(t){return t.SN_isExact()?le(t,this):zt(t,this)};function ue(t){this._=t}ue.prototype=new w;var he=G.ZERO=new ue(0),ce=G.ONE=new ue(1),de=G.M_ONE=new ue(-1),me=G.TWO=new ue(2),fe=[he,ce,me],pe=G.I=new Jt(he,ce),ge=G.M_I=new Jt(he,de);function _e(t){return fe[t]||(-1==t?de:new ue(t))}he.SN_isZero=g;he.SN_isPositive=p;he.SN_isNegative=p;he.SN_compare=function(t){return-t.SN_sign()};he.SN_add=G;he.SN_negate=v;he.SN_abs=v;he.SN_multiply=v;he.SN_square=v;he.SN_reciprocal=D;he.SN_subtract=function(t){return t.SN_negate()};he.SN_divide=function(t){t.SN_isZero()&&t.SN_isExact()&&D();return this};he.SN_expt=function(t){switch(t.SN_realPart().SN_sign()){case 1:return this;case 0:return ce;case-1:default:D()}};he.SN_sqrt=v;he.SN_exp=B;he.SN_sin=v;he.SN_cos=B;he.SN_tan=v;he.SN_asin=v;he.SN_atan=v;ce.SN_isUnit=g;ce.SN_abs=v;ce.SN_multiply=G;ce.SN_reciprocal=v;ce.SN_square=v;ce.SN_expt=he.SN_multiply;ce.SN_sqrt=v;ce.SN_log=I;ce.SN_acos=I;de.SN_isUnit=g;de.SN_abs=B;de.SN_multiply=he.SN_subtract;de.SN_reciprocal=v;de.SN_square=B;de.SN_sqrt=function(){return pe};de.SN_expt=function(t){if(!t.SN_isInteger())return zt(this,t);var e=t.SN_isEven()?ce:de;return t.SN_isExact()?e:e.SN_toInexact()};function ve(t){return t.SN_negate()}function Se(t){return t.SN_reciprocal()}for(at in it){he["SN__add_"+at]=_;he["SN__subtract_"+at]=_;he["SN__multiply_"+at]=v;he["SN__divide_"+at]=D;he["SN__expt_"+at]=B;ce["SN__multiply_"+at]=_;ce["SN__divide_"+at]=_;ce["SN__expt_"+at]=_;de["SN__multiply_"+at]=ve;de["SN__divide_"+at]=ve;de["SN__expt_"+at]=Se}rt.EINative.valueOf=function(){return this._};rt.EINative.SN_numberToString=function(t,e){return this._.toString(t||10)};rt.EINative.SN_debug=function(){return"EINative("+this._+")"};rt.EINative.SN__toBigInteger=function(){return BigInteger(this._)};rt.EINative.SN_isPositive=function(){return this._>0};rt.EINative.SN_isNegative=function(){return this._<0};rt.EINative.SN_sign=function(){return this._>0?1:0==this._?0:-1};rt.EINative.SN_isEven=function(){return 0==(1&this._)};rt.EINative.SN_isOdd=function(){return 1==(1&this._)};rt.EINative.SN_eq=function(t){return t.SN__eq_EINative(this)};rt.EINative.SN__eq_EINative=function(t){return t._===this._};rt.EINative.SN_ne=function(t){return t.SN__ne_EINative(this)};rt.EINative.SN__ne_EINative=function(t){return t._!==this._};rt.EINative.SN_compare=function(t){return t.SN__compare_EINative(this)};rt.EINative.SN__compare_EINative=function(t){return t._===this._?0:t._>this._?1:-1};function Ne(t,e){var n=t+e;return n>-9007199254740992&&n<9007199254740992?_e(n):new be(BigInteger.add(t,e))}rt.EINative.SN_add=function(t){return t.SN__add_EINative(this)};rt.EINative.SN__add_EINative=function(t){return Ne(t._,this._)};rt.EINative.SN_negate=function(){return _e(-this._)};rt.EINative.SN_abs=function(){return this._<0?_e(-this._):this};rt.EINative.SN_subtract=function(t){return t.SN__subtract_EINative(this)};rt.EINative.SN__subtract_EINative=function(t){return Ne(t._,-this._)};rt.EINative.SN_multiply=function(t){return t.SN__multiply_EINative(this)};rt.EINative.SN__multiply_EINative=function(t){var e=t._*this._;return e>-9007199254740992&&e<9007199254740992?_e(e):new be(BigInteger(t._).multiply(this._))};rt.EINative.SN_square=function(){var t=this._*this._;return t<9007199254740992?_e(t):new be(BigInteger(this._).square())};rt.EINative.SN_reciprocal=function(){var t=this._;!function(t){if(!t)throw new Error("assertion failed")}(0!==t);return t<0?ae(de,_e(-t)):ae(ce,this)};function Ee(t,n,r){0===n&&D();var a=n>0?e(t/n):i(t/n);if(0===r)return _e(a);var s,o=n*a;s=_e(s=o>-9007199254740992?t-o:a>0?t-n-n*(a-1):t+n-n*(a+1));return 1===r?s:[_e(a),s]}rt.EINative.SN_div=function(t){return t.SN__div_EINative(this)};rt.EINative.SN__div_EINative=function(t){return Ee(t._,this._,0)};rt.EINative.SN_mod=function(t){return t.SN__mod_EINative(this)};rt.EINative.SN__mod_EINative=function(t){return Ee(t._,this._,1)};rt.EINative.SN_divAndMod=function(t){return t.SN__divAndMod_EINative(this)};rt.EINative.SN__divAndMod_EINative=function(t){return Ee(t._,this._,2)};rt.EINative.SN__exp10=function(t){if(0===this._||0===t)return this;if(t<0){var e=String(this._),n=e.length-1;if("0"===e[n]){for(;"0"===e[n]&&t<0;){t+=1;n-=1}e=_e(Number(e.substring(0,n+1)));if(0===t)return e}else e=this;return re(e,t<-15?new be(BigInteger.ONE.exp10(-t)):_e(Number("1000000000000000".substring(0,1-t))))}if(t<16){var i=m("1000000000000000".substring(0,t+1))*this._;if(i>-9007199254740992&&i<9007199254740992)return _e(i)}return new be(BigInteger(this._).exp10(t))};rt.EINative.SN_exactIntegerSqrt=function(){var t=e(s(pt(this)._));return[_e(t),_e(this._-t*t)]};var Te=BigInteger(9007199254740992);function Fe(t){return t.compareAbs(Te)>=0?new be(t):_e(t.toJSValue())}function be(t){this._=t}be.prototype=new w;function Le(t,e,i){n=BigInteger.parse(t,i);e<0&&(n=n.negate());return new be(n)}rt.EIBig.SN_numberToString=function(t){return this._.toString(t)};rt.EIBig.valueOf=function(){return this._.valueOf()};["isZero","isEven","isOdd","sign","isUnit","isPositive","isNegative"].forEach((function(t){rt.EIBig["SN_"+t]=function(){return this._[t]()}}));rt.EIBig.SN_log=function(){var t=O(this._.abs().log());return this._.isPositive()?t:Xt(t,Ut)};rt.EIBig.SN_debug=function(){return"EIBig("+this._.toString()+")"};rt.EIBig.SN__toBigInteger=function(){return this._};rt.EIBig.SN_add=function(t){return t.SN__add_EIBig(this)};rt.EIBig.SN_negate=function(){return new be(this._.negate())};rt.EIBig.SN_abs=function(){return new be(this._.abs())};rt.EIBig.SN_subtract=function(t){return t.SN__subtract_EIBig(this)};rt.EIBig.SN_multiply=function(t){return t.SN__multiply_EIBig(this)};rt.EIBig.SN_square=function(){return new be(this._.square())};rt.EIBig.SN__exp10=function(t){return 0===t?this:t>0?new be(this._.exp10(t)):re(this,ce.SN__exp10(-t))};rt.EIBig.SN_sqrt=function(){var t=O(l(this._.abs().log()/2));return this._.isNegative()?Xt(Bt,t):t};rt.EIBig.SN_exactIntegerSqrt=function(){var t=pt(this)._.log()/2/h,n=BigInteger(a(10,t-e(t)).toString()+"e"+e(t));return function(t,e){for(;;){var n=t.divRem(e),i=n[0],r=e.subtract(i);if(r.isZero())return[i,n[1]];if(r.isUnit())return r.isPositive()?[i,i.add(n[1])]:[e,e.add(n[1])];e=i.add(r.quotient(2))}}(this._,n).map(Fe)};function we(t,e){for(var n;0!==t;){n=t;t=e%t;e=n}return _e(e)}function ke(t,e){if(t instanceof ue&&e instanceof ue)return we(t.valueOf(),e.valueOf());if((t=t.SN__toBigInteger()).isZero())return e;e=e.SN__toBigInteger();for(var n;;){n=t;if((t=e.remainder(t)).isZero())return new be(n);if((e=n).compareAbs(Te)<0)return we(t.valueOf(),e.valueOf())}}function Oe(t){var e=rt[t],n={};function i(t,r,a){t&&t.forEach((function(t){if(!e[r+t]){n[r+t]=a;i(nt[t],r,a)}}))}for(var r in e)if(/^SN_/.test(r)){var a=r.lastIndexOf("_");if(-1!==a){var s=e[r];if(s){var o=r.substring(a+1);i(nt[o],r.substring(0,a+1),s)}}}for(var l in n)e[l]=n[l]}for(var at in it)Oe(at);if(k===Number){for(var xe in rt.R)/^SN_/.test(xe)&&!rt.Flonum[xe]&&(rt.Flonum[xe]=rt.R[xe]);for(var xe in rt.C)/^SN_/.test(xe)&&!rt.Flonum[xe]&&(rt.Flonum[xe]=rt.C[xe]);for(var xe in rt.Flonum)rt.C[xe]||(rt.C[xe]=S)}for(var at in it)for(var xe in rt[at])it[at].prototype[xe]=rt[at][xe];!function(t){var e="";for(var n in it)if(/[a-z]/.test(n)){var i=it[n].prototype;for(xe in i)i[xe]===N&&(e+="Pure virtual: "+n+"."+xe+"\n")}e&&t(e)}(this.alert||this.print||function(t){throw t});G.pluginApi={N:E,C:T,R:F,ER:b,EQ:L,EI:w,pureVirtual:N,raise:vt};G._bogusApi={Flonum:k,Rectangular:Jt,EQFraction:se,EINative:ue,EIBig:be};return G}();if("undefined"!=typeof exports){exports.SchemeNumber=SchemeNumber;for(var name in SchemeNumber.fn)exports[name]=SchemeNumber.fn[name]}if(!sn){var sn=SchemeNumber,fn=sn.fn,ns=fn["number->string"];sn.raise=function(t,e){throw"division by exact zero"==e?"MSG: You cannot divide by 0.":"BigNum Error: "+e}}var varBank={},functionBank=varBank,functionLoaders=[];function bootCalc(){functionBank=varBank={};varBank["-parent"]=null;varBank.e=new Material(2.718281828459045);varBank.pi=new Material(3.141592653589793);varBank.phi=new Material(1.61803399);for(var t=0;t<functionLoaders.length;t++)functionLoaders[t]();varBank.stringbase=StringBase;varBank.vectorbase=VectorBase;window.ObjectBase&&(varBank.objectbase=ObjectBase);window.AgentBase&&(varBank.agentbase=AgentBase)}if(!Agent)var Agent=function(){};if(!Agents)var Agents=function(){};var PrimitiveStore=function(t,e){this.primitive=t;this.type=e};Boolean.prototype.toNum=function(){return this.valueOf()};String.prototype.toNum=function(){return this.valueOf()};Number.prototype.toNum=function(){return this.valueOf()};Function.prototype.toNum=function(){return this([])};function UserFunction(){}UserFunction.prototype.toNum=function(){return this.fn?this.fn([]):this([])};var StringObject={},StringBase,VectorObject={},VectorBase={},Vector=function(t,e,n){this.parent=n||VectorBase;this.items=t;this.names=e;this.namesLC=void 0;if(e){this.namesLC=[];for(var i=0;i<e.length;i++)e[i]?this.namesLC.push(e[i].toLowerCase()):this.namesLC.push(void 0)}};Vector.prototype.toNum=function(){if(this.isNum)return this;for(var t=this.fullClone(),e=0;e<t.items.length;e++)t.items[e]=t.items[e].toNum();t.isNum=!0;return t};Vector.prototype.toString=function(){for(var t=[],e=0;e<this.items.length;e++){var n=prepareDisplay(this.items[e].toNum().toString());this.names&&this.names[e]&&(n=this.names[e]+": "+n);t.push(n)}return"{"+t.join(", ")+"}"};Vector.prototype.length=function(){return this.items.length};Vector.prototype.cloneCombine=function(t,e,n,i){return this.fullClone().combine(t,e,n,i)};Vector.prototype.combine=function(t,e,n,i){if(t instanceof Vector&&this.length()!=t.length()&&!this.names&&!t.names)throw"MSG: Vectors must have equal length when combined.";if(t instanceof Vector&&this.names&&t.names){if(!i&&t.depth()>this.depth())return t.combine(this,e,!n);if(!this.keysMatch(t.namesLC)){if(this.items[0]instanceof Vector){for(var r=0;r<this.items.length;r++)this.items[r].combine(t,e,n,!0);return this}throw"MSG: Keys do not match for vector operation."}}for(r=0;r<this.length();r++){var a;if(t instanceof Vector)if(this.names&&t.names){var s=t.namesLC.indexOf(this.namesLC[r]);"*"==this.names&&(s=-2);(isUndefined(s)||-1==s)&&(s=t.names.indexOf("*"));if(isUndefined(s)||-1==s)throw"MSG: Mismatched keys for vector operation.";a=-2==s?void 0:t.items[s]}else a=t.items[r];else a=t;isDefined(a)&&(this.items[r]=n?e(a,this.items[r]):e(this.items[r],a))}if(this.names&&this.names.indexOf("*")>-1&&t instanceof Vector&&t.names){var o=this.items[this.names.indexOf("*")];for(r=0;r<t.names.length;r++)if(t.names[r]&&(-1==this.namesLC.indexOf(t.namesLC[r])||"*"==t.names)){n?this.items.push(e(t.items[r],o)):this.items.push(e(o,t.items[r]));this.names.push(t.names[r]);this.namesLC.push(t.namesLC[r])}}return this};Vector.prototype.collapseDimensions=function(t){if(t instanceof Vector){if(this.depth()==t.depth())return this;for(var e=[],n=this,i=t,r=0;r<this.depth();r++)if(i instanceof Vector)if(void 0===n.namesLC&&void 0===i.namesLC||void 0!==n.namesLC&&void 0!==i.namesLC&&keysMatch(n.namesLC,i.namesLC)){e.push("*");n=n.items[0];i=i.items[0]}else{e.push((function(t){return functionBank.sum(t[0].items)}));n=n.items[0]}else{e.push((function(t){return functionBank.sum(t[0].items)}));n=n.items[0]}if(i.items)throw"MSG: Keys do not match for vector collapsing.";return selectFromMatrix(this,e)}return functionBank.sum([functionBank.flatten([this])])};function keysMatch(t,e){if(-1==e.indexOf("*"))for(var n=0;n<t.length;n++)if("*"!=t[n]){if(isUndefined(t[n]))return!1;if(-1==e.indexOf(t[n]))return!1}if(-1==t.indexOf("*"))for(n=0;n<e.length;n++)if("*"!=e[n]){if(isUndefined(e[n]))return!1;if(-1==t.indexOf(e[n]))return!1}return!0}Vector.prototype.depth=function(){return 0!=this.items.length&&this.items[0]instanceof Vector?this.items[0].depth()+1:1};Vector.prototype.keysMatch=function(t){return!!this.names&&keysMatch(this.namesLC,t)};Vector.prototype.cloneApply=function(t){return this.fullClone().apply(t)};Vector.prototype.apply=function(t){for(var e=0;e<this.items.length;e++)this.items[e]=t(this.items[e],this.names?this.names[e]:void 0);return this};Vector.prototype.stackApply=function(t){return 1==this.depth()?t(this):this.stack().recurseApply(t)};Vector.prototype.stack=function(t){var e=[];t=t||[0];for(var n=this.select(t),i=1;i<this.items.length;i++){t[0]=i;var r=this.select(t);if(n instanceof Vector&&r instanceof Vector){if(n.names&&!r.names||r.names&&!n.names)throw"MSG: Mismatched keys for vector collapsing.";if(n.items.length!=r.items.length)throw"MSG: Vectors of unequal size."}else if(!(n instanceof Vector||r instanceof Vector))throw"MSG: Mismatched keys for vector collapsing."}t[0]=0;t.push(0);for(i=0;i<n.items.length;i++){t[t.length-1]=n.names?n.namesLC[i]:i;if(n.items[i]instanceof Vector)e.push(this.stack(t.slice()));else{for(var a=[],s=0;s<this.items.length;s++){var o=t.slice();o[0]=s;var l=this.select(o);if(l instanceof Vector)throw"MSG: Number where vector expected in vector collapsing.";a.push(l)}var u=new Vector(a);u.terminateApply=!0;e.push(u)}}return new Vector(e,n.names?n.names.slice():void 0)};Vector.prototype.select=function(t){for(var e=this,n=0;n<t.length;n++){if(!e.items)throw"MSG: Number where vector expected in vector collapsing.";if(t[n]instanceof String||"string"==typeof t[n]){var i=e.namesLC.indexOf(t[n].valueOf());if(-1==i)throw"MSG: Mismatched keys for vector collapsing.";e=e.items[i]}else e=e.items[t[n]]}return e};Vector.prototype.recurseApply=function(t){for(var e=0;e<this.items.length;e++)this.items[e]instanceof Vector&&!this.items[e].terminateApply?this.items[e]=this.items[e].recurseApply(t):this.items[e]=t(this.items[e]);return this};Vector.prototype.fullNames=function(){if(this.items[0]instanceof Vector&&this.items[0].names){for(var t=this.items[0].fullNames(),e=[],n=0;n<this.names.length;n++)for(var i=0;i<t.length;i++)e.push([this.names[n]].concat(t[i]));return e}for(e=[],n=0;n<this.names.length;n++)e.push([this.names[n]]);return e};Vector.prototype.clone=function(){for(var t=[],e=0;e<this.items.length;e++)this.items[e]instanceof Vector?t.push(this.items[e].clone()):t.push(this.items[e]);return new Vector(t,this.names?this.names.slice():void 0,this.parent)};Vector.prototype.fullClone=function(){for(var t=[],e=0;e<this.items.length;e++)this.items[e].fullClone?t.push(this.items[e].fullClone()):t.push(this.items[e]);return new Vector(t,this.names?this.names.slice():void 0,this.parent)};Vector.prototype.equals=function(t){if(this.length()!=t.length())return!1;for(var e=0;e<this.items.length;e++)if(!strictEquals(this.items[e],t.items[e]))return!1;return!0};if(!Primitive){var Primitive=function(t){this.v=t;this.vector=new Vector([],[],VectorBase)};Primitive.prototype.value=function(){return this.v.fullClone()};Primitive.prototype.setValue=function(t){this.v=t;return t};Primitive.prototype.toNum=function(){return this.v.fullClone()};Primitive.prototype.toString=function(){return"Primitive Reference"}}function strictEquals(t,e){if(t instanceof Agent||e instanceof Agent){if(t instanceof Agent&&e instanceof Agent&&t.instanceId==e.instanceId)return!0}else if(t instanceof Vector||e instanceof Vector){if(t instanceof Vector&&e instanceof Vector&&t.equals(e))return!0}else if(eq(t,e))return!0;return!1}function createTree(t){var e=new org.antlr.runtime.ANTLRStringStream(t.replace(/\\n/g,"\n")),n=new FormulaLexer(e),i=new org.antlr.runtime.CommonTokenStream(n),r=new FormulaParser(i),a=convertToObject(r.lines().tree,r);isLocal();return a}function trimTree(t,e){return trimNode(t,e)}function evaluateTree(t,e){evaluatingLine=void 0;try{return evaluateNode(t,e)}catch(t){if(t.returnVal)return t.data;throw t}}var PB={test:new Primitive(new Material(3)),a:new Primitive(new Material(1)),b:new Primitive(new Material(2)),c:new Primitive(new Material(3))};function evaluate(t,e){PB["test vector"]=new Primitive(new Vector([new Material(1),new Material(2),new Material(3)],[],VectorBase));PB["test vector 2"]=new Primitive(new Vector([new Material(1.2),new Material(2.9),new Material(3)],[],VectorBase));var n,i=trimTree(createTree(t),PB);try{n=evaluateTree(i,varBank);e||(n=n.toNum())}catch(t){if("PLOT"==t){var r={isPlot:!0,data:[]},a={};a["-parent"]=varBank;for(var s=-100;s<=100;s+=1){a.x=new Material(s/10);r.data.push([s/10,0+evaluateTree(i,a).value])}return r}throw t}if(n instanceof Material){n.value.toPrecision&&(0===n.value?n.value="0":n.value=n.value.toPrecision(21));"."==n.value.substr(n.value.length-1,1)&&(n.value=n.value.substring(0,n.value.length-1));n.value=n.value.replace(/\.?\+\.?/g,"+");n.value=n.value.replace(/\.?\-\.?/g,"-");n.value=n.value.replace(/\.i/g,"i");n.value=n.value.replace(/(\d)i/g,"$1*<i>i</i>");n.value=n.value.replace(/\.e/g,"e");n.value=n.value.replace(/e\+/g,"e");"+inf.0"==n.value?n.value="Infinity":"-inf.0"==n.value&&(n.value="-Infinity")}return n}var TreeNode=function(t,e,n){this.origText=t;this.text=t.toLowerCase();this.typeName=e;this.line=n;this.children=[]};function convertToObject(t,e){var n=t.getToken(),i=new TreeNode(n.getText(),e.getTokenNames()[n.getType()],n.line);if(t.getChildCount()>0)for(var r=t.getChildren(),a=0;a<r.length;a++){i.children.push(convertToObject(r[a],e));!i.line&&i.children[i.children.length-1].line&&(i.line=i.children[i.children.length-1].line)}return i}var funcEvalMap=new Object,evaluatingLine=null;funcEvalMap.LINES=function(t,e){if(0==t.children.length)return new Material(0);for(var n,i=0;i<t.children.length;i++){if("return"==t.children[i].text)throw{returnVal:!0,data:evaluateNode(t.children[i].children[0],e)};n=evaluateNode(t.children[i],e)}return n};funcEvalMap.NEGATE=function(t,e){return negate(evaluateNode(t.children[0],e).toNum())};function negate(t){if(t instanceof Vector)return t.cloneApply(negate);if("boolean"==typeof t)throw"MSG: Cannot convert Booleans to Numbers.";if(t instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";return new Material(fn["-"](t.value),t.units)}funcEvalMap.AND=function(t,e){return funAnd(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function funAnd(t,e){return t instanceof Vector?t.cloneCombine(e,funAnd,!1):e instanceof Vector?e.cloneCombine(t,funAnd,!0):trueValue(t)&&trueValue(e)}funcEvalMap.OR=function(t,e){return funOr(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function funOr(t,e){return t instanceof Vector?t.cloneCombine(e,funOr,!1):e instanceof Vector?e.cloneCombine(t,funOr,!0):trueValue(t)||trueValue(e)}funcEvalMap.XOR=function(t,e){return funXor(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function funXor(t,e){return t instanceof Vector?t.cloneCombine(e,funXor,!1):e instanceof Vector?e.cloneCombine(t,funXor,!0):(trueValue(t)||trueValue(e))&&!(trueValue(t)&&trueValue(e))}funcEvalMap.NOT=function(t,e){return fNot(evaluateNode(t.children[0],e).toNum())};function fNot(t){return t instanceof Vector?t.cloneApply(fNot):!trueValue(t)}funcEvalMap.NOTEQUALS=function(t,e){return neq(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function neq(t,e){if("boolean"==typeof t&&!(e instanceof Vector)||"boolean"==typeof e&&!(t instanceof Vector))return trueValue(t)!=trueValue(e);if((t instanceof String||"string"==typeof t)&&!(e instanceof Vector)||(e instanceof String||"string"==typeof e)&&!(t instanceof Vector))return(t.toLowerCase?t.toLowerCase():t)!=(e.toLowerCase?e.toLowerCase():e);if(t instanceof Vector)return t.cloneCombine(e,neq,!1);if(e instanceof Vector)return e.cloneCombine(t,neq,!0);if(!(t instanceof Material&&e instanceof Material))return t!=e;if(t.units!==e.units){var n=convertUnits(e.units,t.units);if(0===n)return!0;e.value=fn["*"](e.value,n);e.units=t.units}return!fn["="](t.value,e.value)}funcEvalMap.EQUALS=function(t,e){return eq(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function eq(t,e){if("boolean"==typeof t&&!(e instanceof Vector)||"boolean"==typeof e&&!(t instanceof Vector))return trueValue(t)==trueValue(e);if(("string"==typeof t||t instanceof String)&&!(e instanceof Vector)||("string"==typeof e||e instanceof String)&&!(t instanceof Vector))return(t.toLowerCase?t.toLowerCase():t)==(e.toLowerCase?e.toLowerCase():e);if(t instanceof Vector)return t.cloneCombine(e,eq,!1);if(e instanceof Vector)return e.cloneCombine(t,eq,!0);if(!(t instanceof Material&&e instanceof Material))return t==e;if(t.units!==e.units){var n=convertUnits(e.units,t.units);if(0===n)return!1;e.value=fn["*"](e.value,n);e.units=t.units}return fn["="](t.value,e.value)}function comparisonValid(t,e){if(t instanceof String||"string"==typeof t||e instanceof String||"string"==typeof e)throw"MSG: Cannot use Strings in logical inequality comparisons.";if(t instanceof Agent||e instanceof Agent)throw"MSG: Cannot use Agents in logical inequality comparisons."}funcEvalMap.LT=function(t,e){return lessThan(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function lessThan(t,e){comparisonValid(t,e);if(t instanceof Vector)return t.cloneCombine(e,lessThan,!1);if(e instanceof Vector)return e.cloneCombine(t,lessThan,!0);if(t.units!==e.units){var n=convertUnits(e.units,t.units);if(0===n)unitAlert(t.units,e.units,"comparison");else{e.value=fn["*"](e.value,n);e.units=t.units}}return fn["<"](t.value,e.value)}funcEvalMap.LTEQ=function(t,e){return lessThanEq(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function lessThanEq(t,e){comparisonValid(t,e);if(t instanceof Vector)return t.cloneCombine(e,lessThanEq,!1);if(e instanceof Vector)return e.cloneCombine(t,lessThanEq,!0);if(t.units!==e.units){var n=convertUnits(e.units,t.units);if(0===n)unitAlert(t.units,e.units,"comparison");else{e.value=fn["*"](e.value,n);e.units=t.units}}return fn["<="](t.value,e.value)}funcEvalMap.GT=function(t,e){return greaterThan(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function greaterThan(t,e){comparisonValid(t,e);if(t instanceof Vector)return t.cloneCombine(e,greaterThan,!1);if(e instanceof Vector)return e.cloneCombine(t,greaterThan,!0);if(t.units!==e.units){var n=convertUnits(e.units,t.units);if(0===n)unitAlert(t.units,e.units,"comparison");else{e.value=fn["*"](e.value,n);e.units=t.units}}return fn[">"](t.value,e.value)}funcEvalMap.GTEQ=function(t,e){return greaterThanEq(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function greaterThanEq(t,e){comparisonValid(t,e);if(t instanceof Vector)return t.cloneCombine(e,greaterThanEq,!1);if(e instanceof Vector)return e.cloneCombine(t,greaterThanEq,!0);if(t.units!==e.units){var n=convertUnits(e.units,t.units);if(0===n)unitAlert(t.units,e.units,"comparison");else{e.value=fn["*"](e.value,n);e.units=t.units}}return fn[">="](t.value,e.value)}funcEvalMap.PLUS=function(t,e){return plus(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function plus(t,e){if(t instanceof Vector)return t.cloneCombine(e,plus,!1);if(e instanceof Vector)return e.cloneCombine(t,plus,!0);if("boolean"==typeof t||"boolean"==typeof e)throw"MSG: Cannot convert Booleans to Numbers.";if(t instanceof Agent||e instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";if("string"==typeof t||t instanceof String||"string"==typeof e||e instanceof String){var n=new String(t.toString()+e.toString());n.parent=StringBase;return n}if(t.units!==e.units){var i=convertUnits(e.units,t.units);if(0===i)unitAlert(t.units,e.units,"addition");else{e.value=fn["*"](e.value,i);e.units=t.units}}return new Material(fn["+"](t.value,e.value),e.units)}funcEvalMap.MINUS=function(t,e){return minus(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function minus(t,e){if(t instanceof Vector)return t.cloneCombine(e,minus,!1);if(e instanceof Vector)return e.cloneCombine(t,minus,!0);if("boolean"==typeof t||"boolean"==typeof e)throw"MSG: Cannot convert Booleans to Numbers.";if(t instanceof Agent||e instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";if(t.units!==e.units){var n=convertUnits(e.units,t.units);if(0===n)unitAlert(t.units,e.units,"subtraction");else{e.value=fn["*"](e.value,n);e.units=t.units}}return new Material(fn["-"](t.value,e.value),e.units)}funcEvalMap.MULT=function(t,e){return mult(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function mult(t,e){if(t instanceof Vector)return t.cloneCombine(e,mult,!1);if(e instanceof Vector)return e.cloneCombine(t,mult,!0);if("boolean"==typeof t||"boolean"==typeof e)throw"MSG: Cannot convert Booleans to Numbers.";if(t instanceof Agent||e instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";var n=fn["*"](t.value,e.value);if(t.units&&e.units){t.units.addBase();e.units.addBase();return new Material(fn["*"](fn["*"](t.units.toBase,n),e.units.toBase),t.units.multiply(e.units,1))}return t.units?new Material(n,t.units):e.units?new Material(n,e.units):new Material(n)}funcEvalMap.DIV=function(t,e){return div(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function div(t,e){if(t instanceof Vector)return t.cloneCombine(e,div,!1);if(e instanceof Vector)return e.cloneCombine(t,div,!0);if("boolean"==typeof t||"boolean"==typeof e)throw"MSG: Cannot convert Booleans to Numbers.";if(t instanceof Agent||e instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";var n=fn["/"](t.value,e.value);if(t.units&&e.units){t.units.addBase();e.units.addBase();return new Material(fn["/"](fn["*"](t.units.toBase,n),e.units.toBase),t.units.multiply(e.units,-1))}return t.units?new Material(n,t.units):e.units?new Material(n,e.units.power(-1)):new Material(n)}funcEvalMap.POWER=function(t,e){if(1==t.children.length)return evaluateNode(t.children[0],e);for(var n=evaluateNode(t.children[t.children.length-1],e).toNum(),i=t.children.length-1;i>0;i--){var r=evaluateNode(t.children[i-1],e).toNum();if(!(n instanceof Vector)&&n.units)throw"MSG: Exponents may not have units.";n=power(r,n)}return n};function power(t,e){if(t instanceof Vector)return t.cloneCombine(e,power,!1);if(e instanceof Vector)return e.cloneCombine(t,power,!0);if("boolean"==typeof t||"boolean"==typeof e)throw"MSG: Cannot convert Booleans to Numbers.";if(t instanceof Agent||e instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";var n=t.value;"number"==typeof n&&(n=sn("#e"+n));return new Material(fn.expt(n,e.value),t.units?t.units.power(e.value):void 0)}funcEvalMap.MOD=function(t,e){return doMod(evaluateNode(t.children[0],e).toNum(),evaluateNode(t.children[1],e).toNum())};function doMod(t,e){if(t instanceof Vector)return t.cloneCombine(e,doMod,!1);if(e instanceof Vector)return e.cloneCombine(t,doMod,!0);if("boolean"==typeof t||"boolean"==typeof e)throw"MSG: Cannot convert Booleans to Numbers.";if(t instanceof Agent||e instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";if(e.units)throw'MSG: The right hand side of "mod" may not have units.';return new Material(fn.mod(t.value,e.value),t.units)}funcEvalMap.IDENT=function(t,e){for(var n=t.text;!(n in e);){if(!e["-parent"]){if("x"==n&&window.isCalc)throw"PLOT";if("i"==n)return new Material(sn("i"));throw'MSG: The variable or function "'+t.origText+'" does not exist.'}e=e["-parent"]}var i=e[n];i instanceof TreeNode&&"ARRAY"==i.typeName&&(i=evaluateNode(i,e));return!i.fullClone||i instanceof Vector?i:i.fullClone()};funcEvalMap.NEW=function(t,e){var n=evaluateNode(t.children[0],e);if(n instanceof Vector){var i,r,a=new Vector([],void 0,n);try{i=(r=selectFromVector(n,"constructor")).data}catch(t){}if(i)2==t.children.length?callFunction(i,t.children[1],e,a,r.parent):callFunction(i,{children:[]},e,a,r.parent);else if(2==t.children.length&&t.children[1].children.length>0)throw"MSG: No constructor available for '"+t.children[0].text+"'.";return a}throw"MSG: 'New' can only be use to create instances of Vectors."};funcEvalMap.INNER=function(t,e){var n,i,r=evaluateNode(t.children[0],e);if(2==t.children.length&"FUNCALL"==t.children[1].typeName)return callFunction(r,t.children[1],e);e.self&&"parent"==t.children[0].text?n=e.self:r instanceof Function||r instanceof UserFunction||(n=r);for(var a=1;a<t.children.length;a++)if("SELECTOR"==t.children[a].typeName)if("DOTSELECTOR"==t.children[a].children[0].typeName)for(var s=0;s<t.children[a].children[0].children.length;s++){var o=[];t.children[a].children[0].children[s].text?o.push(t.children[a].children[0].children[s].text):o.push(t.children[a].children[0].children[s].valueOf());try{r=selectFromMatrix(r,o)}catch(t){if(!(r instanceof Primitive)||r instanceof Agent)throw t;r=r.toNum();s--}if(!(r instanceof Function||r instanceof UserFunction)){n=r;i=r}}else{if(r instanceof Primitive&&!((r=r.toNum())instanceof Function||r instanceof UserFunction)){n=r;i=r}try{r=selectFromMatrix(r,createMatrixSelector(t.children[a],e,0,!0))}catch(t){if(!(r instanceof Primitive))throw t;r=r.toNum();a--}if(!(r instanceof Function||r instanceof UserFunction)){n=r;i=r}}else if(!((r=callFunction(r,t.children[a],e,n,i))instanceof Function||r instanceof UserFunction)){n=r;i=r}return r};function callFunction(t,e,n,i,r){if("function"!=typeof t&&!(t instanceof UserFunction))throw"MSG: Trying to call a non-function.";var a,s=[],o="";if(e instanceof Array)s=e;else{e.functionFingerprint||(e.functionFingerprint="FINGERPRINT-"+Math.random());o=e.functionFingerprint;if(t.delayEvalParams)for(var l=0;l<e.children.length;l++)s.push({node:e.children[l],scope:n});else for(l=0;l<e.children.length;l++){var u=evaluateNode(e.children[l],n);!u.fullClone||u instanceof Vector||(u=u.fullClone());s.push(u)}}if(t.fn)a=t.fn;else{e.delayEvalParams=t.delayEvalParams;a=t}var h=evaluatingLine,c=a(s,o,i,r);evaluatingLine=h;return c}function createMatrixSelector(t,e,n,i){for(var r=[],a=n=n||0;a<t.children.length;a++){if("MULT"==t.children[a].typeName)r.push("*");else{var s=evaluateNode(t.children[a],e);if("function"==typeof s||s instanceof UserFunction){if("function"==typeof s)var o=s;else o=s.fn;!function(t){r.push((function(e){if(!e[0].stackApply)throw"MSG: Can't apply function across elements of non-vector.";return e[0].stackApply((function(e){return t([e])}))}))}(o)}else r.push(s.toNum())}}return r}function selectFromMatrix(t,e,n){var i=t;i instanceof Vector||(i.vector?i=i.vector:i.parent&&(i=new Vector([],[],i.parent)));isUndefined(n)&&i.fullClone&&(i=i.fullClone());var r=selectFromVector(i,e.shift(),0==e.length?n:void 0,isDefined(n)),a=[];a=r.collapsed?[r.data]:r.data.items;for(;e.length>0;){for(var s=[],o=e.shift(),l=0;l<a.length;l++){if(!(a[l]instanceof Vector))throw"MSG: No element available for: "+o;var u=selectFromVector(a[l],o,0==e.length?n:void 0);if(u.collapsed){if(!n){a[l].items=[u.data];a[l].names=["!!BREAKOUT DATA"]}s=s.concat(u.data)}else{s=s.concat(u.data.items);if(!n){a[l].items=u.data.items;a[l].names=u.data.names}}}a=s}return doBreakouts(r.data)}function doBreakouts(t){if(!(t instanceof Vector))return t;if(1==t.items.length&&t.names&&"!!BREAKOUT DATA"==t.names[0])return doBreakouts(t.items[0]);for(var e=0;e<t.items.length;e++)t.items[e]=doBreakouts(t.items[e]);return t}function selectFromVector(t,e,n,i){if("*"==e)return{data:t};if("function"==typeof e)return{data:e([t]),collapsed:!0};if("parent"==e){if(t.parent)return{data:i?t.parent:t.parent.fullClone(),collapsed:!0};throw"MSG: Vector does not have a parent."}if(e instanceof Vector){for(var r=[],a=t.names?[]:void 0,s=0;s<e.items.length;s++){var o=e.items[s],l=!0;"boolean"==typeof o&&(o?o=new Material(s+1):l=!1);if(l){var u=selectElementFromVector(t,o,n);r.push(u.value);a&&a.push(u.name)}}return{collapsed:!1,parent:t,data:new Vector(r,a,t.parent)}}return{collapsed:!0,parent:t,data:selectElementFromVector(t,e,n).value}}function selectElementFromVector(t,e,n){var i,r=void 0,a=void 0;if(e instanceof String||"string"==typeof e)try{if(isUndefined(n)&&!t.names)throw"MSG: Key '"+e+"' not in vector.";if(t.names){i=-1;for(var s=e.toLowerCase(),o=0;o<t.names.length;o++)if(t.names[o]&&t.names[o].toLowerCase()===s){i=o;break}(i<0||isUndefined(i))&&(i=t.names.indexOf("*"))}if(i<0||isUndefined(i)){if(isUndefined(n))throw"MSG: Key '"+e+"' not in vector.";i=e}}catch(i){if(t.parent)return selectElementFromVector(t.parent,e,n);throw i}else i=parseFloat(e.toNum())-1;if(i instanceof String||"string"==typeof i){if(!t.names){t.names=[];for(o=0;o<t.items.length;o++)t.names.push(void 0)}t.items.push(n);t.names.push(i.valueOf());a=n;r=i}else{if(i<0||!t.items||i>=t.items.length||i%1!=0)throw"MSG: Index "+(1+i)+" is not in the vector.";isUndefined(n)||(t.items[i]=n);a=t.items[i];t.names&&(r=t.names[i])}return{name:r,value:a}}funcEvalMap.ARRAY=function(t,e){if(1==t.children.length&&t.children[0]instanceof Vector)return t.children[0].fullClone();for(var n=[],i=[],r=!1,a=0;a<t.children.length;a++){n.push(evaluateNode(t.children[a].children[0],e));if(t.children[a].children.length>1){t.children[a].children[1].text?i.push(t.children[a].children[1].origText):i.push(t.children[a].children[1].valueOf());r=!0}else i.push(void 0)}return new Vector(n,r?i:void 0)};funcEvalMap.RANGE=function(t,e){if(1==t.children.length)return evaluateNode(t.children[0],e);var n=[],i=evaluateNode(t.children[0],e).toNum(),r=evaluateNode(t.children[t.children.length-1],e).toNum();if(!(i instanceof Material&&r instanceof Material))throw"MSG: Range elements must be numbers.";n.push(i.fullClone());if(i.units!==r.units){if(1!=convertUnits(i.units,r.units))throw"MSG: Units on both sides of ':' must be equal."}var a=2==t.children.length?new Material(1,i.units):evaluateNode(t.children[1],e).toNum();if(!(a instanceof Material))throw"MSG: Range elements must be numbers.";if(eq(i,r));else if(lessThan(i,r))for(var s=plus(i,a);lessThanEq(s,r);){n.push(s);s=plus(s,a)}else if(greaterThan(i,r)){2==t.children.length&&(a=negate(a));for(s=plus(i,a);greaterThanEq(s,r);){n.push(s);s=plus(s,a)}}return new Vector(n)};function makeFunctionCall(t,e,n,i,r){var a=new UserFunction;a.localScope=new Object;a.localScope.nVars=e.length;for(var s=0;s<e.length;s++)a.localScope[s+=""]=e[s];a.localScope["-parent"]=r;a.defaults=n;a.fn=function(e,n,s,o){for(var l=e.length,u=0;u<e.length;u++)e[u].optional&&l--;if(a.localScope.nVars-a.defaults.length>e.length||l>a.localScope.nVars){var h=[];for(u=0;u<a.localScope.nVars;u++)a.defaults.length-(a.localScope.nVars-u)>-1?h.push(a.localScope[u+=""]+"="+a.defaults[a.defaults.length-(a.localScope.nVars-u)]):h.push(a.localScope[u+=""]);throw"MSG: Wrong number of parameters for "+t+"("+h.join(", ")+")."}var c={"-parent":r};for(u=0;u<e.length;u++)c[a.localScope[u+=""]]=e[u];for(u=e.length;u<a.localScope.nVars;u++)c[a.localScope[u+=""]]=a.defaults[a.defaults.length-(a.localScope.nVars-u)];s&&(c.self||(c.self=s));o&&o.parent&&(c.parent=o.parent);try{return evaluateNode(i,c)}catch(t){if(t.returnVal)return t.data;throw t}};return a}funcEvalMap.THROW=function(t,e){throw"MSG: "+evaluateNode(t.children[0],e)};funcEvalMap.TRYCATCH=function(t,e){try{return evaluateNode(t.children[0],e)}catch(i){var n={"-parent":e};n[t.children[2].text]=s("string"==typeof i||i instanceof String?i.substr(5):"An error has occurred.");return evaluateNode(t.children[1],n)}};funcEvalMap.WHILE=function(t,e){for(var n=new Material(0),i={"-parent":e};trueValue(evaluateNode(t.children[0],e).toNum());)n=evaluateNode(t.children[1],i);return n};funcEvalMap.IFTHENELSE=function(t,e){for(var n={"-parent":e},i=0;i<t.children[0].children.length;i++)if(trueValue(evaluateNode(t.children[0].children[i],e).toNum()))return evaluateNode(t.children[1].children[i],n);return t.children[0].children.length!=t.children[1].children.length?evaluateNode(t.children[1].children[i],n):new Material(0)};funcEvalMap.FORIN=function(t,e){var n=new Material(0),i=t.children[0].text,r={"-parent":e},a=evaluateNode(t.children[1],e);if(!(a instanceof Vector))throw"MSG: The in argument of a For-In loop mush be a a vector.";for(var s=0;s<a.items.length;s++){r[i]=a.items[s];n=evaluateNode(t.children[2],r)}return n};funcEvalMap.FOR=function(t,e){var n=new Material(0),i=t.children[0].text,r=evaluateNode(t.children[1].children[0],e).toNum(),a=new Material(1);3==t.children[1].children.length&&(a=evaluateNode(t.children[1].children[2],e).toNum());var s={"-parent":e};s[i]=r;for(;fn[a.value>=0?"<=":">="](s[i].value,evaluateNode(t.children[1].children[1],e).toNum());){n=evaluateNode(t.children[2],s);s[i]=plus(s[i],a)}return n};funcEvalMap.FUNCTION=function(t,e){var n=t.children[0].children[0].text;functionGenerator(n,t.children[0],t.children[1],t.children[2],e);return'"'+n+'" defined'};funcEvalMap.ANONFUNCTION=function(t,e){return functionGenerator(null,t.children[0],t.children[1],t.children[2],e)};funcEvalMap.ASSIGN=function(t,e){var n=t.children.length-1,i=evaluateNode(t.children[t.children.length-1],e);if(n>1&&(!(i instanceof Vector)||i.items.length<n))throw"MSG: Too few elements returned for assignment.";for(var r=0;r<n;r++)if(t.children[r]instanceof PrimitiveStore)1==n?t.children[r].primitive.setValue(i):t.children[r].primitive.setValue(i.items[r]);else{var a=t.children[r].children[0].text;if(t.children[r].children.length>1)var s=createSelector(t.children[r].children[1],e);for(var o,l=e;null!==e["-parent"]&&!isDefined(e[a]);)e=e["-parent"];null===e["-parent"]&&isUndefined(e[a])&&(e=l);o=1==n?i:i.items[r];if(1==t.children[r].children.length)e[a]=o;else{if(!isDefined(e[a]))throw"MSG: The variable '"+t.children[r].children[0].origText+"' does not exist.";selectFromMatrix(e[a],s,o)}}return n>1?new Vector(i.items.slice(0,n)):i};function createSelector(t,e){if("DOTSELECTOR"==t.children[0].typeName){for(var n=[],i=0;i<t.children[0].children.length;i++)t.children[0].children[i].text?n.push(t.children[0].children[i].text):n.push(t.children[0].children[i].valueOf());return n}return createMatrixSelector(t,e,0,!0)}funcEvalMap.MATERIAL=function(t,e){var n=evaluateNode(t.children[0],e).toNum();if(n.units)throw"MSG: Cannot create material where numeric part itself has units.";return new Material(n.value,t.children[1])};function functionGenerator(t,e,n,i,r){for(var a=[],s=[],o=null===t?0:1;o<e.children.length;o++)a.push(e.children[o].text);for(o=0;o<n.children.length;o++)s.push(n.children[o]);if(null===t)return makeFunctionCall(null===t?"Function":t,a,s,i,r);r[t]=makeFunctionCall(t,a,s,i,r)}var unitEvalMap=new Object;unitEvalMap.MULT=function(t){return evaluateUnits(t.children[0]).concat(evaluateUnits(t.children[1]))};unitEvalMap.POW=function(t){var e=1,n=1;if(3==t.children.length){e*=-1;n++}var i=evaluateUnits(t.children[0]),r=evaluateUnits(t.children[n])*e;if(i instanceof Array){for(var a=0;a<i.length;a++)i[a].exponent=i[a].exponent*r;return i}return Math.pow(i,r)};unitEvalMap.DIV=function(t){for(var e=evaluateUnits(t.children[0]),n=evaluateUnits(t.children[1]),i=0;i<n.length;i++)n[i].exponent=-1*n[i].exponent;return e.concat(n)};unitEvalMap.PER=unitEvalMap.DIV;unitEvalMap.UNIT=function(t){for(var e="",n=0;n<t.children.length;n++){e+=t.children[n].text;n<t.children.length-1&&(e+=" ")}return[{id:e,exponent:1}]};unitEvalMap.UNITCLUMP=function(t){var e=evaluateUnits(t.children[0]);if(t.children.length>1)for(var n=1;n<t.children.length;n++)if("NEGATE"==t.children[n].typeName)for(var i=0;i<e.length;i++)e[i].exponent=-1*e[i].exponent;else if("SQUARED"==t.children[n].typeName)for(i=0;i<e.length;i++)e[i].exponent=2*e[i].exponent;else if("CUBED"==t.children[n].typeName)for(i=0;i<e.length;i++)e[i].exponent=3*e[i].exponent;return e};unitEvalMap.INTEGER=function(t){return parseInt(t.text)};unitEvalMap.FLOAT=function(t){return parseFloat(t.text)};function evaluateUnits(t){return t instanceof Material?t.value:unitEvalMap[t.typeName](t)}function evaluateNode(t,e){if(t instanceof TreeNode){evaluatingLine=t.line||evaluatingLine;return funcEvalMap[t.typeName](t,e)}if(!(t instanceof PrimitiveStore))return t;if("totalValue"==t.type){if(!t.primitive.totalContents)throw"MSG: You can only use the double-bracket notation for total conveyor contents on Stock primitives.";return t.primitive.totalContents()}return"object"==t.type?t.primitive:void 0}var trimEvalMap=new Object,AgentBase;trimEvalMap.POWER=function(t,e){if(1==t.children.length)return trimNode(t.children[0],e);for(var n=new TreeNode(t.origText,t.typeName,t.line),i=0;i<t.children.length;i++)n.children.push(trimNode(t.children[i],e));return n};trimEvalMap.INNER=function(t,e){if(1==t.children.length)return trimNode(t.children[0],e);for(var n=new TreeNode(t.origText,t.typeName,t.line),i=0;i<t.children.length;i++)n.children.push(trimNode(t.children[i],e));return n};trimEvalMap.RANGE=trimEvalMap.POWER;trimEvalMap.TRUE=function(t){return!0};trimEvalMap.FALSE=function(t){return!1};trimEvalMap.STRING=function(t){var e,n=t.origText.substr(1,t.origText.length-2);e='"'==t.origText[0]?n.replace(/\\\\/g,"\\\\TEMPTXT\\\\").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\t/g,"\t").replace(/\\b/g,"\b").replace(/\\f/g,"\f").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\\\TEMPTXT\\\\/g,"\\"):n.replace(/\n/,"\\n");(e=new String(e)).vector=new Vector([],[],StringBase);return e};trimEvalMap.INTEGER=function(t){return new Material(sn("#e"+t.text))};trimEvalMap.MATERIAL=function(t,e){for(var n=t.children[0],i=trimNode(t.children[1],e),r=(n=evaluateUnits(n),[]),a=[],s=0;s<n.length;s++){var o=a.indexOf(n[s].id);if(-1==o){r.push(n[s].exponent);a.push(n[s].id)}else r[o]=r[o]+n[s].exponent}if(i instanceof Material){if(i.units)throw"MSG: Cannot create material where numeric part itself has units.";return new Material(i.value,getUnitStore(a,r,!0))}var l=new TreeNode(t.origText,"MATERIAL",t.line);l.children=[i,getUnitStore(a,r,!0)];return l};trimEvalMap.MULT=function(t,e){if(0==t.children.length)return"*";var n=trimNode(t.children[0],e),i=trimNode(t.children[1],e);if(isConst(n)&&isConst(i))return mult(n,i);var r=new TreeNode(t.origText,t.typeName,t.line);r.children=[n,i];return r};trimEvalMap.DIV=function(t,e){var n=trimNode(t.children[0],e),i=trimNode(t.children[1],e);if(isConst(n)&&isConst(i))return div(n,i);var r=new TreeNode(t.origText,t.typeName,t.line);r.children=[n,i];return r};trimEvalMap.PLUS=function(t,e){var n=trimNode(t.children[0],e),i=trimNode(t.children[1],e);if(isConst(n)&&isConst(i))return plus(n,i);var r=new TreeNode(t.origText,t.typeName,t.line);r.children=[n,i];return r};trimEvalMap.MINUS=function(t,e){var n=trimNode(t.children[0],e),i=trimNode(t.children[1],e);if(isConst(n)&&isConst(i))return minus(n,i);var r=new TreeNode(t.origText,t.typeName,t.line);r.children=[n,i];return r};trimEvalMap.FLOAT=trimEvalMap.INTEGER;trimEvalMap.PRIMITIVE=function(t,e){var n;if(void 0===(n="[["==t.text.substr(0,2)?new PrimitiveStore(e[t.text.substr(2,t.text.length-4)],"totalValue"):new PrimitiveStore(e[t.text.substr(1,t.text.length-2)],"object")).primitive)throw"MSG: The primitive <i>"+t.origText+"</i> could not be found.";return n};trimEvalMap.NEGATE=function(t,e){if(0==t.children.length)return new TreeNode(t.origText,t.typeName,t.line);var n=trimNode(t.children[0],e);if(isConst(n))return negate(n);var i=new TreeNode(t.origText,t.typeName,t.line);i.children=[n];return i};trimEvalMap.ARRAY=function(t,e){for(var n=new TreeNode(t.origText,t.typeName,t.line),i=[],r=[],a=!1,s=0;s<t.children.length;s++){n.children.push(trimNode(t.children[s],e));i.push(n.children[s].children[0]);if(n.children[s].children.length>1){n.children[s].children[1].text?r.push(n.children[s].children[1].origText):r.push(n.children[s].children[1].valueOf());a=!0}else r.push(void 0)}var o=!0;for(s=0;s<i.length;s++)if(!isConst(i[s])){o=!1;break}o&&(n.children=[new Vector(i,a?r:void 0)]);return n};function isConst(t){return t instanceof Material||"string"==typeof t||t instanceof String||"boolean"==typeof t||t instanceof Vector}function trimNode(t,e){if(trimEvalMap.hasOwnProperty(t.typeName)){evaluatingLine=t.line||evaluatingLine;return trimEvalMap[t.typeName](t,e)}for(var n=new TreeNode(t.origText,t.typeName,t.line),i=0;i<t.children.length;i++)n.children.push(trimNode(t.children[i],e));return n}function trueValue(t){if("boolean"==typeof t)return t;if(t instanceof Material)return neq(t.value,0);throw"MSG: Only numbers can be used in place of booleans."}function isLocal(){return"localhost"==document.location.hostname||"insightmaker.test"==document.location.hostname||"calc.test"==document.location.hostname}function isUndefined(t){return void 0===t}function isDefined(t){return!isUndefined(t)}function fireEvent(t,e,n){var i,r=t;if(t instanceof Vector)i=t.parent;else if(t.vector instanceof Vector)i=(t=t.vector).parent;else{if(!(t.parent instanceof Vector))return!1;i=t=t.parent}try{var a=selectFromVector(t,e)}catch(t){return!1}n.optional=!0;return callFunction(a.data,[n],varBank,r,i)}function ObjToVec(t){for(var e=Object.keys(t),n=[],i=0;i<e.length;i++)n.push(t[e[i]]);return new Vector(n,e)}functionLoaders.push((function(){defineFunction("RandBeta",{params:[{name:"Alpha",noUnits:!0,noVector:!0},{name:"Beta",noUnits:!0,noVector:!0}]},(function(t){return new Material(RandBeta(t[0].value,t[1].value))}));defineFunction("RandDist",{params:[{name:"Distribution",noUnits:!0,needVector:!0},{name:"Y (in which case Distribution is X)",noUnits:!0,needVector:!0,defaultVal:!1}]},(function(t){var e,n;if(1==t.length||!1===t[1]){var i=t[0];e=[];n=[];for(var r=0;r<i.items.length;r++){e.push(i.items[r].items[0].toNum().value);n.push(i.items[r].items[1].toNum().value)}}else{e=t[0].toNum().items.map((function(t){return t.value}));n=t[1].toNum().items.map((function(t){return t.value}))}return new Material(RandDist(e,n))}));defineFunction("RandBoolean",{params:[{name:"Probability",defaultVal:.5,noUnits:!0,noVector:!0}]},(function(t){var e;e=0!=t.length?t[0].toNum().value:.5;return Rand()<e}));defineFunction("Rand",{params:[{name:"Lower Bound",defaultVal:0,noUnits:!0,noVector:!0},{name:"Upper Bound",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){return 0!=t.length?new Material(Rand(t[0].toNum().value,t[1].toNum().value)):new Material(Rand())}));defineFunction("RandNormal",{params:[{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){return 0!=t.length?new Material(RandNormal(t[0].toNum().value,t[1].toNum().value)):new Material(RandNormal())}));defineFunction("RandExp",{params:[{name:"Rate",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){return 0!=t.length?new Material(RandExp(t[0].toNum().value)):new Material(RandExp())}));defineFunction("RandLognormal",{params:[{name:"Mean",noUnits:!0,noVector:!0},{name:"Standard Deviation",noUnits:!0,noVector:!0}]},(function(t){return new Material(RandLognormal(t[0].toNum().value,t[1].toNum().value))}));defineFunction("RandBinomial",{params:[{name:"Count",noUnits:!0,noVector:!0},{name:"Probability",noUnits:!0,noVector:!0}]},(function(t){return new Material(RandBinomial(t[0].toNum().value,t[1].toNum().value))}));defineFunction("RandNegativeBinomial",{params:[{name:"Successes",noUnits:!0,noVector:!0},{name:"Probability",noUnits:!0,noVector:!0}]},(function(t){return new Material(RandNegativeBinomial(t[0].toNum().value,t[1].toNum().value))}));defineFunction("RandGamma",{params:[{name:"Alpha",noUnits:!0,noVector:!0},{name:"Beta",noUnits:!0,noVector:!0}]},(function(t){return new Material(RandGamma(t[0].toNum().value,t[1].toNum().value))}));defineFunction("RandPoisson",{params:[{name:"Rate",noUnits:!0,noVector:!0}]},(function(t){return new Material(RandPoisson(t[0].toNum().value))}));defineFunction("RandTriangular",{params:[{name:"Minimum",noUnits:!0,noVector:!0},{name:"Maximum",noUnits:!0,noVector:!0},{name:"Peak",noUnits:!0,noVector:!0}]},(function(t){return new Material(RandTriangular(t[0].toNum().value,t[1].toNum().value,t[2].toNum().value))}));defineFunction("Real",{params:[{name:"Number"}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn["real-part"](e.value);return e}));defineFunction("Imag",{params:[{name:"Number"}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn["imag-part"](e.value);return e}));defineFunction("Magnitude",{params:[{name:"Number"}]},(function(t){if(t[0].toNum()instanceof Vector)return functionBank.sqrt([functionBank.sum([mult(t[0],t[0])])]);var e=t[0].toNum();e.value=fn.magnitude(e.value);return e}));defineFunction("Angle",{params:[{name:"Number"}],recurse:!0},(function(t){return new Material(fn.angle(t[0].toNum().value),getUnitStore(["radians"],[1]))}));defineFunction("Abs",{params:[{name:"Number"}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn.abs(e.value);return e}));defineFunction("sin",{params:[{name:"Number"}],recurse:!0},(function(t){var e=t[0].toNum();e.units&&(e=mult(e,new Material(1,getUnitStore(["radians"],[-1]))));if(e.units)throw"MSG: Non-angular units cannot be used in Sin().";return new Material(fn.sin(e.value))}));defineFunction("cos",{params:[{name:"Number"}],recurse:!0},(function(t){var e=t[0].toNum();e.units&&(e=mult(e,new Material(1,getUnitStore(["radians"],[-1]))));if(e.units)throw"MSG: Non-angular units cannot be used in Cos().";return new Material(fn.cos(e.value))}));defineFunction("tan",{params:[{name:"Number"}],recurse:!0},(function(t){var e=t[0].toNum();e.units&&(e=mult(e,new Material(1,getUnitStore(["radians"],[-1]))));if(e.units)throw"MSG: Non-angular units cannot be used in Tan().";return new Material(fn.tan(e.value))}));defineFunction("asin",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.asin(t[0].toNum().value))}));defineFunction("acos",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.acos(t[0].toNum().value))}));defineFunction("atan",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.atan(t[0].toNum().value))}));defineFunction("arcsin",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.asin(t[0].toNum().value),getUnitStore(["radians"],[1]))}));defineFunction("arccos",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.acos(t[0].toNum().value),getUnitStore(["radians"],[1]))}));defineFunction("arctan",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.atan(t[0].toNum().value),getUnitStore(["radians"],[1]))}));defineFunction("Sign",{params:[{name:"Number"}],recurse:!0},(function(t){var e=t[0].toNum();if(e.value<0)return div(new Material(-1),new Material(1));if(e.value>0)return div(new Material(1),new Material(1));if(0==e.value)return new Material(0);throw"MSG: Invalid value for Sign"}));defineFunction("Sqrt",{params:[{name:"Number"}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn.sqrt(e.value);e.units&&(e.units=e.units.power(.5));return e}));defineFunction("Ln",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.log(t[0].toNum().value))}));defineFunction("Log",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.log(t[0].toNum().value,10))}));defineFunction("Logit",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn["-"](fn.log(e.value),fn.log(fn["-"](1,e.value)));return e}));defineFunction("Expit",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn["/"](1,fn["+"](1,fn.exp(fn["-"](e.value))));return e}));defineFunction("Round",{params:[{name:"Number",noUnits:!1}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn.round(e.value);return e}));defineFunction("Ceiling",{params:[{name:"Number",noUnits:!1}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn.ceiling(e.value);return e}));defineFunction("Floor",{params:[{name:"Number",noUnits:!1}],recurse:!0},(function(t){var e=t[0].toNum();e.value=fn.floor(e.value);return e}));defineFunction("Exp",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(fn.exp(t[0].toNum().value))}));functionBank.ifthenelse=function(t){testArgumentsSize(t,"IfThenElse",3,3);var e=evaluateNode(t[0].node,t[0].scope).toNum();return e instanceof Vector?function(t,e,n){var i=function(t,e){return t instanceof Vector?t.combine(e,i):[t,e]};e=e.toNum();n=n.toNum();if(e instanceof Vector)var r=e.cloneCombine(n,i);else r=n instanceof Vector?n.cloneCombine(e,(function(t,e){return i(e,t)})):i(e,n);var a=function(t,e){return t instanceof Vector?t.combine(e,a):trueValue(t)?e[0]:e[1]};return t.cloneCombine(r,a)}(e,evaluateNode(t[1].node,t[1].scope),evaluateNode(t[2].node,t[2].scope)):trueValue(e)?evaluateNode(t[1].node,t[1].scope):evaluateNode(t[2].node,t[2].scope)};functionBank.ifthenelse.delayEvalParams=!0;functionBank.map=function(t){testArgumentsSize(t,"Map",2,2);var e,n;(e=t[0].node instanceof Vector?t[0].node:t[0]instanceof Vector?t[0]:evaluateNode(t[0].node,t[1].scope))instanceof Primitive&&(e=e.toNum());if(!(e instanceof Vector))throw"MSG: Map() requires a vector as its first argument.";e=e.fullClone();var i,r={x:null,"-parent":t[1].scope},a=t[1].node;try{n=evaluateNode(a,r)}catch(t){}if(n instanceof Function||n instanceof UserFunction){n.fn&&(n=n.fn);i=function(t,e){return n([t])}}else i=function(t,e){r.x=t;r.key=e||"";return evaluateNode(a,r)};return e.apply(i)};functionBank.map.delayEvalParams=!0;VectorObject.map=functionBank.map;defineFunction("Sample",{object:[functionBank,VectorObject],params:[{name:"Vector",needVector:!0},{name:"Sample Size"},{name:"Repeat",noVector:!0,allowBoolean:!0,defaultVal:!1}]},(function(t){var e=t[0].toNum(),n=t[1].toNum().value;if(0==n)return new Vector([]);var i=e.length(),r=t[2]&&trueValue(t[2].toNum());if(0==i)throw"MSG: Sample() requires a non-empty vector.";var a=[];if(r)for(var s=0;s<n;s++)a.push(e.items[Math.floor(Rand()*i)]);else{if(i<n)throw"MSG: Vector for Sample() is too small for the given sample size.";var o=e.items.slice();for(s=0;s<n;s++)a.push(o.splice(Math.floor(Rand()*o.length),1)[0])}return new Vector(a)}));defineFunction("IndexOf",{object:[functionBank,VectorObject],params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Needle",allowBoolean:!0,allowString:!0}]},(function(e){var n=e[1];if(n instanceof Vector){for(var i=[],r=0;r<n.items.length;r++)i.push(t(n.items[r],e[0]));return new Vector(i)}return t(n,e[0])}));defineFunction("Contains",{object:[functionBank,VectorObject],params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Needle",allowBoolean:!0,noVector:!0,allowString:!0}]},(function(t){return!eq(new Material(0),functionBank.indexof(t))}));defineFunction("Collapse",{params:[{name:"Source",needVector:!0,noUnits:!1},{name:"Target",noVector:!1}]},(function(t){return t[0].toNum().collapseDimensions(t[1].toNum())}));function t(t,e){for(var n=0;n<e.length();n++)if(eq(t,e.items[n]))return new Material(n+1);return new Material(0)}functionBank.filter=function(t){testArgumentsSize(t,"Filter",2,2);var e;(e=t[0].node instanceof Vector?t[0].node:t[0]instanceof Vector?t[0]:evaluateNode(t[0].node,t[0].scope))instanceof Primitive&&(e=e.toNum());if(!(e instanceof Vector))throw"MSG: Filter() requires a vector as its first argument.";e=e.fullClone();var n=functionBank.map(t);return functionBank.select([e,n])};functionBank.filter.delayEvalParams=!0;VectorObject.filter=functionBank.filter;functionBank.join=function(t){for(var e=[],n=[],i=!1,r=0;r<t.length;r++){var a=t[r];a instanceof Primitive&&(a=a.toNum());if(a instanceof Vector){e=e.concat(a.items);if(a.names){n=n.concat(a.names);i=!0}else for(var s=0;s<a.items.length;s++)n.push(void 0)}else{e.push(a);n.push(void 0)}}return new Vector(e,i?n:void 0)};functionBank.repeat=function(t){testArgumentsSize(t,"Repeat",2,2);var e=evaluateNode(t[1].node,t[1].scope).toNum(),n=e;e instanceof Vector&&(n=e.items.length);for(var i=[],r={x:null,"-parent":t[1].scope,key:null},a=0;a<n;a++){e instanceof Vector&&(r.key=e.items[a]);r.x=new Material(a+1);i.push(evaluateNode(t[0].node,r))}return new Vector(i,e instanceof Vector?e.items.slice():void 0)};functionBank.repeat.delayEvalParams=!0;defineFunction("Select",{params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Indexes",noUnits:!0}]},(function(t){t[1].toNum();if(t[1]instanceof Vector){for(var e=t[1].toNum(),n=!0,i=0;i<e.length();i++)if(e.items[i]instanceof Material){n=!1;break}if(1==n){var r=[],a=t[0].names?[]:void 0;if(e.length()!=t[0].length())throw"MSG: Length of vector must be equal for boolean selection.";for(i=0;i<e.length();i++)if(trueValue(e.items[i])){r.push(t[0].items[i]);t[0].names&&a.push(t[0].names[i])}return new Vector(r,a)}for(r=[],a=t[0].names?[]:void 0,i=0;i<e.length();i++){var s=e.items[i].value;if(s<=0||s>t[0].length())throw"MSG: Selected element out of range.";r.push(t[0].items[s-1]);t[0].names&&a.push(t[0].names[s-1])}return new Vector(r,a)}if(t[1].value>0&&t[1].value<=t[0].length())return t[0].items[t[1].value-1];throw"MSG: Selected element out of range."}));defineFunction("Reverse",{allowEmpty:!0,params:{name:"Items..."},prep:function(t){return functionBank.join(t)}},(function(t){return new Vector(t.items.slice().reverse(),t.names?t.names.slice().reverse():void 0)}));defineFunction("Reverse",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.reverse(t)}));defineFunction("Sort",{allowEmpty:!0,params:{name:"Items..."},prep:function(t){return functionBank.join(t).toNum()}},(function(t){return t.stackApply((function(t){for(var e=[],n=0;n<t.items.length;n++)e.push({item:t.items[n],name:t.names?t.names[n]:void 0});var i=e.sort((function(t,e){return lessThan(t.item,e.item)?-1:greaterThan(t.item,e.item)?1:0})),r=t.names?[]:void 0;e=[];for(n=0;n<i.length;n++){e.push(i[n].item);r&&r.push(i[n].name)}return new Vector(e,r)}))}));defineFunction("Sort",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.sort(t)}));defineFunction("Unique",{allowEmpty:!0,params:{name:"Items....",allowBoolean:!0},prep:function(t){return functionBank.join(t).toNum()}},(function(t){if(0==t.items.length)return new Vector([]);for(var e=[],n=t.names?[]:void 0,i=0;i<t.items.length;i++){for(var r=!1,a=0;a<e.length;a++)if(strictEquals(t.items[i],e[a])){r=!0;break}if(!r){e.push(t.items[i]);n&&n.push(t.names[i])}}return new Vector(e,n)}));defineFunction("Unique",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.unique(t)}));defineFunction("Union",{object:[functionBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},(function(t){return functionBank.unique(functionBank.join(t).items)}));defineFunction("Intersection",{object:[functionBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},(function(t){for(var e=t[0],n=t[1],i=[],r=0;r<e.items.length;r++)for(var a=0;a<n.items.length;a++)if(strictEquals(e.items[r],n.items[a])){i.push(e.items[r]);break}return functionBank.unique(i)}));defineFunction("Difference",{object:[functionBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},(function(t){for(var e=t[0],n=t[1],i=[],r=0;r<e.items.length;r++){for(var a=!1,s=0;s<n.items.length;s++)if(strictEquals(e.items[r],n.items[s])){a=!0;break}a||i.push(e.items[r])}for(r=0;r<n.items.length;r++){for(a=!1,s=0;s<e.items.length;s++)if(strictEquals(n.items[r],e.items[s])){a=!0;break}a||i.push(n.items[r])}return functionBank.unique(i)}));defineFunction("Factorial",{params:[{name:"Number",noUnits:!0}],recurse:!0},(function(t){return new Material(factorial(t[0].toNum().value))}));defineFunction("Max",{params:{name:"Items..."},prep:e},(function(t){return t.stackApply((function(t){var e=t.items;if(e.length>0){for(var n=e[0],i=1;i<e.length;i++)greaterThan(e[i],n)&&(n=e[i]);return n}throw"MSG: You must have at least one element to calculate a max."}))}));defineFunction("Max",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.max(t)}));function e(t,e,n){if(!e)for(var r=0;r<t.length;r++)t[r]=t[r].toNum();return 1==t.length&&t[0]instanceof Vector?n?t[0]:functionBank.flatten([t[0]]):new Vector(function(t){for(var e,n=!1,r=0;r<t.length;r++)if(t[r]instanceof Vector){e=t[r];n=!0;break}if(n)for(r=0;r<t.length;r++)t[r]instanceof Vector||(t[r]=i(e,t[r]));return t}(t))}function n(t){for(var n=0;n<t.length;n++)t[n].toNum&&(t[n]=t[n].toNum());return 1==t.length&&t[0]instanceof Vector?functionBank.flatten([t[0].toNum()]).items:e(t,void 0,!0).items}function i(t,e){for(var n=t.fullClone(),r=0;r<n.items.length;r++)n.items[r]instanceof Vector?n.items[r]=i(n.items[r],e):n.items[r]=e;return n}defineFunction("Lookup",{params:[{name:"Value",noVector:!0},{name:"Value Vector",needVector:!0},{name:"Results Vector",needVector:!0}]},(function(t){var e=t[0].toNum(),n=t[1].toNum(),i=t[2].toNum();if(n.items.length!=i.items.length)throw"MSG: The value and results vectors must be the same length";if(n.items.length<1)throw"MSG: You must have at least one element in your vectors";for(var r=[],a=0;a<n.items.length;a++)r.push({x:n.items[a],y:i.items[a]});r.sort((function(t,e){return greaterThan(t.x,e.x)?1:lessThan(t.x,e.x)?-1:0}));for(a=0;a<r.length;a++){if(eq(r[a].x,e))return r[a].y.fullClone();if(greaterThan(r[a].x,e)){if(0==a)return r[a].y.fullClone();var s=minus(r[a].x,r[a-1].x),o=minus(e,r[a-1].x),l=div(minus(r[a].x,e),s),u=div(o,s);return plus(mult(r[a-1].y,l),mult(r[a].y,u))}}return r[r.length-1].y.fullClone()}));defineFunction("Fill",{object:[functionBank,VectorObject],params:[{name:"Vector",needVector:!0},{name:"Value",allowBoolean:!0}]},(function(t){return i(t[0],t[1])}));defineFunction("Min",{params:{name:"Items..."},prep:e},(function(t){return t.stackApply((function(t){var e=t.items;if(e.length>0){for(var n=e[0],i=1;i<e.length;i++)lessThan(e[i],n)&&(n=e[i]);return n}throw"MSG: You must have at least one element to calculate a median."}))}));defineFunction("Min",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.min(t)}));defineFunction("Mean",{params:{name:"Items..."},prep:n},(function(t){for(var e=t[0],n=1;n<t.length;n++)e=plus(e,t[n]);return div(e,new Material(t.length))}));defineFunction("Mean",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.mean(t)}));defineFunction("Sum",{params:{name:"Items..."},prep:n},(function(t){for(var e=t[0],n=1;n<t.length;n++)e=plus(e,t[n]);return e}));defineFunction("Sum",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.sum(t)}));defineFunction("Product",{params:{name:"Items..."},prep:n},(function(t){for(var e=t[0],n=1;n<t.length;n++)e=mult(e,t[n]);return e}));defineFunction("Product",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.product(t)}));defineFunction("Median",{params:{name:"Items..."},prep:e},(function(t){return t.stackApply((function(t){var e=functionBank.sort([t]).items;if(e.length>0)return Math.floor((e.length-1)/2)==(e.length-1)/2?e[(e.length-1)/2]:div(plus(e[Math.floor((e.length-1)/2)],e[Math.ceil((e.length-1)/2)]),new Material(2));throw"MSG: You must have at least one element to calculate a median."}))}));defineFunction("Median",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.median(t)}));defineFunction("StdDev",{params:{name:"Items..."},prep:e},(function(t){return t.stackApply((function(t){var e=t.items;if(e.length>1){for(var n=functionBank.mean(e),i=power(minus(e[0],n),new Material(2)),r=1;r<e.length;r++)i=plus(i,power(minus(e[r],n),new Material(2)));var a=power(div(i,new Material(e.length-1)),new Material(.5));return functionBank.real([a])}throw"MSG: You must have at least two elements to calculate the standard deviation."}))}));defineFunction("StdDev",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.stddev(t)}));defineFunction("Correlation",{params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},(function(t){var e=t[0].toNum(),n=t[1].toNum();if(e.length()<=1)throw"MSG: You must have at least two elements in your vectors to calculate their correlation.";if(e.length()!=n.length())throw"MSG: The vectors for Correlation() must be of the same size.";var i=functionBank.mean([e]),r=functionBank.mean([n]),a=functionBank.stddev([e]),s=functionBank.stddev([n]);return 0==a.value||0==s.value?new Material(0):div(functionBank.sum([mult(minus(e.clone(),i),minus(n.clone(),r))]),mult(minus(functionBank.count([e]),new Material(1)),mult(a,s)))}));functionBank.count=function(t){t=functionBank.join(t).items;return new Material(sn("#e"+t.length))};functionBank.flatten=function(t){var e=r(functionBank.join(t));return new Vector(e.items,e.hasName?e.names:void 0)};defineFunction("Keys",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return t[0].names?new Vector(t[0].names.filter((function(t){return isDefined(t)})).map((function(t){return s(t)}))):new Vector([])}));defineFunction("Values",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return new Vector(t[0].items)}));defineFunction("Length",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return new Material(sn("#e"+t[0].items.length))}));defineFunction("Count",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return new Material(sn("#e"+t[0].items.length))}));defineFunction("Flatten",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},(function(t){return functionBank.flatten(t)}));function r(t){for(var e=[],n=[],i=void 0,a=0;a<t.length();a++)if(t.items[a]instanceof Vector){var s=r(t.items[a]);e=e.concat(s.items);n=n.concat(s.names);i=i||s.hasName}else{e.push(t.items[a]);if(t.names){n.push(t.names[a]);i=!0}else n.push(void 0)}return{items:e,names:n,hasName:i}}defineFunction("CDFNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,n=t[1]?t[1].toNum().value:0,i=t[2]?t[2].toNum().value:1;return new Material(jStat.normal.cdf(e,n,i))}));defineFunction("PDFNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,n=t[1]?t[1].toNum().value:0,i=t[2]?t[2].toNum().value:1;return new Material(jStat.normal.pdf(e,n,i))}));defineFunction("InvNormal",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value;if(e<0||e>1)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";var n=t[1]?t[1].toNum().value:0,i=t[2]?t[2].toNum().value:1;return new Material(jStat.normal.inv(e,n,i))}));defineFunction("CDFLogNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,n=t[1]?t[1].toNum().value:0,i=t[2]?t[2].toNum().value:1;return new Material(jStat.lognormal.cdf(e,n,i))}));defineFunction("PDFLogNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,n=t[1]?t[1].toNum().value:0,i=t[2]?t[2].toNum().value:1;return new Material(jStat.lognormal.pdf(e,n,i))}));defineFunction("InvLogNormal",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value;if(e<0||e>1)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";var n=t[1]?t[1].toNum().value:0,i=t[2]?t[2].toNum().value:1;return new Material(jStat.lognormal.inv(e,n,i))}));defineFunction("CDFt",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,n=t[1].toNum().value;if(n<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.studentt.cdf(e,n))}));defineFunction("PDFt",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,n=t[1].toNum().value;if(n<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.studentt.pdf(e,n))}));defineFunction("Invt",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value;if(e<0||e>1)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";var n=t[1].toNum().value;if(n<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.studentt.inv(e,n))}));defineFunction("CDFF",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 1",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 2",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,n=t[1].toNum().value;if(n<=0)throw"MSG: Degrees of Freedom must be greater than 0.";var i=t[2].toNum().value;if(i<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.centralF.cdf(e,n,i))}));defineFunction("PDFF",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 1",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 2",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,n=t[1].toNum().value;if(n<=0)throw"MSG: Degrees of Freedom must be greater than 0.";var i=t[2].toNum().value;if(i<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.centralF.pdf(e,n,i))}));defineFunction("InvF",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 1",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 2",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value;if(e<0||e>1)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";var n=t[1].toNum().value;if(n<=0)throw"MSG: Degrees of Freedom must be greater than 0.";var i=t[2].toNum().value;if(i<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.centralF.inv(e,n,i))}));defineFunction("CDFChiSquared",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,n=t[1].toNum().value;if(n<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.chisquare.cdf(e,n))}));defineFunction("PDFChiSquared",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,n=t[1].toNum().value;if(n<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.chisquare.pdf(e,n))}));defineFunction("InvChiSquared",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value;if(e<0||e>1)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";var n=t[1].toNum().value;if(n<=0)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.chisquare.inv(e,n))}));defineFunction("CDFExponential",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Rate",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,n=t[1].toNum().value;if(n<=0)throw"MSG: Rate must be greater than 0.";return new Material(jStat.exponential.cdf(e,n))}));defineFunction("PDFExponential",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Rate",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,n=t[1].toNum().value;if(n<=0)throw"MSG: Rate must be greater than 0.";return new Material(jStat.exponential.pdf(e,n))}));defineFunction("InvExponential",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"DRate",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value;if(e<0||e>1)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";var n=t[1].toNum().value;if(n<=0)throw"MSG: Rate must be greater than 0.";return new Material(jStat.exponential.inv(e,n))}));defineFunction("CDFPoisson",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Lambda",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,n=t[1].toNum().value;if(n<=0)throw"MSG: Lambda must be greater than 0.";return new Material(jStat.poisson.cdf(e,n))}));defineFunction("PMFPoisson",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Lambda",noUnits:!0,noVector:!0}]},(function(t){var e=t[0].toNum().value,n=t[1].toNum().value;if(n<=0)throw"MSG: Rate must be greater than 0.";return new Material(jStat.poisson.pdf(e,n))}));defineFunction("SetRandSeed",{params:[{name:"Seed Number",noUnits:!0,noVector:!0}]},(function(t){Math.seedrandom(t[0].toNum().value);return"Random Seed Set"}));defineFunction("Alert",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},(function(t){alert(t[0]);return 1}));defineFunction("Console",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},(function(t){console.log(t[0]);return 1}));defineFunction("Prompt",{params:[{name:"Message",allowString:!0,allowBoolean:!0},{name:"Default",defaultVal:"",allowString:!0,allowBoolean:!0}]},(function(t){var e=t[1];e instanceof Material&&!e.units&&(e=e.value);t=prompt(t[0],e);return parseFloat(t).toString()==t?new Material(parseFloat(t)):t}));defineFunction("Confirm",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},(function(t){return confirm(t[0])}));defineFunction("Parse",{object:StringObject,params:[{name:"String",allowString:!0}]},(function(t){return new Material(parseFloat(t[0],10))}));defineFunction("Split",{object:StringObject,params:[{name:"String",needString:!0},{name:"Splitter",needString:!0}]},(function(t){return s(new Vector(t[0].split(t[1])))}));defineFunction("Join",{object:VectorObject,params:[{name:"String",needVector:!0},{name:"Joiner",needString:!0}]},(function(t){return s(t[0].items.join(t[1]))}));defineFunction("Trim",{object:StringObject,params:[{name:"String",needString:!0}],recurse:!0},(function(t){return s(t[0].trim())}));defineFunction("Range",{object:StringObject,params:[{name:"String",needString:!0},{name:"Indexes",noUnits:!0,allowVector:!0}]},(function(t){if(t[1]instanceof Vector){for(var e="",n=0;n<t[1].items.length;n++)e+=t[0].charAt(t[1].items[n].toNum().value-1);return s(e)}return s(t[0].charAt(t[1].toNum().value-1))}));defineFunction("Length",{object:StringObject,params:[{name:"String",needString:!0}]},(function(t){return new Material(t[0].length)}));defineFunction("IndexOf",{object:StringObject,params:[{name:"Haystack",needString:!0},{name:"Needle",needString:!0}]},(function(t){return new Material(t[0].indexOf(t[1])+1)}));defineFunction("Contains",{object:StringObject,params:[{name:"Haystack",needString:!0},{name:"Needle",needString:!0}]},(function(t){return!eq(StringObject.indexof(t),new Material(0))}));defineFunction("Lowercase",{object:StringObject,params:[{name:"String",needString:!0}]},(function(t){return s(t[0].toLowerCase())}));defineFunction("Uppercase",{object:StringObject,params:[{name:"String",needString:!0}]},(function(t){return s(t[0].toUpperCase())}));StringBase=makeObjectBase(StringObject);VectorBase=makeObjectBase(VectorObject)}));function s(t){if(t instanceof Vector)return t.recurseApply(s);var e=new String(t);e.parent=StringBase;return e}function makeObjectBase(t){for(var e=Object.keys(t),n=[],i=0;i<e.length;i++)n.push(objectizeFunction(t[e[i]]));var r=new Vector(n,e);r.parent=void 0;return r}function defineFunction(t,e,n){for(var i,r=e.params,a=Array.isArray(r),s=[],o=r.length,l=0;l<r.length;l++)if(r[l].hasOwnProperty("defaultVal")){o=l;break}for(l=0;l<r.length;l++)if(r[l].vectorize){s.push(l);if(r[l].noVector)throw"MSG: Cannot have a non-vector vectorized parameter. Function '"+t+"', parameter '"+r[l].name+"'."}i=a?e.object?t+"("+r.slice(1).map((function(t){return t.name+(t.hasOwnProperty("defaultVal")?"="+t.defaultVal.toString():"")})).join(", ")+")":t+"("+r.map((function(t){return t.name+(t.hasOwnProperty("defaultVal")?"="+t.defaultVal.toString():"")})).join(", ")+")":t+"(items...)";var u=function(l,h){e.prep&&(l=e.prep(l));if(a&&(l.length>r.length||l.length<o))throw"MSG: Wrong number of parameters for "+i+".";if(!a&&0==l.length&&!e.allowEmpty)throw"MSG: At least one parameter required for "+t+"().";for(var c=0;c<l.length;c++){var d=a?r[c]:r;if(d.noUnits&&l[c].toNum()instanceof Material&&l[c].toNum().units)throw"MSG: "+i+" does not except units for the argument '"+d.name+"'.";if(d.noVector&&l[c]instanceof Vector)throw"MSG: "+i+" does not except vectors for the argument '"+d.name+"'.";if(d.vectorize&&l[c]instanceof Vector&&!l[c].names)throw"MSG: "+i+" does not accepted non-named vectors for the argument '"+d.name+"'.";if(d.needVector){l[c]instanceof Primitive&&(l[c]=l[c].toNum());if(!(l[c]instanceof Vector))throw"MSG: "+i+" requires a vector for the argument '"+d.name+"'."}if(d.needPrimitive&&!(l[c]instanceof Primitive))throw"MSG: "+i+" requires a primitive for the argument '"+d.name+"'.";if(!d.allowBoolean&&"boolean"==typeof l[c])throw"MSG: "+i+" does not accept boolean values for the argument '"+d.name+"'.";!d.needAgent||l[c]instanceof Agent||(l[c]=agent(l[c],i,d.name));if(d.needString&&!("string"==typeof l[c]||l[c]instanceof String))throw"MSG: "+i+" requires a string for the argument '"+d.name+"'.";if(!d.allowString&&!d.needString&&("string"==typeof l[c]||l[c]instanceof String))throw"MSG: "+i+" does not accept string values for the argument '"+d.name+"'.";!d.needAgents||l[c]instanceof Agents||(l[c]=agents(l[c],i,d.name));!d.needPopulation||l[c]instanceof Vector||(l[c]=getPopulation(l[c],i,d.name));if(d.needFunction&&!(l[c]instanceof Function||l[c]instanceof UserFunction))throw"MSG: "+i+" requires a function for the argument '"+d.name+"'."}if(e.recurse)var m=l[0].toNum();if(e.recurse&&m instanceof Vector)return m.cloneApply((function(t){return u([t].concat(l.slice(1)),h)}));if(s.length>0){var f=void 0,p=-1;for(c=0;c<s.length;c++)if(l[s[c]]){if((N=l[s[c]].toNum())instanceof Vector&&N.namesLC)if(f){if(!f.keysMatch(N.namesLC))throw"MSG: Vector keys do not match between parameters '"+r[p].name+"' and '"+r[s[c]].name+"' in "+i+"."}else{f=N;p=s[c]}}if(f){var g=f.namesLC,_=[];for(c=0;c<g.length;c++){for(var v=[],S=0;S<l.length;S++)if(-1==s.indexOf(S))v.push(l[S]);else{var N;(N=l[S].toNum())instanceof Vector&&N.namesLC?v.push(N.select([g[c]])):v.push(N)}var E=n(v,h);if(E instanceof Vector){if(!f.keysMatch(E.namesLC))throw"MSG: Vector keys do not match between parameter '"+r[p].name+"' and calculation result.";_.push(E.select([g[c]]))}else _.push(E)}return new Vector(_,g)}return n(l,h)}return n(l,h)};if(e.object)if(e.object instanceof Array)for(l=0;l<e.object.length;l++)e.object[l][t.toLowerCase()]=u;else e.object[t.toLowerCase()]=u;else functionBank[t.toLowerCase()]=u;e.recurse&&(VectorObject[t.toLowerCase()]=u)}function objectizeFunction(t){var e=function(e,n,i){return t([i].concat(e),n,i)};e.delayEvalParams=t.delayEvalParams;return e}function factorial(t){if(Math.round(t)!=t)throw"MSG: The factorial() function only accepts integers.";if(t<0)throw"MSG: The factorial() function is only defined for integers 0 or larger.";return t>1?t*factorial(t-1):1}function testArgumentsSize(t,e,n,i){if(t.length<n||t.length>i)throw"MSG: Wrong number of parameters for "+e+"()."}Function.prototype.method=function(t,e){this.prototype[t]=e;return this};Function.method("inherits",(function(t){var e={},n=this.prototype=new t;this.method("uber",(function(i){i in e||(e[i]=0);var r,a,s=e[i],o=t.prototype;if(s){for(;s;){o=o.constructor.prototype;s-=1}r=o[i]}else(r=n[i])==this[i]&&(r=o[i]);e[i]+=1;a=r.apply(this,Array.prototype.slice.apply(arguments,[1]));e[i]-=1;return a}));return this}));var AgentObject={},PrimitiveBase,PrimitiveObject={};functionLoaders.push((function(){defineFunction("Stop",{params:[]},(function(t){throw{msg:"STOP"}}));defineFunction("Pause",{params:[]},(function(t){simulate.sleep(!0);return new Material(0)}));defineFunction("Time",{params:[]},(function(t){return simulate.time().fullClone()}));defineFunction("TimeStep",{params:[]},(function(t){return simulate.timeStep.fullClone()}));defineFunction("TimeLength",{params:[]},(function(t){return simulate.timeLength.fullClone()}));defineFunction("TimeStart",{params:[]},(function(t){return simulate.timeStart.fullClone()}));defineFunction("TimeEnd",{params:[]},(function(t){return simulate.timeEnd.fullClone()}));defineFunction("Seconds",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},(function(t){return mult(0==t.length?simulate.time().fullClone():t[0].toNum(),new Material(1,getUnitStore(["seconds"],[-1])))}));defineFunction("Minutes",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},(function(t){return mult(0==t.length?simulate.time().fullClone():t[0].toNum(),new Material(1,getUnitStore(["minutes"],[-1])))}));defineFunction("Hours",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},(function(t){return mult(0==t.length?simulate.time().fullClone():t[0].toNum(),new Material(1,getUnitStore(["hours"],[-1])))}));defineFunction("Days",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},(function(t){return mult(0==t.length?simulate.time().fullClone():t[0].toNum(),new Material(1,getUnitStore(["days"],[-1])))}));defineFunction("Weeks",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},(function(t){return mult(0==t.length?simulate.time().fullClone():t[0].toNum(),new Material(1,getUnitStore(["weeks"],[-1])))}));defineFunction("Months",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},(function(t){return mult(0==t.length?simulate.time().fullClone():t[0].toNum(),new Material(1,getUnitStore(["months"],[-1])))}));defineFunction("Years",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},(function(t){return mult(0==t.length?simulate.time().fullClone():t[0].toNum(),new Material(1,getUnitStore(["years"],[-1])))}));defineFunction("Seasonal",{params:[{name:"Peak",defaultVal:"0",vectorize:!0}]},(function(t){var e;0==t.length?e=new Material(0,simulate.timeUnits):(e=t[0].fullClone()).units||(e.units=simulate.timeUnits);var n=2*minus(functionBank.time([]),e).forceUnits(createUnitStore("years")).value*3.14159265359;return new Material(Math.cos(n))}));defineFunction("Unitless",{params:[{name:"Value",noVector:!0}]},(function(t){return new Material(t[0].toNum().value)}));defineFunction("PastMean",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},(function(t){return 1==t.length?functionBank.mean(t[0].getPastValues()):functionBank.mean(t[0].getPastValues(t[1].toNum()))}));defineFunction("PastMedian",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},(function(t){return 1==t.length?functionBank.median(t[0].getPastValues()):functionBank.median(t[0].getPastValues(t[1].toNum()))}));defineFunction("PastValues",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},(function(t){var e;e=1==t.length?t[0].getPastValues():t[0].getPastValues(t[1].toNum());return new Vector(e)}));defineFunction("PastStdDev",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},(function(t){var e;return(e=1==t.length?t[0].getPastValues():t[0].getPastValues(t[1].toNum())).length>1?functionBank.stddev(e):new Material(0)}));defineFunction("PastCorrelation",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"[Primitive]",noVector:!0,needPrimitive:!0,object:[functionBank,PrimitiveObject]},{name:"Past Range",vectorize:!0,defaultVal:"All Time"}]},(function(t){var e,n;if("All Time"!=t[2]){e=t[0].getPastValues();n=t[1].getPastValues()}else{e=t[0].getPastValues(t[2].toNum());n=t[1].getPastValues(t[2].toNum())}return e.length>1?functionBank.correlation([new Vector(e),new Vector(n)]):new Material(0)}));defineFunction("PastMax",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},(function(t){return 1==t.length?functionBank.max(t[0].getPastValues()):functionBank.max(t[0].getPastValues(t[1].toNum()))}));defineFunction("PastMin",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},(function(t){return 1==t.length?functionBank.min(t[0].getPastValues()):functionBank.min(t[0].getPastValues(t[1].toNum()))}));defineFunction("Pulse",{params:[{name:"Start Time",vectorize:!0},{name:"Height",vectorize:!0,defaultVal:1},{name:"Width",vectorize:!0,defaultVal:0},{name:"Repeat Period",vectorize:!0,defaultVal:0}]},(function(t){var e=t[0].toNum(),n=new Material(1),i=new Material(0),r=new Material(0);if(t.length>1){n=t[1].toNum();if(t.length>2){i=t[2].toNum();t.length>3&&(r=t[3].toNum())}}e.units||(e.units=simulate.timeUnits);i.units||(i.units=simulate.timeUnits);r.units||(r.units=simulate.timeUnits);if(r.value<=0){if(eq(simulate.time(),e)||greaterThanEq(simulate.time(),e)&&lessThanEq(simulate.time(),plus(e,i)))return n}else if(greaterThanEq(simulate.time(),e)){t=minus(simulate.time(),mult(functionBank.floor([div(minus(simulate.time(),e),r)]),r));var a=minus(simulate.time(),e);if(0==minus(functionBank.round([div(a,r)]),div(a,r)).value||greaterThanEq(t,e)&&lessThanEq(t,plus(e,i)))return n}return new Material(0,n.units)}));defineFunction("Ramp",{params:[{name:"Start Time",vectorize:!0},{name:"Finish Time",vectorize:!0},{name:"Height",vectorize:!0,defaultVal:1}]},(function(t){var e=t[0].toNum(),n=t[1].toNum(),i=new Material(1);3==t.length&&(i=t[2].toNum());e.units||(e.units=simulate.timeUnits);n.units||(n.units=simulate.timeUnits);if(greaterThanEq(simulate.time(),e)){return div(mult(functionBank.min([minus(n,e),minus(simulate.time(),e)]),i),minus(n,e))}return new Material(0,i.units)}));defineFunction("Step",{params:[{name:"Start Time",vectorize:!0},{name:"Height",vectorize:!0,defaultVal:1}]},(function(t){var e=t[0].toNum(),n=new Material(1);2==t.length&&(n=t[1].toNum());e.units||(e.units=simulate.timeUnits);return greaterThanEq(simulate.time(),e)?n:new Material(0,n.units)}));functionBank.staircase=functionBank.step;defineFunction("Smooth",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Period",vectorize:!0},{name:"Initial Value",vectorize:!0,defaultVal:"None"}]},(function(t){if(t[1].toNum().value<=0)throw"MSG: The smoothing period must be greater than 0.";return 2==t.length?t[0].smoothF(t[1].toNum()):t[0].smoothF(t[1].toNum(),t[2].toNum())}));defineFunction("Delay",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Delay",vectorize:!0},{name:"Initial Value",defaultVal:"None",vectorize:!0}]},(function(t){if(t[1].toNum().value<0)throw"MSG: The delay must be greater than or equal to 0.";return 2==t.length?t[0].pastValue(t[1].toNum()):t[0].pastValue(t[1].toNum(),t[2].toNum())}));defineFunction("Delay1",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Delay",vectorize:!0},{name:"Initial Value",vectorize:!0,defaultVal:"None"}]},(function(t){if(t[1].toNum().value<=0)throw"MSG: The delay must be greater than 0.";return 2==t.length?t[0].expDelayF(1,t[1].toNum()):t[0].expDelayF(1,t[1].toNum(),t[2].toNum())}));defineFunction("Delay3",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Delay",vectorize:!0},{name:"Initial Value",vectorize:!0,defaultVal:"None"}]},(function(t){if(t[1].toNum().value<=0)throw"MSG: The delay must be greater than 0.";return 2==t.length?t[0].expDelayF(3,t[1].toNum()):t[0].expDelayF(3,t[1].toNum(),t[2].toNum())}));functionBank.fix=function(t,e){testArgumentsSize(t,"Fix",1,2);var n=-1;2==t.length&&(n=evaluateNode(t[1].node,t[1].scope).toNum());for(var i=null,r=0;r<simulate.oldAggregateSeries.length;r++)if(simulate.oldAggregateSeries[r].match(e)){i=simulate.oldAggregateSeries[r];break}if(null===i){i=new AggregateSeries(e,n);simulate.oldAggregateSeries.push(i)}return i.get(t[0])};functionBank.fix.delayEvalParams=!0;functionBank.populationsize=function(t){testArgumentsSize(t,"PopulationSize",1,1);if(t[0]instanceof Agents)return new Material(sn("#e"+t[0].agents.length));throw"MSG: PopulationSize must be passed an agent population as an argument."};PrimitiveObject.populationsize=functionBank.populationsize;defineFunction("Remove",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent]"}]},(function(t){if(t[0].dead)throw"MSG: Cannot remove an already removed agent.";simulate.tasks.add(new Task({time:simulate.time(),priority:10,expires:1,name:"Remove Agent",action:function(){t[0].die()}}));return new Material(1)}));defineFunction("Add",{object:[functionBank,PrimitiveObject],params:[{name:"[Agent Population]"},{needAgent:!0,name:"[Base]",defaultVal:"Agent Base"}]},(function(t){for(;!(t[0]instanceof Agents)&&null!=t[0].container;)t[0]=t[0].container;if(!(t[0]instanceof Agents))throw"MSG: You must pass an agent population as the first argument to Add().";return 2==t.length?t[0].add(t[1]):t[0].add()}));defineFunction("FindAll",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"}]},(function(t){return t[0]}));defineFunction("ResetTimer",{object:[functionBank,PrimitiveObject],params:[{needPrimitive:!0,name:"[Action]"}]},(function(t){if(!(t[0]instanceof Action))throw"MSG: ResetTimer requires an Action primitive.";t[0].resetTimer();return new Material(0)}));defineFunction("Transition",{object:[functionBank,PrimitiveObject],params:[{needPrimitive:!0,name:"[Transition]"}]},(function(t){if(!(t[0]instanceof Transition))throw"MSG: Transition requires an Transition primitive.";t[0].doTransition();return new Material(0)}));defineFunction("Value",{object:[functionBank,VectorObject,AgentObject],params:[{name:"[Population]"},{needPrimitive:!0,name:"[Primitive]"}]},(function(t){var e=t[1].id,n=null;t[0]instanceof Agents||t[0]instanceof Agent||t[0]instanceof Vector||!t[0]||(t[0]=t[0].toNum());t[0]instanceof Agents&&(n=getPopulation(t[0]));t[0]instanceof Vector&&(n=t[0]);if(null!==n){for(var i=[],r=-1,a=0;a<n.items.length;a++)if(-1!=r)i.push(n.items[a].children[r]);else for(var s=0;s<n.items[a].children.length;s++)if(n.items[a].children[s].id==e){i.push(n.items[a].children[s]);r=s;break}return new Vector(i)}if(t[0]instanceof Agent){for(s=0;s<t[0].children.length;s++)if(t[0].children[s].id==e)return t[0].children[s];throw'MSG: Could not find referenced primitive for "Value()".'}throw'MSG: Invalid type for the first argument of "Value()".'}));defineFunction("SetValue",{object:[functionBank,VectorObject,PrimitiveObject,AgentObject],params:[{name:"[Population]"},{needPrimitive:!0,name:"[Primitive]"},{name:"Value",noVector:!0,allowBoolean:!0}]},(function(t){var e=t[1].id,n=null;t[0]instanceof Agents&&(n=getPopulation(t[0]));t[0]instanceof Vector&&(n=t[0]);if(null!==n){for(var i=0;i<n.length();i++)for(var r=0;r<n.items[i].children.length;r++)n.items[i].children[r].id==e&&n.items[i].children[r].setValue(t[2]);return new Material(1)}if(t[0]instanceof Agent){for(r=0;r<t[0].children.length;r++)if(t[0].children[r].id==e){t[0].children[r].setValue(t[2]);return new Material(1)}throw'MSG: Could not find referenced primitive for "SetValue()".'}throw'MSG: Invalid type for the first argument of "SetValue()".'}));defineFunction("FindIndex",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Index",noVector:!0,noUnits:!0}]},(function(t){for(var e=t[0],n=0;n<e.length();n++)if(e.items[n].index+1==t[1].value)return e.items[n];throw"MSG: Index not found in population."}));defineFunction("FindState",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{needPrimitive:!0,name:"[State]"}]},(function(t){var e=t[0];if(!(t[1]instanceof State||"State"===t[1].dna.type))throw"MSG: FindState() requires a State primitive as its argument.";for(var n=t[1].id,i=[],r=0;r<e.items.length;r++)-1!==e.items[r].stateIDs.indexOf(n)&&i.push(e.items[r]);return new Vector(i)}));defineFunction("FindNotState",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{needPrimitive:!0,name:"[State]"}]},(function(t){var e=t[0];if(!(t[1]instanceof State||"State"===t[1].dna.type))throw"MSG: FindNotState() requires a State primitive as its argument.";for(var n=t[1].id,i=[],r=0;r<e.items.length;r++)-1===e.items[r].stateIDs.indexOf(n)&&i.push(e.items[r]);return new Vector(i)}));defineFunction("FindNearby",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Target"},{name:"Distance Limit",noVector:!0}]},(function(e){var n=e[0],i=t(e[1]);try{var r=agent(e[1])}catch(t){}for(var a=[],s=0;s<n.length();s++){var o=agent(n.items[s]);o!==r&&lessThanEq(distance(i,o),e[2])&&a.push(o)}return new Vector(a)}));defineFunction("FindNearest",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Target"},{noUnits:!0,noVector:!0,defaultVal:1,name:"Count"}]},(function(e){var n=e[0],i=1;if(3==e.length){if((i=e[2].value)<1)throw"MSG: You must select at least one agent in FindNearest().";if(i!=Math.floor(i))throw"MSG: Count must be an integer."}var r=t(e[1]);try{var a=agent(e[1])}catch(t){}for(var s=[],o=0;o<n.items.length;o++){var l=agent(n.items[o]);l!==a&&s.push({distance:distance(r,l),item:l})}if(s.length<i)throw"MSG: Can't find nearest "+i+" agents of a population of size "+s.length+".";var u=[s[0]];for(o=1;o<s.length;o++){for(var h=!1,c=0;c<u.length;c++)if(lessThan(s[o].distance,u[c].distance)){u.splice(c,0,s[o]);h=!0;break}!h&&u.length<i?u.push(s[o]):u.length>i&&(u.length=i)}if(1===u.length)return u[0].item;u.sort((function(t,e){return t.distance-e.distance}));return new Vector(u.map((function(t){return t.item})))}));defineFunction("FindFurthest",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Target"},{noUnits:!0,noVector:!0,defaultVal:1,name:"Count"}]},(function(e){var n=e[0],i=1;if(3===e.length){if((i=e[2].value)<1)throw"MSG: You must select at least one agent in FindFurthest().";if(i!=Math.floor(i))throw"MSG: Count must be an integer."}var r=t(e[1]);try{var a=agent(e[1])}catch(t){}for(var s=[],o=0;o<n.items.length;o++){var l=agent(n.items[o]);l!==a&&s.push({distance:distance(r,l),item:l})}if(s.length<i)throw"MSG: Can't find furthest "+i+" agents of a population of size "+s.length+".";var u=[s[0]];for(o=1;o<s.length;o++){for(var h=!1,c=0;c<u.length;c++)if(greaterThan(s[o].distance,u[c].distance)){u.splice(c,0,s[o]);h=!0;break}!h&&u.length<i?u.push(s[o]):u.length>i&&(u.length=i)}if(1===u.length)return u[0].item;u.sort((function(t,e){return e.distance-t.distance}));return new Vector(u.map((function(t){return t.item})))}));defineFunction("Index",{object:[functionBank,AgentObject],params:[{noVector:!0,needAgent:!0,name:"[Agent]"}]},(function(t){return new Material(sn("#e"+(t[0].index+1)))}));defineFunction("Connect",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"},{name:"Weight",defaultVal:"missing"}]},(function(t){var e=void 0;"missing"!=t[2]&&(e=t[2]);t[1]instanceof Vector?t[1].items.forEach((function(n){t[0].connect(n,e)})):t[0].connect(t[1],e);return new Material(1)}));defineFunction("Unconnect",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"}]},(function(t){t[1]instanceof Vector?t[1].items.forEach((function(e){t[0].unconnect(e)})):t[0].unconnect(t[1]);return new Material(1)}));defineFunction("Connected",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent]"}]},(function(t){return new Vector(t[0].connected.slice())}));defineFunction("ConnectionWeight",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"}]},(function(t){return t[1]instanceof Vector?new Vector(t[1].items.map((function(e){return t[0].connectionWeight(e)}))):t[0].connectionWeight(t[1])}));defineFunction("SetConnectionWeight",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"},{name:"Weight"}]},(function(t){t[1]instanceof Vector?t[1].items.forEach((function(e){t[0].setConnectionWeight(e,t[2])})):t[0].setConnectionWeight(t[1],t[2]);return new Material(1)}));functionBank.die=function(t){console.log(t);throw'MSG: Terminated using "die".'};functionBank.print=function(t){if(2==t.length){console.log(t[0].value.toString());console.log(t[1]);return t[1]}console.log(t[0]);return t[0]};defineFunction("Width",{params:[{needAgents:!0,name:"[Agent Population]"}]},(function(t){return t[0].geoWidth}));defineFunction("Height",{params:[{needAgents:!0,name:"[Agent Population]"}]},(function(t){return t[0].geoHeight}));defineFunction("Distance",{object:[functionBank,AgentObject],params:[{name:"Location 1"},{name:"Location 2"}]},(function(e){e[0]=t(e[0]);e[1]=t(e[1]);return distance(e[0],e[1])}));defineFunction("Location",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent]"}]},(function(t){if(t[0].location)return t[0].location.fullClone();throw"MSG: The location is not defined."}));defineFunction("SetLocation",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent]"},{needVector:!0,name:"Direction"}]},(function(t){var e=t[1].toNum(),n=t[0];n.location=e.fullClone();if(!n.location.names){n.location.names=["x","y"];n.location.namesLC=["x","y"]}return new Material(0)}));defineFunction("Move",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Mover]"},{needVector:!0,name:"Direction"}]},(function(t){var e=t[1].toNum();shiftLocation(t[0],plus(t[0].location,e));return new Material(0)}));function t(t){if(t instanceof Vector){if(2!=t.items.length)throw"MSG: Location vector does not contain exactly two elements.";return t}try{return agent(t).location}catch(t){throw"MSG: Location must be a vector or an agent."}}defineFunction("MoveTowards",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Mover]"},{name:"[Target]"},{name:"Distance",noVector:!0}]},(function(e){var n=e[0],i=t(e[1]),r=n.location,a=minus(i.items[0],r.items[0]),s=minus(i.items[1],r.items[1]);if(0==a.value&&0==s.value)return new Material(1);if(n.container.geoWrap){greaterThan(a,n.container.halfWidth)?a=minus(n.container.geoWidth,a):lessThan(a,negate(n.container.halfWidth))&&(a=minus(a,negate(n.container.geoWidth)));greaterThan(s,n.container.halfHeight)?s=minus(n.container.geoHeight,s):lessThan(s,negate(n.container.halfHeight))&&(s=minus(s,negate(n.container.geoHeight)))}var o=new Vector([a,s],["x","y"]);shiftLocation(e[0],plus(e[0].location,mult(o,div(e[2],distance(e[0],e[1]instanceof Vector?e[1]:agent(e[1]))))));return new Material(1)}));PrimitiveBase=makeObjectBase(PrimitiveObject);AgentBase=makeObjectBase(AgentObject);PrimitiveBase.parent=AgentBase;VectorBase=makeObjectBase(VectorObject)}));function distance(t,e){var n=t instanceof Vector?t:t.location,i=e instanceof Vector?e:e.location,r=n.items[0].toString()+","+n.items[1].toString(),a=i.items[0].toString()+","+i.items[1].toString();if(simulate.distanceCache[r+"-"+a])return simulate.distanceCache[r+"-"+a];if(simulate.distanceCache[a+"-"+r])return simulate.distanceCache[a+"-"+r];var s=minus(n.items[0],i.items[0]),o=minus(n.items[1],i.items[1]),l=null;t instanceof Vector?e instanceof Vector||(l=e.container):l=t.container;if(null!==l&&l.geoWrap){greaterThan(s,l.halfWidth)?s=minus(l.geoWidth,s):lessThan(s,negate(l.halfWidth))&&(s=minus(s,negate(l.geoWidth)));greaterThan(o,l.halfHeight)?o=minus(l.geoHeight,o):lessThan(o,negate(l.halfHeight))&&(o=minus(o,negate(l.geoHeight)))}var u=s.value,h=o.value;s.units!==o.units&&(h=fn["*"](h,convertUnits(s.units,o.units)));var c=fn["real-part"](fn.sqrt(fn["+"](fn["*"](u,u),fn["*"](h,h))));c=new Material(c,s.units);simulate.distanceCache[r+a]=c;return c}function agent(t){(t instanceof Variable||t instanceof Stock)&&(t=t.toNum());if(t instanceof Agent)return t;if(!strictAgentResolution&&t instanceof Primitive)return agent(t.container);throw"MSG: An agent is required here."}function agents(t){if(t instanceof Agents)return t;if(t instanceof Primitive||t instanceof Agent)return agents(t.container);throw"MSG: An agent population is required here."}function getPopulation(t){if(t.items)return t;return t instanceof Agents?new Vector(t.agents.slice()):t.toNum()instanceof Vector?t.toNum():new Vector([agent(t)])}function shiftLocation(t,e){if(t.container.geoWrap){for(;lessThan(e.items[0],new Material(0));)e.items[0]=plus(e.items[0],t.container.geoWidth);for(;greaterThan(e.items[0],t.container.geoWidth);)e.items[0]=minus(e.items[0],t.container.geoWidth);for(;lessThan(e.items[1],new Material(0));)e.items[1]=plus(e.items[1],t.container.geoHeight);for(;greaterThan(e.items[1],t.container.geoHeight);)e.items[1]=minus(e.items[1],t.container.geoHeight)}t.location=e;if(!t.location.names){t.location.names=["x","y"];t.location.namesLC=["x","y"]}}function isUndefined(t){return void 0===t}function isDefined(t){return!isUndefined(t)}function constraintAlert(t,e,n){error("The "+("max"==e?"maximum":"minimum")+" constraint on the primitive <b>"+clean(getName(findID(t.id)))+"</b> has been violated. The primitive's value attempted to become "+clean(n.value)+" when the "+("max"==e?"maximum":"minimum")+" allowed value is "+("max"==e?t.dna.maxConstraint:t.dna.minConstraint)+".",t,!1)}function error(t,e,n,i,r){var a={msg:t,primitive:e,showEditor:n,line:i,details:r};if(isLocal()){console.log("Error:");console.log(a)}throw a}function testPrimitive(t,e,n){for(var i=0;i<n.length;i++)if(!(t[n[i]]instanceof Primitive))throw"MSG: "+e+"() requires a primitive reference to be passed to it as argument number "+(n[i]+1)+"."}function prepareDisplay(t){return t}function AggregateSeries(t,e){this.id=t;this.spacing=e;this.oldValues=[]}AggregateSeries.method("match",(function(t){return this.id==t}));AggregateSeries.method("get",(function(t){var e=0;e=this.spacing<0?0:0==this.spacing?Math.floor(div(minus(simulate.time(),simulate.timeStart),simulate.UserTimeStep).value):Math.floor(div(minus(simulate.time(),simulate.timeStart),this.spacing.forceUnits(simulate.timeUnits)).value);for(;this.oldValues.length-1<e;)this.oldValues.push(evaluateNode(t.node,t.scope));return this.oldValues[e].fullClone?this.oldValues[e].fullClone():this.oldValues[e]}));function DataBank(){this.dataSeries={}}DataBank.method("series",(function(){return Object.keys(this.dataSeries)}));DataBank.method("clone",(function(){for(var t=new DataBank,e=this.series(),n=0;n<e.length;n++)t.dataSeries[e[n]]=this.dataSeries[e[n]];return t}));DataBank.method("getSeries",(function(t){this.dataSeries[t]||(this.dataSeries[t]=[]);return this.dataSeries[t]}));DataBank.method("trimValues",(function(t){for(var e=this.series(),n=0;n<e.length;n++){var i=this.getSeries(e[n]);i.length-1>t&&i.splice(t+1,i.length-t+1)}}));function ExpGroup(t,e,n){this.stocks=[];this.k=e;for(var i=1;i<=t;i++)this.stocks.push(n);this.out=n}ExpGroup.method("moveForward",(function(t){var e=new ExpGroup(this.stocks.length,this.k,new Material(0));e.out=this.stocks[this.stocks.length-1];for(var n=this.stocks.length-1;n>0;n--)e.stocks[n]=plus(mult(this.stocks[n],new Material(1-this.k)),mult(this.stocks[n-1],new Material(this.k)));e.stocks[0]=plus(mult(this.stocks[0],new Material(1-this.k)),mult(t,new Material(this.k)));return e}));function Primitive(){this.id=null;this.agentId=null;this.index=null;this.instanceId=null;this.container=null;this.dna=null;this.equation=null;this.cachedValue=void 0;this.pastValues=[];this.pastData=new DataBank;this.frozen=!1;this.parent=PrimitiveBase}Primitive.method("clone",(function(){var t=new this.constructorFunction;t.dna=this.dna;t.container=this.container;t.agentId=this.agentId;t.index=this.index;t.id=this.id;t.createIds();t.pastValues=this.pastValues.slice(0);this.dna.slider&&(simulate.sliders[this.dna.id]?simulate.sliders[this.dna.id].push(t):simulate.sliders[this.dna.id]=[t]);t.cachedValue=this.cachedValue?this.cachedValue.fullClone():this.cachedValue;this.innerClone(t);return t}));Primitive.method("clearCached",(function(){this.cachedValue=void 0}));Primitive.method("storeValue",(function(){isUndefined(this.cachedValue)&&this.value();this.pastValues.push(this.cachedValue)}));Primitive.method("toNum",(function(){return this.value()}));Primitive.method("calculateValue",(function(){throw"MSG: "+getText("[%s] does not have a value and can not be used as a value in an equation.",this.dna.name)}));Primitive.method("createIds",(function(){this.instanceId=simulate.getID(this.agentId+"-"+this.index)}));Primitive.method("getPastValues",(function(t){var e,n=this.pastValues.slice(),i=Math.ceil(div(simulate.time(),this.dna.solver.userTimeStep).value)+1;n.length<i&&n.push(this.value());if(isUndefined(t))e=n.map((function(t){return t.fullClone()}));else{i=Math.ceil(div(t.forceUnits(simulate.timeUnits),this.dna.solver.userTimeStep).value);e=[];for(var r=Math.max(0,n.length-1-i);r<n.length;r++)e.push(n[r].fullClone())}return e}));Primitive.method("pastValue",(function(t,e){var n;if(0==(n=this.pastValues.length-1<Math.round((simulate.time().value-simulate.timeStart.value)/this.dna.solver.userTimeStep.value)?div(t.forceUnits(simulate.timeUnits),this.dna.solver.userTimeStep).value:div(t.forceUnits(simulate.timeUnits),this.dna.solver.userTimeStep).value+1))return this.value();if(Math.ceil(n)>this.pastValues.length)return isUndefined(e)?this.pastValues.length>0?this.pastValues[0].fullClone():this.value():e;if(n==Math.round(n))return 0==n?value:this.pastValues[this.pastValues.length-n].fullClone();var i,r,a=n-Math.floor(n),s=Math.floor(n);i=0==s?this.value():this.pastValues[this.pastValues.length-s];r=this.pastValues[this.pastValues.length-1-s];return plus(mult(i,new Material(1-a)),mult(r,new Material(a)))}));Primitive.method("smoothF",(function(t,e){var n=div(this.dna.solver.userTimeStep,t.forceUnits(simulate.timeUnits)).value,i=this.pastData.getSeries("Smooth: "+n+","+e);0==i.length&&(isUndefined(e)?i.push(this.pastValues[0]?this.pastValues[0]:this.value()):i.push(e));for(var r=Math.floor((simulate.time().value-simulate.timeStart.value)/this.dna.solver.userTimeStep.value),a=i.length-1;a<r;a++){var s=this.pastValues[a]?this.pastValues[a]:this.cachedValue?this.cachedValue:this.pastValues[a-1];i.push(plus(mult(i[a],new Material(1-n)),mult(new Material(n),s)))}return i[i.length-1].fullClone()}));Primitive.method("expDelayF",(function(t,e,n){this.value();var i=div(this.dna.solver.userTimeStep,e.forceUnits(simulate.timeUnits)).value*t,r=this.pastData.getSeries("ExpDelay: "+t+","+e.value+","+n);if(0==r.length)if(isUndefined(n))r.push(new ExpGroup(t,i,this.pastValues[0]?this.pastValues[0]:this.value()));else{var a=new ExpGroup(t,i,n);r.push(a.moveForward(this.pastValues[0]?this.pastValues[0]:this.value()))}for(var s=r.length;s<this.pastValues.length;s++)r.push(r[s-1].moveForward(this.pastValues[s]));return r[r.length-1].out.fullClone()}));Primitive.method("testUnits",(function(t,e){if(t instanceof Vector){var n=this;t.recurseApply((function(t){n.testUnits(t,e);return t}))}else{if(!this.dna.units&&t.units)error(getText("Wrong units generated for %s. Expected no units and got %s. Either specify units for the primitive or adjust the equation.","<i>"+clean(this.dna.name)+"</i>","<i>"+clean(t.units.toString())+"</i>"),this,!0);else if(this.dna.units!==t.units){var i=convertUnits(t.units,this.dna.units,!0);if(0==i){if(isLocal()){console.log(t.units);console.log(this.dna.units)}error(getText("Wrong units generated for %s. Expected %s, and got %s.","<i>"+clean(this.dna.name)+"</i>","<i>"+clean(this.dna.units.toString())+"</i>","<i>"+clean(t.units.toString())+"</i>"),this,!0);return}t.value=t.value*i;t.units=this.dna.units}if(this instanceof Flow&&1!=e&&this.dna.flowUnitless){var r=mult(t,new Material(1,simulate.timeUnits));t.value=r.value;t.units=r.units}}}));Primitive.method("setValue",(function(){throw"MSG: "+getText("You cannot set the value for that primitive.")}));Primitive.method("printPastValues",(function(){console.log(this.pastValues.map((function(t){return t.value})))}));Primitive.method("value",(function(){if(isUndefined(this.cachedValue)&&this.frozen&&this.pastValues.length>0){var t=this.pastValues[this.pastValues.length-1];t.fullClone?this.cachedValue=t.fullClone():this.cachedValue=t}if(isUndefined(this.cachedValue)){if(simulate.valuedPrimitives.indexOf(this)>-1)throw"MSG: "+getText("Circular equation loop identified including the primitives: %s",simulate.valuedPrimitives.slice(simulate.valuedPrimitives.indexOf(this)).map((function(t){return t.dna.name})).join(", "));simulate.valuedPrimitives.push(this);try{var e=this.calculateValue().toNum();if(e instanceof Material&&!isFinite(e.value)){isLocal()&&console.log(e);throw this instanceof Stock?"MSG: "+getText("The stock has become infinite in size. Check the flows into it for rapid growth."):"MSG: "+getText("The result of this calculation is not a number (are you dividing by 0?).")}}catch(t){if(!t.substr)throw t;isLocal()&&console.log(t);"MSG:"==t.substr(0,4)?error(t.substr(4,t.length),this,!0):error(t,this,!0)}if(!(this instanceof State)){this.testUnits(e);this.testConstraints(e)}this.cachedValue=e}return this.cachedValue.fullClone?this.cachedValue.fullClone():this.cachedValue}));Primitive.method("testConstraints",(function(t){var e=this,n=function(t){(1==e.dna.maxConstraintType&&t.value>e.dna.maxConstraint||2==e.dna.maxConstraintType&&t.value>=e.dna.maxConstraint)&&constraintAlert(e,"max",t);(1==e.dna.minConstraintType&&t.value<e.dna.minConstraint||2==e.dna.minConstraintType&&t.value<=e.dna.minConstraint)&&constraintAlert(e,"min",t);return t};t instanceof Vector?t.recurseApply(n):n(t)}));Primitive.method("setEquation",(function(t,e){if(this instanceof Flow||this instanceof Transition){null!==this.omega&&(e.omega=this.omega);null!==this.alpha&&(e.alpha=this.alpha)}try{this.equation=trimTree(t,e)}catch(t){isLocal()&&console.log(t);error(t.substr(4,t.length),this,!0)}}));function Placeholder(t,e){this.dna=t;this.id=t.id;this.primitive=e}Placeholder.inherits(Primitive);Placeholder.method("calculateValue",(function(){error(getText("[%s] is a placeholder and cannot be used as a direct value in equations.",clean(this.dna.name)),this.primitive,!0)}));function State(){Primitive.call(this);this.active=null;this.downStreamTransitions=[];this.constructorFunction=State}State.inherits(Primitive);State.method("innerClone",(function(t){t.setValue(this.active)}));State.method("setValue",(function(t){this.setActive(trueValue(t));this.cachedValue=void 0;simulate.valuedPrimitives=[];this.value();this.agentId&&this.container.updateStates()}));State.method("calculateValue",(function(){null===this.active&&this.setInitialActive(!0);return this.active?new Material(1):new Material(0)}));State.method("setInitialActive",(function(t){var e;try{e=evaluateTree(this.equation,globalVars(this)).toNum()}catch(t){if(!t.substr)throw t;isLocal()&&console.log(t);"MSG:"==t.substr(0,4)?error(t.substr(4,t.length),this,!0):error(t,this,!0)}this.setActive(trueValue(e),t);this.agentId&&this.container.updateStates()}));State.method("setActive",(function(t,e){this.active=t;if(t&&null!==this.dna.residency){var n=this;simulate.tasks.add(new Task({name:"State Residency",time:plus(simulate.time(),this.dna.residency),priority:5,expires:1,action:function(){for(var t=0;t<n.downStreamTransitions.length;t++)scheduleTrigger.call(n.downStreamTransitions[t])}}))}else if(!e){if(t){simulate.transitionPrimitives||(simulate.transitionPrimitives=[]);if(simulate.transitionPrimitives.length>1200&&simulate.transitionPrimitives.indexOf(this)>-1)throw"MSG: "+getText("Circular fully active transition loop identified including the states: %s",simulate.transitionPrimitives.slice(0,5).map((function(t){return t.dna.name})).join(", "));simulate.transitionPrimitives.push(this)}for(var i=0;i<this.downStreamTransitions.length;i++)scheduleTrigger.call(this.downStreamTransitions[i]);t&&(simulate.transitionPrimitives=[])}}));State.method("getActive",(function(){null===this.active&&this.setInitialActive(!0);return this.active}));function Transition(){Primitive.call(this);this.alpha=null;this.omega=null;this.scheduledTrigger=null;this.constructorFunction=Transition}Transition.inherits(Primitive);Transition.method("innerClone",(function(t){}));Transition.method("setEnds",(function(t,e){this.alpha=t;this.omega=e;t&&t.downStreamTransitions.push(this)}));Transition.method("canTrigger",(function(){return!this.alpha||this.alpha&&this.alpha.getActive()||this.dna.repeat&&"Condition"!=this.dna.trigger}));Transition.method("trigger",(function(){this.scheduledTrigger=null;if(!this.frozen){this.alpha&&this.alpha.setActive(!1);this.omega&&this.omega.setActive(!0);this.agentId&&this.container.updateStates();this.dna.repeat&&"Condition"!=this.dna.trigger&&scheduleTrigger.call(this)}}));function scheduleTrigger(){updateTrigger.call(this,!0)}function clearTrigger(t){if(this.scheduledTrigger&&(t||!this.dna.repeat)){this.scheduledTrigger.kill();this.scheduledTrigger=null}}function updateTrigger(t){t&&clearTrigger.call(this);if(this.canTrigger()){try{var e=evaluateTree(this.equation,globalVars(this)).toNum()}catch(t){if(!t.substr)throw t;isLocal()&&console.log(t);"MSG:"==t.substr(0,4)?error(t.substr(4,t.length),this,!0):error(t,this,!0)}if("Condition"==this.dna.trigger)trueValue(e)&&this.trigger();else{e instanceof Material||error(getText("The value of this trigger must evaluate to a number."),this,!0);var n;if("Timeout"==this.dna.trigger){e.units||(e.units=simulate.timeUnits);if(this.scheduledTrigger&&eq(e,this.scheduledTrigger.data.value))return;this.dna.repeat&&0==e.value&&error(getText("A trigger Timeout of 0 with 'Repeat' set to true results in an infinite loop."),this,!0);n=e}else if("Probability"==this.dna.trigger){e.units&&error(getText("The probability for the trigger had units of %s. Probabilities must be unitless.",this.value().units.toString()),this,!0);e=e.value;if(this.scheduledTrigger&&eq(e,this.scheduledTrigger.data.value))return;if(1==e){this.dna.repeat&&error(getText("A trigger probability of 1 with 'Repeat' as true results in an infinite loop."),this,!0);n=new Material(0,simulate.timeUnits)}else if(e>1)error(getText("The probability for the trigger must be less than or equal to 1."),this,!0);else if(e<0)error(getText("The probability for the trigger must be greater than or equal to 0."),this,!0);else if(0==e){if(!this.scheduledTrigger)return}else{var i=-Math.log(1-e);n=new Material(RandExp(i),simulate.timeUnits)}}var r=simulate.time();if(this.scheduledTrigger){this.scheduledTrigger.kill();if("Timeout"==this.dna.trigger){if(lessThanEq(n,minus(simulate.time(),this.scheduledTrigger.data.start))){this.scheduledTrigger=null;this.trigger();return}r=this.scheduledTrigger.data.start;n=minus(n,minus(simulate.time(),r));this.scheduledTrigger=null}else if("Probability"==this.dna.trigger){if(0==e){this.scheduledTrigger=null;return}n=mult(n=minus(this.scheduledTrigger.time,simulate.time()),new Material(-Math.log(1-this.scheduledTrigger.data.value)/(i=-Math.log(1-e))));r=this.scheduledTrigger.data.start;this.scheduledTrigger=null}}n=plus(n,simulate.time());var a=this;this.scheduledTrigger=new Task({name:"Trigger",time:n,priority:5,expires:1,action:function(){a.trigger()},data:{start:r,value:e}});simulate.tasks.add(this.scheduledTrigger)}}}function Action(){Primitive.call(this);this.action=null;this.scheduledTrigger=null;this.block=!1;this.constructorFunction=Action}Action.inherits(Primitive);Action.method("innerClone",(function(t){}));Action.method("canTrigger",(function(){return!this.block}));Action.method("resetTimer",(function(){scheduleTrigger.call(this)}));Action.method("trigger",(function(){this.scheduledTrigger=null;if(!this.frozen)try{evaluateTree(this.action,globalVars(this));this.dna.repeat?"Condition"!==this.dna.trigger&&scheduleTrigger.call(this):this.block=!0}catch(t){if(!t.substr)throw t;isLocal()&&console.log(t);"MSG:"==t.substr(0,4)?error(t.substr(4,t.length),this,!0):error(t,this,!0)}}));function Agents(){Primitive.call(this);this.size=null;this.agents=null;this.geoWidth=null;this.geoHeight=null;this.halfWidth=null;this.halfHeight=null;this.geoDimUnits=null;this.geoDimUnitsObject=null;this.geoWrap=null;this.DNAs=null;this.stateIds=[];this.constructorFunction=Agents;this.vector=new Vector([],[],PrimitiveBase)}Agents.inherits(Primitive);Agents.method("collectData",(function(){for(var t=[],e=0;e<this.agents.length;e++){var n=this.agents[e];t.push({instanceId:n.instanceId,connected:n.connected.map((function(t){return t.instanceId})),location:simpleNum(n.location.clone(),this.geoDimUnitsObject),state:n.states.length>0?n.states.slice():null})}return t}));Agents.method("states",(function(){return this.stateIds.slice(0)}));Agents.method("toNum",(function(){throw"MSG: "+getText("[%s] is a population of agents and cannot be used as a direct value in equations.",clean(this.dna.name))}));Agents.method("add",(function(t){this.size=1+parseInt(this.size,10);if(t){(r=t.agentClone()).agentId=this.agentId;r.setIndex(this.size-1);r.createAgentIds();for(var e=0;e<this.DNAs.length;e++){var n=r.children[e],i=this.DNAs[e];n.container=r;linkPrimitive(n,i)}r.updateStates()}else{var r;(r=new Agent).container=this;r.children=[];r.childrenId={};r.agentId=this.agentId;for(e=0;e<this.DNAs.length;e++)decodeDNA(this.DNAs[e],r);r.setIndex(this.size-1);r.createAgentIds();for(e=0;e<this.DNAs.length;e++)linkPrimitive(r.children[e],this.DNAs[e]);setAgentInitialValues(r);var a=getPrimitiveNeighborhood(this,this.dna);if("Custom Function"==this.placement){a.self=r;r.location=simpleUnitsTest(simpleEquation(this.placementFunction,{"-parent":varBank,self:r},a),this.geoDimUnitsObject);if(!r.location.names){r.location.names=["x","y"];r.location.namesLC=["x","y"]}}else r.location=new Vector([mult(this.geoWidth,new Material(Rand())),mult(this.geoHeight,new Material(Rand()))],["x","y"]);if("Custom Function"==this.network)for(var s=trimTree(createTree(this.networkFunction),a),o=e+1;o<this.agents.length;o++)trueValue(simpleEquation(this.networkFunction,{"-parent":varBank,a:r,b:this.agents[o]},a,s))&&r.connect(this.agents[o])}var l=this;simulate.tasks.add(new Task({priority:10,expires:1,name:"Add Agent",time:simulate.time(),action:function(){l.agents.push(r);for(var e=0;e<r.children.length;e++){var n=r.children[e],i=l.DNAs[e];(n instanceof Action||n instanceof Transition)&&"Condition"!=i.trigger&&scheduleTrigger.call(n);if(t)if(n instanceof Action)i.solver.actions.push(n);else if(n instanceof Transition)i.solver.transitions.push(n);else if(!(n instanceof Agents)){i.solver.valued.push(n);n instanceof Flow?i.solver.flows.push(n):n instanceof Stock?i.solver.stocks.push(n):n instanceof State&&i.solver.states.push(n)}}}}));return r}));function Agent(){this.agentId=null;this.instanceId=null;this.index=null;this.children=null;this.location=null;this.connected=[];this.connectedWeights=[];this.dead=!1;this.constructorFunction=Agent;this.stateIDs=[];this.states=[];this.vector=new Vector([],[],AgentBase)}Agent.prototype.createIds=Primitive.prototype.createIds;Agent.method("toString",(function(){return"Agent "+(this.index+1)}));Agent.method("toNum",(function(){return this}));Agent.method("updateStates",(function(){this.states=[];this.stateIDs=[];for(var t=0;t<this.children.length;t++)if(this.children[t].active){this.states.push(this.children[t]);this.stateIDs.push(this.children[t].dna.id)}}));Agent.method("agentClone",(function(){var t=new Agent;t.dna=this.dna;t.children=[];t.childrenId={};for(var e=0;e<this.children.length;e++){t.children.push(this.children[e].clone());t.childrenId[t.children[e].dna.id]=t.children[e]}t.location=this.location.clone();t.connected=this.connected.slice(0);t.connectedWeights=this.connectedWeights.slice(0);t.container=this.container;return t}));Agent.method("setIndex",(function(t){this.index=t;for(var e=0;e<this.children.length;e++)this.children[e].index=t}));Agent.method("createAgentIds",(function(){this.createIds();for(var t=0;t<this.children.length;t++)this.children[t].createIds()}));Agent.method("die",(function(){for(;this.connected.length>0;)this.unconnect(this.connected[0]);for(var t=0;t<this.container.agents.length;t++)if(this.container.agents[t]==this){this.container.agents.splice(t,1);break}for(t=0;t<this.children.length;t++){var e=this.children[t],n=e.dna.solver;if(e instanceof Action){n.actions.splice(n.actions.indexOf(e),1);clearTrigger.call(e,!0)}else if(e instanceof Transition){n.transitions.splice(n.transitions.indexOf(e),1);clearTrigger.call(e,!0)}else if(!(e instanceof Agents)){n.valued.splice(n.valued.indexOf(e),1);e instanceof Flow?n.flows.splice(n.flows.indexOf(e),1):e instanceof Stock?n.stocks.splice(n.stocks.indexOf(e),1):e instanceof State&&n.states.splice(n.states.indexOf(e),1)}}this.dead=!0}));Agent.method("connect",(function(t,e){var n=void 0===e?new Material(1):e;if(t!==this)if(-1==this.connected.indexOf(t)){if(!(t instanceof Agent))throw"MSG: Only agents may be connected.";this.connected.push(t);this.connectedWeights.push(n);t.connected.push(this);t.connectedWeights.push(n)}else if(void 0!==e){this.connectedWeights[this.connected.indexOf(t)]=e;t.connectedWeights[t.connected.indexOf(t)]=e}}));Agent.method("unconnect",(function(t){if(t!==this){var e=this.connected.indexOf(t);if(-1!=e){this.connected.splice(e,1);this.connectedWeights.splice(e,1);e=t.connected.indexOf(this);t.connected.splice(e,1);t.connectedWeights.splice(e,1)}}}));Agent.method("connectionWeight",(function(t){if(t!==this){var e=this.connected.indexOf(t);if(-1!=e)return this.connectedWeights[e].fullClone()}throw"MSG: Agents are not connected and so do not have a connection weight."}));Agent.method("setConnectionWeight",(function(t,e){if(t!==this){var n=this.connected.indexOf(t);if(-1!=n){this.connectedWeights[n]=e.fullClone();return}}throw"MSG: Agents are not connected and so do not have a connection weight."}));function Stock(){Primitive.call(this);this.level=null;this.constructorFunction=Stock;this.delay=void 0;this.tasks=[];this.initRate=null;this.oldLevel=null}Stock.inherits(Primitive);Stock.method("innerClone",(function(t){t.level=this.level;t.oldLevel=this.oldLevel;t.tasks=this.tasks;t.delay=this.delay}));Stock.method("setValue",(function(t){this.level=t;this.cachedValue=void 0;simulate.valuedPrimitives=[];this.value()}));Stock.method("print",(function(){console.log(this.level.map((function(t){return t.value})))}));Stock.method("preserveLevel",(function(){for(var t=this.tasks.length-1;t>=0;t--)this.tasks[t].data.tentative=!1;this.oldLevel=this.level}));Stock.method("restoreLevel",(function(){for(var t=this.tasks.length-1;t>=0;t--)if(this.tasks[t].data.tentative){this.tasks[t].remove();this.tasks.splice(t,1)}this.level=this.oldLevel}));Stock.method("setDelay",(function(t){t=t||this.dna.delay;this.delay=t}));Stock.method("setInitialValue",(function(){var t,e=this;try{t=evaluateTree(this.equation,globalVars(this)).toNum()}catch(t){if(!t.substr)throw t;isLocal()&&console.log(t);"MSG:"==t.substr(0,4)?error(t.substr(4,t.length),this,!0):error(t,this,!0)}"boolean"==typeof t&&(t=new Material(t?1:0));if(t instanceof Vector){var n=this.dna;t.recurseApply((function(t){n.nonNegative&&t.value<0&&(t=new Material(0,n.units));t.units||(t.units=n.units);return t}))}else{this.dna.nonNegative&&t.value<0&&(t=new Material(0,this.dna.units));t.units||(t.units=this.dna.units)}if(isUndefined(this.delay))this.level=t;else{var i=mult(t,div(simulate.userTimeStep,this.delay));this.initRate=div(t,this.delay.forceUnits(simulate.timeUnits));this.level=i;simulate.tasks.addEvent((function(t,n,i){if(t.value>0&&lessThanEq(minus(i,simulate.timeStart),minus(e.delay,simulate.userTimeStep))){t=functionBank.min([t,minus(e.delay,minus(n,simulate.timeStart))]);e.level=plus(e.level,mult(t,e.initRate))}}))}}));Stock.method("subtract",(function(t,e){this.level=minus(this.level,t);if(this.dna.nonNegative)if(this.level instanceof Vector){var n=this.dna;this.level.recurseApply((function(t){return t.value<0?new Material(0,n.units):t}))}else this.level.value<0&&(this.level=new Material(0,this.dna.units))}));Stock.method("add",(function(t,e){if(isUndefined(this.delay)){this.level=plus(this.level,t);if(this.dna.nonNegative)if(this.level instanceof Vector){var n=this.dna;this.level.recurseApply((function(t){return t.value<0?new Material(0,n.units):t}))}else this.level.value<0&&(this.level=new Material(0,this.dna.units))}else this.scheduleAdd(t,e)}));Stock.method("scheduleAdd",(function(t,e,n){var i,r=this,a=new Task({time:plus(e,n=n||this.delay),data:{amnt:t,tentative:!0},priority:-100,name:"Conveyor Add ("+this.dna.name+")",action:function(){i=r.level;r.level=plus(r.level,t);if(r.dna.nonNegative)if(r.level instanceof Vector){var e=r.dna;r.level.recurseApply((function(t){return t.value<0?new Material(0,e.units):t}))}else r.level.value<0&&(r.level=new Material(0,r.dna.units))},rollback:function(){r.level=i}});this.tasks.push(a);simulate.tasks.add(a)}));Stock.method("totalContents",(function(){if(isDefined(this.delay)){for(var t=this.level,e=0;e<this.tasks.length;e++)greaterThan(this.tasks[e].time,simulate.time())&&lessThanEq(this.tasks[e].time,plus(simulate.time(),this.delay))&&(t=plus(t,this.tasks[e].data.amnt));var n=minus(this.delay,simulate.userTimeStep);if(greaterThan(n,simulate.timeProgressed())){var i=minus(n,simulate.timeProgressed());t=plus(t,mult(this.initRate,i))}return t}return this.level}));Stock.method("calculateValue",(function(){null===this.level&&this.setInitialValue();if(isDefined(this.delay)&&4==this.dna.solver.RKOrder){for(var t=this.level,e=0;e<this.tasks.length;e++)greaterThan(this.tasks[e].time,simulate.time())&&lessThanEq(this.tasks[e].time,plus(simulate.time(),this.dna.solver.timeStep))&&(t=plus(t,this.tasks[e].data.amnt));return t}return this.level}));function Converter(){Primitive.call(this);this.source=null;this.constructorFunction=Converter}Converter.inherits(Primitive);Converter.method("innerClone",(function(t){}));Converter.method("setSource",(function(t){this.source=t}));Converter.method("getInputValue",(function(){var t;if("*time"==this.source)t=simulate.time();else{(t=this.source.value().toNum())||error(getText("Undefined input value."),this,!1);t instanceof Vector&&error(getText("Converters do not accept vectors as input values."),this,!1)}return t}));Converter.method("calculateValue",(function(){return new Material(this.getOutputValue().value,this.dna.units)}));Converter.method("getOutputValue",(function(){var t=this.getInputValue();if(0==this.dna.inputs.length)return new Material(0);for(var e=0;e<this.dna.inputs.length;e++)if("discrete"==this.dna.interpolation){if(greaterThan(this.dna.inputs[e],t))return 0==e?this.dna.outputs[0]:this.dna.outputs[e-1]}else if("linear"==this.dna.interpolation){if(eq(this.dna.inputs[e],t))return this.dna.outputs[e];if(greaterThan(this.dna.inputs[e],t)){return 0==e?this.dna.outputs[0]:div(plus(mult(minus(t,this.dna.inputs[e-1]),this.dna.outputs[e]),mult(minus(this.dna.inputs[e],t),this.dna.outputs[e-1])),minus(this.dna.inputs[e],this.dna.inputs[e-1]))}}return this.dna.outputs[this.dna.outputs.length-1]}));function Variable(){Primitive.call(this);this.constructorFunction=Variable}Variable.inherits(Primitive);Variable.method("innerClone",(function(t){}));Variable.method("calculateValue",(function(){var t=evaluateTree(this.equation,globalVars(this));if("boolean"==typeof t)t=new Material(t?1:0);else if(t instanceof Vector)return t;t.units||(t.units=this.dna.units);return t}));function Flow(){Primitive.call(this);this.alpha=null;this.omega=null;this.rate=null;this.RKPrimary=[];this.constructorFunction=Flow}Flow.inherits(Primitive);Flow.method("innerClone",(function(t){}));Flow.method("setEnds",(function(t,e){this.alpha=t;this.omega=e}));Flow.method("calculateValue",(function(){this.predict();return this.rate.fullClone()}));Flow.method("clean",(function(){this.rate=null;this.RKPrimary=[]}));Flow.method("predict",(function(t){if(null===this.rate||t){try{var e=evaluateTree(this.equation,globalVars(this)).toNum();if(!(e instanceof Vector||isFinite(e.value)))throw"MSG: "+getText("The result of this calculation is not finite. Flows must have finite values. Are you dividing by 0?")}catch(t){if(!t.substr)throw t;isLocal()&&console.log(t);"MSG:"==t.substr(0,4)?error(t.substr(4,t.length),this,!0):error(t,this,!0)}"boolean"==typeof e&&(e=new Material(e?1:0));this.rate=e.fullClone();if(this.rate instanceof Vector){var n=this.dna;this.rate.recurseApply((function(t){t.units||(t.units=n.units);return t}))}else this.rate.units||(this.rate.units=this.dna.units);this.testUnits(this.rate,!0);this.rate=mult(this.rate,this.dna.solver.timeStep);t&&this.RKPrimary.length>0?this.RKPrimary[this.RKPrimary.length-1]=this.rate:this.RKPrimary.push(this.rate);4==this.dna.solver.RKOrder&&(1==this.dna.solver.RKPosition?this.rate=this.RKPrimary[0]:2==this.dna.solver.RKPosition?this.rate=this.RKPrimary[1]:3==this.dna.solver.RKPosition?this.rate=this.RKPrimary[2]:4==this.dna.solver.RKPosition&&(this.rate=div(plus(plus(plus(this.RKPrimary[0],mult(new Material(2),this.RKPrimary[1])),mult(new Material(2),this.RKPrimary[2])),this.RKPrimary[3]),new Material(6))));this.rate=div(this.rate,this.dna.solver.timeStep);this.dna.onlyPositive&&(this.rate instanceof Vector?this.rate.recurseApply((function(t){return t.value>=0?t:new Material(0,t.units)})):this.rate.value<=0&&(this.rate=new Material(0,this.rate.units)))}}));Flow.method("apply",(function(t,e,n){try{if(null===this.rate)return;var i=this.rate.fullClone(),r=i=mult(i,t),a=i,s=!1;if(null!==this.alpha){var o=this.alpha.level;if(i instanceof Vector&&(!(o instanceof Vector)||o.depth()<i.depth())){r=i.fullClone().collapseDimensions(o);s=!0}else o instanceof Vector&&(!(i instanceof Vector)||o.depth()>i.depth())&&error(getText("The alpha of the flow is a vector with a higher order than the flow rate. There has to be at least one element in the flow rate for each element in the alpha."),this,!0)}if(null!==this.omega){o=this.omega.level;if(i instanceof Vector&&(!(o instanceof Vector)||o.depth()<i.depth())){a=i.fullClone().collapseDimensions(o);s=!0}else o instanceof Vector&&(!(i instanceof Vector)||o.depth()>i.depth())&&error(getText("The omega of the flow is a vector with a higher order than the flow rate. There has to be at least one element in the flow rate for each element in the omega."),this,!0)}if(s){null!==this.alpha&&this.alpha.dna.nonNegative&&error(getText("Cannot use non-negative stocks when the flow rate is a vector that needs to be collapsed."),this.alpha,!1);null!==this.omega&&this.omega.dna.nonNegative&&error(getText("Cannot use non-negative stocks when the flow rate is a vector that needs to be collapsed."),this.omega,!1)}else{if(null!==this.omega&&this.omega.dna.nonNegative){if((l=plus(this.omega.level.toNum(),i))instanceof Vector){l.recurseApply((function(t){return t.value<0?t:new Material(0,t.units)}));i=minus(i,l)}else l.value<0&&(i=negate(this.omega.level.toNum()));0}if(null!==this.alpha&&this.alpha.dna.nonNegative){var l;if((l=minus(this.alpha.level.toNum(),i))instanceof Vector){l.recurseApply((function(t){return t.value<0?t:new Material(0,t.units)}));i=minus(i,l);i=minus(i,l)}else l.value<0&&(i=this.alpha.level.toNum());0}if(null!==this.omega&&this.omega.dna.nonNegative)if(i instanceof Vector)for(var u=functionBank.flatten([plus(this.omega.level.toNum(),i)]),h=0;h<u.items.length;h++)u.items[h].value<0&&error(getText("Inconsistent non-negative constraints for flow."),this,!1);else plus(this.omega.level.toNum(),i).value<0&&error(getText("Inconsistent non-negative constraints for flow."),this,!1)}var c=0;try{if(null!==this.omega){c=1;s?this.omega.add(a,e):this.omega.add(i,e)}if(null!==this.alpha){c=2;s?this.alpha.subtract(r,e):this.alpha.subtract(i,e)}}catch(t){var d="";1==c?d=this.omega:2==c&&(d=this.alpha);error("MSG: Keys do not match for vector operation."==t?getText("Incompatible vector keys for flow %s and connected stock %s.","<i>["+clean(this.dna.name)+"]</i>","<i>["+clean(d.dna.name)+"]</i>"):getText("Incompatible units for flow %s and connected stock %s. Stock has units of %s. The flow should have the equivalent units divided by some time unit such as Years.","<i>["+clean(this.dna.name)+"]</i>","<i>["+clean(d.dna.name)+"]</i>","<i>"+(d.dna.units?clean(d.dna.units.toString()):"unitless")+"</i>"),this,!1)}}catch(t){if(!t.substr)throw t;"MSG:"==t.substr(0,4)?error(t.substr(4,t.length),this,!0):error(t,this,!0)}}));function globalVars(t){return t instanceof Agent?{"-parent":varBank,self:t}:t.container?{"-parent":varBank,self:t.container}:varBank}function TaskQueue(t){t=t||{};this.tasks=new RedBlackTree;this.onMoveEvents=[];this.setTime(t.start);this.debug=!1;this.end=t.end;this.states={}}TaskQueue.prototype.print=function(){console.log("Current Time: "+this.time.value);this.tasks.goMin();for(;null!==this.tasks.current();){console.log(this.tasks.current().name);console.log("    Time: "+this.tasks.current().time.value);console.log("    Priority: "+this.tasks.current().priority);isDefined(this.tasks.current().expires)&&console.log("    Expires: "+this.tasks.current().expires);isDefined(this.tasks.current().skip)&&console.log("    Skip: "+this.tasks.current().skip);this.tasks.next()}};TaskQueue.prototype.addEvent=function(t){this.onMoveEvents.push(t)};TaskQueue.prototype.fireEvents=function(t,e,n){this.debug&&console.log("Firing Events");for(var i=0;i<this.onMoveEvents.length;i++)this.onMoveEvents[i](t,e,n)};TaskQueue.prototype.setTime=function(t){if(isUndefined(this.time)||neq(t,this.time)){var e=this.time;this.time=t;isDefined(e)&&this.fireEvents(minus(t,e),e,t)}};TaskQueue.prototype.moveTime=function(t){this.debug&&console.log("Shifting time by: "+t.value);this.moveTo(timePlus(this.time,t))};TaskQueue.prototype.moveTo=function(t){if(!eq(this.time,t)){this.debug&&console.log("Shifting time to: "+t.value);if(null!==this.tasks.current()){for(var e=this.tasks.max().time,n=this.tasks.min().time;lessThan(this.time,t)&&!greaterThan(this.time,e);)this.step();for(;greaterThan(this.time,t)&&greaterThan(this.time,n);)this.stepBack()}this.setTime(t);this.debug&&console.log("Time shift to  "+t.value+" completed.")}};TaskQueue.prototype.add=function(t){t.queue=this;this.tasks.add(t)};TaskQueue.prototype.step=function(){if(isUndefined(this.time)){this.tasks.goMin();this.setTime(this.tasks.current().time)}this.tasks.current().time;if(null!==this.tasks.current()){var t=this.tasks.current().deadAction;this.tasks.current().execute();if(!t&&this.tasks.current().timeShift){this.tasks.current().timeShift();return}this.tasks.next()}if(null!==this.tasks.current())this.setTime(this.tasks.current().time);else{this.tasks.next();this.setTime(mult(this.tasks.max().time,new Material(10)))}};TaskQueue.prototype.stepBack=function(){if(isUndefined(this.time)){this.tasks.goMin();this.setTime(this.tasks.current().time)}else{null===this.tasks.current()?this.tasks.goMax():this.tasks.previous();for(var t=this.tasks.current().time;null!==this.tasks.current()&&eq(t,this.tasks.current().time);){this.tasks.current().rollback();this.tasks.previous()}null===this.tasks.current()?this.tasks.goMin():this.tasks.next();this.setTime(this.tasks.current().time)}};TaskQueue.prototype.atStart=function(){return isUndefined(this.time)||this.tasks.current()===this.tasks.min()};TaskQueue.prototype.completed=function(){return isDefined(this.time)&&(greaterThan(this.time,this.end)||null===this.tasks.current())};TaskQueue.prototype.remove=function(t){t==this.tasks.current()&&this.tasks.next();this.tasks.remove(t)};var TaskId=0,simulate,model;function Task(t){this.id=TaskId++;this.name=t.name;this.time=t.time;this.action=t.action;this.reverse=t.rollback;this.priority=t.priority||0;this.expires=t.expires;this.skip=t.skip;this.timeShift=t.timeShift;this.data=t.data;this.blocker=t.blocker;this.deadAction=!1;this.deadReverse=!1;this.action&&(this.action.task=this);this.reverse&&(this.action.reverse=this)}Task.prototype.execute=function(){if(this.action&&!this.deadAction&&(!this.blocker||!this.queue.states[this.blocker])){if(isDefined(this.skip)&&this.skip>0){this.skip--;this.queue.debug&&console.log("Skipping: "+this.name)}else{this.queue.debug&&console.log("%c Executing: "+this.name+" (Time: "+this.time.value+")","color:blue");if(isDefined(this.expires)){this.expires--;this.queue.debug&&console.log("    Current count before expire: "+this.expires);if(this.expires<=0){this.queue.debug&&console.log("    Task expired.");this.deadAction=!0}}}this.action()}};Task.prototype.rollback=function(){if(this.reverse&&!this.deadReverse&&(!this.blocker||!this.queue.states[this.blocker])){this.queue.debug&&console.log("Rolling back: "+this.name+" (Time: "+this.time.value+")");if(isDefined(this.expires)&&this.expires<=0){this.queue.debug&&console.log("    Rollback expired.");this.deadReverse=!0}this.reverse()}};Task.prototype.reschedule=function(t){this.queue.remove(this);this.time=t;this.queue.add(this)};Task.prototype.remove=function(){this.queue.remove(this)};Task.prototype.kill=function(){this.deadAction=!0;this.deadReverse=!0};Task.prototype.block=function(t){t=t||this.blocker;this.queue.states[t]=!0};Task.prototype.unblock=function(t){t=t||this.blocker;this.queue.states[t]=!1};Task.prototype.compare=function(t){return eq(t.time,this.time)?t.priority==this.priority?t.id==this.id?0:t.id<this.id?1:-1:t.priority<this.priority?1:-1:lessThan(t.time,this.time)?1:-1};Task.prototype.toString=function(){return this.name+" - "+this.id};function scheduleRepeated(t,e,n,i,r){for(var a=div(minus(r,n),i),s=0;s<=a;s++){e.time=plus(n,mult(i,new Material(s)));t.add(new Task(e))}}RedBlackNode.VERSION=1;function RedBlackNode(t,e){this._left=null;this._right=null;this._value=t;this._height=1;this.parent=e}RedBlackNode.prototype.add=function(t){var e,n,i,r=t.compare(this._value);if(0!=r){if(r<0)if(null!=this._left){e=this._left.add(t);this._left=e[0];this._left.parent=this;i=e[1]}else i=this._left=new RedBlackNode(t,this);else if(r>0)if(null!=this._right){e=this._right.add(t);this._right=e[0];this._right.parent=this;i=e[1]}else i=this._right=new RedBlackNode(t,this);n=[this.balanceTree(),i]}else n=[this,this];return n};RedBlackNode.prototype.balanceTree=function(){var t,e=null!=this._left?this._left._height:0,n=null!=this._right?this._right._height:0;if(e>n+1)t=this.swingRight();else if(n>e+1)t=this.swingLeft();else{this.setHeight();t=this}return t};RedBlackNode.prototype.join=function(t){var e;if(null==t)e=this;else{var n;if(this._height>t._height){(n=this)._right=t.join(n._right);n._right.parent=n}else{(n=t)._left=this.join(n._left);n._left.parent=n}e=n.balanceTree()}return e};RedBlackNode.prototype.moveLeft=function(){var t=this._right,e=t._left;this._right=e;this._right&&(this._right.parent=this);t._left=this;t._left.parent=t;this.setHeight();t.setHeight();return t};RedBlackNode.prototype.moveRight=function(){var t=this._left,e=t._right;this._left=e;this._left&&(this._left.parent=this);t._right=this;t._right.parent=t;this.setHeight();t.setHeight();return t};RedBlackNode.prototype.remove=function(t){var e,n,i,r=t.compare(this._value);if(0!=r){if(r<0)if(null!=this._left){e=this._left.remove(t);this._left=e[0];this._left&&(this._left.parent=this);i=e[1]}else i=null;else if(null!=this._right){e=this._right.remove(t);this._right=e[0];this._right&&(this._right.parent=this);i=e[1]}else i=null;n=this}else{i=this;if(null==this._left)n=this._right;else if(null==this._right)n=this._left;else{n=this._left.join(this._right);this._left=null;this._right=null}}return null!=i?null!=n?[n.balanceTree(),i]:[n,i]:[this,null]};RedBlackNode.prototype.setHeight=function(){var t=null!=this._left?this._left._height:0,e=null!=this._right?this._right._height:0;this._height=t<e?e+1:t+1};RedBlackNode.prototype.swingLeft=function(){var t=this._right,e=t._left,n=t._right,i=this._left;null!=i&&i._height;if((null!=e?e._height:0)>(null!=n?n._height:0)){this._right=t.moveRight();this._right.parent=this}return this.moveLeft()};RedBlackNode.prototype.swingRight=function(){var t=this._left,e=t._right,n=t._left,i=this._right;null!=i&&i._height;if((null!=e?e._height:0)>(null!=n?n._height:0)){this._left=t.moveLeft();this._left.parent=this}return this.moveRight()};RedBlackNode.prototype.traverse=function(t){null!=this._left&&this._left.traverse(t);t(this);null!=this._right&&this._right.traverse(t)};RedBlackNode.prototype.toString=function(){return this._value.toString()};RedBlackNode.prototype.validateParents=function(){if(this._right){if(this._right.parent!==this){console.log("Invalid right");console.log(this)}this._right.validateParents()}if(this._left){if(this._left.parent!==this){console.log("Invalid left");console.log(this)}this._left.validateParents()}};RedBlackTree.VERSION=1;function RedBlackTree(){this._root=null;this._cursor=null}RedBlackTree.prototype._findNode=function(t){for(var e=this._root;null!=e;){var n=t.compare(e._value);if(0==n)break;e=n<0?e._left:e._right}return e};RedBlackTree.prototype._maxNode=function(t){null==t&&(t=this._root);if(null!=t)for(;null!=t._right;)t=t._right;return t};RedBlackTree.prototype._minNode=function(t){null==t&&(t=this._root);if(null!=t)for(;null!=t._left;)t=t._left;return t};RedBlackTree.prototype._nextNode=function(t){if(null!=t)if(null!=t._right)t=this._minNode(t._right);else{for(;null!=t.parent&&t.parent._right===t;)t=t.parent;t=t.parent}else t=this._minNode(this._root);return t};RedBlackTree.prototype._previousNode=function(t){if(null!=t)if(null!=t._left)t=this._maxNode(t._left);else{for(;null!=t.parent&&t.parent._left===t;)t=t.parent;t=t.parent}else t=this._maxNode(this._root);return t};RedBlackTree.prototype.add=function(t){var e;if(null==this._root)e=this._root=new RedBlackNode(t);else{var n=this._root.add(t);this._root=n[0];this._root.parent=null;e=n[1]}return e};RedBlackTree.prototype.find=function(t){var e=this._findNode(t);return null!=e?e:null};RedBlackTree.prototype.findNext=function(t){var e=this._findNode(t,!0);return null!=(e=this._nextNode(e))?e._value:null};RedBlackTree.prototype.findPrevious=function(t){var e=this._findNode(t,!0);return null!=(e=this._previousNode(e))?e._value:null};RedBlackTree.prototype.max=function(){var t=this._maxNode();return null!=t?t._value:null};RedBlackTree.prototype.min=function(){var t=this._minNode();return null!=t?t._value:null};RedBlackTree.prototype.next=function(){this._cursor=this._nextNode(this._cursor);return this._cursor?this._cursor._value:null};RedBlackTree.prototype.previous=function(){this._cursor=this._previousNode(this._cursor);return this._cursor?this._cursor._value:null};RedBlackTree.prototype.remove=function(t){var e;if(null!=this._root){var n=this._root.remove(t);this._root=n[0];e=n[1]}else e=null;return e};RedBlackTree.prototype.goMin=function(){this._cursor=this._minNode(this._root)};RedBlackTree.prototype.goMax=function(){this._cursor=this._maxNode(this._root)};RedBlackTree.prototype.current=function(){return this._cursor?this._cursor._value:null};RedBlackTree.prototype.traverse=function(t){null!=this._root&&this._root.traverse(t)};RedBlackTree.prototype.toString=function(){var t=[];if(null!=this._root)for(var e=[[this._root,0,"^"]];e.length>0;){for(var n=e.pop(),i=n[0],r=n[1],a="",s=0;s<r;s++)a+="  ";a+=n[2]+"("+i.toString()+")";t.push(a);null!=i._right&&e.push([i._right,r+1,"R"]);null!=i._left&&e.push([i._left,r+1,"L"])}return t.join("\n")};RedBlackTree.prototype.validateParents=function(){if(null!=this._root.parent){console.log("Invalid root node parent");this._root.validateParents()}console.log("done")};var strictUnits=null,strictAgentResolution=!1,strictLinks=!1;function runSimulation(t){try{return innerRunSimulation(t)}catch(e){console.error(e);return checkErr(e,t)}}function checkErr(t,e,n){simulate&&simulate.terminate();isLocal()&&console.log(t);var i;if(t.msg)i={error:t.msg,errorPrimitive:isDefined(t.primitive)?findID(t.primitive.id):null};else{i={error:getText("An unknown simulation error occurred. Please report this issue to the Insight Maker team."),errorPrimitive:null};if("string"==typeof t){"MSG:"===t.substr(0,4)&&(i.error=t.substr(4));t={msg:i.error}}else t.msg=i.msg}simulate.results||(simulate.results={});simulate.results.error=t.msg;e.onError&&e.onError(i);if(e.silent)return i;handleErrorObject(t)}var timeUnits=null;function innerRunSimulation(t){evaluatingLine=null;simulate=new Simulator;t.resultsWindow&&(simulate.resultsWindow=t.resultsWindow);bootCalc();allPlaceholders=[];(model={}).submodels={base:{id:"base",DNAs:[],agents:[{children:[],childrenId:{}}],size:1}};var e=getSetting();strictUnits=isTrue(e.getAttribute("StrictUnits"));strictAgentResolution=isTrue(e.getAttribute("StrictAgentResolution"));strictLinks=isTrue(getSetting().getAttribute("StrictLinks"));var n=e.getAttribute("Units");if(isDefined(n)){for(var i=e.getAttribute("Units").split("\n"),r=[],a=[],s=[],o=0;o<i.length;o++){var l=i[o].split("<>");if(l[2]&&""!=l[2].trim()){r.push(l[0]);a.push(l[1]);var u=createUnitStore(l[2]);if(isUndefined(u))throw{msg:'You cannot define a units synonym for "unitless".'};s.push(u.toStringShort())}}loadUnits(r,s,a)}var h=getUnitStore([timeUnits=e.getAttribute("TimeUnits").toLowerCase()],[1]);model.timeLength=new Material(sn("#i"+e.getAttribute("TimeLength")),h);model.timeStart=new Material(sn("#i"+e.getAttribute("TimeStart")),h);model.timeStep=new Material(sn("#i"+e.getAttribute("TimeStep")),h);e.getAttribute("TimePause")>0&&(model.timePause=new Material(sn("#i"+e.getAttribute("TimePause")),h));simulate.timeUnits=h;var c={};c.base={timeStep:new Material(sn("#i"+e.getAttribute("TimeStep")),h),algorithm:e.getAttribute("SolutionAlgorithm"),id:"base",maxLoaded:-1};model.solvers=c;var d=findType("Folder");for(o=0;o<d.length;o++){var m=d[o].getAttribute("Solver");if(m){if((p=JSON.parse(m)).enabled){c[d[o].id]=p;c[d[o].id].timeStep=new Material(sn("#i"+c[d[o].id].timeStep),h);c[d[o].id].id=d[o].id;c[d[o].id].maxLoaded=-1}}}var f=Object.keys(c);for(o=0;o<f.length;o++){var p;(p=c[f[o]]).userTimeStep=p.timeStep;"RK4"==p.algorithm?p.RKOrder=4:p.RKOrder=1;4==p.RKOrder?p.timeStep=div(p.userTimeStep,new Material(2)):p.timeStep=p.userTimeStep;p.stocks=[];p.flows=[];p.transitions=[];p.actions=[];p.states=[];p.valued=[];p.displayed=[]}isDefined(e.getAttribute("Macros"))&&evaluateMacros(e.getAttribute("Macros"));var g=primitives();for(o=0;o<g.length;o++)if("Agents"==g[o].value.nodeName){var _=g[o],v=_.getAttribute("Agent"),S=parseInt(v,10);S==v&&(v=S);if(isUndefined(v))throw{msg:getText("You must select a base agent for the primitive %s. You can create agent definitions using Folder primitives.","<i>"+clean(_.getAttribute("name"))+"</i>"),primitive:_,showEditor:!1};var N=new Agents;N.dna=new DNA(_,v);N.id=_.id;N.agentId=v;N.createIds();N.dna.solver=folderSolvers(_,c);N.dna.solver.displayed.push(N);N.geoDimUnits=_.getAttribute("GeoDimUnits");N.geoDimUnitsObject=createUnitStore(_.getAttribute("GeoDimUnits"));N.geoWidth=simpleUnitsTest(simpleEquation(_.getAttribute("GeoWidth")),N.geoDimUnitsObject,_);N.geoHeight=simpleUnitsTest(simpleEquation(_.getAttribute("GeoHeight")),N.geoDimUnitsObject,_);N.halfWidth=div(N.geoWidth,new Material(2));N.halfHeight=div(N.geoHeight,new Material(2));N.geoWrap=isTrue(_.getAttribute("GeoWrap"));N.placement=_.getAttribute("Placement");N.placementFunction=_.getAttribute("PlacementFunction");N.network=_.getAttribute("Network");N.networkFunction=_.getAttribute("NetworkFunction");N.agentBase=findID(v).getAttribute("AgentBase")||"";""!=N.agentBase.trim()&&(N.agentBase=simpleEquation(N.agentBase,varBank));var E=getChildren(findID(v));N.DNAs=[];for(var T=0;T<E.length;T++){modelType(E[T].value.nodeName)&&N.DNAs.push(getDNA(E[T],c));"State"==E[T].value.nodeName&&N.stateIds.push(E[T].id)}N.size=_.getAttribute("Size");N.agents=[];N.dna.agents=N;model.submodels[_.id]=N;model.submodels.base.DNAs.push(N.dna)}else inAgent(g[o])||modelType(g[o].value.nodeName)&&model.submodels.base.DNAs.push(getDNA(g[o],c));for(var F in model.submodels){F=model.submodels[F];for(T=0;T<F.size;T++){var b;if("base"==F.id)b=F.agents[0];else{(b=new Agent).container=F;b.index=T;b.children=[];b.childrenId={};b.agentId=F.id;b.createIds();F.agentBase&&(b.vector.parent=F.agentBase);F.agents.push(b)}for(o=0;o<F.DNAs.length;o++)decodeDNA(F.DNAs[o],b)}}simulate.setup({model:model});for(var F in model.submodels){F=model.submodels[F];for(T=0;T<F.size;T++)for(o=0;o<F.DNAs.length;o++)linkPrimitive(F.agents[T].children[o],F.DNAs[o])}for(var F in model.submodels){F=model.submodels[F];for(T=0;T<F.size;T++)setAgentInitialValues(F.agents[T])}for(var F in model.submodels)if("base"!=F){try{buildNetwork(model.submodels[F])}catch(t){isLocal()&&console.log(t);var L=getText("An error with the custom network function prevented the simulation from running.");t.msg?L=L+"<br/><br/>"+t.msg:"MSG:"==t.toString().substr(0,4)&&(L=L+"<br/><br/>"+t.toString().substr(4));throw{msg:L,primitive:model.submodels[F].cell,showEditor:!1}}try{buildPlacements(model.submodels[F])}catch(t){isLocal()&&console.log(t);L=getText("An error with the agent placement function prevented the simulation from running.");t.msg?L=L+"<br/><br/>"+t.msg:"MSG:"==t.toString().substr(0,4)&&(L=L+"<br/><br/>"+t.toString().substr(4));throw{msg:L,primitive:model.submodels[F].cell,showEditor:!1}}}simulate.results={Time:[],data:[]};simulate.displayInformation={ids:[],times:[],objects:[]};model.submodels.base.agents[0].children.forEach((function(t){if(!(t instanceof Action||t instanceof Transition)){simulate.displayInformation.objects.push(t);simulate.displayInformation.ids.push(t.id);var e={};if(t instanceof Agents){e.width=t.geoWidth;e.height=t.geoHeight;e.units=t.geoDimUnitsObject;e.states=t.states()}else t.dna.solver.displayed.push(t);simulate.results[t.id]={data:e,results:[],dataMode:"float"}}}));if(t.silent){if(!t.onPause)return formatSimResults(simulate.run(t));simulate.run(t)}else{var w=div(model.timeLength,model.timeStep);for(o=0;o<=w;o++)simulate.displayInformation.times.push(plus(model.timeStart,mult(model.timeStep,new Material(o))).value);var k=t.onSuccess;t.onSuccess=function(t){updateDisplayed(null);simulate.resultsWindow.results=formatSimResults(simulate.results);k&&k(t)};t.onCompletedFirstPass=function(){if(t.resultsWindow){t.resultsWindow.displayInformation.store.suspendEvents();t.resultsWindow.displayInformation.store.maxLoaded=-1;t.resultsWindow.displayInformation.store.clearFilter();t.resultsWindow.displayInformation.store.removeAll();simulate.displayInformation=t.resultsWindow.displayInformation;var e=t.resultsWindow.displayInformation.scripter;e.simulator=simulate;e.playBut.setGlyph(61516);e.combo.setValue(-1);e.time=0;e.timeIndex=0;e.isFinished=!1;e.updatingSlider=!0;e.slider.setValue(e.minTime);e.updatingSlider=!1;e.advanceTimer();t.resultsWindow.displayInformation.store.resumeEvents();clearInterval(e.animInter);e.animInter=setInterval((function(){e.advanceTimer()}),200);for(var n=0;n<simulate.displayInformation.origIds.length;n++){var i=simulate.displayInformation.origIds[n];if("Agents"==(l=(o=simulate.displayInformation.objects[n]).dna).type){simulate.results[i].states=o.stateIds;simulate.displayInformation.agents[i.toString()].data=simulate.results[i].data;simulate.displayInformation.agents[i.toString()].results=simulate.results[i].results}else if(simulate.results.data[0][i]instanceof Vector&&simulate.results.data[0][i].names){var r=simulate.results.data[0][i].fullNames();simulate.results[i].indexedFullNames=r.slice();for(var a=0;a<r.length;a++)r[a]=r[a].join(", ");simulate.results[i].indexedNames=r}}}else{simulate.displayInformation.colors=[];simulate.displayInformation.headers=[];simulate.displayInformation.agents=[];simulate.displayInformation.displayedHeaders=[];simulate.displayInformation.displayedIds=[];simulate.displayInformation.renderers=[];simulate.displayInformation.elementIds=[];simulate.displayInformation.res=simulate.results;var s=[];simulate.displayInformation.origIds=simulate.displayInformation.ids.slice();for(n=0;n<simulate.displayInformation.origIds.length;n++){i=simulate.displayInformation.origIds[n];var o,l=(o=simulate.displayInformation.objects[n]).dna;simulate.displayInformation.displayedIds.push(i);simulate.displayInformation.displayedHeaders.push(l.name);if("Agents"==l.type){var u=o.stateIds;simulate.results[i].states=u;for(a=0;a<u.length;a++){var h=findID(u[a]);s.push(i);simulate.displayInformation.elementIds.push("e"+i+"-"+u[a]);simulate.displayInformation.headers.push(getName(h));simulate.displayInformation.colors.push(getLineColor(h));"float"==simulate.results[i].dataMode?simulate.displayInformation.renderers.push(commaStr):"agents"==simulate.results[i].dataMode?simulate.displayInformation.renderers.push((function(t){return t})):simulate.displayInformation.renderers.push(void 0)}simulate.displayInformation.agents[i.toString()]={id:i,item:l.cell,data:simulate.results[i].data,results:simulate.results[i].results}}else if(simulate.results.data[0][i]instanceof Vector&&simulate.results.data[0][i].names){var c=getLineColor(l.cell);r=simulate.results.data[0][i].fullNames();simulate.results[i].indexedFullNames=r.slice();for(a=0;a<r.length;a++)r[a]=r[a].join(", ");simulate.results[i].indexedNames=r;for(a=0;a<r.length;a++){s.push(i);simulate.displayInformation.elementIds.push("e"+i+"-"+a);simulate.displayInformation.headers.push(l.name+" ("+r[a]+")");simulate.displayInformation.colors.push(c);simulate.displayInformation.renderers.push(commaStr)}}else{s.push(i);simulate.displayInformation.elementIds.push("e"+i);simulate.displayInformation.headers.push(l.name);simulate.displayInformation.colors.push(getLineColor(l.cell));"float"==simulate.results[i].dataMode?simulate.displayInformation.renderers.push(commaStr):simulate.displayInformation.renderers.push(void 0)}}var d=[{type:"float",name:"Time"},{type:"int",name:"id"}];for(n=0;n<simulate.displayInformation.elementIds.length;n++)d.push({type:"auto",name:simulate.displayInformation.elementIds[n],defaultValue:void 0});simulate.displayInformation.store=new Ext.data.Store({fields:d,data:void 0});simulate.displayInformation.store.maxLoaded=-1;simulate.displayInformation.ids=s}};var O=t.onStep;t.onStep=function(t){var e=!1,n=simulate.progress();if(!simulate.shouldSleep){var i=(new Date).getTime()-simulate.wakeUpTime;if(!simulate.resultsWindow&&i>100||i>600){updateDisplayed(t);e=!0;simulate.timer=setTimeout((function(){simulate.resume()}),20);simulate.sleep()}}1!=n||e||updateDisplayed(t);O&&O(t)};var x=t.onError;t.onError=function(t){try{for(var e in simulate.model.solvers)updateDisplayed(simulate.model.solvers[e])}catch(t){}if(simulate.resultsWindow){simulate.resultsWindow.scripter.pause(!1);simulate.resultsWindow.scripter.finished()}x&&x(t)};simulate.run(t)}}function formatSimResults(t){var e=function(t){return function(e){if(e instanceof Vector){if(e.names){for(var i={},r=0;r<e.names.length;r++)i[e.names[r]]=n(e.items[r]);return i}return e.items.slice().map(n)}return t?e:void 0}},n=e(!0);t=deepClone({},t,3,e(!1));if(isUndefined(t.error)){t.error="none";t.errorPrimitive=null}t.names={};for(var i=model.submodels.base.agents[0].children,r=0;r<i.length;r++)t.names[i[r].name]=i[r].id;t.value=function(t){return this[t.id].results};t.lastValue=function(t){return this[t.id].results[this[t.id].results.length-1]};if(t.Time){t.periods=t.Time.length;t.times=t.Time}return t}function createUnitStore(t){if(t&&""!=t.trim()&&"unitless"!=t.trim().toLowerCase())return simpleEquation("{1 "+t+"}").units}function simpleEquation(t,e,n,i){e||(e={});n||(n={});i||(i=trimTree(createTree(t),n));return evaluateTree(i,e)}function simpleNum(t,e){if(t instanceof Vector)return new Vector(t.items.map((function(t){return simpleNum(t,e)})));if(!e&&t.units)throw getText("The result of the calculation has units %s, but no units are specified for the calculation. Please set the units for the calculation so we can determine the proper output.",t.units.toString());if(t.units){t.units.addBase();e.addBase();return 0+fn["*"](t.value,fn["/"](sn("#e"+t.units.toBase),e.toBase))}return 0+t.value}function simpleUnitsTest(t,e,n,i){if(t instanceof Vector)return new Vector(t.items.map((function(t){return simpleUnitsTest(t,e,n,i)})));if(t.units||e){if(t.units){if(t.units===e)return t;var r=convertUnits(t.units,e,!1);if(0==r){if(isLocal()){console.log(t.units);console.log(e)}throw{msg:getText("Wrong units generated. Expected %s, and got %s.","<i>"+clean(e?e.toString():"unitless")+"</i>","<i>"+clean(t.units?t.units.toString():"unitless")+"</i>"),primitive:n,showEditor:i}}t.value=t.value*r;t.units=e;return t}t.units=e;return t}return t}function handleErrorObject(t){if(isLocal()){console.log(t);console.trace&&console.trace()}if(t.msg){if(isDefined(t.primitive)){var e=findID(t.primitive.id);highlight(e);t.showEditor&&showEditor(e,[{type:"error",row:void 0!==t.line?t.line-1:evaluatingLine-1,text:t.details?t.details:"Error"}])}mxUtils.alert(t.msg)}else t.error?mxUtils.alert(t):mxUtils.alert(getText("An unknown model simulation error occurred. Please report this issue to the Insight Maker team."))}function evaluateMacros(t){evaluateTree(trimTree(createTree(t),{}),varBank)}function DNA(t,e){this.type=t.value.nodeName;this.cell=t;e=e||t.id;var n=parseInt(t.id,10);n==t.id?this.id=n:this.id=e;this.name=t.getAttribute("name");this.units=null}function getDNA(t,e){var n=new DNA(t);n.solver=folderSolvers(t,e);if(t){var i=getParent(t);i&&(n.frozen=isTrue(getFrozen(i)))}"Variable"!==n.type&&"Flow"!=n.type||isTrue(t.getAttribute("ShowSlider"))&&(n.slider=!0);if("Flow"==n.type||"Transition"==n.type){null!==t.target&&(n.targetId=orig(t.target).id);null!==t.source&&(n.sourceId=orig(t.source).id)}if("Converter"==n.type)n.value=getValue(t);else try{n.value=createTree(getValue(t))}catch(e){isLocal()&&console.log(e);var r=getText("The primitive %s has an equation error that must be corrected before the model can be run.","<i>["+clean(n.name)+"]</i>");e.substr&&"MSG:"==e.substr(0,4)&&(r+="<br/><br/>"+e.toString().substr(4));var a=void 0;e.match&&e.match(/line (\d+)/i)&&(a=e.match(/line (\d+)/i)[1]);error(r,t,!0,a,e.match?e:void 0)}if("Action"==n.type){n.trigger=t.getAttribute("Trigger");n.repeat=isTrue(t.getAttribute("Repeat"));n.recalculate=isTrue(t.getAttribute("Recalculate"))||"Condition"==n.trigger;try{n.triggerValue=createTree(""+t.getAttribute("Value"))}catch(t){r=getText("The trigger for %s has an equation error that must be corrected before the model can be run.","<i>["+clean(n.name)+"]</i>");t.substr&&"MSG:"==t.substr(0,4)&&(r+="<br/><br/>"+t.toString().substr(4));error(r,n.cell,!1,a)}}else if("Transition"==n.type){n.trigger=t.getAttribute("Trigger");n.repeat=isTrue(t.getAttribute("Repeat"));n.recalculate=isTrue(t.getAttribute("Recalculate"))||"Condition"==n.trigger}else if("State"==n.type)if(isUndefined(t.getAttribute("Residency"))||""==t.getAttribute("Residency").trim())n.residency=null;else try{n.residency=evaluateTree(trimTree(createTree(t.getAttribute("Residency")),{}));n.residency.units||(n.residency.units=simulate.timeUnits);eq(n.residency,new Material(0,simulate.timeUnits))&&(n.residency=null)}catch(e){isLocal()&&console.log(e);throw{msg:getText("Invalid state residency."),primitive:t,showEditor:!1}}else if("Stock"==n.type){n.nonNegative=isTrue(t.getAttribute("NonNegative"));if("Conveyor"==t.getAttribute("StockMode")){n.stockType="Conveyor";try{n.delay=evaluateTree(trimTree(createTree(t.getAttribute("Delay")),{}));n.delay.units||(n.delay.units=simulate.timeUnits)}catch(e){isLocal()&&console.log(e);throw{msg:getText("Invalid stock delay."),primitive:t,showEditor:!1}}}}else if("Flow"==n.type)n.onlyPositive=isTrue(t.getAttribute("OnlyPositive"));else if("Converter"==n.type){n.source=t.getAttribute("Source");n.interpolation="Linear"==t.getAttribute("Interpolation")?"linear":"discrete";if(isUndefined(t.getAttribute("Data"))||""==t.getAttribute("Data").trim())throw{msg:getText("The converter %s does not have any data.","<i>"+clean(n.name)+"</i>"),primitive:t,showEditor:!0};var s,o=t.getAttribute("Data").split(";"),l=[],u=[];s="Time"==n.source?simulate.timeUnits:createUnitStore(orig(findID(n.source)).getAttribute("Units"));for(var h=0;h<o.length;h++){var c=o[h].split(",");l.push(new Material(sn(c[0].trim()),s));u.push(new Material(sn(c[1].trim())))}n.inputs=l;n.outputs=u}if("State"!=n.type){if("Transition"!=n.type&&"Action"!=n.type){var d=t.getAttribute("Units");try{if("Flow"!=n.type||d&&""!=d.trim()&&"unitless"!=d.trim().toLowerCase())n.units=createUnitStore(d);else{n.units=getUnitStore([timeUnits],[-1]);n.flowUnitless=!0}}catch(e){isLocal()&&console.log(e);throw{msg:getText('Invalid units specified for primitive: "%s".',clean(d)),primitive:t,showEditor:!0}}}else"Timeout"==n.trigger&&(n.units=simulate.timeUnits);n.maxConstraint=t.getAttribute("MaxConstraint");n.maxConstraintType=isTrue(t.getAttribute("MaxConstraintUsed"))?1:null;n.minConstraint=t.getAttribute("MinConstraint");n.minConstraintType=isTrue(t.getAttribute("MinConstraintUsed"))?1:null}if(n.units){n.units.addBase();n.toBase=n.units.toBase}else n.toBase=1;n.unitless=!n.units;return n}function folderSolvers(t,e){if(!t||null==t)return e.base;if("Agents"==t.value.nodeName){var n=t.getAttribute("Agent");if(e[n])return e[n]}var i=getParent(t);return i&&e[i.id]?e[i.id]:folderSolvers(i,e)}function decodeDNA(t,e){var n,i=t.type;"Variable"==i?n=new Variable:"State"==i?n=new State:"Transition"==i?n=new Transition:"Action"==i?n=new Action:"Stock"==i?n=new Stock:"Flow"==i?n=new Flow:"Converter"==i&&(n=new Converter);if(n){n.dna=t;n.id=t.id;n.index=e.index;n.agentId=e.agentId;n.container=e;n.createIds();n.frozen=t.frozen;e.children.push(n);e.childrenId[n.id]=n;t.slider&&(simulate.sliders[t.id]?simulate.sliders[t.id].push(n):simulate.sliders[t.id]=[n]);if(n instanceof Action)t.solver.actions.push(n);else if(n instanceof Transition)t.solver.transitions.push(n);else if(!(n instanceof Agents)){t.solver.valued.push(n);n instanceof Flow?t.solver.flows.push(n):n instanceof Stock?t.solver.stocks.push(n):n instanceof State&&t.solver.states.push(n)}}else if("Agents"==i){e.children.push(t.agents);e.childrenId[t.id]=t}}function linkPrimitive(t,e){var n=e.type;if("Agents"!=n){var i=getPrimitiveNeighborhood(t,e);if("Flow"==n||"Transition"==n){var r=null,a=null;if(i["[alpha"]){r=i["[alpha"];i.alpha||(i.alpha=r)}if(i["[omega"]){a=i["[omega"];i.omega||(i.omega=a)}t.setEnds(r,a)}if("Action"==n){try{t.equation=trimTree(e.triggerValue,i)}catch(t){var s=getText("The primitive %s has an equation error that must be corrected before the model can be run.","<i>["+clean(e.name)+"]</i>");t.substr&&"MSG:"==t.substr(0,4)&&(s+="<br/><br/>"+t.toString().substr(4));error(s,e.cell,!1,o)}try{t.action=trimTree(e.value,i)}catch(t){s=getText("The primitive %s has an equation error that must be corrected before the model can be run.","<i>["+clean(e.name)+"]</i>");t.substr&&"MSG:"==t.substr(0,4)&&(s+="<br/><br/>"+t.toString().substr(4));var o=void 0;t.match&&t.match(/line (\d+)/i)&&(o=t.match(/line (\d+)/i)[1]);error(s,e.cell,!0,o,t.match?t:void 0)}}else if("Converter"==n)if("Time"==e.source)t.setSource("*time");else{var l=orig(findID(e.source)).id,u=!1;for(var h in i)if(l==i[h].id){t.setSource(i[h]);u=!0;break}u||error("Converter source could not be found. Please redefine it.",e.cell,!1)}else t.setEquation(e.value,i)}}function setAgentInitialValues(t){for(var e=0;e<t.children.length;e++)if(t.children[e]instanceof Stock){t.children[e].setDelay();try{t.children[e].setInitialValue()}catch(n){isLocal()&&console.log(n);if(!(n instanceof String))throw n;error(n.substr(4,n.length),t.children[e],!0)}}else if(t.children[e]instanceof State)try{null===t.children[e].active&&t.children[e].setInitialActive(!0)}catch(n){isLocal()&&console.log(n);if(!(n instanceof String))throw n;error(n.substr(4,n.length),t.children[e],!0)}}function buildNetwork(t){if("Custom Function"==t.network)for(var e=getPrimitiveNeighborhood(t,t.dna),n=trimTree(createTree(t.networkFunction),e),i=0;i<t.agents.length-1;i++)for(var r=i+1;r<t.agents.length;r++)trueValue(simpleEquation(t.networkFunction,{"-parent":varBank,a:t.agents[i],b:t.agents[r]},e,n))&&t.agents[i].connect(t.agents[r]);else if("None"!=t.network)throw{msg:"Unknown network type: "+t.network+".",primitive:t.cell,showEditor:!1}}function buildPlacements(t,e){var n,i,r;if("Random"==t.placement)t.agents.forEach((function(e){e.location=new Vector([mult(t.geoWidth,new Material(Rand())),mult(t.geoHeight,new Material(Rand()))],["x","y"])}));else if("Custom Function"==t.placement)t.agents.forEach((function(e){var n=getPrimitiveNeighborhood(t,t.dna);n.self=e;e.location=simpleUnitsTest(simpleEquation(t.placementFunction,{"-parent":varBank,self:e},n),t.geoDimUnitsObject);if(!e.location.names){e.location.names=["x","y"];e.location.namesLC=["x","y"]}}));else if("Grid"==t.placement){n=trimTree(createTree("{x: x*width(self), y: y*height(self)}"),{});var a=t.agents.length,s=simpleNum(simpleEquation("width(self)/height(self)",{"-parent":varBank,self:t},{}),t.geoDimUnitsObject);r=Math.sqrt(a/s);i=Math.floor(r*s);!(r=Math.ceil(r))*i>=a&&(i+=1);var o=0;t.agents.forEach((function(e){var a=(o%i+.5)/i,s=(Math.floor(o/i)+.5)/r;e.location=simpleUnitsTest(simpleEquation("{x: x*width(self), y: y*height(self)}",{self:e,x:new Material(a),y:new Material(s),"-parent":varBank},{},n),t.geoDimUnitsObject);o++}))}else if("Ellipse"==t.placement){n=trimTree(createTree("{width(self), height(self)}/2+{sin(index(self)/size*2*3.14159), cos(index(self)/size*2*3.14159)}*{width(self), height(self)}/2"),{});a=new Material(t.agents.length);t.agents.forEach((function(e){e.location=simpleUnitsTest(simpleEquation("{width(self), height(self)}/2+{sin(index(self)/size*2*3.14159), cos(index(self)/size*2*3.14159)}*{width(self), heigh(self)}/2",{self:e,size:a,"-parent":varBank},{},n),t.geoDimUnitsObject)}))}else{if("Network"!=t.placement)throw{msg:"Unknown placement type: "+t.placement+".",primitive:t.cell,showEditor:!1};n=trimTree(createTree("{x: x*width(self), y: y*height(self)}"),{});var l=new Graph,u=t.agents.map((function(t){return l.newNode({data:t})})),h=function(t){for(var e=0;e<u.length;e++)if(u[e].data.data===t)return u[e];return null};t.agents.forEach((function(t){t.connected.forEach((function(e){l.newEdge(h(t),h(e))}))}));for(var c=new Layout.ForceDirected(l,400,600,.5),d=0;d<60;d++){c.applyCoulombsLaw();c.applyHookesLaw();c.attractToCentre();c.updateVelocity(.03);c.updatePosition(.03)}var m=c.getBoundingBox();m.width=m.topright.x-m.bottomleft.x;m.height=m.topright.y-m.bottomleft.y;c.eachNode((function(e,i){var r=function(t){return{x:(t.x-m.bottomleft.x)/m.width,y:(t.y-m.bottomleft.y)/m.height}}(i.p);e.data.data.location=simpleUnitsTest(simpleEquation("{x: x*width(self), y: y*height(self)}",{self:t,x:new Material(r.x),y:new Material(r.y),"-parent":varBank},{},n),t.geoDimUnitsObject)}))}}var allPlaceholders={};function getPrimitiveNeighborhood(t,e){var n=neighborhood(e.cell),i=allPlaceholders[e.id]?allPlaceholders[e.id]:{},r={self:t};if(!n.placeholders&&"Agents"==e.type)for(var a=0;a<t.DNAs.length;a++)i[t.DNAs[a].name.toLowerCase()]=new Placeholder(t.DNAs[a],t);for(var s=0;s<n.length;s++){var o=n[s].item;if("Agents"==o.value.nodeName){r[model.submodels[o.id].dna.name.toLowerCase()]=model.submodels[o.id];if(!n.placeholders)for(a=0;a<model.submodels[o.id].DNAs.length;a++)r[model.submodels[o.id].DNAs[a].name.toLowerCase()]=new Placeholder(model.submodels[o.id].DNAs[a],t)}else if("agent"!=n[s].type){var l=!1;if(t.container&&t.container.childrenId[o.id]){r[u=t.container.childrenId[o.id].dna.name.toLowerCase()]=t.container.childrenId[o.id];l=!0}if(!l&&model.submodels.base.agents[0].childrenId[o.id]){var u;r[u=model.submodels.base.agents[0].childrenId[o.id].dna.name.toLowerCase()]=model.submodels.base.agents[0].childrenId[o.id];l=!0}l||"Flow"!=e.type&&"Transition"!=e.type||o!=findID(o.id)||error(e.type+" primitives may not cross agent boundaries.",e.cell,!1);"Flow"!=e.type&&"Transition"!=e.type||r[u]&&(e.targetId==r[u].id?r["[omega"]=r[u]:e.sourceId==r[u].id&&(r["[alpha"]=r[u]))}}var h=Object.keys(i);for(a=0;a<h.length;a++)r[h[a]]=i[h[a]];allPlaceholders[e.id]=i;return r}function modelType(t){return!("Link"==t||"Picture"==t||"Text"==t||"Button"==t||"Folder"==t||"Setting"==t||"Display"==t||"Ghost"==t)}function updateDisplayed(t){var e=t?t.displayed:[];if(simulate.displayInformation.store){if(e.length>0){var n=[],i=t.maxLoaded;i=isDefined(i)?i+1:0;for(var r=t.maxLoaded,a=i;a<simulate.results.Time.length;a++){var s=simulate.displayInformation.store.getById(a),o={};if(!s){o.id=a;o.Time=simulate.results.Time[a]}if(isUndefined(simulate.results.data[a][e[0].id]));else{r=a;for(var l=0;l<e.length;l++){var u=simulate.displayInformation.ids.indexOf(e[l].id);if(u>-1)if(simulate.results[simulate.displayInformation.ids[u]].states){var h=simulate.results[simulate.displayInformation.ids[u]].states;if(simulate.results.data[a][e[l].id]){for(var c=simulate.results.data[a][e[l].id].current,d={},m=0;m<c.length;m++)if(c[m].state)for(var f=0;f<c[m].state.length;f++)d[c[m].state[f].id.toString()]=d[c[m].state[f].id.toString()]+1||1;for(m=0;m<h.length;m++)o[simulate.displayInformation.elementIds[u+m]]=d[h[m]]||0}}else if(simulate.results[simulate.displayInformation.ids[u]].indexedNames)for(var p=0;u<simulate.displayInformation.ids.length&&simulate.displayInformation.ids[u]==e[l].id;){try{o[simulate.displayInformation.elementIds[u]]=selectFromMatrix(simulate.results.data[a][e[l].id].fullClone(),simulate.results[simulate.displayInformation.ids[u]].indexedFullNames[p].slice())}catch(t){throw{msg:getText("Cannot change vector keys during a simulation."),primitive:e[l].dna.cell,showEditor:!0}}p++;u++}else o[simulate.displayInformation.elementIds[u]]=simulate.results.data[a][e[l].id]}}if(s){s.set(o);s.commit()}else n.push(o)}t.maxLoaded=r;simulate.displayInformation.store.maxLoaded=Math.max(simulate.displayInformation.store.maxLoaded,t.maxLoaded);simulate.displayInformation.store.suspendEvents();simulate.displayInformation.store.add(n);simulate.displayInformation.store.resumeEvents();simulate.displayInformation.store.filter()}if(!simulate.resultsWindow){simulate.resultsWindow=createResultsWindow(simulate.displayInformation,simulate.config);simulate.resultsWindow.scripter.loadTime(0);var g=-1==simulate.resultsWindow.scripter.combo.getValue()?200:100/Math.min(.5,simulate.resultsWindow.scripter.combo.getValue());f=simulate.resultsWindow.scripter;simulate.resultsWindow.scripter.animInter=setInterval((function(){f.advanceTimer()}),g)}simulate.resultsWindow.sliders=simulate.sliders;a==simulate.displayInformation.times.length&&simulate.resultsWindow.scripter.finished()}}module.exports={is_owner:is_owner,translations:translations,analysisCount:analysisCount,isSendingtoServer:isSendingtoServer,waitingToSendToServer:waitingToSendToServer,waitingToSendTimeout:waitingToSendTimeout,primitiveCache:primitiveCache,neighborhoodCache:neighborhoodCache,downloadButton:downloadButton,executeLayout:executeLayout,trusted:trusted,globalVarBank:globalVarBank,FormulaLexer:FormulaLexer,FormulaParser:FormulaParser,baseSources:baseSources,baseTargets:baseTargets,baseScalings:baseScalings,conScalings:conScalings,conTargets:conTargets,conSourceNames:conSourceNames,conUnitTargets:conUnitTargets,conSourceRegEx:conSourceRegEx,cachedUnits:cachedUnits,findSourceIndex:findSourceIndex,unitsBank:unitsBank,titleCaseReg:titleCaseReg,titleCaseFunc:titleCaseFunc,SchemeNumber:SchemeNumber,SchemeNumber:SchemeNumber,functionBank:functionBank,functionLoaders:functionLoaders,PrimitiveStore:PrimitiveStore,Primitive:Primitive,StringObject:StringObject,VectorObject:VectorObject,VectorBase:VectorBase,Vector:Vector,PB:PB,TreeNode:TreeNode,funcEvalMap:funcEvalMap,evaluatingLine:evaluatingLine,unitEvalMap:unitEvalMap,trimEvalMap:trimEvalMap,AgentObject:AgentObject,PrimitiveObject:PrimitiveObject,TaskId:TaskId,strictUnits:strictUnits,strictAgentResolution:strictAgentResolution,strictLinks:strictLinks,timeUnits:timeUnits,allPlaceholders:allPlaceholders,isLocal:isLocal,getText:getText,SimpleNode:SimpleNode,loadXML:loadXML,simpleCloneNode:simpleCloneNode,mxGraphToJson:mxGraphToJson,setAttributeUndoable:setAttributeUndoable,getGraphXml:getGraphXml,sendGraphtoServer:sendGraphtoServer,validPrimitiveName:validPrimitiveName,isPrimitive:isPrimitive,cellsContainNodename:cellsContainNodename,connectionType:connectionType,setAllConnectable:setAllConnectable,primitives:primitives,childrenCells:childrenCells,clearPrimitiveCache:clearPrimitiveCache,neighborhood:neighborhood,doubleArray:doubleArray,isValued:isValued,setSaveEnabled:setSaveEnabled,hasDisplay:hasDisplay,urlImage:urlImage,setPicture:setPicture,setLabelPosition:setLabelPosition,removeAgent:removeAgent,deletePrimitive:deletePrimitive,linkBroken:linkBroken,testConverterSource:testConverterSource,downloadModel:downloadModel,getSetting:getSetting,handelCursors:handelCursors,updateProperties:updateProperties,isTrue:isTrue,customUnits:customUnits,orig:orig,currentStyleIs:currentStyleIs,setStyles:setStyles,stringArray:stringArray,quickLabel:quickLabel,processLabel:processLabel,replaceAll:replaceAll,loadBackgroundColor:loadBackgroundColor,isUndefined:isUndefined,isDefined:isDefined,isTouch:isTouch,propagateGhosts:propagateGhosts,propagateName:propagateName,map:map,unitsUsedInModel:unitsUsedInModel,changeNodeName:changeNodeName,cmd:cmd,inAgent:inAgent,parentAgent:parentAgent,isGray:isGray,colourNameToHex:colourNameToHex,flatten:flatten,deepClone:deepClone,exportSvg:exportSvg,showMessage:showMessage,showPrompt:showPrompt,showChoice:showChoice,showURL:showURL,downloadFile:downloadFile,showData:showData,frontWindow:frontWindow,closeAllWindows:closeAllWindows,openFile:openFile,runModel:runModel,simulationRunning:simulationRunning,endRunningSimulation:endRunningSimulation,saveModel:saveModel,clearModel:clearModel,layoutModel:layoutModel,setZoom:setZoom,getTimeStep:getTimeStep,setTimeStep:setTimeStep,getTimeStart:getTimeStart,setTimeStart:setTimeStart,getTimeLength:getTimeLength,setTimeLength:setTimeLength,getPauseInterval:getPauseInterval,setPauseInterval:setPauseInterval,getTimeUnits:getTimeUnits,setTimeUnits:setTimeUnits,getAlgorithm:getAlgorithm,setAlgorithm:setAlgorithm,getMacros:getMacros,setMacros:setMacros,findName:findName,findAll:findAll,findType:findType,findID:findID,findValue:findValue,findNote:findNote,createPrimitive:createPrimitive,createConnector:createConnector,removePrimitive:removePrimitive,highlight:highlight,getSelected:getSelected,setSelected:setSelected,isSelected:isSelected,getID:getID,getType:getType,getName:getName,setName:setName,getUnits:getUnits,setUnits:setUnits,getConstraints:getConstraints,setConstraints:setConstraints,getNote:getNote,setNote:setNote,showNote:showNote,hideNote:hideNote,showEditor:showEditor,getValue:getValue,setValue:setValue,getSize:getSize,getPosition:getPosition,setPosition:setPosition,flash:flash,getShowSlider:getShowSlider,setShowSlider:setShowSlider,getSliderMin:getSliderMin,setSliderMin:setSliderMin,getSliderMax:getSliderMax,setSliderMax:setSliderMax,getSliderStep:getSliderStep,setSliderStep:setSliderStep,getOpacity:getOpacity,setOpacity:setOpacity,getLineColor:getLineColor,setLineColor:setLineColor,getFontColor:getFontColor,setFontColor:setFontColor,getFillColor:getFillColor,setFillColor:setFillColor,getImage:getImage,setImage:setImage,getNonNegative:getNonNegative,setNonNegative:setNonNegative,getStockType:getStockType,setStockType:setStockType,getDelay:getDelay,setDelay:setDelay,getEnds:getEnds,setEnds:setEnds,connected:connected,getResidency:getResidency,setResidency:setResidency,getTriggerType:getTriggerType,setTriggerType:setTriggerType,getTriggerValue:getTriggerValue,setTriggerValue:setTriggerValue,getTriggerRepeat:getTriggerRepeat,setTriggerRepeat:setTriggerRepeat,getTriggerRecalculate:getTriggerRecalculate,setTriggerRecalculate:setTriggerRecalculate,getData:getData,setData:setData,getConverterInput:getConverterInput,setConverterInput:setConverterInput,getInterpolation:getInterpolation,setInterpolation:setInterpolation,pressButton:pressButton,runAction:runAction,getPopulationSize:getPopulationSize,setPopulationSize:setPopulationSize,getAgentBase:getAgentBase,setAgentBase:setAgentBase,getGeometryWrap:getGeometryWrap,setGeometryWrap:setGeometryWrap,getGeometryUnits:getGeometryUnits,setGeometryUnits:setGeometryUnits,getGeometryWidth:getGeometryWidth,setGeometryWidth:setGeometryWidth,getGeometryHeight:getGeometryHeight,setGeometryHeight:setGeometryHeight,getAgentPlacement:getAgentPlacement,setAgentPlacement:setAgentPlacement,getAgentNetwork:getAgentNetwork,setAgentNetwork:setAgentNetwork,collapseFolder:collapseFolder,expandFolder:expandFolder,getCollapsed:getCollapsed,getParent:getParent,setParent:setParent,getFrozen:getFrozen,setFrozen:setFrozen,getChildren:getChildren,getFolderType:getFolderType,setFolderType:setFolderType,getFolderAgentParent:getFolderAgentParent,setFolderAgentParent:setFolderAgentParent,getFolderSolver:getFolderSolver,setFolderSolver:setFolderSolver,excludeType:excludeType,primitiveIndex:primitiveIndex,uniquePrimitives:uniquePrimitives,setGlobal:setGlobal,getGlobal:getGlobal,topBarShown:topBarShown,toggleTopBar:toggleTopBar,sideBarShown:sideBarShown,toggleSideBar:toggleSideBar,updateSideBar:updateSideBar,Simulator:Simulator,loadUnits:loadUnits,Material:Material,unitAlert:unitAlert,sortAndCollapseUnits:sortAndCollapseUnits,getUnitStore:getUnitStore,getUnitsId:getUnitsId,UnitStore:UnitStore,unitsFromString:unitsFromString,toTitleCase:toTitleCase,convertUnits:convertUnits,bootCalc:bootCalc,keysMatch:keysMatch,strictEquals:strictEquals,createTree:createTree,trimTree:trimTree,evaluateTree:evaluateTree,evaluate:evaluate,convertToObject:convertToObject,funAnd:funAnd,funOr:funOr,funXor:funXor,fNot:fNot,neq:neq,eq:eq,comparisonValid:comparisonValid,lessThan:lessThan,lessThanEq:lessThanEq,greaterThan:greaterThan,greaterThanEq:greaterThanEq,plus:plus,minus:minus,mult:mult,div:div,power:power,doMod:doMod,createMatrixSelector:createMatrixSelector,selectFromMatrix:selectFromMatrix,doBreakouts:doBreakouts,selectFromVector:selectFromVector,selectElementFromVector:selectElementFromVector,makeFunctionCall:makeFunctionCall,createSelector:createSelector,functionGenerator:functionGenerator,evaluateUnits:evaluateUnits,evaluateNode:evaluateNode,isConst:isConst,trimNode:trimNode,trueValue:trueValue,isLocal:isLocal,isUndefined:isUndefined,isDefined:isDefined,fireEvent:fireEvent,ObjToVec:ObjToVec,s:s,makeObjectBase:makeObjectBase,factorial:factorial,testArgumentsSize:testArgumentsSize,distance:distance,agent:agent,agents:agents,getPopulation:getPopulation,shiftLocation:shiftLocation,isUndefined:isUndefined,isDefined:isDefined,constraintAlert:constraintAlert,error:error,testPrimitive:testPrimitive,prepareDisplay:prepareDisplay,AggregateSeries:AggregateSeries,DataBank:DataBank,ExpGroup:ExpGroup,Primitive:Primitive,Placeholder:Placeholder,State:State,Transition:Transition,scheduleTrigger:scheduleTrigger,clearTrigger:clearTrigger,updateTrigger:updateTrigger,Action:Action,Agents:Agents,Agent:Agent,Stock:Stock,Converter:Converter,Variable:Variable,Flow:Flow,globalVars:globalVars,TaskQueue:TaskQueue,Task:Task,scheduleRepeated:scheduleRepeated,RedBlackNode:RedBlackNode,RedBlackTree:RedBlackTree,runSimulation:runSimulation,checkErr:checkErr,innerRunSimulation:innerRunSimulation,formatSimResults:formatSimResults,createUnitStore:createUnitStore,simpleEquation:simpleEquation,simpleNum:simpleNum,simpleUnitsTest:simpleUnitsTest,handleErrorObject:handleErrorObject,evaluateMacros:evaluateMacros,DNA:DNA,getDNA:getDNA,folderSolvers:folderSolvers,decodeDNA:decodeDNA,linkPrimitive:linkPrimitive,setAgentInitialValues:setAgentInitialValues,buildNetwork:buildNetwork,buildPlacements:buildPlacements,getPrimitiveNeighborhood:getPrimitiveNeighborhood,modelType:modelType,updateDisplayed:updateDisplayed};